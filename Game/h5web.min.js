
function float2int(t){return 0|t}function hexToArgb(t,e,i){return void 0===e&&(e=!0),void 0===i&&(i=null),i||(i=new Vector3D),i.w=e?255&t>>24:0,i.x=255&t>>16,i.y=255&t>>8,i.z=255&t,i}function hexToArgbNum(t,e,i){return void 0===e&&(e=!0),void 0===i&&(i=null),i=hexToArgb(t,e,i),i.scaleBy(1/255),i}function getBaseUrl(){return Scene_data.supportBlob?"":"_base"}function getRoleUrl(t){return"role/"+t+getBaseUrl()+".txt"}function getSkillUrl(t){return"skill/"+t+getBaseUrl()+".txt"}function getModelUrl(t){return"model/"+t+getBaseUrl()+".txt"}function init(){importScripts("Server.js"),server=new Server,server.worker=this}var BaseEvent=function(){function t(t){this.type=t}return t.COMPLETE="complete",t}(),EventDispatcher=function(){function t(){this._eventsMap=null}return t.prototype.addEventListener=function(t,e,i){this._eventsMap||(this._eventsMap={});var n=this._eventsMap[t];n||(n=this._eventsMap[t]=[]);for(var a={listener:e,thisObject:i},s=0;n.length>s;s++){var o=n[s];if(o.listener==e&&o.thisObject==i)return}n.push(a)},t.prototype.removeEventListener=function(t,e,i){for(var n=this._eventsMap[t],a=0;n.length>a;a++){var s=n[a];if(s.listener==e&&s.thisObject==i)return n.splice(a,1),void 0}},t.prototype.dispatchEvent=function(t){var e=this._eventsMap;if(!e)return!0;var i=e[t.type];if(!i)return!0;var n=i.length;if(0==n)return!0;t.target=this;for(var a=0;n>a;a++){var s=i[a];s.listener.call(s.thisObject,t)}},t}(),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Object3D=function(t){function e(e,i,n){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),t.call(this),this._x=e,this._y=i,this._z=n,this._scaleX=1,this._scaleY=1,this._scaleZ=1,this._rotationX=0,this._rotationY=0,this._rotationZ=0,this.posMatrix=new Matrix3D}return __extends(e,t),e.prototype.toString=function(){return"Object3D("+(this._x+"")+","+(this._y+"")+","+(this._z+"")+")"},Object.defineProperty(e.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this.updateMatrix()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this.updateMatrix()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"z",{get:function(){return this._z},set:function(t){this._z=t,this.updateMatrix()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scale",{set:function(t){this._scaleX=this._scaleY=this._scaleZ=t,this.updateMatrix()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleX",{get:function(){return this._scaleX},set:function(t){this._scaleX=t,this.updateMatrix()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleY",{get:function(){return this._scaleY},set:function(t){this._scaleY=t,this.updateMatrix()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleZ",{get:function(){return this._scaleZ},set:function(t){this._scaleZ=t,this.updateMatrix()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationX",{get:function(){return this._rotationX},set:function(t){this._rotationX=t,this.updateMatrix(),this.updateRotationMatrix()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationY",{get:function(){return this._rotationY},set:function(t){this._rotationY=t,this.updateMatrix(),this.updateRotationMatrix()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationZ",{get:function(){return this._rotationZ},set:function(t){this._rotationZ=t,this.updateMatrix(),this.updateRotationMatrix()},enumerable:!0,configurable:!0}),e.prototype.updateMatrix=function(){this.posMatrix.identity(),this.posMatrix.appendScale(this._scaleX,this._scaleY,this._scaleZ),this.posMatrix.appendRotation(this._rotationX,Vector3D.X_AXIS),this.posMatrix.appendRotation(this._rotationY,Vector3D.Y_AXIS),this.posMatrix.appendRotation(this._rotationZ,Vector3D.Z_AXIS),this.posMatrix.appendTranslation(this._x,this._y,this._z)},e.prototype.updateRotationMatrix=function(){},e}(EventDispatcher),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Camera3D=function(t){function e(){t.call(this),this.distance=500,this.cameraMatrix=new Matrix3D}return __extends(e,t),e.prototype.lookAt=function(t){this.lookAtTarget=t},e.prototype.update=function(){this.lookAtTarget&&(Scene_data.focus3D.x=this.lookAtTarget.x,Scene_data.focus3D.y=this.lookAtTarget.y,Scene_data.focus3D.z=this.lookAtTarget.z)},e}(Object3D),ObjData=function(){function t(){this.vertices=[],this.uvs=[],this.indexs=[],this.lightuvs=[],this.normals=[],this.tangents=[],this.bitangents=[],this.treNum=0}return t}(),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},MeshData=function(t){function e(){t.apply(this,arguments),this.bonetIDAry=[],this.boneWeightAry=[],this.boneNewIDAry=[],this.particleAry=[]}return __extends(e,t),e}(ObjData),BindParticle=function(){function t(t,e){this.url=t,this.socketName=e}return t}(),Dictionary=function(){function t(t){this._keys=[],this._values=[];for(var e=0;t.length>e;e++)this[t[e].key]=t[e].value,this._keys.push(t[e].key),this._values.push(t[e].value)}return t.prototype.add=function(t,e){this[t]=e,this._keys.push(t),this._values.push(e)},t.prototype.remove=function(t){var e=this._keys.indexOf(t,0);this._keys.splice(e,1),this._values.splice(e,1),delete this[t]},t.prototype.keys=function(){return this._keys},t.prototype.values=function(){return this._values},t.prototype.containsKey=function(t){return this[t]===void 0?!1:!0},t.prototype.toLookup=function(){return this},t}(),Context3D=function(){function t(){}return t.prototype.init=function(t){var e=t.getContext("webgl",{stencil:!0,alpha:!0,depth:!0,antialias:!1})||t.getContext("experimental-webgl",{stencil:!0,alpha:!0,depth:!0,antialias:!1});this.renderContext=e},t.prototype.resetSize=function(t,e){this.renderContext.viewport(0,0,t,e)},t.prototype.uploadBuff3D=function(t){var e=this.renderContext.createBuffer();return this.renderContext.bindBuffer(this.renderContext.ARRAY_BUFFER,e),this.renderContext.bufferData(this.renderContext.ARRAY_BUFFER,new Float32Array(t),this.renderContext.STATIC_DRAW),e},t.prototype.uploadBuff3DByBuffer=function(t,e){this.renderContext.bindBuffer(this.renderContext.ARRAY_BUFFER,t),this.renderContext.bufferData(this.renderContext.ARRAY_BUFFER,new Float32Array(e),this.renderContext.STATIC_DRAW)},t.prototype.uploadIndexBuff3D=function(t){var e=this.renderContext.createBuffer();return this.renderContext.bindBuffer(this.renderContext.ELEMENT_ARRAY_BUFFER,e),this.renderContext.bufferData(this.renderContext.ELEMENT_ARRAY_BUFFER,new Uint16Array(t),this.renderContext.STATIC_DRAW),e},t.prototype.uploadIndexBuff3DByBuffer=function(t,e){this.renderContext.bindBuffer(this.renderContext.ELEMENT_ARRAY_BUFFER,t),this.renderContext.bufferData(this.renderContext.ELEMENT_ARRAY_BUFFER,new Uint16Array(e),this.renderContext.STATIC_DRAW)},t.prototype.update=function(){this.renderContext.bindFramebuffer(this.renderContext.FRAMEBUFFER,null),this.renderContext.clearColor(63/255,63/255,63/255,1),this.renderContext.clearDepth(1),this.renderContext.clearStencil(0),this.renderContext.enable(this.renderContext.DEPTH_TEST),this.renderContext.depthMask(!0),this.renderContext.enable(this.renderContext.BLEND),this.renderContext.frontFace(this.renderContext.CW),this.renderContext.clear(this.renderContext.COLOR_BUFFER_BIT|this.renderContext.DEPTH_BUFFER_BIT|this.renderContext.STENCIL_BUFFER_BIT),this.renderContext.blendFunc(this.renderContext.SRC_ALPHA,this.renderContext.ONE_MINUS_SRC_ALPHA),this.setBlendParticleFactors(0)},t.prototype.setDepthTest=function(t){t?this.renderContext.enable(this.renderContext.DEPTH_TEST):this.renderContext.disable(this.renderContext.DEPTH_TEST)},t.prototype.setWriteDepth=function(t){this.renderContext.depthMask(t)},t.prototype.setBlendParticleFactors=function(t){switch(t){case 0:this.renderContext.blendFunc(this.renderContext.ONE,this.renderContext.ONE_MINUS_SRC_ALPHA);break;case 1:this.renderContext.blendFunc(this.renderContext.ONE,this.renderContext.ONE);break;case 2:this.renderContext.blendFunc(this.renderContext.DST_COLOR,this.renderContext.ZERO);break;case 3:this.renderContext.blendFunc(this.renderContext.ONE,this.renderContext.ONE_MINUS_SRC_COLOR);break;case 4:this.renderContext.blendFunc(this.renderContext.SRC_ALPHA,this.renderContext.ONE);break;case-1:this.renderContext.blendFunc(this.renderContext.SRC_ALPHA,this.renderContext.ONE_MINUS_SRC_ALPHA)}},t.prototype.setProgram=function(t){this.renderContext.useProgram(t)},t.prototype.getLocation=function(t,e){return this.renderContext.getUniformLocation(t,e)},t.prototype.setVcMatrix3fv=function(t,e,i){this.renderContext.uniformMatrix3fv(this.renderContext.getUniformLocation(t,e),!1,i)},t.prototype.setVcMatrix4fv=function(t,e,i){this.renderContext.uniformMatrix4fv(this.renderContext.getUniformLocation(t,e),!1,i)},t.prototype.setVcMatrix4fvLocation=function(t,e){this.renderContext.uniformMatrix4fv(t,!1,e)},t.prototype.setVc4fv=function(t,e,i){this.renderContext.uniform4fv(this.renderContext.getUniformLocation(t,e),i)},t.prototype.setVc4fvLocation=function(t,e){this.renderContext.uniform4fv(t,e)},t.prototype.setVc3fv=function(t,e,i){this.renderContext.uniform3fv(this.renderContext.getUniformLocation(t,e),i)},t.prototype.setVc2fv=function(t,e,i){this.renderContext.uniform2fv(this.renderContext.getUniformLocation(t,e),i)},t.prototype.setVcFloat=function(t,e,i){this.renderContext.uniform1fv(this.renderContext.getUniformLocation(t,e),i)},t.prototype.setVa=function(t,e,i){this.renderContext.bindBuffer(this.renderContext.ARRAY_BUFFER,i),this.renderContext.enableVertexAttribArray(t),this.renderContext.vertexAttribPointer(t,e,this.renderContext.FLOAT,!1,0,0)},t.prototype.drawCall=function(t,e){this.renderContext.bindBuffer(this.renderContext.ELEMENT_ARRAY_BUFFER,t),this.renderContext.drawElements(this.renderContext.TRIANGLES,e,this.renderContext.UNSIGNED_SHORT,0)},t.prototype.drawLine=function(t,e){this.renderContext.bindBuffer(this.renderContext.ELEMENT_ARRAY_BUFFER,t),this.renderContext.drawElements(this.renderContext.LINES,e,this.renderContext.UNSIGNED_SHORT,0)},t.prototype.setRenderTexture=function(t,e,i,n){0==n?this.renderContext.activeTexture(this.renderContext.TEXTURE0):1==n?this.renderContext.activeTexture(this.renderContext.TEXTURE1):2==n?this.renderContext.activeTexture(this.renderContext.TEXTURE2):3==n?this.renderContext.activeTexture(this.renderContext.TEXTURE3):4==n?this.renderContext.activeTexture(this.renderContext.TEXTURE4):5==n?this.renderContext.activeTexture(this.renderContext.TEXTURE5):6==n&&this.renderContext.activeTexture(this.renderContext.TEXTURE6),this.renderContext.bindTexture(this.renderContext.TEXTURE_2D,i),this.renderContext.uniform1i(this.renderContext.getUniformLocation(t,e),n)},t.prototype.setRenderTextureCube=function(t,e,i,n){0==n?this.renderContext.activeTexture(this.renderContext.TEXTURE0):1==n?this.renderContext.activeTexture(this.renderContext.TEXTURE1):2==n?this.renderContext.activeTexture(this.renderContext.TEXTURE2):3==n?this.renderContext.activeTexture(this.renderContext.TEXTURE3):4==n?this.renderContext.activeTexture(this.renderContext.TEXTURE4):5==n?this.renderContext.activeTexture(this.renderContext.TEXTURE5):6==n&&this.renderContext.activeTexture(this.renderContext.TEXTURE6),this.renderContext.bindTexture(this.renderContext.TEXTURE_CUBE_MAP,i),this.renderContext.uniform1i(this.renderContext.getUniformLocation(t,e),n)},t.prototype.updateTexture=function(t,e,i,n){this.renderContext.bindTexture(this.renderContext.TEXTURE_2D,t),this.renderContext.texSubImage2D(this.renderContext.TEXTURE_2D,0,e,i,this.renderContext.RGBA,this.renderContext.UNSIGNED_BYTE,n)},t.prototype.getTexture=function(t,e,i,n){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0);var a=this.renderContext.createTexture();this.renderContext.bindTexture(this.renderContext.TEXTURE_2D,a),this.renderContext.texImage2D(this.renderContext.TEXTURE_2D,0,this.renderContext.RGBA,this.renderContext.RGBA,this.renderContext.UNSIGNED_BYTE,t);var s;s=0==i?this.renderContext.LINEAR:this.renderContext.NEAREST;var o;return 0==i?0==n?o=this.renderContext.LINEAR:1==n?o=this.renderContext.LINEAR_MIPMAP_NEAREST:2==n&&(o=this.renderContext.LINEAR_MIPMAP_LINEAR):0==n?o=this.renderContext.NEAREST:1==n?o=this.renderContext.NEAREST_MIPMAP_NEAREST:2==n&&(o=this.renderContext.NEAREST_MIPMAP_LINEAR),this.renderContext.texParameteri(this.renderContext.TEXTURE_2D,this.renderContext.TEXTURE_MAG_FILTER,s),this.renderContext.texParameteri(this.renderContext.TEXTURE_2D,this.renderContext.TEXTURE_MIN_FILTER,o),0==e?(this.renderContext.texParameteri(this.renderContext.TEXTURE_2D,this.renderContext.TEXTURE_WRAP_S,this.renderContext.REPEAT),this.renderContext.texParameteri(this.renderContext.TEXTURE_2D,this.renderContext.TEXTURE_WRAP_T,this.renderContext.REPEAT)):(this.renderContext.texParameteri(this.renderContext.TEXTURE_2D,this.renderContext.TEXTURE_WRAP_S,this.renderContext.CLAMP_TO_EDGE),this.renderContext.texParameteri(this.renderContext.TEXTURE_2D,this.renderContext.TEXTURE_WRAP_T,this.renderContext.CLAMP_TO_EDGE)),0!=n&&this.renderContext.generateMipmap(this.renderContext.TEXTURE_2D),a},t.prototype.creatTexture=function(t,e,i){void 0===i&&(i=0);var n=this.renderContext.createTexture();return this.renderContext.bindTexture(this.renderContext.TEXTURE_2D,n),this.renderContext.texParameteri(this.renderContext.TEXTURE_2D,this.renderContext.TEXTURE_MAG_FILTER,this.renderContext.LINEAR),this.renderContext.texParameteri(this.renderContext.TEXTURE_2D,this.renderContext.TEXTURE_MIN_FILTER,this.renderContext.LINEAR),0==i?(this.renderContext.texParameteri(this.renderContext.TEXTURE_2D,this.renderContext.TEXTURE_WRAP_S,this.renderContext.REPEAT),this.renderContext.texParameteri(this.renderContext.TEXTURE_2D,this.renderContext.TEXTURE_WRAP_T,this.renderContext.REPEAT)):(this.renderContext.texParameteri(this.renderContext.TEXTURE_2D,this.renderContext.TEXTURE_WRAP_S,this.renderContext.CLAMP_TO_EDGE),this.renderContext.texParameteri(this.renderContext.TEXTURE_2D,this.renderContext.TEXTURE_WRAP_T,this.renderContext.CLAMP_TO_EDGE)),this.renderContext.texImage2D(this.renderContext.TEXTURE_2D,0,this.renderContext.RGB,t,e,0,this.renderContext.RGB,this.renderContext.UNSIGNED_BYTE,null),n},t.prototype.createFramebuffer=function(){var t=this.renderContext.createFramebuffer();return this.renderContext.bindFramebuffer(this.renderContext.FRAMEBUFFER,t),t},t}(),Scene_data=function(){function t(){}return Object.defineProperty(t,"viewMatrx3D",{get:function(){return t._viewMatrx3D},set:function(e){t._viewMatrx3D=e},enumerable:!0,configurable:!0}),t.sceneViewHW=500,t.fileRoot="res/",t.verticalScene=!1,t.frameTime=1e3/60,t.MAX_NUMBER=1e7,t.user=0,t.scaleLight=[2],t.supportBlob=!1,t}(),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Display3D=function(t){function e(){t.call(this),this.sceneVisible=!0,this._onStage=!1}return __extends(e,t),e.prototype.update=function(){},Object.defineProperty(e.prototype,"onStage",{get:function(){return this._onStage},enumerable:!0,configurable:!0}),e.prototype.addStage=function(){this._onStage=!0},e.prototype.removeStage=function(){this._onStage=!1},e}(Object3D),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Display3DSprite=function(t){function e(){t.call(this),this.time=0,this._rotationMatrix=new Matrix3D,this.lightMapTexture=TextureManager.getInstance().defaultLightMap}return __extends(e,t),e.prototype.setObjUrl=function(t){var e=this;this.objurl=t,ObjDataManager.getInstance().getObjData(Scene_data.fileRoot+t,function(t){e.objData=t,e.material&&(e.objData.tangentBuffer||ObjDataManager.getInstance().creatTBNBuffer(e.objData))})},e.prototype.setPicUrl=function(t){var e=this;this.picUrl=t,TextureManager.getInstance().getTexture(t,function(t){e.baseTexture=t})},e.prototype.setLightMapUrl=function(t){var e=this;if(t&&""!=t){var i=Scene_data.fileRoot+t;TextureManager.getInstance().getTexture(i,function(t){e.lightMapTexture=t})}},e.prototype.setMaterialUrl=function(t){var e=this;this.materialUrl=Scene_data.fileRoot+t;var i=new MaterialShader;MaterialManager.getInstance().getMaterial(this.materialUrl,function(t){e.material=t,e.material.useNormal&&e.objData&&!e.objData.tangentBuffer&&ObjDataManager.getInstance().creatTBNBuffer(e.objData),(e.material.usePbr||e.material.directLight)&&(e._rotationData=new Float32Array(9),e.updateRotationMatrix())},null,!0,i.name,i)},Object.defineProperty(e.prototype,"lightProbe",{get:function(){return this._lightProbe},set:function(t){if(this._lightProbe=t,this._lightProbe&&!this.resultSHVec){this.resultSHVec=[];for(var e=[.4444730390920146,-.3834955622240026,-.33124467509627725,.09365654209093091,-.05673310882817577,.2120523322966496,.02945768486978205,-.04965996229802928,-.1136529129285836],i=0;9>i;i++)this.resultSHVec.push(new Vector3D(e[i],e[i],e[i]))}},enumerable:!0,configurable:!0}),e.prototype.update=function(){if(this.sceneVisible){return this.updateMaterial(),void 0}},e.prototype.updateMaterial=function(){this.material&&this.objData&&(this.updateBind(),Scene_data.context3D.setProgram(this.material.program),Scene_data.context3D.setVcMatrix4fv(this.material.program,"posMatrix3D",this.posMatrix.m),this.setCam(),this.setBaseMaterialVc(this.material),this.setMaterialVc(this.material),this.setMaterialTexture(this.material),this.setDirectLight(this.material),this.setMaterialVa(),Scene_data.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum))},e.prototype.setMaterialVa=function(){Scene_data.context3D.setVa(0,3,this.objData.vertexBuffer),Scene_data.context3D.setVa(1,2,this.objData.uvBuffer),this.material.directLight||Scene_data.context3D.setVa(2,2,this.objData.lightUvBuffer),(this.material.usePbr||this.material.directLight)&&(Scene_data.context3D.setVa(3,3,this.objData.normalsBuffer),Scene_data.context3D.setVcMatrix3fv(this.material.program,"rotationMatrix3D",this._rotationData)),this.material.useNormal&&(Scene_data.context3D.setVa(4,3,this.objData.tangentBuffer),Scene_data.context3D.setVa(5,3,this.objData.bitangentBuffer))},e.prototype.setDirectLight=function(t){t.directLight&&(Scene_data.context3D.setVc3fv(t.program,"ambientColor",Scene_data.light.ambientColor),Scene_data.context3D.setVc3fv(t.program,"sunDirect",Scene_data.light.sunDirect),Scene_data.context3D.setVc3fv(t.program,"sunColor",Scene_data.light.sunColor))},e.prototype.setCam=function(){Scene_data.context3D.setVcMatrix4fv(this.material.program,"viewMatrix3D",Scene_data.viewMatrx3D.m),Scene_data.context3D.setVcMatrix4fv(this.material.program,"camMatrix3D",Scene_data.cam3D.cameraMatrix.m)},e.prototype.setBind=function(t,e){this.bindTarget=t,this.bindSocket=e,this.bindMatrix=new Matrix3D},e.prototype.setGroup=function(t,e,i){this._isInGroup=!0,this._groupPos=t,this._groupRotation=e,this._groupScale=i,this.groupMatrix=new Matrix3D,this.groupRotationMatrix=new Matrix3D,this.groupMatrix.isIdentity=!1,this.groupMatrix.identity(),this.groupMatrix.appendScale(i.x,i.y,i.z),this.groupMatrix.appendRotation(e.x,Vector3D.X_AXIS),this.groupMatrix.appendRotation(e.y,Vector3D.Y_AXIS),this.groupMatrix.appendRotation(e.z,Vector3D.Z_AXIS),this.groupMatrix.appendTranslation(t.x,t.y,t.z),this.groupRotationMatrix.isIdentity=!1,this.groupRotationMatrix.identity(),this.groupRotationMatrix.prependRotation(e.z,Vector3D.Z_AXIS),this.groupRotationMatrix.prependRotation(e.y,Vector3D.Y_AXIS),this.groupRotationMatrix.prependRotation(e.x,Vector3D.X_AXIS)},e.prototype.updateBind=function(){this.bindTarget&&(this.posMatrix.identity(),this._isInGroup&&this.posMatrix.append(this.groupMatrix),this.bindTarget.getSocket(this.bindSocket,this.bindMatrix),this.posMatrix.append(this.bindMatrix),this.bindMatrix.copyTo(this._rotationMatrix),this._rotationMatrix.identityPostion(),this._isInGroup&&this._rotationMatrix.prepend(this.groupRotationMatrix))},e.prototype.setBaseMaterialVc=function(t){var e=0;t.hasTime&&(e=.001*(TimeUtil.getTimer()-this.time)),(t.hasTime||t.usePbr||t.useKill)&&Scene_data.context3D.setVc4fv(t.program,"fc0",[1,0,t.killNum,e]),t.scaleLightMap&&Scene_data.context3D.setVcFloat(t.program,"scalelight",Scene_data.scaleLight),t.usePbr&&this.setCamPos(t)},e.prototype.setCamPos=function(t){Scene_data.context3D.setVc4fv(t.program,"fc2",[Scene_data.cam3D.x,Scene_data.cam3D.y,Scene_data.cam3D.z,1])},e.prototype.setMaterialVc=function(t){for(var e=t.constList,i=0;e.length>i;i++)Scene_data.context3D.setVc4fv(t.program,e[i].name,e[i].vecNum)},e.prototype.setMaterialTexture=function(t){for(var e=t.texList,i=0;e.length>i;i++)if(e[i].type==TexItem.LIGHTMAP)Scene_data.context3D.setRenderTexture(t.program,e[i].name,this.lightMapTexture,e[i].id);else if(e[i].type==TexItem.LTUMAP&&Scene_data.pubLut)Scene_data.context3D.setRenderTexture(t.program,e[i].name,Scene_data.pubLut,e[i].id);else if(e[i].type==TexItem.CUBEMAP)if(t.useDynamicIBL);else{var n=Math.floor(5*t.roughness);if(Scene_data.skyCubeMap){var a=Scene_data.skyCubeMap[n];Scene_data.context3D.setRenderTextureCube(t.program,e[i].name,a,e[i].id)}}else Scene_data.context3D.setRenderTexture(t.program,e[i].name,e[i].texture,e[i].id)},e.prototype.checkMaterialTexture=function(t){for(var e=t.texList,i=0;e.length>i;i++)if(e[i].type==TexItem.LIGHTMAP){if(!this.lightMapTexture)return!1}else if(e[i].type==TexItem.LTUMAP){if(!Scene_data.pubLut)return!1}else if(e[i].type==TexItem.CUBEMAP){if(t.useDynamicIBL);else if(!Scene_data.skyCubeMap)return!1}else if(!e[i].texture)return!1;return!0},e.prototype.updateRotationMatrix=function(){this._rotationMatrix.identity(),this._rotationMatrix.appendRotation(this._rotationX,Vector3D.X_AXIS),this._rotationMatrix.appendRotation(this._rotationY,Vector3D.Y_AXIS),this._rotationMatrix.appendRotation(this._rotationZ,Vector3D.Z_AXIS),this._rotationData&&this._rotationMatrix.getRotaion(this._rotationData)},e.prototype.setPos=function(t){this.x=t.x,this.y=t.y+10,this.z=t.z},e}(Display3D),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Display3DSky=function(t){function e(){t.call(this),this.program=ProgrmaManager.getInstance().getProgram(SkyShader.Sky_Shader)}return __extends(e,t),e.prototype.setObjUrl=function(t){var e=this;this.objurl=t,ObjDataManager.getInstance().getObjData(Scene_data.fileRoot+t,function(t){e.objData=t})},e.prototype.setCubeUrl=function(t){var e=this;TextureManager.getInstance().loadCubeTexture(t,function(t){e.cubeTextList=t})},e.prototype.update=function(){Scene_data.context3D.setProgram(this.program),Scene_data.context3D.setVcMatrix4fv(this.program,"viewMatrix3D",Scene_data.viewMatrx3D.m),Scene_data.context3D.setVcMatrix4fv(this.program,"camMatrix3D",Scene_data.cam3D.cameraMatrix.m),Scene_data.context3D.setVcMatrix4fv(this.program,"posMatrix3D",this.posMatrix.m),this.cubeTextList&&Scene_data.context3D.setRenderTextureCube(this.program,"s_texture",this.cubeTextList[0],0),Scene_data.context3D.setVa(0,3,this.objData.vertexBuffer),Scene_data.context3D.setVa(1,3,this.objData.normalsBuffer),Scene_data.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum)},e}(Display3D),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Display3dMovie=function(t){function e(){t.call(this),this._completeState=0,this._defaultAction="stand",this._curentFrame=0,this._time=0,this._fileScale=1,this._nextScale=1,this.locationDic={},this._animDic={},this._partDic={},this._preLoadActionDic={},this._waitLoadActionDic={},this.showCapsule=!1,this._enablePhysics=!1}return __extends(e,t),e.prototype.setRoleUrl=function(t,e){var i=this;void 0===e&&(e=1),ResManager.getInstance().loadRoleRes(Scene_data.fileRoot+t,function(t){i.roleResCom(t,e)},e)},e.prototype.roleResCom=function(t,e){var i=this;this._roleRes=t,this._roleRes.useNum++,this._meshUrl=this._roleRes.roleUrl,MeshDataManager.getInstance().getMeshData(this._meshUrl,function(t){i._skinMesh=t,1!=e&&(i._skinMesh.type=1);for(var n in i._animDic)i.processAnimByMesh(i._animDic[n]);t.loadMaterial(function(t){i.loadMaterialCom(t)}),t.loadParticle(i),i.fileScale=t.fileScale},e);for(var n=this._roleRes.actionAry,a=0;n.length>a;a++)this.addAction(n[a],this._roleRes.roleUrl+n[a])},e.prototype.setMeshUrl=function(t,e){var i=this;void 0===e&&(e=1),this._meshUrl=Scene_data.fileRoot+t,MeshDataManager.getInstance().getMeshData(this._meshUrl,function(t){i._skinMesh=t,1!=e&&(i._skinMesh.type=1);for(var n in i._animDic)i.processAnimByMesh(i._animDic[n]);t.loadMaterial(function(t){i.loadMaterialCom(t)}),t.loadParticle(i),i.fileScale=t.fileScale},e)},Object.defineProperty(e.prototype,"scale",{get:function(){return this._nextScale},set:function(t){this._nextScale=t,this._scaleX=t*this._fileScale,this._scaleY=t*this._fileScale,this._scaleZ=t*this._fileScale,this.updateMatrix()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fileScale",{set:function(t){this._fileScale=t,this._scaleX*=t,this._scaleY*=t,this._scaleZ*=t,this.updateMatrix()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shadow",{set:function(t){t?this._shadow||(this._shadow=ShadowManager.getInstance().addShadow()):this._shadow&&ShadowManager.getInstance().removeShadow(this._shadow)},enumerable:!0,configurable:!0}),e.prototype.setShadowSize=function(t){this._shadow&&(this._shadow.size=t)},e.prototype.addStage=function(){t.prototype.addStage.call(this),this._shadow&&(this._shadow.visible=!0)},e.prototype.removeStage=function(){t.prototype.removeStage.call(this),this._shadow&&(this._shadow.visible=!1)},e.prototype.loadMaterialCom=function(t){t.lightProbe&&(this.lightProbe=!0)},e.prototype.setCollision=function(){},e.prototype.addPart=function(t,e,i,n){var a=this;void 0===n&&(n=0),this._partDic[t]||(this._partDic[t]=[]);var s=this._partDic[t];if(0==n)LoadManager.getInstance().load(Scene_data.fileRoot+i,LoadManager.BYTE_TYPE,function(t){a.loadPartInfoCom(t,e,s)});else if(1==n){var o=ParticleManager.getInstance().getParticle(i);s.push(o),o.bindTarget=this,o.bindSocket=e,ParticleManager.getInstance().addParticle(o)}},e.prototype.loadPartInfoCom=function(t,e,i){for(var n=new egret.ByteArray(t),a=n.readInt(),s=0;a>s;s++){var o,r=n.readInt(),h=n.readUTF();1==r&&(o=n.readUTF());var c,l,u,d=n.readBoolean();if(d&&(c=new Vector3D(n.readFloat(),n.readFloat(),n.readFloat()),l=new Vector3D(n.readFloat(),n.readFloat(),n.readFloat()),u=new Vector3D(n.readFloat(),n.readFloat(),n.readFloat())),0==r){var p=ParticleManager.getInstance().getParticle(h);i.push(p),p.bindTarget=this,p.bindSocket=e,ParticleManager.getInstance().addParticle(p),d&&p.setGroup(c,l,u)}else if(1==r){var _=new Display3DSprite;_.setObjUrl(h),_.setMaterialUrl(o),i.push(_),_.setBind(this,e),SceneManager.getInstance().addDisplay(_),d&&_.setGroup(c,l,u)}}},e.prototype.getSocket=function(t,e){if(e.identity(),!this._skinMesh||!this._skinMesh.boneSocketDic[t])return e.append(this.posMatrix),void 0;var i,n=this._skinMesh.boneSocketDic[t],a=n.index;i=this.getFrameMatrix(a),e.appendScale(1/this._scaleX,1/this._scaleY,1/this._scaleZ),e.appendRotation(n.rotationX,Vector3D.X_AXIS),e.appendRotation(n.rotationY,Vector3D.Y_AXIS),e.appendRotation(n.rotationZ,Vector3D.Z_AXIS),e.appendTranslation(n.x,n.y,n.z),i&&(e.append(this._skinMesh.bindPosInvertMatrixAry[a]),e.append(i)),e.append(this.posMatrix)},e.prototype.getSunType=function(){return 0},e.prototype.getFrameMatrix=function(t){if(this._animDic[this._curentAction]){var e=this._animDic[this._curentAction];return e.matrixAry[this._curentFrame][t]}if(this._animDic[this._defaultAction]){var e=this._animDic[this._defaultAction];return e.matrixAry[this._curentFrame][t]}return null},e.prototype.addAction=function(t,e,i){void 0===i&&(i=!1),this._preLoadActionDic[t]=e,t==this._defaultAction||t==this._curentAction?this.setAnimUrl(t,e):i&&this.setAnimUrl(t,e)},e.prototype.setAnimUrl=function(t,e){var i=this;this._waitLoadActionDic[t]=!0,AnimManager.getInstance().getAnimData(e,function(e){i._animDic[t]=e,i.processAnimByMesh(e),i._waitLoadActionDic[t]=!1})},e.prototype.play=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=!0),this._curentAction!=t?(this._curentAction=t,this._completeState=e,this._time=0,this.updateFrame(0),this._animDic.hasOwnProperty(t)?!0:(!this._waitLoadActionDic[t]&&this._preLoadActionDic[t]&&this.setAnimUrl(t,this._preLoadActionDic[t]),!1)):void 0},e.prototype.processAnimByMesh=function(t){if(this._skinMesh&&!t.hasProcess){for(var e=0;t.matrixAry.length>e;e++)for(var i=t.matrixAry[e],n=0;i.length>n;n++)i[n].prepend(this._skinMesh.bindPosMatrixAry[n]);t.hasProcess=!0}},e.prototype.update=function(){if(this._skinMesh){this.lightProbe&&(this.resultSHVec=LightProbeManager.getInstance().getData(new Vector3D(this.x,this.y+10,this.z)));for(var t=0;this._skinMesh.meshAry.length>t;t++)this.updateMaterialMesh(this._skinMesh.meshAry[t]);this.showCapsule&&this.updateShowCapsule()}},e.prototype.updateFrame=function(t){this._time+=t;var e;if(this._curentAction&&this._animDic[this._curentAction])e=this._curentAction;else{if(!this._animDic[this._defaultAction])return;e=this._defaultAction}var i=this._animDic[e];this._curentFrame=float2int(this._time/(2*Scene_data.frameTime)),this._curentFrame>=i.matrixAry.length&&(0==this._completeState?(this._time=0,this._curentFrame=0):1==this._completeState?this._curentFrame=i.matrixAry.length-1:2==this._completeState?(this._curentAction=this._defaultAction,this._curentFrame=0,this._completeState=0):3==this._completeState)},e.prototype.updateShowCapsule=function(){this.capsuleLineSprite?(this.capsuleLineSprite.x=this.x,this.capsuleLineSprite.y=this.y+this._capsule.radius,this.capsuleLineSprite.z=this.z,this.capsuleLineSprite.update()):(this.capsuleLineSprite=new LineDisplaySprite,this.capsuleLineSprite.clear(),this.capsuleLineSprite.baseColor=new Vector3D(1,0,0,1),this.drawCylinder(this._capsule.radius,this._capsule.height),this.drawBall(this._capsule.radius),this.capsuleLineSprite.upToGpu())},e.prototype.drawBall=function(t){var e,i,n,a,s,o,r,h=t,c=12;for(s=0;c>=s;s++)for(n=null,a=c/2;c>a;a++)e=new Vector3D(h,0,0),i=new Matrix3D,i.appendRotation(360/c*a,Vector3D.Z_AXIS),e=i.transformVector(e),o=new Matrix3D,o.appendRotation(360/c*s,Vector3D.Y_AXIS),e=o.transformVector(e),n&&this.capsuleLineSprite.makeLineMode(n,e),n=e.clone();for(s=1;4>=s;s++)for(o=new Matrix3D,o.appendRotation(-20*s,Vector3D.Z_AXIS),r=o.transformVector(new Vector3D(h,0,0)),n=null,a=0;c>a;a++)e=r.clone(),i=new Matrix3D,i.appendRotation(360/c*a,Vector3D.Y_AXIS),e=i.transformVector(e),n&&this.capsuleLineSprite.makeLineMode(n,e),a==c-1&&this.capsuleLineSprite.makeLineMode(r,e),n=e.clone()},e.prototype.drawCylinder=function(t,e){var i,n,a,s=t,o=e,r=12;for(a=0;r>a;a++){var h=new Vector3D(s,0,0),c=new Vector3D(s,+o,0),l=new Matrix3D;l.appendRotation(a*(360/r),Vector3D.Y_AXIS);var u=l.transformVector(h),d=l.transformVector(c);this.capsuleLineSprite.makeLineMode(u,d),this.capsuleLineSprite.makeLineMode(d,new Vector3D(0,+o,0)),a==r-1&&(this.capsuleLineSprite.makeLineMode(u,h),this.capsuleLineSprite.makeLineMode(d,c)),(i||n)&&(this.capsuleLineSprite.makeLineMode(u,i),this.capsuleLineSprite.makeLineMode(d,n)),i=u.clone(),n=d.clone()
}},e.prototype.setVcMatrix=function(t){Scene_data.context3D.setVcMatrix4fv(t.material.program,"viewMatrix3D",Scene_data.viewMatrx3D.m),Scene_data.context3D.setVcMatrix4fv(t.material.program,"camMatrix3D",Scene_data.cam3D.cameraMatrix.m),Scene_data.context3D.setVcMatrix4fv(t.material.program,"posMatrix3D",this.posMatrix.m),Scene_data.context3D.setVcMatrix4fv(t.material.program,"rotationMatrix3D",this._rotationMatrix.m)},e.prototype.setVa=function(t){Scene_data.context3D.setVa(0,3,t.vertexBuffer),Scene_data.context3D.setVa(1,2,t.uvBuffer),Scene_data.context3D.setVa(2,4,t.boneIdBuffer),Scene_data.context3D.setVa(3,4,t.boneWeightBuffer),t.material.usePbr?(Scene_data.context3D.setVa(4,4,t.normalsBuffer),t.material.useNormal&&(Scene_data.context3D.setVa(5,4,t.tangentBuffer),Scene_data.context3D.setVa(6,4,t.bitangentBuffer))):(t.material.lightProbe||t.material.directLight)&&Scene_data.context3D.setVa(4,4,t.normalsBuffer)},e.prototype.updateMaterialMesh=function(t){t.material&&(Scene_data.context3D.setProgram(t.material.program),this.setVcMatrix(t),this.setBaseMaterialVc(t.material),this.setMaterialVc(t.material),this.setMaterialTexture(t.material),this.setVa(t),this.setLightProbeVc(t.material),this.setDirectLight(t.material),this.setMeshVc(t),Scene_data.context3D.drawCall(t.indexBuffer,t.treNum))},e.prototype.setLightProbeVc=function(t){if(t.lightProbe)for(var e=0;this.resultSHVec.length>e;e++)Scene_data.context3D.setVc3fv(t.program,"sh["+e+"]",[this.resultSHVec[e].x,this.resultSHVec[e].y,this.resultSHVec[e].z])},e.prototype.setMeshVc=function(t){var e;if(this._animDic[this._curentAction]){var i=this._animDic[this._curentAction];e=i.matrixAry[this._curentFrame]}else{if(!this._animDic[this._defaultAction])return;var i=this._animDic[this._defaultAction];e=i.matrixAry[this._curentFrame]}if(!this.locationDic[t.materialUrl]){this.locationDic[t.materialUrl]=[];for(var n=0;27>n;n++)this.locationDic[t.materialUrl].push(Scene_data.context3D.getLocation(t.material.program,"bone["+n+"]"))}for(var a=this.locationDic[t.materialUrl],s=t.boneNewIDAry,n=0;s.length>n;n++)Scene_data.context3D.setVcMatrix4fvLocation(a[n],e[s[n]].m)},e.prototype.setPos=function(e){t.prototype.setPos.call(this,e),this._shadow&&(this._shadow.x=e.x,this._shadow.y=e.y+8,this._shadow.z=e.z)},Object.defineProperty(e.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this.updateMatrix(),this._shadow&&(this._shadow.x=t),this.changePos()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this.updateMatrix(),this._shadow&&(this._shadow.y=t),this.changePos()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"z",{get:function(){return this._z},set:function(t){this._z=t,this.updateMatrix(),this._shadow&&(this._shadow.z=t),this.changePos()},enumerable:!0,configurable:!0}),e.prototype.changePos=function(){},e}(Display3DSprite),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Display3dBatchMovie=function(t){function e(){t.call(this),this.batchNum=0,this.batchPos=[]}return __extends(e,t),Object.defineProperty(e.prototype,"fileScale",{set:function(t){this._fileScale=t;for(var e=0;this.batchPos.length>e;e++)this.batchPos[e].fileScale=t},enumerable:!0,configurable:!0}),e.prototype.addSun=function(t){this.batchPos.push(t),t.fileScale=this._fileScale},e.prototype.setVcMatrix=function(t){Scene_data.context3D.setVcMatrix4fv(t.material.program,"viewMatrix3D",Scene_data.viewMatrx3D.m),Scene_data.context3D.setVcMatrix4fv(t.material.program,"camMatrix3D",Scene_data.cam3D.cameraMatrix.m),Scene_data.context3D.setVcMatrix4fv(t.material.program,"rotationMatrix3D",this._rotationMatrix.m);for(var e=0;this.batchPos.length>e;e++)Scene_data.context3D.setVcMatrix4fv(t.material.program,"posMatrixAry["+e+"]",this.batchPos[e].posMatrix.m)},e.prototype.setLightProbeVc=function(){},e.prototype.setVa=function(t){Scene_data.context3D.setVa(0,3,t.vertexBuffer),Scene_data.context3D.setVa(1,3,t.uvBuffer),Scene_data.context3D.setVa(2,4,t.boneIdBuffer),Scene_data.context3D.setVa(3,4,t.boneWeightBuffer),t.material.usePbr?(Scene_data.context3D.setVa(4,4,t.normalsBuffer),t.material.useNormal&&(Scene_data.context3D.setVa(5,4,t.tangentBuffer),Scene_data.context3D.setVa(6,4,t.bitangentBuffer))):(t.material.lightProbe||t.material.directLight)&&Scene_data.context3D.setVa(4,4,t.normalsBuffer)},e.prototype.addStage=function(){if(t.prototype.addStage.call(this),this.batchPos.length)for(var e=0;this.batchPos.length>e;e++)this.batchPos[e].add()},e.prototype.removeStage=function(){if(t.prototype.removeStage.call(this),this.batchPos.length)for(var e=0;this.batchPos.length>e;e++)this.batchPos[e].remove()},e}(Display3dMovie),Movie3D=function(t){function e(){t.apply(this,arguments),this.posData=[0,0,0,10],this._fileScale=1}return __extends(e,t),Object.defineProperty(e.prototype,"shadow",{set:function(t){t&&(this._shadow||(this._shadow=ShadowManager.getInstance().addShadow(),this._shadow.x=this._x,this._shadow.y=this._y,this._shadow.z=this._z))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fileScale",{set:function(t){this._fileScale=t,this._scaleX*=t,this._scaleY*=t,this._scaleZ*=t,this.updateMatrix()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scale",{set:function(t){this._scaleX=t*this._fileScale,this._scaleY=t*this._fileScale,this._scaleZ=t*this._fileScale,this.posData[3]=20*t,this.updateMatrix()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this.posData[0]=t,this.updateMatrix(),this._shadow&&(this._shadow.x=this.retinueShadowFix?t+this.retinueShadowFix.x:t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this.posData[1]=t,this.updateMatrix(),this._shadow&&(this._shadow.y=this.retinueShadowFix?t+this.retinueShadowFix.y+2:t+2)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"z",{get:function(){return this._z},set:function(t){this._z=t,this.posData[2]=t,this.updateMatrix(),this._shadow&&(this._shadow.z=this.retinueShadowFix?t+this.retinueShadowFix.z:t)},enumerable:!0,configurable:!0}),e.prototype.add=function(){this._shadow&&(this._shadow.visible=!0)},e.prototype.remove=function(){this._shadow&&(this._shadow.visible=!1)},e}(Object3D),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Display3dShadow=function(t){function e(){t.call(this),this.needUpdate=!1,this.shadowList=[],this.objData=new ObjData,this.program=ProgrmaManager.getInstance().getProgram(Display3DShadowShader.Display3DShadowShader),this.locationAry=[];for(var e=0;30>e;e++)this.locationAry.push(Scene_data.context3D.getLocation(this.program,"pos["+e+"]"))}return __extends(e,t),e.prototype.addShadow=function(t){this.shadowList.push(t),t.display=this,this.applyObjData()},e.prototype.removeShadow=function(t){var e=this.shadowList.indexOf(t);-1!=e&&(this.shadowList.splice(e,1),this.applyObjData()),0==this.shadowList.length},e.prototype.stateChage=function(){for(var t=0;this.shadowList.length>t&&!this.shadowList[t].visible;t++);this.needUpdate=t==this.shadowList.length?!1:!0},e.prototype.hasIdle=function(){return 30>this.shadowList.length},e.prototype.applyObjData=function(){this.objData.vertices.length=0,this.objData.uvs.length=0,this.objData.indexs.length=0;for(var t=1,e=0;this.shadowList.length>e;e++)this.objData.vertices.push(-t,0,t,t,0,t,t,0,-t,-t,0,-t),this.objData.uvs.push(0,0,e,0,1,e,1,1,e,1,0,e),this.objData.indexs.push(4*e,1+4*e,2+4*e,4*e,2+4*e,3+4*e);this.objData.treNum=6*this.shadowList.length,this.objData.vertexBuffer?(Scene_data.context3D.uploadBuff3DByBuffer(this.objData.vertexBuffer,this.objData.vertices),Scene_data.context3D.uploadBuff3DByBuffer(this.objData.uvBuffer,this.objData.uvs),Scene_data.context3D.uploadIndexBuff3DByBuffer(this.objData.indexBuffer,this.objData.indexs)):(this.objData.vertexBuffer=Scene_data.context3D.uploadBuff3D(this.objData.vertices),this.objData.uvBuffer=Scene_data.context3D.uploadBuff3D(this.objData.uvs),this.objData.indexBuffer=Scene_data.context3D.uploadIndexBuff3D(this.objData.indexs))},e.prototype.update=function(){if(this.needUpdate){Scene_data.context3D.setBlendParticleFactors(0),Scene_data.context3D.setProgram(this.program),Scene_data.context3D.setVcMatrix4fv(this.program,"viewMatrix3D",Scene_data.viewMatrx3D.m),Scene_data.context3D.setVcMatrix4fv(this.program,"camMatrix3D",Scene_data.cam3D.cameraMatrix.m);for(var t=0;this.shadowList.length>t;t++)this.shadowList[t].visible?Scene_data.context3D.setVc4fvLocation(this.locationAry[t],this.shadowList[t].data):Scene_data.context3D.setVc4fvLocation(this.locationAry[t],[0,1e4,0,0]);Scene_data.context3D.setVa(0,3,this.objData.vertexBuffer),Scene_data.context3D.setVa(1,3,this.objData.uvBuffer),Scene_data.context3D.setRenderTexture(this.program,"s_texture",e.texture,0),Scene_data.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum)}},e}(Display3D),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Display3dBg=function(t){function e(){t.call(this),this._scaleData=[1,1],this.program=ProgrmaManager.getInstance().getProgram(UIImageShader.UI_IMG_SHADER),this.initData()}return __extends(e,t),e.prototype.initData=function(){this.objData=new ObjData,this.objData.vertices.push(-1,1,.99,1,1,.99,1,-1,.99,-1,-1,.99),this.objData.uvs.push(0,0,1,0,1,1,0,1),this.objData.indexs.push(0,1,2,0,2,3),this.objData.treNum=6,this.objData.vertexBuffer=Scene_data.context3D.uploadBuff3D(this.objData.vertices),this.objData.uvBuffer=Scene_data.context3D.uploadBuff3D(this.objData.uvs),this.objData.indexBuffer=Scene_data.context3D.uploadIndexBuff3D(this.objData.indexs)},e.prototype.resize=function(){this.appleyPos()},e.prototype.setImgInfo=function(t,e,i){this.setImgUrl(t),this._width=e,this._height=i},e.prototype.setImgUrl=function(t){var e=this;TextureManager.getInstance().getTexture(Scene_data.fileRoot+t,function(t){e.texture=t})},e.prototype.appleyPos=function(){var t=this._width/Scene_data.stageWidth,e=this._height/Scene_data.stageHeight;e>t?(this._scaleData[0]=1,this._scaleData[1]=this._height/Scene_data.stageHeight/t):(this._scaleData[0]=this._width/Scene_data.stageWidth/e,this._scaleData[1]=1)},e.prototype.update=function(){this.appleyPos(),Scene_data.context3D.setBlendParticleFactors(0),Scene_data.context3D.setProgram(this.program),Scene_data.context3D.setVa(0,3,this.objData.vertexBuffer),Scene_data.context3D.setVa(1,2,this.objData.uvBuffer),Scene_data.context3D.setVc2fv(this.program,"scale",this._scaleData),Scene_data.context3D.setRenderTexture(this.program,"s_texture",this.texture,0),Scene_data.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum)},e}(Display3D),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Display2dMovie=function(t){function e(){t.call(this),this.batchPos=[],this._time=0,this._allFrame=12,this._uvData=[0,0],this._uWidth=0,this._vWidth=0,this._state=0,this.objData=new ObjData,this.watchCaramMatrix=new Matrix3D,this.program=ProgrmaManager.getInstance().getProgram(Movie2DShader.MOVIE2D_SHADER)}return __extends(e,t),e.prototype.update=function(){this.watchCaramMatrix.identity(),this.watchCaramMatrix.prependRotation(-Scene_data.cam3D.rotationY,Vector3D.Y_AXIS),this.watchCaramMatrix.prependRotation(-Scene_data.cam3D.rotationX,Vector3D.X_AXIS),Scene_data.context3D.setProgram(this.program),Scene_data.context3D.setVcMatrix4fv(this.program,"viewMatrix3D",Scene_data.viewMatrx3D.m),Scene_data.context3D.setVcMatrix4fv(this.program,"camMatrix3D",Scene_data.cam3D.cameraMatrix.m),Scene_data.context3D.setVcMatrix4fv(this.program,"watchCamMatrix3D",this.watchCaramMatrix.m);for(var t=0;this.batchPos.length>t;t++)Scene_data.context3D.setVc4fv(this.program,"posdata["+t+"]",this.batchPos[t].posData);Scene_data.context3D.setVc2fv(this.program,"outuv",this._uvData),Scene_data.context3D.setRenderTexture(this.program,"s_texture",this.movieTexture,0),Scene_data.context3D.setVa(0,3,this.objData.vertexBuffer),Scene_data.context3D.setVa(1,3,this.objData.uvBuffer),Scene_data.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum)},e.prototype.updateFrame=function(t){this._time+=t;var e=float2int(this._time/(2*Scene_data.frameTime)/3);e>=this._allFrame&&(0==this._state?(this._time=0,e=0):1==this._state?e=this._allFrame-1:2==this._state?(this.play("stand"),e=0,this._state=0):3==this._state),this._uvData[0]=e*this._uWidth},e.prototype.play=function(t,e){void 0===e&&(e=0),this._state=e,this._time=0,this._uvData[1]="walk"==t?this._vWidth:-1!=t.indexOf("attack")?2*this._vWidth:0},e.prototype.addSun=function(t){this.batchPos.push(t)},e.prototype.setUrl=function(t){var e=this;TextureManager.getInstance().getTexture(Scene_data.fileRoot+t,function(t){e.movieTexture=t})},e.prototype.initData=function(t,e,i,n,a){this.objData.vertices.length=0,this.objData.uvs.length=0,this.objData.indexs.length=0,this._uWidth=i,this._vWidth=n,this._allFrame=a;for(var s=0;t>s;s++)this.objData.vertices.push(-.5*e,1,0,.5*e,1,0,.5*e,0,0,-.5*e,0,0),this.objData.uvs.push(0,0,s,1*i,0,s,1*i,1*n,s,0,1*n,s),this.objData.indexs.push(4*s,1+4*s,2+4*s,4*s,2+4*s,3+4*s);this.objData.treNum=this.objData.indexs.length,this.objData.vertexBuffer?(Scene_data.context3D.uploadBuff3DByBuffer(this.objData.vertexBuffer,this.objData.vertices),Scene_data.context3D.uploadBuff3DByBuffer(this.objData.uvBuffer,this.objData.uvs),Scene_data.context3D.uploadIndexBuff3DByBuffer(this.objData.indexBuffer,this.objData.indexs)):(this.objData.vertexBuffer=Scene_data.context3D.uploadBuff3D(this.objData.vertices),this.objData.uvBuffer=Scene_data.context3D.uploadBuff3D(this.objData.uvs),this.objData.indexBuffer=Scene_data.context3D.uploadIndexBuff3D(this.objData.indexs))},e.prototype.addStage=function(){if(t.prototype.addStage.call(this),this.batchPos.length)for(var e=0;this.batchPos.length>e;e++)this.batchPos[e].add()},e.prototype.removeStage=function(){if(t.prototype.removeStage.call(this),this.batchPos.length)for(var e=0;this.batchPos.length>e;e++)this.batchPos[e].remove()},e}(Display3D),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Display3DUISprite=function(t){function e(){t.call(this),this.uiMatrix=new Matrix3D,this.uiMatrix.prependTranslation(0,0,600),this.uiMatrix.prependRotation(-15,Vector3D.X_AXIS),this.uiMatrix.prependRotation(0,Vector3D.Y_AXIS),this.uiViewMatrix=new Matrix3D}return __extends(e,t),e.prototype.loadRes=function(t){var e=this;this.modelRes=new ModelRes,this.modelRes.load(Scene_data.fileRoot+getModelUrl(t),function(){e.loadResCom()})},e.prototype.loadResCom=function(){this.setObjUrl(this.modelRes.objUrl),this.setMaterialUrl(this.modelRes.materialUrl)},e.prototype.resize=function(){this.uiViewMatrix.identity(),this.uiViewMatrix.perspectiveFieldOfViewLH(1,1,500,5e3),this.uiViewMatrix.appendScale(1e3/Scene_data.stageWidth,1e3/Scene_data.stageHeight,1)},e.prototype.setCam=function(){Scene_data.context3D.setVcMatrix4fv(this.material.program,"viewMatrix3D",this.uiViewMatrix.m),Scene_data.context3D.setVcMatrix4fv(this.material.program,"camMatrix3D",this.uiMatrix.m)},e.prototype.setCamPos=function(t){Scene_data.context3D.setVc4fv(t.program,"fc2",[0,0,-600,1])},e.prototype.update=function(){Scene_data.context3D.setWriteDepth(!0),Scene_data.context3D.setDepthTest(!0),t.prototype.update.call(this),Scene_data.context3D.setWriteDepth(!1),Scene_data.context3D.setDepthTest(!1)},e.prototype.setDirectLight=function(t){t.directLight&&(Scene_data.context3D.setVc3fv(t.program,"ambientColor",this.modelRes.light.ambientColor),Scene_data.context3D.setVc3fv(t.program,"sunDirect",this.modelRes.light.sunDirect),Scene_data.context3D.setVc3fv(t.program,"sunColor",this.modelRes.light.sunColor))},e}(Display3DSprite),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Display2DSprite=function(t){function e(){t.call(this),this.batchPos=[],this.objData=new ObjData,this.watchCaramMatrix=new Matrix3D,this.program=ProgrmaManager.getInstance().getProgram(Sprite2DShader.SPRITE2D_SHADER)}return __extends(e,t),e.prototype.setInfo=function(t,e,i){this._imgAtlas||(this._imgAtlas=new UIAtlas),this._imgAtlas.setInfo(t,e,i)},e.prototype.getSprite=function(t){var e=new Sprite;return e.uvData=this._imgAtlas.getRec(t),e},e.prototype.addSprite=function(){for(var t=[],e=0;arguments.length>e;e++)t[e-0]=arguments[e];for(var i=0;t.length>i;i++)this.batchPos.push(t[i]);this.applyData()},e.prototype.applyData=function(){this.objData.vertices.length=0,this.objData.uvs.length=0,this.objData.indexs.length=0;for(var t=0;this.batchPos.length>t;t++){var e=this.batchPos[t].uvData,i=e.pixelHeight/e.pixelWitdh;this.objData.vertices.push(-.5*e.width,1*i*e.width,0,.5*e.width,1*i*e.width,0,.5*e.width,0,0,-.5*e.width,0,0),this.objData.uvs.push(e.x,e.y,t,e.x+e.width,e.y,t,e.x+e.width,e.y+e.height,t,e.x,e.y+e.height,t),this.objData.indexs.push(4*t,1+4*t,2+4*t,4*t,2+4*t,3+4*t)}this.objData.treNum=this.objData.indexs.length,this.objData.vertexBuffer?(Scene_data.context3D.uploadBuff3DByBuffer(this.objData.vertexBuffer,this.objData.vertices),Scene_data.context3D.uploadBuff3DByBuffer(this.objData.uvBuffer,this.objData.uvs),Scene_data.context3D.uploadIndexBuff3DByBuffer(this.objData.indexBuffer,this.objData.indexs)):(this.objData.vertexBuffer=Scene_data.context3D.uploadBuff3D(this.objData.vertices),this.objData.uvBuffer=Scene_data.context3D.uploadBuff3D(this.objData.uvs),this.objData.indexBuffer=Scene_data.context3D.uploadIndexBuff3D(this.objData.indexs))},e.prototype.update=function(){if(0!=this.batchPos.length){this.watchCaramMatrix.identity(),this.watchCaramMatrix.prependRotation(-Scene_data.cam3D.rotationY,Vector3D.Y_AXIS),this.watchCaramMatrix.prependRotation(-Scene_data.cam3D.rotationX,Vector3D.X_AXIS),Scene_data.context3D.setProgram(this.program),Scene_data.context3D.setVcMatrix4fv(this.program,"viewMatrix3D",Scene_data.viewMatrx3D.m),Scene_data.context3D.setVcMatrix4fv(this.program,"camMatrix3D",Scene_data.cam3D.cameraMatrix.m),Scene_data.context3D.setVcMatrix4fv(this.program,"watchCamMatrix3D",this.watchCaramMatrix.m);for(var t=0;this.batchPos.length>t;t++)Scene_data.context3D.setVc4fv(this.program,"posdata["+t+"]",this.batchPos[t].posData);Scene_data.context3D.setRenderTexture(this.program,"s_texture",this._imgAtlas.texture,0),Scene_data.context3D.setVa(0,3,this.objData.vertexBuffer),Scene_data.context3D.setVa(1,3,this.objData.uvBuffer),Scene_data.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum)}},e}(Display3D),Sprite=function(t){function e(){t.apply(this,arguments),this.posData=[0,0,0,100]}return __extends(e,t),e.prototype.setPos=function(t,e,i){this.x=t,this.y=e,this.z=i},Object.defineProperty(e.prototype,"scale",{get:function(){return this._scaleX},set:function(t){this._scaleX=t,this.posData[3]=100*t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{set:function(t){this._x=t,this.posData[0]=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{set:function(t){this._y=t,this.posData[1]=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"z",{set:function(t){this._z=t,this.posData[2]=t},enumerable:!0,configurable:!0}),e}(Object3D),Engine=function(){function t(){}return t.init=function(e){Scene_data.canvas3D=e,Scene_data.context3D=new Context3D,Scene_data.context3D.init(e),UIManager.getInstance().init(),Scene_data.cam3D=new Camera3D,Scene_data.focus3D=new Object3D,Scene_data.focus3D.x=0,Scene_data.focus3D.y=0,Scene_data.focus3D.z=0,Scene_data.focus3D.rotationY=135,Scene_data.focus3D.rotationX=-45,Scene_data.light=new LightVo,t.testBlob(),t.resetSize(),TimeUtil.init(),t.initPbr(),PathManager.init()},t.testBlob=function(){try{new Blob}catch(t){return Scene_data.supportBlob=!1,void 0}Scene_data.supportBlob=!0},t.initPbr=function(){TextureManager.getInstance().getTexture(Scene_data.fileRoot+"base/brdf_ltu.jpg",function(t){Scene_data.pubLut=t},1),TextureManager.getInstance().loadCubeTexture(Scene_data.fileRoot+"base/cube/e",function(t){Scene_data.skyCubeMap=t}),TextureManager.getInstance().getTexture(Scene_data.fileRoot+"base/shadow.png",function(t){Display3dShadow.texture=t})},t.resetSize=function(){document.body.clientWidth>document.body.clientHeight?(Scene_data.stageWidth=document.body.clientWidth,Scene_data.stageHeight=document.body.clientHeight,Scene_data.verticalScene=!1):(Scene_data.stageWidth=document.body.clientHeight,Scene_data.stageHeight=document.body.clientWidth,Scene_data.verticalScene=!0),Scene_data.canvas3D.width=Scene_data.stageWidth,Scene_data.canvas3D.height=Scene_data.stageHeight,Scene_data.context3D.resetSize(Scene_data.stageWidth,Scene_data.stageHeight),UIManager.getInstance().resize(),Scene_data.viewMatrx3D?Scene_data.viewMatrx3D.identity():Scene_data.viewMatrx3D=new Matrix3D;var t=Scene_data.stageWidth,e=Scene_data.stageHeight;0==Scene_data.user?(Scene_data.sceneViewHW=Math.max(t,e),Scene_data.viewMatrx3D.perspectiveFieldOfViewLH(1,1,500,5e3)):(Scene_data.sceneViewHW=.5*Math.max(t,e),Scene_data.viewMatrx3D.perspectiveFieldOfViewLH(1,1,10,5e3)),Scene_data.viewMatrx3D.appendScale(1*2*(Scene_data.sceneViewHW/t),t/e*2*(Scene_data.sceneViewHW/t),1),Scene_data.canvas3D.style.position="absolute",Scene_data.canvas3D.style.left="0px",Scene_data.canvas3D.style.top="0px",Scene_data.canvas3D.style.transform=Scene_data.verticalScene?"matrix(0,1,-1,0,"+Scene_data.stageHeight+",0)":"matrix(1,0,0,1,0,0)",Scene_data.canvas3D.style.transformOrigin="0px 0px 0px"},t.update=function(){TimeUtil.update(),SceneManager.getInstance().update()},t}(),MathClass=function(){function t(){}return t.getCamView=function(t,e){t.update();var i=new Matrix3D;i.appendRotation(-e.rotationX,Vector3D.X_AXIS),i.appendRotation(-e.rotationY,Vector3D.Y_AXIS),i.appendTranslation(e.x,e.y,e.z);var n=i.transformVector(new Vector3D(0,0,-t.distance));return t.x=n.x,t.y=n.y,t.z=n.z,t.rotationX=e.rotationX,t.rotationY=e.rotationY,t.cameraMatrix.identity(),t.cameraMatrix.prependTranslation(0,0,t.distance),t.cameraMatrix.prependRotation(t.rotationX,Vector3D.X_AXIS),t.cameraMatrix.prependRotation(t.rotationY,Vector3D.Y_AXIS),t.cameraMatrix.prependTranslation(-e.x,-e.y,-e.z),t.cameraMatrix.m},t.MathCam=function(t){var e=new Matrix3D;e.prependRotation(t.rotationX,Vector3D.X_AXIS),e.prependRotation(t.rotationY,Vector3D.Y_AXIS),e.prependTranslation(-t.x,-t.y,-t.z),t.cameraMatrix.identity(),t.cameraMatrix.append(e)},t.GetViewHitBoxData=function(t){var e=Scene_data.cam3D.cameraMatrix.clone();e.invert();var i=Scene_data.viewMatrx3D.m[0],n=Scene_data.viewMatrx3D.m[5];this.viewBoxVecItem?(this.lastViewScale.x!=i||this.lastViewScale.y!=n)&&(this.viewBoxVecItem[0]=new Vector3D(-t/i,-t/n,t),this.viewBoxVecItem[1]=new Vector3D(-t/i,+t/n,t),this.viewBoxVecItem[2]=new Vector3D(+t/i,-t/n,t),this.viewBoxVecItem[3]=new Vector3D(+t/i,+t/n,t),this.viewBoxVecItem[4]=new Vector3D(0,0,0)):(this.lastViewScale=new Vector2D(i,n),this.viewBoxVecItem=[],this.viewBoxVecItem.push(new Vector3D(-t/i,-t/n,t)),this.viewBoxVecItem.push(new Vector3D(-t/i,+t/n,t)),this.viewBoxVecItem.push(new Vector3D(+t/i,-t/n,t)),this.viewBoxVecItem.push(new Vector3D(+t/i,+t/n,t)),this.viewBoxVecItem.push(new Vector3D(0,0,0)))},t.mathmidpoint=function(t,e,i){var n,a,s;n=t.x+(e.x-t.x)*i,a=t.y+(e.y-t.y)*i,s=t.z+(e.z-t.z)*i,t.x=n,t.y=a,t.z=s},t.drawbezier=function(t,e){var i=[];if(0==t.length)return{x:0,y:0,z:0};for(var n=0;t.length>n;n++)i.push({x:t[n].x,y:t[n].y,z:t[n].z});for(;i.length>1;){for(var a=0;i.length-1>a;a++)this.mathmidpoint(i[a],i[a+1],e);i.pop()}return i[0]},t.math_distance=function(t,e,i,n){return Math.sqrt((n-e)*(n-e)+(i-t)*(i-t))},t.math_angle=function(t,e,i,n){var a=t-i,s=e-n,o=180*Math.atan(s/a)/Math.PI;return o},t}(),Matrix3D=function(){function t(){this.isIdentity=!0;var t=Array.prototype.concat.apply([],arguments);t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.m=new Float32Array(t)}return t.prototype.clone=function(){var e=new t;return e.m[0]=this.m[0],e.m[1]=this.m[1],e.m[2]=this.m[2],e.m[3]=this.m[3],e.m[4]=this.m[4],e.m[5]=this.m[5],e.m[6]=this.m[6],e.m[7]=this.m[7],e.m[8]=this.m[8],e.m[9]=this.m[9],e.m[10]=this.m[10],e.m[11]=this.m[11],e.m[12]=this.m[12],e.m[13]=this.m[13],e.m[14]=this.m[14],e.m[15]=this.m[15],e},Object.defineProperty(t.prototype,"position",{get:function(){return this.transformVector(new Vector3D)},enumerable:!0,configurable:!0}),t.prototype.copyTo=function(t){t.m[0]=this.m[0],t.m[1]=this.m[1],t.m[2]=this.m[2],t.m[3]=this.m[3],t.m[4]=this.m[4],t.m[5]=this.m[5],t.m[6]=this.m[6],t.m[7]=this.m[7],t.m[8]=this.m[8],t.m[9]=this.m[9],t.m[10]=this.m[10],t.m[11]=this.m[11],t.m[12]=this.m[12],t.m[13]=this.m[13],t.m[14]=this.m[14],t.m[15]=this.m[15]},t.prototype.identity=function(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=0,this.m[4]=0,this.m[5]=1,this.m[6]=0,this.m[7]=0,this.m[8]=0,this.m[9]=0,this.m[10]=1,this.m[11]=0,this.m[12]=0,this.m[13]=0,this.m[14]=0,this.m[15]=1},t.prototype.invert=function(){var t=this.m,e=t[0],i=t[1],n=t[2],a=t[3],s=t[4],o=t[5],r=t[6],h=t[7],c=t[8],l=t[9],u=t[10],d=t[11],p=t[12],_=t[13],f=t[14],m=t[15],y=e*o-i*s,g=e*r-n*s,v=e*h-a*s,x=i*r-n*o,b=i*h-a*o,D=n*h-a*r,T=c*_-l*p,w=c*f-u*p,M=c*m-d*p,S=l*f-u*_,I=l*m-d*_,E=u*m-d*f,A=y*E-g*I+v*S+x*M-b*w+D*T;return A?(A=1/A,this.m[0]=(o*E-r*I+h*S)*A,this.m[1]=(n*I-i*E-a*S)*A,this.m[2]=(_*D-f*b+m*x)*A,this.m[3]=(u*b-l*D-d*x)*A,this.m[4]=(r*M-s*E-h*w)*A,this.m[5]=(e*E-n*M+a*w)*A,this.m[6]=(f*v-p*D-m*g)*A,this.m[7]=(c*D-u*v+d*g)*A,this.m[8]=(s*I-o*M+h*T)*A,this.m[9]=(i*M-e*I-a*T)*A,this.m[10]=(p*b-_*v+m*y)*A,this.m[11]=(l*v-c*b-d*y)*A,this.m[12]=(o*w-s*S-r*T)*A,this.m[13]=(e*S-i*w+n*T)*A,this.m[14]=(_*g-p*x-f*y)*A,this.m[15]=(c*x-l*g+u*y)*A,void 0):null},t.prototype.invertToMatrix=function(t){var e=this.m,i=e[0],n=e[1],a=e[2],s=e[3],o=e[4],r=e[5],h=e[6],c=e[7],l=e[8],u=e[9],d=e[10],p=e[11],_=e[12],f=e[13],m=e[14],y=e[15],g=i*r-n*o,v=i*h-a*o,x=i*c-s*o,b=n*h-a*r,D=n*c-s*r,T=a*c-s*h,w=l*f-u*_,M=l*m-d*_,S=l*y-p*_,I=u*m-d*f,E=u*y-p*f,A=d*y-p*m,C=g*A-v*E+x*I+b*S-D*M+T*w;return C?(C=1/C,t.m[0]=(r*A-h*E+c*I)*C,t.m[1]=(a*E-n*A-s*I)*C,t.m[2]=(f*T-m*D+y*b)*C,t.m[3]=(d*D-u*T-p*b)*C,t.m[4]=(h*S-o*A-c*M)*C,t.m[5]=(i*A-a*S+s*M)*C,t.m[6]=(m*x-_*T-y*v)*C,t.m[7]=(l*T-d*x+p*v)*C,t.m[8]=(o*E-r*S+c*w)*C,t.m[9]=(n*S-i*E-s*w)*C,t.m[10]=(_*D-f*x+y*g)*C,t.m[11]=(u*x-l*D-p*g)*C,t.m[12]=(r*M-o*I-h*w)*C,t.m[13]=(i*I-n*M+a*w)*C,t.m[14]=(f*v-_*b-m*g)*C,t.m[15]=(l*b-u*v+d*g)*C,void 0):null},t.prototype.appendTranslation=function(e,i,n){t.tempM.identity(),t.tempM.prependTranslation(e,i,n),this.append(t.tempM)},t.prototype.prependTranslation=function(t,e,i){var n=this.m;n[12]=n[0]*t+n[4]*e+n[8]*i+n[12],n[13]=n[1]*t+n[5]*e+n[9]*i+n[13],n[14]=n[2]*t+n[6]*e+n[10]*i+n[14],n[15]=n[3]*t+n[7]*e+n[11]*i+n[15]},t.prototype.transformVector=function(t){var e=new Vector3D;return e.x=this.m[0]*t.x+this.m[4]*t.y+this.m[8]*t.z+this.m[12]*t.w,e.y=this.m[1]*t.x+this.m[5]*t.y+this.m[9]*t.z+this.m[13]*t.w,e.z=this.m[2]*t.x+this.m[6]*t.y+this.m[10]*t.z+this.m[14]*t.w,e.w=this.m[3]*t.x+this.m[7]*t.y+this.m[11]*t.z+this.m[15]*t.w,e},t.prototype.append=function(e){t.tempM.m[0]=e.m[0],t.tempM.m[1]=e.m[1],t.tempM.m[2]=e.m[2],t.tempM.m[3]=e.m[3],t.tempM.m[4]=e.m[4],t.tempM.m[5]=e.m[5],t.tempM.m[6]=e.m[6],t.tempM.m[7]=e.m[7],t.tempM.m[8]=e.m[8],t.tempM.m[9]=e.m[9],t.tempM.m[10]=e.m[10],t.tempM.m[11]=e.m[11],t.tempM.m[12]=e.m[12],t.tempM.m[13]=e.m[13],t.tempM.m[14]=e.m[14],t.tempM.m[15]=e.m[15],t.tempM.prepend(this),this.m[0]=t.tempM.m[0],this.m[1]=t.tempM.m[1],this.m[2]=t.tempM.m[2],this.m[3]=t.tempM.m[3],this.m[4]=t.tempM.m[4],this.m[5]=t.tempM.m[5],this.m[6]=t.tempM.m[6],this.m[7]=t.tempM.m[7],this.m[8]=t.tempM.m[8],this.m[9]=t.tempM.m[9],this.m[10]=t.tempM.m[10],this.m[11]=t.tempM.m[11],this.m[12]=t.tempM.m[12],this.m[13]=t.tempM.m[13],this.m[14]=t.tempM.m[14],this.m[15]=t.tempM.m[15]},t.prototype.prepend=function(t){var e=t.m,i=this.m,n=this.m,a=n[0],s=n[1],o=n[2],r=n[3],h=n[4],c=n[5],l=n[6],u=n[7],d=n[8],p=n[9],_=n[10],f=n[11],m=n[12],y=n[13],g=n[14],v=n[15],x=e[0],b=e[1],D=e[2],T=e[3];i[0]=x*a+b*h+D*d+T*m,i[1]=x*s+b*c+D*p+T*y,i[2]=x*o+b*l+D*_+T*g,i[3]=x*r+b*u+D*f+T*v,x=e[4],b=e[5],D=e[6],T=e[7],i[4]=x*a+b*h+D*d+T*m,i[5]=x*s+b*c+D*p+T*y,i[6]=x*o+b*l+D*_+T*g,i[7]=x*r+b*u+D*f+T*v,x=e[8],b=e[9],D=e[10],T=e[11],i[8]=x*a+b*h+D*d+T*m,i[9]=x*s+b*c+D*p+T*y,i[10]=x*o+b*l+D*_+T*g,i[11]=x*r+b*u+D*f+T*v,x=e[12],b=e[13],D=e[14],T=e[15],i[12]=x*a+b*h+D*d+T*m,i[13]=x*s+b*c+D*p+T*y,i[14]=x*o+b*l+D*_+T*g,i[15]=x*r+b*u+D*f+T*v},t.prototype.appendRotation=function(e,i){t.tempM.identity(),t.tempM.prependRotation(e,i),this.append(t.tempM)},t.prototype.tomat3=function(){var t=Array.prototype.concat.apply([],arguments);t=[1,0,0,0,1,0,0,0,1];var e=new Float32Array(t);return e[0]=this.m[0],e[1]=this.m[1],e[2]=this.m[2],e[3]=this.m[4],e[4]=this.m[5],e[5]=this.m[6],e[6]=this.m[8],e[7]=this.m[9],e[8]=this.m[10],e},t.prototype.getRotaion=function(t){t[0]=this.m[0],t[1]=this.m[1],t[2]=this.m[2],t[3]=this.m[4],t[4]=this.m[5],t[5]=this.m[6],t[6]=this.m[8],t[7]=this.m[9],t[8]=this.m[10]},Object.defineProperty(t.prototype,"postion",{get:function(){return new Vector3D(this.m[12],this.m[13],this.m[14])},enumerable:!0,configurable:!0}),t.prototype.identityPostion=function(){this.m[12]=0,this.m[13]=0,this.m[14]=0},Object.defineProperty(t.prototype,"x",{get:function(){return this.m[12]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this.m[13]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"z",{get:function(){return this.m[14]},enumerable:!0,configurable:!0}),t.prototype.prependRotation=function(t,e){var i,n,a,s,o,r,h,c,l,u,d,p,_,f,m,y,g,v,x,b,D,T,w,M,S=this.m,I=this.m,E=e.x,A=e.y,C=e.z,R=Math.sqrt(E*E+A*A+C*C);return 1e-6>Math.abs(R)?null:(R=1/R,E*=R,A*=R,C*=R,i=Math.sin(t*Math.PI/180),n=Math.cos(t*Math.PI/180),a=1-n,s=I[0],o=I[1],r=I[2],h=I[3],c=I[4],l=I[5],u=I[6],d=I[7],p=I[8],_=I[9],f=I[10],m=I[11],y=E*E*a+n,g=A*E*a+C*i,v=C*E*a-A*i,x=E*A*a-C*i,b=A*A*a+n,D=C*A*a+E*i,T=E*C*a+A*i,w=A*C*a-E*i,M=C*C*a+n,S[0]=s*y+c*g+p*v,S[1]=o*y+l*g+_*v,S[2]=r*y+u*g+f*v,S[3]=h*y+d*g+m*v,S[4]=s*x+c*b+p*D,S[5]=o*x+l*b+_*D,S[6]=r*x+u*b+f*D,S[7]=h*x+d*b+m*D,S[8]=s*T+c*w+p*M,S[9]=o*T+l*w+_*M,S[10]=r*T+u*w+f*M,S[11]=h*T+d*w+m*M,I!==S&&(S[12]=I[12],S[13]=I[13],S[14]=I[14],S[15]=I[15]),S)},t.prototype.prependScale=function(t,e,i){var n=this.m,a=this.m;return a[0]=n[0]*t,a[1]=n[1]*t,a[2]=n[2]*t,a[3]=n[3]*t,a[4]=n[4]*e,a[5]=n[5]*e,a[6]=n[6]*e,a[7]=n[7]*e,a[8]=n[8]*i,a[9]=n[9]*i,a[10]=n[10]*i,a[11]=n[11]*i,a[12]=n[12],a[13]=n[13],a[14]=n[14],a[15]=n[15],a},t.prototype.appendScale=function(e,i,n){t.tempM.identity(),t.tempM.prependScale(e,i,n),this.append(t.tempM)},t.prototype.perspectiveFieldOfViewLH=function(t,e,i,n){var a=1/Math.tan(t/2),s=a/e,o=this.m;o[0]=s,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=a,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=n/(n-i),o[11]=1,o[12]=0,o[13]=0,o[14]=i*n/(i-n),o[15]=0},t.prototype.fromVtoV=function(t,e){var i=t.cross(e),n=Math.acos(t.dot(e)),a=new Quaternion;a.fromAxisAngle(i,n),a.toMatrix3D(this)},t.prototype.buildLookAtLH=function(t,e,i){var n=this.m,a=new Vector3D;a.x=e.x-t.x,a.y=e.y-t.y,a.z=e.z-t.z,a.normalize();var s=i.cross(a);s.normalize();var o=a.cross(s);n[0]=s.x,n[1]=o.x,n[2]=a.x,n[3]=0,n[4]=s.y,n[5]=o.y,n[6]=a.y,n[7]=0,n[8]=s.z,n[9]=o.z,n[10]=a.z,n[11]=0,n[12]=-s.dot(t),n[13]=-o.dot(t),n[14]=-a.dot(t),n[15]=1
},t.tempM=new t,t}(),Quaternion=function(){function t(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1),this.x=0,this.y=0,this.z=0,this.w=1,this.x=t,this.y=e,this.z=i,this.w=n}return t.prototype.print=function(){alert(this.x+""+" "+(this.y+"")+" "+(this.z+"")+" "+(this.w+""))},t.prototype.toEulerAngles=function(t){void 0===t&&(t=null),t||(t=new Vector3D);var e=this.x,i=this.y,n=this.z,a=this.w;return t.x=Math.atan2(2*(a*e+i*n),1-2*(e*e+i*i)),t.y=Math.asin(2*(a*i-n*e)),t.z=Math.atan2(2*(a*n+e*i),1-2*(i*i+n*n)),t},t.prototype.toMatrix3D=function(t){void 0===t&&(t=null),t||(t=new Matrix3D);var e=t.m,i=this.x,n=this.y,a=this.z,s=this.w,o=i+i,r=n+n,h=a+a,c=i*o,l=n*o,u=n*r,d=a*o,p=a*r,_=a*h,f=s*o,m=s*r,y=s*h;return e[0]=1-u-_,e[1]=l+y,e[2]=d-m,e[3]=0,e[4]=l-y,e[5]=1-c-_,e[6]=p+f,e[7]=0,e[8]=d+m,e[9]=p-f,e[10]=1-c-u,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,t},t.prototype.fromAxisAngle=function(t,e){var i=Math.sin(e/2),n=Math.cos(e/2);this.x=t.x*i,this.y=t.y*i,this.z=t.z*i,this.w=n,this.normalize()},t.prototype.normalize=function(t){void 0===t&&(t=1);var e=t/Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);this.x*=e,this.y*=e,this.z*=e,this.w*=e},t.prototype.fromMatrix=function(t){var e=[0,0,0,0,0,0,0,0,0];e[0]=t.m[0],e[1]=t.m[1],e[2]=t.m[2],e[3]=t.m[4],e[4]=t.m[5],e[5]=t.m[6],e[6]=t.m[8],e[7]=t.m[9],e[8]=t.m[10];var i,n=e[0]+e[4]+e[8],a=[0,0,0,0];if(n>0)i=Math.sqrt(n+1),a[3]=.5*i,i=.5/i,a[0]=(e[5]-e[7])*i,a[1]=(e[6]-e[2])*i,a[2]=(e[1]-e[3])*i;else{var s=0;e[4]>e[0]&&(s=1),e[8]>e[3*s+s]&&(s=2);var o=(s+1)%3,r=(s+2)%3;i=Math.sqrt(e[3*s+s]-e[3*o+o]-e[3*r+r]+1),a[s]=.5*i,i=.5/i,a[3]=(e[3*o+r]-e[3*r+o])*i,a[o]=(e[3*o+s]+e[3*s+o])*i,a[r]=(e[3*r+s]+e[3*s+r])*i}this.x=a[0],this.y=a[1],this.z=a[2],this.w=a[3]},t.prototype.setMd5W=function(){this.w=1-(this.x*this.x+this.y*this.y+this.z*this.z),this.w=0>this.w?0:-Math.sqrt(this.w)},t}(),Vector3D=function(){function t(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1),this.x=0,this.y=0,this.z=0,this.w=1,this.x=t,this.y=e,this.z=i,this.w=n}return t.prototype.normalize=function(){var t=this.length;0!=t&&this.scaleBy(1/t)},Object.defineProperty(t.prototype,"length",{get:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},enumerable:!0,configurable:!0}),t.prototype.scaleBy=function(t){this.x*=t,this.y*=t,this.z*=t,this.w*=t},t.prototype.scaleByW=function(){this.x*=this.w,this.y*=this.w,this.z*=this.w},t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y,this.z+e.z)},t.prototype.subtract=function(e){return new t(this.x-e.x,this.y-e.y,this.z-e.z)},t.prototype.addByNum=function(t,e,i,n){void 0===n&&(n=0),this.x+=t,this.y+=e,this.z+=i,this.w+=n},t.prototype.setTo=function(t,e,i){this.x=t,this.y=e,this.z=i},t.prototype.cross=function(e){return new t(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x)},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},t.prototype.clone=function(){return new t(this.x,this.y,this.z)},t.distance=function(t,e){var i=t.x-e.x,n=t.y-e.y,a=t.z-e.z;return Math.sqrt(i*i+n*n+a*a)},t.prototype.toString=function(){return"Vector3D("+(this.x+"")+","+(this.y+"")+","+(this.z+"")+","+(this.w+"")+")"},t.X_AXIS=new t(1,0,0),t.Y_AXIS=new t(0,1,0),t.Z_AXIS=new t(0,0,1),t}(),Vector2D=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=0,this.y=0,this.x=t,this.y=e}return t.prototype.normalize=function(){var t=this.length;0!=t&&this.scaleBy(1/t)},Object.defineProperty(t.prototype,"length",{get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},enumerable:!0,configurable:!0}),t.prototype.scaleBy=function(t){this.x*=t,this.y*=t},t.prototype.toString=function(){return"Vector2D("+(this.x+"")+","+(this.y+"")+")"},t.distance=function(t,e){var i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)},t}(),Rectangle=function(){function t(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=1),void 0===n&&(n=1),this.x=0,this.y=0,this.width=0,this.height=1,this.x=t,this.y=e,this.width=i,this.height=n}return t.prototype.sets=function(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n},t.prototype.setRec=function(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height},t}(),Circle=function(){function t(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this.setData(t,e,i)}return t.prototype.setData=function(t,e,i){this.x=t,this.y=e,this.radius=i},t.prototype.setPos=function(t,e){this.x=t,this.y=e},Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t},enumerable:!0,configurable:!0}),t.prototype.setRadius=function(t){this.radius=t},t.prototype.testPoint=function(t){var e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)<this.radius},t}(),Groundposition=function(){function t(){}return t._pushpoint=function(t){var e=new Object3D;e.x=t.x,e.y=t.y,e.z=t.z,e.rx=0,e.ry=0,e.rz=0,this._vitem.push(e)},t._getposition=function(t,e,i){this._vitem=[],this._pushpoint(new Object3D(0,0,500)),this._pushpoint(new Object3D(-500,0,0)),this._pushpoint(new Object3D(500,0,0));for(var n=0;this._vitem.length>n;n++)this.math_change_point(t,this._vitem[n]);var a=Scene_data.stageWidth,s=Scene_data.stageHeight;return Calculation._get_hit_rec(this._vitem[0],this._vitem[1],this._vitem[2],t,e-a/2,s/2-i)},t.math_change_point=function(t,e){var i=e.x-Scene_data.cam3D.x,n=e.y-Scene_data.cam3D.y,a=e.z-Scene_data.cam3D.z,s=new Matrix3D;s.appendRotation(t.rotationY,Vector3D.Y_AXIS),s.appendRotation(t.rotationX,Vector3D.X_AXIS);var o=s.transformVector(new Vector3D(i,n,a));e.rx=o.x,e.ry=o.y,e.rz=o.z},t}(),ObjectMath=function(){function t(){this.a=0,this.b=0,this.c=0,this.d=0}return t}(),Calculation=function(){function t(){}return t._get_hit_rec=function(t,e,i,n,a,s){var o=new Object3D,r=new Object3D,h=new Object3D;o.x=t.rx,o.y=t.ry,o.z=t.rz,r.x=e.rx,r.y=e.ry,r.z=e.rz,h.x=i.rx,h.y=i.ry,h.z=i.rz;var c=this._PanelEquationFromThreePt(o,r,h),l=this._math_intersect(c,a,s);return this._anti_computing_point(l,n),l},t._anti_computing_point=function(t,e){var i=t.rx,n=t.ry,a=t.rz,s=new Matrix3D;s.appendRotation(-e.rotationX,Vector3D.X_AXIS),s.appendRotation(-e.rotationY,Vector3D.Y_AXIS);var o=s.transformVector(new Vector3D(i,n,a));t.x=o.x,t.y=o.y,t.z=o.z},t._math_intersect=function(t,e,i){var n=t.a,a=t.b,s=t.c,o=t.d,r=1,h=new Object3D,c=0==e?1:e/r,l=0==i?1:i/r,u=2*Scene_data.sceneViewHW;return h.rx=-o/(n+a*l/c+s*u/c),h.ry=h.rx/c*l,h.rz=h.rx/c*u,h},t._PanelEquationFromThreePt=function(t,e,i){var n=(e.y-t.y)*(i.z-t.z)-(e.z-t.z)*(i.y-t.y),a=(e.z-t.z)*(i.x-t.x)-(e.x-t.x)*(i.z-t.z),s=(e.x-t.x)*(i.y-t.y)-(e.y-t.y)*(i.x-t.x),o=0-(n*t.x+a*t.y+s*t.z),r=new ObjectMath;return r.a=n,r.b=a,r.c=s,r.d=o,r},t}(),ProgrmaManager=function(){function t(){this._dic={}}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.getProgram=function(t){return this._dic[t]?this._dic[t]:(alert("please registe Program=>"+t),null)},t.prototype.registe=function(t,e){this._dic[t]||(e.encode(),this._dic[t]=e.program)},t.prototype.getMaterialProgram=function(t,e,i,n,a){void 0===n&&(n=null),void 0===a&&(a=!1);var s=t+"_"+i.url;if(n){for(var o=0;n.length>o;o++)s+="_"+n[o];s+=""+a}return this._dic[s]?this._dic[s]:(a&&(n=[i.usePbr,i.useNormal,i.hasFresnel,i.useDynamicIBL,i.lightProbe,i.directLight,i.noLight]),e.paramAry=n,e.fragment=i.shaderStr,e.encode(),-1!=s.indexOf("all")&&(console.log("**********"+s),console.log(e.vertex),console.log(e.fragment)),e.program)},t}(),Shader3D=function(){function t(){this.fragment=this.getFragmentShaderString()}return t.prototype.encode=function(){this.vertex=this.getVertexShaderString();var t=Scene_data.context3D.renderContext;this.program=t.createProgram();var e=t.createShader(t.VERTEX_SHADER),i=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(e,this.vertex),t.shaderSource(i,this.fragment),t.compileShader(e),t.compileShader(i),t.attachShader(this.program,e),t.attachShader(this.program,i),this.binLocation(t),t.linkProgram(this.program);var n=t.getProgramInfoLog(this.program),a=t.getShaderInfoLog(e),s=t.getShaderInfoLog(i);""!=n&&console.log("shader"+n+","+a+","+s)},t.prototype.binLocation=function(){},t.prototype.getVertexShaderString=function(){return""},t.prototype.getFragmentShaderString=function(){return""},t}(),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},BuildShader=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.binLocation=function(t){t.bindAttribLocation(this.program,0,"v3Position"),t.bindAttribLocation(this.program,1,"v2CubeTexST")},e.prototype.getVertexShaderString=function(){var t="attribute vec3 v3Position;attribute vec2 v2CubeTexST;uniform mat4 viewMatrix3D;uniform mat4 camMatrix3D;uniform mat4 posMatrix3D;varying vec2 v_texCoord;void main(void){   v_texCoord = vec2(v2CubeTexST.x, v2CubeTexST.y);   vec4 vt0= vec4(v3Position, 1.0);   vt0 = posMatrix3D * vt0;   vt0 = camMatrix3D * vt0;   vt0 = viewMatrix3D * vt0;   gl_Position = vt0;}";return t},e.prototype.getFragmentShaderString=function(){var t=" precision mediump float;\nuniform sampler2D s_texture;\nuniform vec4 testconst;uniform vec4 testconst2;varying vec2 v_texCoord;\nvoid main(void)\n{\nvec4 infoUv = texture2D(s_texture, v_texCoord.xy);\nvec4 test = vec4(0,0,0,1);\ntest.xyz = mix(vec3(1,1,1)*0.5,testconst.xyz,0.5);\ninfoUv.xyz = test.xyz * infoUv.xyz;\ngl_FragColor = infoUv;\n}";return t},e.buildShader="BuildShader",e}(Shader3D),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},MaterialShader=function(t){function e(){t.call(this),this.name="Material_shader"}return __extends(e,t),e.prototype.binLocation=function(t){t.bindAttribLocation(this.program,0,"v3Position"),t.bindAttribLocation(this.program,1,"v2CubeTexST");var e=this.paramAry[0],i=this.paramAry[1];this.paramAry[4];var n=this.paramAry[5],a=this.paramAry[6];n||a||t.bindAttribLocation(this.program,2,"v2lightuv"),e?(t.bindAttribLocation(this.program,3,"v3Normal"),i&&(t.bindAttribLocation(this.program,4,"v3Tangent"),t.bindAttribLocation(this.program,5,"v3Bitangent"))):n&&t.bindAttribLocation(this.program,3,"v3Normal")},e.prototype.getVertexShaderString=function(){var t=this.paramAry[0],e=this.paramAry[1];this.paramAry[2],this.paramAry[3],this.paramAry[4];var i=this.paramAry[5],n=this.paramAry[6],a="attribute vec3 v3Position;\nattribute vec2 v2CubeTexST;\nvarying vec2 v0;\n";return i?a+="varying vec3 v2;\n":n||(a+="attribute vec2 v2lightuv;\nvarying vec2 v2;\n"),t&&(a+="attribute vec3 v3Normal;\nvarying vec3 v1;\n",a+=e?"varying mat3 v4;\n":"varying vec3 v4;\n"),e&&(a+="attribute vec3 v3Tangent;\nattribute vec3 v3Bitangent;\n"),i&&(t||(a+="attribute vec3 v3Normal;\n"),a+="uniform vec3 sunDirect;\nuniform vec3 sunColor;\nuniform vec3 ambientColor;\n"),a+="uniform mat4 viewMatrix3D;\nuniform mat4 camMatrix3D;\nuniform mat4 posMatrix3D;\nuniform mat3 rotationMatrix3D;\n",a+="void main(void){\nv0 = vec2(v2CubeTexST.x, v2CubeTexST.y);\nvec4 vt0= vec4(v3Position, 1.0);\nvt0 = posMatrix3D * vt0;\n",i||n||(a+="v2 = vec2(v2lightuv.x, v2lightuv.y);\n"),t&&(a+="v1 = vec3(vt0.x,vt0.y,vt0.z);\n"),a+="vt0 = camMatrix3D * vt0;\nvt0 = viewMatrix3D * vt0;\n",t&&(a+=e?"v4 = mat3(rotationMatrix3D * v3Tangent,rotationMatrix3D * v3Bitangent, rotationMatrix3D * v3Normal);\n":"v4 = rotationMatrix3D * v3Normal;\n"),i&&(a+=t?"float suncos = dot(v4.xyz,sunDirect.xyz);\n":"vec3 n = rotationMatrix3D * v3Normal;\nfloat suncos = dot(n.xyz,sunDirect.xyz);\n",a+="suncos = clamp(suncos,0.0,1.0);\nv2 = sunColor * suncos + ambientColor;"),a+="gl_Position = vt0;}"},e.prototype.getFragmentShaderString=function(){var t="uniform sampler2D s_texture1;\nuniform vec4 testconst;varying vec2 v_texCoord;\nvoid main(void)\n{\nvec4 infoUv = texture2D(s_texture, v_texCoord.xy);\ninfoUv.xyz = testconst.xyz * infoUv.xyz;\ngl_FragColor = infoUv;\n}";return t},e}(Shader3D),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},MaterialAnimShader=function(t){function e(){t.call(this),this.name="Material_Anim_shader"}return __extends(e,t),e.prototype.binLocation=function(t){t.bindAttribLocation(this.program,0,"pos"),t.bindAttribLocation(this.program,1,"v2Uv"),t.bindAttribLocation(this.program,2,"boneID"),t.bindAttribLocation(this.program,3,"boneWeight");var e=this.paramAry[0],i=this.paramAry[1],n=this.paramAry[4],a=this.paramAry[5];e?(t.bindAttribLocation(this.program,4,"normal"),i&&(t.bindAttribLocation(this.program,5,"tangent"),t.bindAttribLocation(this.program,6,"bitangent"))):(n||a)&&t.bindAttribLocation(this.program,4,"normal")},e.prototype.getVertexShaderString=function(){var t=this.paramAry[0],e=this.paramAry[1];this.paramAry[2],this.paramAry[3];var i=this.paramAry[4],n=this.paramAry[5],a=this.paramAry[6],s="attribute vec4 pos;\nattribute vec2 v2Uv;\nattribute vec4 boneID;\nattribute vec4 boneWeight;\nvarying vec2 v0;\nuniform mat4 bone[27];\nuniform mat4 viewMatrix3D;\nuniform mat4 camMatrix3D;\nuniform mat4 posMatrix3D;\n";return i?s+="uniform vec3 sh[9];\nvarying vec3 v2;\n":n?s+="uniform vec3 sunDirect;\nuniform vec3 sunColor;\nuniform vec3 ambientColor;\nvarying vec3 v2;\n":a||(s+="varying vec2 v2;\n"),t?(s+="attribute vec4 normal;\nuniform mat4 rotationMatrix3D;\nvarying vec3 v1;\n",s+=e?"varying mat3 v4;\n":"varying vec3 v4;\n",e&&(s+="attribute vec4 tangent;\nattribute vec4 bitangent;\n")):(i||n)&&(s+="attribute vec4 normal;\nuniform mat4 rotationMatrix3D;\n"),s+="void main(void){\nv0 = v2Uv;\nvec4 vt0 = bone[int(boneID.x)] * pos * boneWeight.x;\nvt0 += bone[int(boneID.y)] * pos * boneWeight.y;\nvt0 += bone[int(boneID.z)] * pos * boneWeight.z;\nvt0 += bone[int(boneID.w)] * pos * boneWeight.w;\nvt0 = posMatrix3D * vt0;\n",t&&(s+="v1 = vec3(vt0.x,vt0.y,vt0.z);\n"),s+="vt0 = camMatrix3D * vt0;\nvt0 = viewMatrix3D * vt0;\ngl_Position = vt0;\n",t?s+=e?"vec4 vt2 = bone[int(boneID.x)] * tangent * boneWeight.x;\nvt2 += bone[int(boneID.y)] * tangent * boneWeight.y;\nvt2 += bone[int(boneID.z)] * tangent * boneWeight.z;\nvt2 += bone[int(boneID.w)] * tangent * boneWeight.w;\nvt2 = rotationMatrix3D * vt2;\nvt2.xyz = normalize(vt2.xyz);\nvec4 vt1 = bone[int(boneID.x)] * bitangent * boneWeight.x;\nvt1 += bone[int(boneID.y)] * bitangent * boneWeight.y;\nvt1 += bone[int(boneID.z)] * bitangent * boneWeight.z;\nvt1 += bone[int(boneID.w)] * bitangent * boneWeight.w;\nvt1 = rotationMatrix3D * vt1;\nvt1.xyz = normalize(vt1.xyz);\nvt0 = bone[int(boneID.x)] * normal * boneWeight.x;\nvt0 += bone[int(boneID.y)] * normal * boneWeight.y;\nvt0 += bone[int(boneID.z)] * normal * boneWeight.z;\nvt0 += bone[int(boneID.w)] * normal * boneWeight.w;\nvt0 = rotationMatrix3D * vt0;\nvt0.xyz = normalize(vt0.xyz);\nv4 = mat3(vec3(vt2.x,vt2.y,vt2.z),vec3(vt1.x,vt1.y,vt1.z),vec3(vt0.x,vt0.y,vt0.z));\n":"vt0 = bone[int(boneID.x)] * normal * boneWeight.x;\nvt0 += bone[int(boneID.y)] * normal * boneWeight.y;\nvt0 += bone[int(boneID.z)] * normal * boneWeight.z;\nvt0 += bone[int(boneID.w)] * normal * boneWeight.w;\nvt0 = rotationMatrix3D * vt0;\nvt0.xyz = normalize(vt0.xyz);\nv4 = vec3(vt0.x,vt0.y,vt0.z);\n":(i||n)&&(s+="vt0 = bone[int(boneID.x)] * normal * boneWeight.x;\nvt0 += bone[int(boneID.y)] * normal * boneWeight.y;\nvt0 += bone[int(boneID.z)] * normal * boneWeight.z;\nvt0 += bone[int(boneID.w)] * normal * boneWeight.w;\nvt0 = rotationMatrix3D * vt0;\nvt0.xyz = normalize(vt0.xyz);\n"),i?s+="vec3 lpb = sh[0] * 0.28209479177387814;\nlpb += sh[1] * (vt0.y * -0.4886025119029199);\nlpb += sh[2] * (vt0.z * 0.4886025119029199);\nlpb += sh[3] * (vt0.x * -0.4886025119029199);\nlpb += sh[4] * (vt0.x * vt0.y * 1.0925484305920792);\nlpb += sh[5] * (vt0.z * vt0.y * -1.0925484305920792);\nlpb += sh[6] * ((3.0 * vt0.z * vt0.z - 1.0) * 0.31539156525252005);\nlpb += sh[7] * (vt0.z * vt0.x * -1.0925484305920792);\nlpb += sh[8] * ((vt0.x * vt0.x - vt0.y * vt0.y) * 0.5462742152960396);\nv2 = lpb;\n":n?s+="float suncos = dot(vt0.xyz,sunDirect.xyz);\nsuncos = clamp(suncos,0.0,1.0);\nv2 = sunColor * suncos + ambientColor;":a||(s+="v2 = v2Uv;\n"),s+="}"},e.prototype.getFragmentShaderString=function(){var t="uniform sampler2D s_texture1;\nuniform vec4 testconst;varying vec2 v_texCoord;\nvoid main(void)\n{\nvec4 infoUv = texture2D(s_texture, v_texCoord.xy);\ninfoUv.xyz = testconst.xyz * infoUv.xyz;\ngl_FragColor = infoUv;\n}";return t},e}(Shader3D),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},MaterialBatchAnimShader=function(t){function e(){t.call(this),this.name="Material_Batch_Anim_Shader"}return __extends(e,t),e.prototype.binLocation=function(t){t.bindAttribLocation(this.program,0,"pos"),t.bindAttribLocation(this.program,1,"v2Uv"),t.bindAttribLocation(this.program,2,"boneID"),t.bindAttribLocation(this.program,3,"boneWeight");var e=this.paramAry[0],i=this.paramAry[1],n=this.paramAry[4],a=this.paramAry[5];e?(t.bindAttribLocation(this.program,4,"normal"),i&&(t.bindAttribLocation(this.program,5,"tangent"),t.bindAttribLocation(this.program,6,"bitangent"))):(n||a)&&t.bindAttribLocation(this.program,4,"normal")},e.prototype.getVertexShaderString=function(){var t=this.paramAry[0],e=this.paramAry[1];this.paramAry[2],this.paramAry[3];var i=this.paramAry[4],n=this.paramAry[5],a=this.paramAry[6],s="precision mediump float;\nattribute vec4 pos;\nattribute vec3 v2Uv;\nattribute vec4 boneID;\nattribute vec4 boneWeight;\nvarying vec2 v0;\nuniform mat4 bone[19];\nuniform mat4 viewMatrix3D;\nuniform mat4 camMatrix3D;\nuniform mat4 posMatrixAry[6];\n";return i?s+="varying vec3 v2;\n":n?s+="uniform vec3 sunDirect;\nuniform vec3 sunColor;\nuniform vec3 ambientColor;\nvarying vec3 v2;\n":a||(s+="varying vec2 v2;\n"),t?(s+="attribute vec4 normal;\nuniform mat4 rotationMatrix3D;\nvarying vec3 v1;\n",s+=e?"varying mat3 v4;\n":"varying vec3 v4;\n",e&&(s+="attribute vec4 tangent;\nattribute vec4 bitangent;\n")):(i||n)&&(s+="attribute vec4 normal;\nuniform mat4 rotationMatrix3D;\n"),s+="void main(void){\nv0 = vec2(v2Uv.xy);\nvec4 vt0 = bone[int(boneID.x)] * pos * boneWeight.x;\nvt0 += bone[int(boneID.y)] * pos * boneWeight.y;\nvt0 += bone[int(boneID.z)] * pos * boneWeight.z;\nvt0 += bone[int(boneID.w)] * pos * boneWeight.w;\nvt0 = posMatrixAry[int(v2Uv.z)] * vt0;\n",t&&(s+="v1 = vec3(vt0.x,vt0.y,vt0.z);\n"),s+="vt0 = camMatrix3D * vt0;\nvt0 = viewMatrix3D * vt0;\ngl_Position = vt0;\n",t?s+=e?"vec4 vt2 = bone[int(boneID.x)] * tangent * boneWeight.x;\nvt2 += bone[int(boneID.y)] * tangent * boneWeight.y;\nvt2 += bone[int(boneID.z)] * tangent * boneWeight.z;\nvt2 += bone[int(boneID.w)] * tangent * boneWeight.w;\nvt2 = rotationMatrix3D * vt2;\nvt2.xyz = normalize(vt2.xyz);\nvec4 vt1 = bone[int(boneID.x)] * bitangent * boneWeight.x;\nvt1 += bone[int(boneID.y)] * bitangent * boneWeight.y;\nvt1 += bone[int(boneID.z)] * bitangent * boneWeight.z;\nvt1 += bone[int(boneID.w)] * bitangent * boneWeight.w;\nvt1 = rotationMatrix3D * vt1;\nvt1.xyz = normalize(vt1.xyz);\nvt0 = bone[int(boneID.x)] * normal * boneWeight.x;\nvt0 += bone[int(boneID.y)] * normal * boneWeight.y;\nvt0 += bone[int(boneID.z)] * normal * boneWeight.z;\nvt0 += bone[int(boneID.w)] * normal * boneWeight.w;\nvt0 = rotationMatrix3D * vt0;\nvt0.xyz = normalize(vt0.xyz);\nv4 = mat3(vec3(vt2.x,vt2.y,vt2.z),vec3(vt1.x,vt1.y,vt1.z),vec3(vt0.x,vt0.y,vt0.z));\n":"vt0 = bone[int(boneID.x)] * normal * boneWeight.x;\nvt0 += bone[int(boneID.y)] * normal * boneWeight.y;\nvt0 += bone[int(boneID.z)] * normal * boneWeight.z;\nvt0 += bone[int(boneID.w)] * normal * boneWeight.w;\nvt0 = rotationMatrix3D * vt0;\nvt0.xyz = normalize(vt0.xyz);\nv4 = vec3(vt0.x,vt0.y,vt0.z);\n":(i||n)&&(s+="vt0 = bone[int(boneID.x)] * normal * boneWeight.x;\nvt0 += bone[int(boneID.y)] * normal * boneWeight.y;\nvt0 += bone[int(boneID.z)] * normal * boneWeight.z;\nvt0 += bone[int(boneID.w)] * normal * boneWeight.w;\nvt0 = rotationMatrix3D * vt0;\nvt0.xyz = normalize(vt0.xyz);\n"),i?s+="vec3 lpb = normalize(vec3(1.0,1.0,-1.0));\nfloat lp = min(0.0,dot(lpb,vec3(vt0.xyz)));\nlp = lp * 2.0 + 0.7;\nv2 = vec3(lp,lp,lp);\n":n?s+="float suncos = dot(vt0.xyz,sunDirect.xyz);\nsuncos = clamp(suncos,0.0,1.0);\nv2 = sunColor * suncos + ambientColor;":a||(s+="v2 = v2Uv;\n"),s+="}"},e.prototype.getFragmentShaderString=function(){var t="uniform sampler2D s_texture1;\nuniform vec4 testconst;varying vec2 v_texCoord;\nvoid main(void)\n{\nvec4 infoUv = texture2D(s_texture, v_texCoord.xy);\ninfoUv.xyz = testconst.xyz * infoUv.xyz;\ngl_FragColor = infoUv;\n}";return t},e}(Shader3D),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},SkyShader=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.binLocation=function(t){t.bindAttribLocation(this.program,0,"v3Position"),t.bindAttribLocation(this.program,1,"v3Normal")},e.prototype.getVertexShaderString=function(){var t="attribute vec3 v3Position;attribute vec3 v3Normal;uniform mat4 viewMatrix3D;uniform mat4 camMatrix3D;uniform mat4 posMatrix3D;varying vec3 vNormal;void main(void){   vNormal = vec3(v3Normal.x, v3Normal.y,v3Normal.z);   vec4 vt0= vec4(v3Position, 1.0);   vt0 = posMatrix3D * vt0;   vt0 = camMatrix3D * vt0;   vt0 = viewMatrix3D * vt0;   gl_Position = vt0;}";return t},e.prototype.getFragmentShaderString=function(){var t="precision mediump float;\nuniform samplerCube s_texture;\nvarying vec3 vNormal;\nvoid main(void)\n{\nvec4 infoUv = textureCube(s_texture, vNormal);\ngl_FragColor = infoUv;\n}";return t},e.Sky_Shader="SkyShader",e}(Shader3D),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Display3DShadowShader=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.binLocation=function(t){t.bindAttribLocation(this.program,0,"v3Pos"),t.bindAttribLocation(this.program,1,"v2uv")},e.prototype.getVertexShaderString=function(){var t="attribute vec3 v3Pos;attribute vec3 v2uv;uniform mat4 viewMatrix3D;uniform mat4 camMatrix3D;uniform vec4 pos[30];varying vec2 v_texCoord;void main(void){   v_texCoord = vec2(v2uv.x, v2uv.y);   vec3 vt1= vec3(v3Pos.xyz * pos[int(v2uv.z)].w + pos[int(v2uv.z)].xyz);   vec4 vt0= vec4(vt1, 1.0);   vt0 = camMatrix3D * vt0;   vt0 = viewMatrix3D * vt0;   gl_Position = vt0;}";return t},e.prototype.getFragmentShaderString=function(){var t=" precision mediump float;\nuniform sampler2D s_texture;\nvarying vec2 v_texCoord;\nvoid main(void)\n{\nvec4 infoUv = texture2D(s_texture, v_texCoord.xy);\ninfoUv.xyz *= infoUv.w;\ngl_FragColor = infoUv;\n}";return t},e.Display3DShadowShader="Display3DShadowShader",e}(Shader3D),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},UIShader=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.binLocation=function(t){t.bindAttribLocation(this.program,0,"v3Pos"),t.bindAttribLocation(this.program,1,"v2uv")},e.prototype.getVertexShaderString=function(){var t="attribute vec3 v3Pos;attribute vec3 v2uv;uniform vec4 ui[30];uniform vec4 ui2[30];varying vec2 v_texCoord;void main(void){   vec4 data = ui2[int(v2uv.z)];   v_texCoord = vec2(v2uv.x * data.x + data.z, v2uv.y * data.y + data.w);   data = ui[int(v2uv.z)];   vec3 pos = vec3(0.0,0.0,0.0);   pos.xy = v3Pos.xy * data.zw * 2.0;   pos.x += data.x * 2.0 - 1.0;   pos.y += -data.y * 2.0 + 1.0;   vec4 vt0= vec4(pos, 1.0);   gl_Position = vt0;}";return t},e.prototype.getFragmentShaderString=function(){var t=" precision mediump float;\nuniform sampler2D s_texture;\nvarying vec2 v_texCoord;\nvoid main(void)\n{\nvec4 infoUv = texture2D(s_texture, v_texCoord.xy);\ninfoUv.xyz *= infoUv.w;\ngl_FragColor = infoUv;\n}";return t},e.UI_SHADER="UIShader",e}(Shader3D),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},UIImageShader=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.binLocation=function(t){t.bindAttribLocation(this.program,0,"v3Pos"),t.bindAttribLocation(this.program,1,"v2uv")},e.prototype.getVertexShaderString=function(){var t="attribute vec3 v3Pos;attribute vec2 v2uv;uniform vec2 scale;varying vec2 v_texCoord;void main(void){   v_texCoord = vec2(v2uv.x, v2uv.y);   vec4 vt0= vec4(v3Pos.x*scale.x,v3Pos.y*scale.y,v3Pos.z,1.0);   gl_Position = vt0;}";return t},e.prototype.getFragmentShaderString=function(){var t=" precision mediump float;\nuniform sampler2D s_texture;\nvarying vec2 v_texCoord;\nvoid main(void)\n{\nvec4 infoUv = texture2D(s_texture, v_texCoord.xy);\ninfoUv.xyz *= infoUv.w;\ngl_FragColor = infoUv;\n}";return t},e.UI_IMG_SHADER="UI_img_Shader",e}(Shader3D),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},UIMaskShader=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.binLocation=function(t){t.bindAttribLocation(this.program,0,"v3Pos")},e.prototype.getVertexShaderString=function(){var t="attribute vec3 v3Pos;uniform vec4 ui;void main(void){   vec3 pos = vec3(0.0,0.0,0.0);   pos.xy = v3Pos.xy * ui.zw * 2.0;   pos.x += ui.x * 2.0 - 1.0;   pos.y += -ui.y * 2.0 + 1.0;   vec4 vt0= vec4(pos, 1.0);   gl_Position = vt0;}";return t},e.prototype.getFragmentShaderString=function(){var t=" precision mediump float;\nvoid main(void)\n{\ngl_FragColor = vec4(0.5,0.5,0.5,1.0);\n}";return t},e.UI_MASK_SHADER="UImaskShader",e}(Shader3D),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Movie2DShader=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.binLocation=function(t){t.bindAttribLocation(this.program,0,"v3Pos"),t.bindAttribLocation(this.program,1,"v2uv")},e.prototype.getVertexShaderString=function(){var t="attribute vec3 v3Pos;attribute vec3 v2uv;uniform mat4 viewMatrix3D;\nuniform mat4 camMatrix3D;\nuniform mat4 watchCamMatrix3D;\nuniform vec4 posdata[6];uniform vec2 outuv;varying vec2 v_texCoord;void main(void){   vec4 data = posdata[int(v2uv.z)];   vec4 vt0= vec4(v3Pos * data.w,1.0);   vt0= watchCamMatrix3D * vt0;   vt0.xyz += data.xyz;   v_texCoord = vec2(v2uv.x,v2uv.y) + outuv;   gl_Position = viewMatrix3D * camMatrix3D * vt0;}";return t},e.prototype.getFragmentShaderString=function(){var t=" precision mediump float;\nuniform sampler2D s_texture;\nvarying vec2 v_texCoord;\nvoid main(void)\n{\nvec4 infoUv = texture2D(s_texture, v_texCoord.xy);\ninfoUv.xyz *= infoUv.w;\nif(infoUv.w < 0.1){discard;}\ngl_FragColor = infoUv;\n}";return t},e.MOVIE2D_SHADER="Movie2DShader",e}(Shader3D),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Sprite2DShader=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.binLocation=function(t){t.bindAttribLocation(this.program,0,"v3Pos"),t.bindAttribLocation(this.program,1,"v2uv")},e.prototype.getVertexShaderString=function(){var t="attribute vec3 v3Pos;attribute vec3 v2uv;uniform mat4 viewMatrix3D;\nuniform mat4 camMatrix3D;\nuniform mat4 watchCamMatrix3D;\nuniform vec4 posdata[12];varying vec2 v_texCoord;void main(void){   vec4 data = posdata[int(v2uv.z)];   vec4 vt0= vec4(v3Pos * data.w,1.0);   vt0= watchCamMatrix3D * vt0;   vt0.xyz += data.xyz;   v_texCoord = vec2(v2uv.x,v2uv.y);   gl_Position = viewMatrix3D * camMatrix3D * vt0;}";return t},e.prototype.getFragmentShaderString=function(){var t=" precision mediump float;\nuniform sampler2D s_texture;\nvarying vec2 v_texCoord;\nvoid main(void)\n{\nvec4 infoUv = texture2D(s_texture, v_texCoord.xy);\ninfoUv.xyz *= infoUv.w;\nif(infoUv.w < 0.1){discard;}\ngl_FragColor = infoUv;\n}";return t},e.SPRITE2D_SHADER="Sprite2DShader",e}(Shader3D),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},CombineParticle=function(t){function e(){t.call(this),this._maxTime=1e6,this._rotationX=0,this._rotationY=0,this._rotationZ=0,this.hasMulItem=!1,this.sceneVisible=!0,this._displayAry=[],this._time=0,this.bindMatrix=new Matrix3D,this.invertBindMatrix=new Matrix3D,this.bindVecter3d=new Vector3D,this.bindScale=new Vector3D(1,1,1),this.groupMatrix=new Matrix3D,this.groupRotationMatrix=new Matrix3D}return __extends(e,t),Object.defineProperty(e.prototype,"bindTarget",{set:function(t){this._bindTarget=t,this.invertBindMatrix.isIdentity=!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bindSocket",{set:function(t){this._bindSocket=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{set:function(t){this.bindVecter3d.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{set:function(t){this.bindVecter3d.y=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"z",{set:function(t){this.bindVecter3d.z=t},enumerable:!0,configurable:!0}),e.prototype.setPos=function(t,e,i){this.bindVecter3d.setTo(t,e,i);for(var n=0;this._displayAry.length>n;n++)this._displayAry[n].resetPos()},e.prototype.setMulPos=function(t){for(var e=0;this._displayAry.length>e;e++)this._displayAry[e].resetMulPos(t)},Object.defineProperty(e.prototype,"scaleX",{set:function(t){this.bindScale.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleY",{set:function(t){this.bindScale.y=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleZ",{set:function(t){this.bindScale.z=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationX",{set:function(t){this._rotationX=t,this.applyRotation()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationY",{set:function(t){this._rotationY=t,this.applyRotation()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationZ",{set:function(t){this._rotationZ=t,this.applyRotation()},enumerable:!0,configurable:!0}),e.prototype.applyRotation=function(){this.bindMatrix.identity(),this.bindMatrix.appendRotation(this._rotationX,Vector3D.X_AXIS),this.bindMatrix.appendRotation(this._rotationY,Vector3D.Y_AXIS),this.bindMatrix.appendRotation(this._rotationZ,Vector3D.Z_AXIS),this.bindMatrix.copyTo(this.invertBindMatrix),this.invertBindMatrix.invert(),this.invertBindMatrix.isIdentity=!1},e.prototype.setGroup=function(t,e,i){this._isInGroup=!0,this._groupPos=t,this._groupRotation=e,this._groupScale=i,this.groupMatrix.isIdentity=!1,this.groupMatrix.identity(),this.groupMatrix.appendScale(i.x,i.y,i.z),this.groupMatrix.appendRotation(e.x,Vector3D.X_AXIS),this.groupMatrix.appendRotation(e.y,Vector3D.Y_AXIS),this.groupMatrix.appendRotation(e.z,Vector3D.Z_AXIS),this.groupMatrix.appendTranslation(t.x,t.y,t.z),this.groupRotationMatrix.isIdentity=!1,this.groupRotationMatrix.identity(),this.groupRotationMatrix.prependRotation(e.z,Vector3D.Z_AXIS),this.groupRotationMatrix.prependRotation(e.y,Vector3D.Y_AXIS),this.groupRotationMatrix.prependRotation(e.x,Vector3D.X_AXIS)
},e.prototype.setDataByte=function(t){var e=t.readInt();this._sourceComNum=0,this._maxTime=0,this._sourceAllNum=e,this._displayAry=[];for(var i=0;e>i;i++){var n=t.readInt(),a=t.readUTF(),s=JSON.parse(a),o=this.getDisplay3DById(n);o.setAllByteInfo(t,s),o.setBind(this.bindVecter3d,this.bindMatrix,this.bindScale,this.invertBindMatrix,this.groupMatrix),this._displayAry.push(o),o.timeline.maxFrameNum>this._maxTime&&(this._maxTime=o.timeline.maxFrameNum)}this._maxTime*=Scene_data.frameTime},e.prototype.getDisplay3DById=function(t){var e={};return e.particleType=t,this.getDisplay3D(e)},e.prototype.setData=function(t){this._sourceComNum=0,this._sourceAllNum=t.length,this._displayAry=[],this._maxTime=0;for(var e=0;t.length>e;e++){var i=t[e].display,n=this.getDisplay3D(i);n.setAllInfo(t[e]),n.setBind(this.bindVecter3d,this.bindMatrix,this.bindScale,this.invertBindMatrix,this.groupMatrix),this._displayAry.push(n),n.timeline.maxFrameNum>this._maxTime&&(this._maxTime=n.timeline.maxFrameNum)}this._maxTime*=Scene_data.frameTime},e.prototype.updateTime=function(t){this._time+=t;for(var e=0;this._displayAry.length>e;e++)this._displayAry[e].updateTime(this._time);this.updateBind(),this._time>=this._maxTime&&this.dispatchEvent(new BaseEvent(BaseEvent.COMPLETE))},e.prototype.updateBind=function(){this._bindTarget&&(this._bindTarget.getSocket(this._bindSocket,this.bindMatrix),this.bindVecter3d.setTo(this.bindMatrix.x,this.bindMatrix.y,this.bindMatrix.z),this.bindMatrix.identityPostion(),this.groupRotationMatrix.isIdentity?this.bindMatrix.invertToMatrix(this.invertBindMatrix):(this.bindMatrix.copyTo(this.invertBindMatrix),this.invertBindMatrix.prepend(this.groupRotationMatrix),this.invertBindMatrix.invert()))},e.prototype.reset=function(){this._time=0;for(var t=0;this._displayAry.length>t;t++)this._displayAry[t].reset()},e.prototype.update=function(){for(var t=0;this._displayAry.length>t;t++)this._displayAry[t].update()},e.prototype.getDisplay3D=function(t){var e,i=t.particleType;switch(i){case 1:e=new Display3DFacetParticle;break;case 18:e=new Display3DBallPartilce;break;case 3:e=new Display3DLocusPartilce;break;case 14:e=new Display3DLocusBallPartilce;break;case 9:e=new Display3DModelObjParticle;break;case 4:e=new Display3DModelPartilce;break;case 7:e=new Display3dModelAnimParticle;break;case 8:e=new Display3DFollowPartilce;break;case 12:e=new Display3DFollowLocusPartilce;break;case 22:e=new Display3DFollowMulLocusParticle,this.hasMulItem=!0}return e.visible=!1,e},e}(EventDispatcher),ParticleManager=function(){function t(){this._time=0,this._particleList=[],this._resDic={},this.initShader()}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.initShader=function(){ProgrmaManager.getInstance().registe(Display3DFacetShader.Display3D_Facet_Shader,new Display3DFacetShader)},t.prototype.getParticle=function(t){var e,i=this;e=new CombineParticle;var n=Scene_data.fileRoot+t;return this._resDic[n]?this.onLoadCom(this._resDic[n],e):LoadManager.getInstance().load(n,LoadManager.XML_TYPE,function(t,e){i.onLoadCom(t,e)},e),e},t.prototype.addRes=function(t,e){this._resDic[t]||(this._resDic[t]=e)},t.prototype.update=function(){for(var t=0;this._particleList.length>t;t++)this._particleList[t].sceneVisible&&this._particleList[t].update()},t.prototype.updateTime=function(){for(var t=TimeUtil.getTimer(),e=t-this._time,i=0;this._particleList.length>i;i++)this._particleList[i].sceneVisible&&this._particleList[i].updateTime(e);this._time=t},t.prototype.addParticle=function(t){-1==this._particleList.lastIndexOf(t)&&this._particleList.push(t)},t.prototype.removeParticle=function(t){var e=this._particleList.indexOf(t);-1!=e&&this._particleList.splice(e,1)},t.prototype.onLoadCom=function(t,e){var i=JSON.parse(t);e.setData(i)},t}(),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Display3DParticle=function(t){function e(){t.call(this),this._width=100,this._height=100,this._originWidthScale=.5,this._originHeightScale=.5,this._eyeDistance=0,this._watchEye=!1,this._isZiZhuan=!1,this.overAllScale=1,this.isInGroup=!1,this.visible=!0,this._rotationMatrix=new Matrix3D,this.modelMatrix=new Matrix3D}return __extends(e,t),e.prototype.setBind=function(t,e,i,n,a){this.bindVecter3d=t,this.bindMatrix=e,this.bindScale=i,this.invertBindMatrix=n,this.groupMatrix=a},e.prototype.getMulBindList=function(){return null},e.prototype.updateMatrix=function(){this.bindMatrix&&(this.modelMatrix.identity(),this.groupMatrix.isIdentity||this.posMatrix.append(this.groupMatrix),this.modelMatrix.append(this.posMatrix),this.modelMatrix.append(this.bindMatrix),this.modelMatrix.appendTranslation(this.bindVecter3d.x,this.bindVecter3d.y,this.bindVecter3d.z))},e.prototype.updateTime=function(t){this._time=t-this._beginTime,this.timeline.updateTime(t),this.visible=this.timeline.visible,this.posMatrix.identity(),this.posMatrix.prependScale(.1*this._scaleX*this.bindScale.x,.1*this._scaleY*this.bindScale.y,.1*this._scaleZ*this.bindScale.z),this.timeline.updateMatrix(this.posMatrix,this)},e.prototype.reset=function(){this.timeline.reset(),this.updateTime(0)},e.prototype.clearAllAnim=function(){},e.prototype.update=function(){this.visible&&this.materialParam&&(Scene_data.context3D.setBlendParticleFactors(this._alphaMode),this.materialParam?Scene_data.context3D.setProgram(this.materialParam.program):Scene_data.context3D.setProgram(this.program),this.updateMatrix(),this.setVc(),this.setVa())},e.prototype.setVc=function(){},e.prototype.setVa=function(){},e.prototype.setMaterialVc=function(){if(this.materialParam){for(var t=this.materialParam.dynamicConstList,e=this._time%(Scene_data.frameTime*this._life),i=0;t.length>i;i++)t[i].update(e);this.materialParam.material.hasTime&&(e*=this.materialParam.material.timeSpeed,Scene_data.context3D.setVc4fv(this.materialParam.program,"fc0",[1,0,0,e]));for(var n=this.materialParam.material.constList,i=0;n.length>i;i++)Scene_data.context3D.setVc4fv(this.materialParam.program,"fc"+n[i].id,n[i].vecNum)}},e.prototype.setMaterialTexture=function(){if(this.materialParam){for(var t=this.materialParam.material.texList,e=0;t.length>e;e++)t[e].isDynamic||Scene_data.context3D.setRenderTexture(this.materialParam.program,t[e].name,t[e].texture,t[e].id);for(var i=this.materialParam.dynamicTexList,e=0;i.length>e;e++)Scene_data.context3D.setRenderTexture(this.materialParam.program,i[e].target.name,i[e].texture,i[e].target.id)}},e.prototype.inverBind=function(){this.invertBindMatrix.isIdentity||this._rotationMatrix.prepend(this.invertBindMatrix)},e.prototype.resetPos=function(){},e.prototype.resetMulPos=function(){},e.prototype.setAllByteInfo=function(t){this.timeline=new TimeLine;var e=t.readUTF();this.timeline.setAllInfo(JSON.parse(e)),this._beginTime=this.timeline.beginTime,this._width=t.readFloat(),this._height=t.readFloat(),this._widthFixed=t.readBoolean(),this._heightFixed=t.readBoolean(),this._originWidthScale=t.readFloat(),this._originHeightScale=t.readFloat(),this._eyeDistance=t.readFloat(),this._alphaMode=t.readFloat(),this._uSpeed=t.readFloat(),this._vSpeed=t.readFloat(),this._animLine=t.readFloat(),this._animRow=t.readFloat(),this._animInterval=t.readFloat(),this._renderPriority=t.readFloat(),this._distortion=t.readBoolean(),this._isUV=t.readBoolean(),this._isU=t.readBoolean(),this._isV=t.readBoolean(),this._life=t.readFloat(),this._life=this._life>1e4?Scene_data.MAX_NUMBER:this._life,this._watchEye=t.readBoolean(),this._ziZhuanAngly=new Vector3D,this._ziZhuanAngly.x=t.readFloat(),this._ziZhuanAngly.y=t.readFloat(),this._ziZhuanAngly.z=t.readFloat(),this._ziZhuanAngly.w=t.readFloat(),this.rotationX=t.readFloat(),this.rotationY=t.readFloat(),this.rotationZ=t.readFloat();var i=new Vector3D;i.x=t.readFloat(),i.y=t.readFloat(),i.z=t.readFloat(),i.w=t.readFloat(),this.center=i,this.overAllScale=t.readFloat();var n=t.readUTF();this.materialParamData=JSON.parse(n),this.materialUrl=t.readUTF(),!this._ziZhuanAngly||0==this._ziZhuanAngly.x&&0==this._ziZhuanAngly.y&&0==this._ziZhuanAngly.z||(this._isZiZhuan=!0)},e.prototype.setAllInfo=function(t){this.timeline=new TimeLine,this.timeline.setAllInfo(t.timeline),this._beginTime=this.timeline.beginTime;var e=t.display;this._width=e.width,this._height=e.height,this._widthFixed=e.widthFixed,this._heightFixed=e.heightFixed,this._originWidthScale=e.originWidthScale,this._originHeightScale=e.originHeightScale,this._eyeDistance=e.eyeDistance,this._alphaMode=e.alphaMode,this._uSpeed=e.uSpeed,this._vSpeed=e.vSpeed,this._animLine=0==e.animLine?1:e.animLine,this._animRow=0==e.animRow?1:e.animRow,this._animInterval=0==e.animInterval?1:e.animInterval,this._renderPriority=e.renderPriority,this._distortion=e.distortion,this._isUV=e.isUV,this._isU=e.isU,this._isV=e.isV,this._life=e.life>1e4?Scene_data.MAX_NUMBER:e.life,this._watchEye=e.watchEye,this._ziZhuanAngly=this.getVector3DByObject(e.ziZhuanAngly),!this._ziZhuanAngly||0==this._ziZhuanAngly.x&&0==this._ziZhuanAngly.y&&0==this._ziZhuanAngly.z||(this._isZiZhuan=!0),e.rotationX&&(this.rotationX=e.rotationX),e.rotationY&&(this.rotationY=e.rotationY),e.rotationZ&&(this.rotationZ=e.rotationZ),e.center&&(this.center=this.getVector3DByObject(e.center)),e.overAllScale&&(this.overAllScale=e.overAllScale),this.materialParamData=e.materialParam,this.materialUrl=e.materialUrl},Object.defineProperty(e.prototype,"center",{set:function(t){this._center=t,this.x=t.x,this.y=t.y,this.z=t.z},enumerable:!0,configurable:!0}),e.prototype.getVector3DByObject=function(t){return t?new Vector3D(t.x,t.y,t.z,t.w):null},Object.defineProperty(e.prototype,"widthFixed",{get:function(){return this._widthFixed},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"heightFixed",{get:function(){return this._heightFixed},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"materialUrl",{get:function(){return this._materialUrl},set:function(t){var e=this;this._materialUrl!=t&&(this._materialUrl=t,MaterialManager.getInstance().getMaterial(Scene_data.fileRoot+t,function(t){e.onMaterialLoad(t)}))},enumerable:!0,configurable:!0}),e.prototype.onMaterialLoad=function(t){this.materialParam=new MaterialParam,this.materialParam.setMaterial(t),this.materialParam.setLife(this._life),this.materialParamData&&(this.materialParam.setTextObj(this.materialParamData.texAry),this.materialParam.setConstObj(this.materialParamData.conAry)),MaterialManager.getInstance().loadDynamicTexUtil(this.materialParam),this.regShader()},e.prototype.regShader=function(){},e.prototype.clone=function(){return null},e}(Display3D),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},ParticleData=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(ObjData),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Display3DFacetParticle=function(t){function e(){t.call(this),this._isCycle=!1,this._lifeVisible=!0,this.objData=new ParticleData,this._resultUvVec=Array(2)}return __extends(e,t),e.prototype.update=function(){this._lifeVisible&&t.prototype.update.call(this)},e.prototype.reset=function(){t.prototype.reset.call(this),this._lifeVisible=!0},e.prototype.setVc=function(){this.updateRotaionMatrix(),this.updateUV(),Scene_data.context3D.setVcMatrix4fv(this.materialParam.program,"viewMatrix3D",Scene_data.viewMatrx3D.m),Scene_data.context3D.setVcMatrix4fv(this.materialParam.program,"camMatrix3D",Scene_data.cam3D.cameraMatrix.m),Scene_data.context3D.setVcMatrix4fv(this.materialParam.program,"posMatrix3D",this.modelMatrix.m),Scene_data.context3D.setVcMatrix4fv(this.materialParam.program,"rotationMatrix3D",this._rotationMatrix.m),Scene_data.context3D.setVc2fv(this.materialParam.program,"uvMove",this._resultUvVec),this.setMaterialVc(),!this._isCycle&&this._time/Scene_data.frameTime>this._life-2&&(this._lifeVisible=!1)},e.prototype.setVa=function(){Scene_data.context3D.setVa(0,3,this.objData.vertexBuffer),Scene_data.context3D.setVa(1,2,this.objData.uvBuffer),this.setMaterialTexture(),Scene_data.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum)},e.prototype.updateRotaionMatrix=function(){this._rotationMatrix.identity(),this._watchEye&&(this.timeline.inverAxisRotation(this._rotationMatrix),this._locky||this._lockx||this.inverBind(),this._locky||this._rotationMatrix.prependRotation(-Scene_data.cam3D.rotationY,Vector3D.Y_AXIS),this._lockx||this._rotationMatrix.prependRotation(-Scene_data.cam3D.rotationX,Vector3D.X_AXIS)),this._isZiZhuan&&this.timeline.applySelfRotation(this._rotationMatrix,this._ziZhuanAngly)},e.prototype.updateUV=function(){var t=float2int(this._time/Scene_data.frameTime);t=t>this._maxAnimTime?this._maxAnimTime:t,t=t/this._animInterval%(this._animLine*this._animRow),this._resultUvVec[0]=float2int(t%this._animLine)/this._animLine+this._time/Scene_data.frameTime*this._uSpeed,this._resultUvVec[1]=float2int(t/this._animLine)/this._animRow+this._time/Scene_data.frameTime*this._vSpeed},e.prototype.makeRectangleData=function(t,e,i,n,a,s,o,r,h){void 0===i&&(i=.5),void 0===n&&(n=.5),void 0===a&&(a=!1),void 0===s&&(s=!1),void 0===o&&(o=!1),void 0===r&&(r=1),void 0===h&&(h=1);var c=[],l=[];l.push(-i*t,e-n*e,0),l.push(t-i*t,e-n*e,0),l.push(t-i*t,-n*e,0),l.push(-i*t,-n*e,0);var u=[];if(u.push(new Vector2D(0,0)),u.push(new Vector2D(0,1/h)),u.push(new Vector2D(1/r,1/h)),u.push(new Vector2D(1/r,0)),s)for(var d=0;u.length>d;d++)u[d].x=-u[d].x;if(o)for(var d=0;u.length>d;d++)u[d].y=-u[d].y;a&&u.push(u.shift());for(var d=0;u.length>d;d++)c.push(u[d].x,u[d].y);var p=[];p.push(0,1,2,0,2,3),this.objData.vertexBuffer=Scene_data.context3D.uploadBuff3D(l),this.objData.uvBuffer=Scene_data.context3D.uploadBuff3D(c),this.objData.indexBuffer=Scene_data.context3D.uploadIndexBuff3D(p),this.objData.treNum=p.length},e.prototype.setAllByteInfo=function(e,i){this._maxAnimTime=e.readFloat(),this._isCycle=e.readBoolean(),this._lockx=e.readBoolean(),this._locky=e.readBoolean(),t.prototype.setAllByteInfo.call(this,e,i),this.uploadToGpu()},e.prototype.setAllInfo=function(e){this._maxAnimTime=e.display.maxAnimTime,this._isCycle=e.display.isCycle,this._lockx=e.display.lockx,this._locky=e.display.locky,t.prototype.setAllInfo.call(this,e),this.uploadToGpu()},e.prototype.uploadToGpu=function(){this.makeRectangleData(this._width,this._height,this._originWidthScale,this._originHeightScale,this._isUV,this._isU,this._isV,this._animLine,this._animRow)},e.prototype.regShader=function(){this.materialParam.program=ProgrmaManager.getInstance().getMaterialProgram(Display3DFacetShader.Display3D_Facet_Shader,new Display3DFacetShader,this.materialParam.material)},e}(Display3DParticle),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Display3DFacetShader=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.binLocation=function(t){t.bindAttribLocation(this.program,0,"v3Position"),t.bindAttribLocation(this.program,1,"v2TexCoord")},e.prototype.getVertexShaderString=function(){var t="attribute vec4 v3Position;\nattribute vec2 v2TexCoord;\nuniform mat4 viewMatrix3D;\nuniform mat4 camMatrix3D;\nuniform mat4 rotationMatrix3D;\nuniform mat4 posMatrix3D;\nuniform vec2 uvMove;\nvarying vec2 v0;\nvoid main(void){\n   v0 = v2TexCoord + uvMove;\n   gl_Position = viewMatrix3D  * camMatrix3D * posMatrix3D * rotationMatrix3D * v3Position;\n}";return t},e.prototype.getFragmentShaderString=function(){var t=" precision mediump float;\nuniform sampler2D tex;\nvarying vec2 v0;\nvoid main(void)\n{\nvec4 infoUv = texture2D(tex, v0.xy);\ngl_FragColor = infoUv;\n}";return t},e.Display3D_Facet_Shader="Display3DFacetShader",e}(Shader3D),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Display3DBallPartilce=function(t){function e(){t.call(this),this._totalNum=1,this._acceleration=.2,this._toscale=0,this._shootAngly=new Vector3D(1,0,0),this._shootSpeed=0,this._isRandom=!1,this._isSendRandom=!1,this._isSendAngleRandom=!1,this._paticleMaxScale=1,this._paticleMinScale=1,this._addforce=new Vector3D(0,0,0),this._lixinForce=new Vector3D(0,0,0),this._waveform=new Vector3D(0,0,0,0),this._round=new Vector3D,this._is3Dlizi=!1,this._speed=1,this._isLoop=!1,this._basePositon=new Vector3D(0,0,0),this._baseRandomAngle=0,this._shapeType=0,this._playSpeed=1,this._beginScale=0,this.objData=new ParticleBallData}return __extends(e,t),e.prototype.setVa=function(){Scene_data.context3D.setVa(0,3,this.objData.vertexBuffer),Scene_data.context3D.setVa(1,3,this.objData.uvBuffer),Scene_data.context3D.setVa(2,4,this.particleBallData.basePosBuffer),Scene_data.context3D.setVa(3,3,this.particleBallData.beMoveBuffer),this._needSelfRotation&&Scene_data.context3D.setVa(4,2,this.particleBallData.baseRotationBuffer),this._needRandomColor&&Scene_data.context3D.setVa(5,4,this.particleBallData.randomColorBuffer),this.setMaterialTexture(),Scene_data.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum)},e.prototype.setVc=function(){this.updateWatchCaramMatrix(),Scene_data.context3D.setVcMatrix4fv(this.materialParam.program,"viewMatrix",Scene_data.viewMatrx3D.m),Scene_data.context3D.setVcMatrix4fv(this.materialParam.program,"cameraMatrix",Scene_data.cam3D.cameraMatrix.m),Scene_data.context3D.setVcMatrix4fv(this.materialParam.program,"modelMatrix",this.modelMatrix.m),Scene_data.context3D.setVcMatrix4fv(this.materialParam.program,"watheye",this._rotationMatrix.m),this._timeVec[0]=this._time/Scene_data.frameTime*this._playSpeed,Scene_data.context3D.setVc4fv(this.materialParam.program,"time",this._timeVec),this._needAddSpeed&&Scene_data.context3D.setVc3fv(this.materialParam.program,"force",this._addSpeedVec),this._needScale&&(Scene_data.context3D.setVc4fv(this.materialParam.program,"scale",this._scaleVec),Scene_data.context3D.setVc4fv(this.materialParam.program,"scaleCtrl",this._scaleCtrlVec)),this._is3Dlizi&&(this.updateAllRotationMatrix(),this._wordPosVec[0]=this.bindVecter3d.x,this._wordPosVec[1]=this.bindVecter3d.y,this._wordPosVec[2]=this.bindVecter3d.z,this._caramPosVec[0]=Scene_data.cam3D.x,this._caramPosVec[1]=Scene_data.cam3D.y,this._caramPosVec[2]=Scene_data.cam3D.z,Scene_data.context3D.setVcMatrix4fv(this.materialParam.program,"rotationMatrix",this._allRotationMatrix.m),Scene_data.context3D.setVc3fv(this.materialParam.program,"worldPos",this._wordPosVec),Scene_data.context3D.setVc3fv(this.materialParam.program,"camPos",this._caramPosVec)),1==this._uvType?Scene_data.context3D.setVc3fv(this.materialParam.program,"animCtrl",this._animCtrlVec):2==this._uvType&&Scene_data.context3D.setVc2fv(this.materialParam.program,"uvCtrl",this._uvCtrlVec),this.setMaterialVc()},e.prototype.updateWatchCaramMatrix=function(){this._rotationMatrix.identity(),this.facez?this._rotationMatrix.prependRotation(90,Vector3D.X_AXIS):this._is3Dlizi?(this.timeline.inverAxisRotation(this._rotationMatrix),this.inverBind()):this._watchEye&&(this.timeline.inverAxisRotation(this._rotationMatrix),this.inverBind(),this._rotationMatrix.prependRotation(-Scene_data.cam3D.rotationY,Vector3D.Y_AXIS),this._rotationMatrix.prependRotation(-Scene_data.cam3D.rotationX,Vector3D.X_AXIS))},e.prototype.updateAllRotationMatrix=function(){this._allRotationMatrix.identity(),this._allRotationMatrix.prependScale(.1*this.overAllScale*this._scaleX*this.bindScale.x,.1*this.overAllScale*this._scaleY*this.bindScale.y,.1*this.overAllScale*this._scaleZ*this.bindScale.z),this.timeline.inverAxisRotation(this._rotationMatrix),this.isInGroup&&(this._allRotationMatrix.appendRotation(this.groupRotation.x,Vector3D.X_AXIS),this._allRotationMatrix.appendRotation(this.groupRotation.y,Vector3D.Y_AXIS),this._allRotationMatrix.appendRotation(this.groupRotation.z,Vector3D.Z_AXIS)),this.bindMatrix&&this._allRotationMatrix.append(this.bindMatrix)},e.prototype.uploadToGpu=function(){this.initBaseData(),this.initBasePos(),this.initSpeed(),this.initSelfRotaion(),this.pushToGpu()},e.prototype.pushToGpu=function(){this.particleBallData.vertexBuffer=Scene_data.context3D.uploadBuff3D(this.particleBallData.vertices),this.particleBallData.uvBuffer=Scene_data.context3D.uploadBuff3D(this.particleBallData.uvs),this.particleBallData.basePosBuffer=Scene_data.context3D.uploadBuff3D(this.particleBallData.basePos),this.particleBallData.beMoveBuffer=Scene_data.context3D.uploadBuff3D(this.particleBallData.beMove),this.particleBallData.indexBuffer=Scene_data.context3D.uploadIndexBuff3D(this.particleBallData.indexs),this.particleBallData.treNum=this.particleBallData.indexs.length,this._needSelfRotation&&(this.particleBallData.baseRotationBuffer=Scene_data.context3D.uploadBuff3D(this.particleBallData.baseRotation))},e.prototype.initBaseData=function(){for(var t=[],e=[],i=[],n=0;this._totalNum>n;n++)this.makeRectangleData(t,e,this._width,this._height,this._originWidthScale,this._originHeightScale,this._isUV,this._isU,this._isV,this._animLine,this._animRow,n),i.push(0+4*n,1+4*n,2+4*n,0+4*n,2+4*n,3+4*n);this.particleBallData.vertices=t,this.particleBallData.uvs=e,this.particleBallData.indexs=i},e.prototype.initBasePos=function(){for(var t=[],e=0;this._totalNum>e;e++){var i,n;if(this._isRandom){var a=new Vector3D(this._round.x*this._round.w,this._round.y*this._round.w,this._round.z*this._round.w);this._isEven?this._closeSurface?(i=new Vector3D(0,0,a.z),n=new Matrix3D,n.appendRotation(360*Math.random(),Vector3D.Y_AXIS),i=n.transformVector(i),i.y=2*a.y*Math.random()-a.y):(i=new Vector3D(0,0,2*a.z*Math.random()-a.z),n=new Matrix3D,n.appendRotation(360*Math.random(),Vector3D.Y_AXIS),i=n.transformVector(i),i.y=2*a.y*Math.random()-a.y):this._closeSurface?(i=new Vector3D(0,0,a.z),n=new Matrix3D,this._halfCircle?n.appendRotation(180*-Math.random(),Vector3D.X_AXIS):n.appendRotation(360*Math.random(),Vector3D.X_AXIS),n.appendRotation(360*Math.random(),Vector3D.Y_AXIS),i=n.transformVector(i)):i=this._halfCircle?new Vector3D(2*a.x*Math.random()-a.x,a.y*Math.random(),2*a.z*Math.random()-a.z):new Vector3D(2*a.x*Math.random()-a.x,2*a.y*Math.random()-a.y,2*a.z*Math.random()-a.z)}else i=new Vector3D;i=i.add(this._basePositon);for(var s=0;4>s;s++)t.push(i.x,i.y,i.z,e*this._shootSpeed)}this.particleBallData.basePos=t},e.prototype.initSpeed=function(){for(var t=[],e=0;this._totalNum>e;e++){var i=new Vector3D,n=new Vector3D;if(0!=this._shootAngly.x||0!=this._shootAngly.y||0!=this._shootAngly.z){var a=Math.tan(this._shootAngly.w*Math.PI/180*Math.random()),s=360*Math.PI/180*Math.random();n=new Vector3D(Math.sin(s)*a,Math.cos(s)*a,1);var o=new Matrix3D;o.fromVtoV(new Vector3D(0,0,1),new Vector3D(this._shootAngly.x,this._shootAngly.y,this._shootAngly.z)),n=o.transformVector(n),n.normalize(),i=i.add(n)}(0!=this._lixinForce.x||0!=this._lixinForce.y||0!=this._lixinForce.z)&&(n=new Vector3D(Math.random()>.5?-this._lixinForce.x:this._lixinForce.x,Math.random()>.5?-this._lixinForce.y:this._lixinForce.y,Math.random()>.5?-this._lixinForce.z:this._lixinForce.z),n.normalize(),i=i.add(n)),this._islixinAngly&&(n=this._isEven?new Vector3D(this.particleBallData.basePos[16*e],0,this.particleBallData.basePos[16*e+2]):new Vector3D(this.particleBallData.basePos[16*e],this.particleBallData.basePos[16*e+1],this.particleBallData.basePos[16*e+2]),n.normalize(),i=i.add(n)),i.normalize(),this._isSendRandom?i.scaleBy(this._speed*Math.random()):i.scaleBy(this._speed),this._baseRandomAngle*Math.random()*Math.PI/180;for(var r=0;4>r;r++)t.push(i.x,i.y,i.z)}this.particleBallData.beMove=t},e.prototype.initBaseColor=function(){for(var t=ColorTransition.getInstance().getImageData(this._textureRandomColorInfo),e=t.data,i=[],n=0;this._totalNum>n;n++){var a=4*float2int(128*Math.random()),s=new Vector3D(e[a],e[a+1],e[a+2],e[a+3]);s.scaleBy(1/255),i.push(s.x,s.y,s.z,s.w),i.push(s.x,s.y,s.z,s.w),i.push(s.x,s.y,s.z,s.w),i.push(s.x,s.y,s.z,s.w)}this.particleBallData.randomColor=i,this.particleBallData.randomColorBuffer=Scene_data.context3D.uploadBuff3D(this.particleBallData.randomColor)},e.prototype.initSelfRotaion=function(){var t=0,e=0;if(0==this._ziZhuanAngly.x&&0==this._ziZhuanAngly.y&&0==this._ziZhuanAngly.z&&0==this._ziZhuanAngly.w)return this._needSelfRotation=!1,void 0;this._needSelfRotation=!0;for(var i=[],n=0;this._totalNum>n;)t=this._ziZhuanAngly.x,1==this._ziZhuanAngly.y&&(t*=Math.random()),e=this._ziZhuanAngly.z,1==this._ziZhuanAngly.w?e*=Math.random():-1==this._ziZhuanAngly.w&&(e*=2*Math.random()-1),i.push(t,e),i.push(t,e),i.push(t,e),i.push(t,e),n++;this.particleBallData.baseRotation=i},e.prototype.makeRectangleData=function(t,e,i,n,a,s,o,r,h,c,l,u){void 0===a&&(a=.5),void 0===s&&(s=.5),void 0===o&&(o=!1),void 0===r&&(r=!1),void 0===h&&(h=!1),void 0===c&&(c=1),void 0===l&&(l=1),void 0===u&&(u=0);var d=Math.random()*(this._particleRandomScale.x-this._particleRandomScale.y)+this._particleRandomScale.y;t.push(-a*i*d,(n-s*n)*d,0),t.push((i-a*i)*d,(n-s*n)*d,0),t.push((i-a*i)*d,-s*n*d,0),t.push(-a*i*d,-s*n*d,0);var p=[];if(p.push(new Vector2D(0,0)),p.push(new Vector2D(0,1/l)),p.push(new Vector2D(1/c,1/l)),p.push(new Vector2D(1/c,0)),r)for(var _=0;p.length>_;_++)p[_].x=-p[_].x;if(h)for(var _=0;p.length>_;_++)p[_].y=-p[_].y;o&&p.push(p.shift());for(var _=0;p.length>_;_++)e.push(p[_].x,p[_].y,u)},Object.defineProperty(e.prototype,"particleBallData",{get:function(){return this.objData},enumerable:!0,configurable:!0}),e.prototype.setAllByteInfo=function(e,i){this._totalNum=e.readFloat(),this._acceleration=e.readFloat(),this._toscale=e.readFloat(),this._shootSpeed=e.readFloat(),this._isRandom=e.readBoolean(),this._isSendRandom=e.readBoolean(),this._round.x=e.readFloat(),this._round.y=e.readFloat(),this._round.z=e.readFloat(),this._round.w=e.readFloat(),this._is3Dlizi=e.readBoolean(),this._halfCircle=e.readBoolean(),this._shootAngly.x=e.readFloat(),this._shootAngly.y=e.readFloat(),this._shootAngly.z=e.readFloat(),this._shootAngly.w=e.readFloat(),this._speed=e.readFloat(),this._isLoop=e.readBoolean(),this._isSendAngleRandom=e.readBoolean(),this._waveform.x=e.readFloat(),this._waveform.y=e.readFloat(),this._waveform.z=e.readFloat(),this._waveform.w=e.readFloat(),this._closeSurface=e.readBoolean(),this._isEven=e.readBoolean(),this._paticleMaxScale=e.readFloat(),this._paticleMinScale=e.readFloat(),this._basePositon.x=e.readFloat(),this._basePositon.y=e.readFloat(),this._basePositon.z=e.readFloat(),this._basePositon.w=e.readFloat(),this._baseRandomAngle=e.readFloat(),this._shapeType=e.readFloat(),this._lockX=e.readBoolean(),this._lockY=e.readBoolean(),this._addforce.x=e.readFloat(),this._addforce.y=e.readFloat(),this._addforce.z=e.readFloat(),this._addforce.w=e.readFloat(),this._addforce.scaleByW(),this._lixinForce.x=e.readFloat(),this._lixinForce.y=e.readFloat(),this._lixinForce.z=e.readFloat(),this._lixinForce.w=e.readFloat(),this._islixinAngly=e.readBoolean(),this._particleRandomScale=new Vector3D,this._particleRandomScale.x=e.readFloat(),this._particleRandomScale.y=e.readFloat(),this._particleRandomScale.z=e.readFloat(),this._particleRandomScale.w=e.readFloat(),this._playSpeed=e.readFloat(),this.facez=e.readBoolean(),this._beginScale=e.readFloat(),this._widthFixed=e.readBoolean(),this._heightFixed=e.readBoolean(),this.readRandomColor(e),0!=this._acceleration||0!=this._addforce.x||0!=this._addforce.y||0!=this._addforce.z?(this._needAddSpeed=!0,this._addSpeedVec=[this._addforce.x,this._addforce.y,this._addforce.z]):this._needAddSpeed=!1,0!=this._toscale||0!=this._waveform.x||0!=this._waveform.y?(this._needScale=!0,this._scaleVec=[this._toscale,this._waveform.x,this._waveform.y,this._beginScale],this._scaleCtrlVec=[this._widthFixed?0:1,this._heightFixed?0:1,this._paticleMaxScale-1,this._paticleMinScale-1]):this._needScale=!1,t.prototype.setAllByteInfo.call(this,e,i),this._timeVec=[0,this._acceleration,this._life,this._isLoop?1:-1],this._is3Dlizi&&(this._wordPosVec=[0,0,0],this._caramPosVec=[0,0,0],this._allRotationMatrix=new Matrix3D),this.uploadToGpu()},e.prototype.readRandomColor=function(t){var e=t.readInt(),i={};i.alpha=[],i.color=[],i.pos=[];for(var n=0;e>n;n++)i.alpha.push(t.readFloat()),i.color.push(t.readFloat()),i.pos.push(t.readFloat());this._textureRandomColorInfo=i},e.prototype.setAllInfo=function(e){var i=e.display;this._totalNum=i.totalNum,this._acceleration=i.acceleration,this._toscale=i.toscale,this._shootSpeed=i.shootSpeed,this._isRandom=i.isRandom,this._isSendRandom=i.isSendRandom,this._round=this.getVector3DByObject(i.round),this._is3Dlizi=i.is3Dlizi,this._halfCircle=i.halfCircle,this._shootAngly=this.getVector3DByObject(i.shootAngly),this._speed=i.speed,this._isLoop=i.isLoop,this._isSendAngleRandom=i.isSendAngleRandom,this._waveform=this.getVector3DByObject(i.waveform),this._closeSurface=i.closeSurface,this._isEven=i.isEven,this._paticleMaxScale=i.paticleMaxScale,this._paticleMinScale=i.paticleMinScale,this._basePositon=this.getVector3DByObject(i.basePositon),this._baseRandomAngle=i.baseRandomAngle,this._shapeType=i.shapeType,this._lockX=i.lockX,this._lockY=i.lockY,this._textureRandomColorInfo=i.randomColor,this._addforce=this.getVector3DByObject(i.addforce),this._addforce.scaleByW(),this._lixinForce=this.getVector3DByObject(i.lixinForce),this._islixinAngly=i.islixinAngly,this._particleRandomScale=this.getVector3DByObject(i.particleRandomScale),this._playSpeed=i.playSpeed,this.facez=i.facez,this._beginScale=i.beginScale,0!=this._acceleration||0!=this._addforce.x||0!=this._addforce.y||0!=this._addforce.z?(this._needAddSpeed=!0,this._addSpeedVec=[this._addforce.x,this._addforce.y,this._addforce.z]):this._needAddSpeed=!1,0!=this._toscale||0!=this._waveform.x||0!=this._waveform.y?(this._needScale=!0,this._scaleVec=[this._toscale,this._waveform.x,this._waveform.y,this._beginScale],this._widthFixed=i.widthFixed,this._heightFixed=i.heightFixed,this._scaleCtrlVec=[this._widthFixed?0:1,this._heightFixed?0:1,this._paticleMaxScale-1,this._paticleMinScale-1]):this._needScale=!1,t.prototype.setAllInfo.call(this,e),this._timeVec=[0,this._acceleration,this._life,this._isLoop?1:-1],this._is3Dlizi&&(this._wordPosVec=[0,0,0],this._caramPosVec=[0,0,0],this._allRotationMatrix=new Matrix3D),this.uploadToGpu()},e.prototype.regShader=function(){if(this.materialParam){var t=this.getShaderParam();this.materialParam.program=ProgrmaManager.getInstance().getMaterialProgram(Display3DBallShader.Display3D_Ball_Shader,new Display3DBallShader,this.materialParam.material,t)}},e.prototype.getShaderParam=function(){1!=this._animRow||1!=this._animLine?(this._uvType=1,this._animCtrlVec=[this._animLine,this._animRow,this._animInterval]):0!=this._uSpeed||0!=this._vSpeed?(this._uvType=2,this._uvCtrlVec=[this._uSpeed,this._vSpeed]):this._uvType=0;var t=this.materialParam.material.hasParticleColor;this._needRandomColor=this.materialParam.material.hasVertexColor,this._needRandomColor&&this.initBaseColor();var e,i;i=t?1:0;var n=this._needRandomColor?1:0,a=this._is3Dlizi?1:0,s=this._needSelfRotation?1:0,o=this._needScale?1:0,r=this._needAddSpeed?1:0;return e=[i,n,a,s,o,r,this._uvType]},e}(Display3DParticle),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Display3DBallShader=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.binLocation=function(t){t.bindAttribLocation(this.program,0,"vPosition"),t.bindAttribLocation(this.program,1,"texcoord"),t.bindAttribLocation(this.program,2,"basePos"),t.bindAttribLocation(this.program,3,"speed");
var e=this.paramAry[3];e&&t.bindAttribLocation(this.program,4,"rotation");var i=this.paramAry[1];i&&t.bindAttribLocation(this.program,5,"color")},e.prototype.getVertexShaderString=function(){var t,e,i,n,a,s,o,r,h,c,l,u,h,r,d,p,_,f,m,y,g,v,x;d="attribute vec4 vPosition;\nattribute vec3 texcoord;\nattribute vec4 basePos;\nattribute vec3 speed;\nuniform mat4 watheye;\nuniform mat4 viewMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 cameraMatrix;\nuniform vec4 time;\nvarying vec2 v0;\n",v="attribute vec4 color;\nvarying vec4 v2;\n",p="uniform vec4 scale;\nuniform vec4 scaleCtrl;\n",_="attribute vec2 rotation;\n",f="uniform vec3 force;\n",m="uniform mat4 rotationMatrix;\nuniform vec3 worldPos;\nuniform vec3 camPos;\n",y="uniform vec3 animCtrl;\n",g="uniform vec2 uvCtrl;\n",x="varying vec2 v1;\n",t="float ctime = time.x - basePos.w;\nif (time.w > 0.0 && ctime >= 0.0) {\n    ctime = fract(ctime / time.z) * time.z;\n}\nvec4 pos = vPosition;\n",e="float stime = ctime - scale.w;\nstime = max(stime,0.0);\nfloat sf = scale.x * stime;\nif (scale.y != 0.0 && scale.z != 0.0) {\n    sf += sin(scale.y * stime) * scale.z;\n}\nif (sf > scaleCtrl.z) {\n    sf = scaleCtrl.z;\n} else if (sf < scaleCtrl.w) {\n    sf = scaleCtrl.w;\n}\nvec2 sv2 = vec2(scaleCtrl.x * sf, scaleCtrl.y * sf);\nsv2 = sv2 + 1.0;\npos.x *= sv2.x;\npos.y *= sv2.y;\n",i="float angle = rotation.x + rotation.y * ctime;\nvec4 np = vec4(sin(angle), cos(angle), 0, 0);\nnp.z = np.x * pos.y + np.y * pos.x;\nnp.w = np.y * pos.y - np.x * pos.x;\npos.xy = np.zw;\n",n="vec3 addPos = speed * ctime;\nvec3 uspeed = vec3(0,0,0);\nif (ctime < 0.0 || ctime >= time.z) {\n    addPos.y = addPos.y + 100000.0;\n}\n",a="if(time.y != 0.0 && length(speed) != 0.0) {\n    uspeed = vec3(speed.x, speed.y, speed.z);\n    uspeed = normalize(uspeed);\n    uspeed = uspeed * time.y;\n    uspeed.xyz = uspeed.xyz + force.xyz;\n} else {\n    uspeed = vec3(force.x, force.y, force.z);\n}\naddPos.xyz = addPos.xyz + uspeed.xyz * ctime * ctime;\n",s="uspeed = speed + uspeed * ctime * 2.0;\nuspeed = normalize(uspeed);\nvec4 tempMul = rotationMatrix * vec4(uspeed,1.0);\nuspeed.xyz = tempMul.xyz;\nuspeed = normalize(uspeed);\nvec3 cPos = addPos;\ntempMul = rotationMatrix * vec4(cPos,1.0);\ncPos.xyz = tempMul.xyz; \ncPos.xyz = worldPos.xyz + cPos.xyz;\ncPos.xyz = camPos.xyz - cPos.xyz;\ncPos = normalize(cPos);\ncPos = cross(uspeed, cPos);\ncPos = normalize(cPos);\nuspeed = uspeed * pos.x;\ncPos = cPos * pos.y;\npos.xyz = uspeed.xyz + cPos.xyz;\n",o="pos = watheye * pos;\npos.xyz = pos.xyz + basePos.xyz + addPos.xyz;\ngl_Position = viewMatrix * cameraMatrix * modelMatrix * pos;\n",c="v0 = vec2(texcoord.x,texcoord.y);\n",l="vec2 uv = vec2(texcoord.x,texcoord.y);\nfloat animframe = floor(ctime / animCtrl.z);\nanimframe = animframe / animCtrl.x;\nuv.x += animframe;\nanimframe = floor(animframe);\nuv.y += animframe / animCtrl.y;\nv0.xy = uv.xy;\n",u="vec2 uv = uvCtrl;\nuv.xy = uv.xy * ctime + texcoord.xy;\nv0.xy = uv.xy;\n",h="v2 = color;\n",r="v1 = vec2(ctime/time.z,1.0);\n";var b=this.paramAry[0],D=this.paramAry[1],T=this.paramAry[2],w=this.paramAry[3],M=this.paramAry[4],S=this.paramAry[5],I=this.paramAry[6],E="",A="";E+=t,A+=d,M&&(E+=e,A+=p),w&&(E+=i,A+=_),E+=n,S&&(E+=a,A+=f),T&&(E+=s,A+=m),E+=o,1==I?(E+=l,A+=y):2==I?(E+=u,A+=g):E+=c,D&&(E+=h,A+=v),b&&(E+=r,A+=x);var C=A+"void main(){\n"+E+"}";return C},e.prototype.getFragmentShaderString=function(){var t=" precision mediump float;\nuniform sampler2D tex;\nvarying vec2 v0;\nvoid main(void)\n{\nvec4 infoUv = texture2D(tex, v0.xy);\ngl_FragColor = infoUv;\n}";return t},e.Display3D_Ball_Shader="Display3DBallShader",e}(Shader3D),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},ParticleBallData=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(ParticleData),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Display3DLocusPartilce=function(t){function e(){t.call(this),this._speed=1,this._isLoop=!1,this.objData=new ParticleData,this._resultUvVec=Array(3)}return __extends(e,t),e.prototype.setVa=function(){Scene_data.context3D.setVa(0,3,this.objData.vertexBuffer),Scene_data.context3D.setVa(1,2,this.objData.uvBuffer),this._watchEye&&Scene_data.context3D.setVa(2,4,this.objData.normalsBuffer),this.setMaterialTexture(),Scene_data.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum)},e.prototype.setVc=function(){this.updateUV(),Scene_data.context3D.setVcMatrix4fv(this.materialParam.program,"viewMatrix3D",Scene_data.viewMatrx3D.m),Scene_data.context3D.setVcMatrix4fv(this.materialParam.program,"camMatrix3D",Scene_data.cam3D.cameraMatrix.m),Scene_data.context3D.setVcMatrix4fv(this.materialParam.program,"posMatrix3D",this.modelMatrix.m),Scene_data.context3D.setVc3fv(this.materialParam.program,"uvMove",this._resultUvVec),this._watchEye&&(this._caramPosVec[0]=Scene_data.cam3D.x,this._caramPosVec[1]=Scene_data.cam3D.y,this._caramPosVec[2]=Scene_data.cam3D.z,Scene_data.context3D.setVc3fv(this.materialParam.program,"camPos",this._caramPosVec)),this._changUv&&Scene_data.context3D.setVc3fv(this.materialParam.program,"isUv",this._uvVec),this.setMaterialVc()},e.prototype.updateUV=function(){var t=this._time/Scene_data.frameTime,e=this._life/100,i=this._speed*t/this._density/10;this._isEnd&&(i=Math.min(1,i)),this._isLoop&&(i%=this._life?e+1:1),this._resultUvVec[0]=i},e.prototype.initUV=function(){var t=this._time/Scene_data.frameTime,e=this._life/100,i=this._speed*t/this._density/10;this._isEnd&&(i=Math.min(1,i));var n;this._isLoop?this._life?(i%=e+1,n=new Vector3D(i,e,-e)):(i%=1,n=new Vector3D(i+1,99,-2)):n=this._life?new Vector3D(i,e,-1):new Vector3D(i,99,-1),this._resultUvVec[0]=n.x,this._resultUvVec[1]=n.y,this._resultUvVec[2]=n.z},e.prototype.uploadToGpu=function(){this.objData.vertexBuffer=Scene_data.context3D.uploadBuff3D(this.objData.vertices),this.objData.uvBuffer=Scene_data.context3D.uploadBuff3D(this.objData.uvs),this._watchEye&&(this.objData.normalsBuffer=Scene_data.context3D.uploadBuff3D(this.objData.normals)),this.objData.indexBuffer=Scene_data.context3D.uploadIndexBuff3D(this.objData.indexs),this.objData.treNum=this.objData.indexs.length},e.prototype.setAllByteInfo=function(e,i){i.display,this._isLoop=e.readBoolean(),this._speed=e.readFloat(),this._density=e.readFloat(),this._isEnd=e.readBoolean(),this.objData.vertices=[],this.objData.normals=[],this.objData.uvs=[],this.objData.indexs=[];for(var n=e.readInt(),a=0;n>a;a++)this.objData.vertices.push(e.readFloat());for(var s=e.readInt(),a=0;s>a;a++)this.objData.normals.push(e.readFloat());for(var o=e.readInt(),r=0;o>r;r++)this.objData.uvs.push(e.readFloat());for(var h=e.readInt(),c=0;h>c;c++)this.objData.indexs.push(e.readInt());t.prototype.setAllByteInfo.call(this,e,i),this.initUV(),this._watchEye&&(this._caramPosVec=[0,0,0]),this._uvVec=[this._isU?-1:1,this._isV?-1:1,this._isUV?1:-1],this.uploadToGpu()},e.prototype.setAllInfo=function(e){var i=e.display;this._isLoop=i.isLoop,this._speed=i.speed,this._density=i.density,this._isEnd=i.isEnd,this.objData.vertices=i.vecData.vec,this.objData.uvs=i.vecData.uvs,this.objData.normals=i.vecData.normals,this.objData.indexs=i.vecData.index,t.prototype.setAllInfo.call(this,e),this.initUV(),this._watchEye&&(this._caramPosVec=[0,0,0]),this._uvVec=[this._isU?-1:1,this._isV?-1:1,this._isUV?1:-1],this.uploadToGpu()},e.prototype.regShader=function(){if(this.materialParam){var t=this._watchEye?1:0,e=0,i=this.materialParam.material.hasParticleColor;this._isU||this._isV||this._isUV?(e=1,this._changUv=!0):this._changUv=!1;var n;n=[t,e,i?1:0],this.materialParam.program=ProgrmaManager.getInstance().getMaterialProgram(Display3DLocusShader.Display3D_Locus_Shader,new Display3DLocusShader,this.materialParam.material,n)}},e}(Display3DParticle),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Display3DLocusShader=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.binLocation=function(t){t.bindAttribLocation(this.program,0,"v3Position"),t.bindAttribLocation(this.program,1,"v2TexCoord"),this.paramAry[0]&&t.bindAttribLocation(this.program,2,"v3Normal")},e.prototype.getVertexShaderString=function(){var t="attribute vec4 v3Position;\nattribute vec2 v2TexCoord;\nuniform mat4 viewMatrix3D;\nuniform mat4 camMatrix3D;\nuniform mat4 posMatrix3D;\nuniform vec3 uvMove;\nvarying vec2 v0;\nvarying vec4 v2;\n",e="attribute vec4 v3Normal;\nuniform vec3 camPos;\n",i="uniform vec3 isUv;\n",n="varying vec2 v1;\n",a="   vec2 tempv0 = v2TexCoord;\n   tempv0.x -= uvMove.x;\n",s="   v1 = v2TexCoord;\n",o="   v0 = tempv0;\n",r="   tempv0.xy *= isUv.xy;\n   if(isUv.z >= 0.0){\n   vec2 tempv1 = tempv0;\n   tempv0.y = tempv1.x;\n   tempv0.x = tempv1.y;}\n   v0 = tempv0;\n",h="   float alpha = tempv0.x/uvMove.y;\n   alpha = 1.0 - clamp(abs(alpha),0.0,1.0);\n   float kill = -tempv0.x;\n   kill *= tempv0.x - uvMove.z;\n   v2 = vec4(kill,0.0,0.0,alpha);\n",c="   gl_Position = viewMatrix3D  * camMatrix3D * posMatrix3D * v3Position;\n",l="   vec4 tempPos = posMatrix3D * v3Position;\n   vec3 mulPos = vec3(tempPos.x,tempPos.y,tempPos.z);\n   vec3 normals = vec3(v3Normal.x,v3Normal.y,v3Normal.z);\n   mulPos = normalize(camPos - mulPos);\n   mulPos = cross(mulPos, normals);\n   mulPos = normalize(mulPos);\n   mulPos *= v3Normal.w;\n   tempPos.xyz = mulPos.xyz + v3Position.xyz;\n   gl_Position = viewMatrix3D  * camMatrix3D * posMatrix3D * tempPos;\n",u=this.paramAry[0],d=this.paramAry[1],p=this.paramAry[2],_=t;u&&(_+=e),d&&(_+=i),p&&(_+=n);var f=a+h;p&&(f+=s),f+=d?r:o,f+=u?l:c;var m=_+"void main(void){\n"+f+"}";return m},e.prototype.getFragmentShaderString=function(){var t=" precision mediump float;\nuniform sampler2D tex;\nvarying vec2 v0;\nvoid main(void)\n{\nvec4 infoUv = texture2D(tex, v0.xy);\ngl_FragColor = infoUv;\n}";return t},e.Display3D_Locus_Shader="Display3DLocusShader",e}(Shader3D),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Display3DLocusBallPartilce=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.initBasePos=function(){for(var t=[],e=0;this._totalNum>e;e++){var i,n=3*e;if(this._isRandom){var a=new Vector3D(this._round.x*this._round.w,this._round.y*this._round.w,this._round.z*this._round.w);i=new Vector3D(this._posAry[n]+Math.random()*a.x,this._posAry[n+1]+Math.random()*a.y,this._posAry[n+2]+Math.random()*a.z)}else i=new Vector3D(this._posAry[n],this._posAry[n+1],this._posAry[n+2]);i=i.add(this._basePositon);for(var s=0;4>s;s++)t.push(i.x,i.y,i.z,e*this._shootSpeed)}this.particleBallData.basePos=t},e.prototype.initSpeed=function(){for(var t=[],e=0;this._totalNum>e;e++){var i=new Vector3D;if(0==this._tangentSpeed)i.addByNum(this._angleAry[3*e],this._angleAry[3*e+1],this._angleAry[3*e+2]);else if(2==this._tangentSpeed)i.setTo(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1);else{var n=new Vector3D(this._tangentAry[3*e],this._tangentAry[3*e+1],this._tangentAry[3*e+2]);n.scaleBy(this._tangentSpeed),i=i.add(n)}i.normalize(),this._isSendRandom?i.scaleBy(this._speed*Math.random()):i.scaleBy(this._speed);for(var a=0;4>a;a++)t.push(i.x,i.y,i.z)}this.particleBallData.beMove=t},e.prototype.setAllByteInfo=function(e,i){var n=i.display;this._tangentSpeed=n.tangentSpeed,this._posAry=n.vecData.pos,this._angleAry=n.vecData.angle,this._tangentAry=n.vecData.tangent,t.prototype.setAllByteInfo.call(this,e,i),this.uploadToGpu()},e.prototype.setAllInfo=function(e){var i=e.display;this._tangentSpeed=i.tangentSpeed,this._posAry=i.vecData.pos,this._angleAry=i.vecData.angle,this._tangentAry=i.vecData.tangent,t.prototype.setAllInfo.call(this,e)},e}(Display3DBallPartilce),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Display3DModelPartilce=function(t){function e(){t.call(this),this.objData=new ParticleData,this._resultUvVec=Array(2)}return __extends(e,t),e.prototype.setVc=function(){this.updateWatchCaramMatrix(),this.updateUV(),Scene_data.context3D.setVcMatrix4fv(this.materialParam.program,"viewMatrix3D",Scene_data.viewMatrx3D.m),Scene_data.context3D.setVcMatrix4fv(this.materialParam.program,"camMatrix3D",Scene_data.cam3D.cameraMatrix.m),Scene_data.context3D.setVcMatrix4fv(this.materialParam.program,"posMatrix3D",this.modelMatrix.m),Scene_data.context3D.setVcMatrix4fv(this.materialParam.program,"rotationMatrix3D",this._rotationMatrix.m),Scene_data.context3D.setVc2fv(this.materialParam.program,"uvMove",this._resultUvVec),this.setMaterialVc()},e.prototype.setVa=function(){Scene_data.context3D.setVa(0,3,this.objData.vertexBuffer),Scene_data.context3D.setVa(1,2,this.objData.uvBuffer),this.setMaterialTexture(),Scene_data.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum)},e.prototype.updateWatchCaramMatrix=function(){this._rotationMatrix.identity(),this._watchEye&&(this.timeline.inverAxisRotation(this._rotationMatrix),this._rotationMatrix.prependRotation(-Scene_data.cam3D.rotationY,Vector3D.Y_AXIS),this._rotationMatrix.prependRotation(-Scene_data.cam3D.rotationX,Vector3D.X_AXIS)),this._isZiZhuan&&this.timeline.applySelfRotation(this._rotationMatrix,this._ziZhuanAngly)},e.prototype.updateUV=function(){this._resultUvVec[0]=this._time/Scene_data.frameTime*this._uSpeed,this._resultUvVec[1]=this._time/Scene_data.frameTime*this._vSpeed},e.prototype.uploadToGpu=function(){this.objData.vertexBuffer=Scene_data.context3D.uploadBuff3D(this.objData.vertices),this.objData.uvBuffer=Scene_data.context3D.uploadBuff3D(this.objData.uvs),this.objData.indexBuffer=Scene_data.context3D.uploadIndexBuff3D(this.objData.indexs),this.objData.treNum=this.objData.indexs.length},e.prototype.setAllByteInfo=function(e,i){this.objData.vertices=[],this.objData.uvs=[],this.objData.indexs=[],this._maxAnimTime=e.readFloat();for(var n=e.readInt(),a=0;n>a;a++)this.objData.vertices.push(e.readFloat());for(var s=e.readInt(),o=0;s>o;o++)this.objData.uvs.push(e.readFloat());for(var r=e.readInt(),h=0;r>h;h++)this.objData.indexs.push(e.readInt());t.prototype.setAllByteInfo.call(this,e,i),this.uploadToGpu()},e.prototype.setAllInfo=function(e){var i=e.display;this._maxAnimTime=i.maxAnimTime,this.objData.vertices=i.vecData.ves,this.objData.uvs=i.vecData.uvs,this.objData.indexs=i.vecData.indexs,t.prototype.setAllInfo.call(this,e),this.uploadToGpu()},e.prototype.regShader=function(){this.materialParam.program=ProgrmaManager.getInstance().getMaterialProgram(Display3DFacetShader.Display3D_Facet_Shader,new Display3DFacetShader,this.materialParam.material)},e}(Display3DParticle),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Display3DModelObjParticle=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.update=function(){this._depthMode&&Scene_data.context3D.setDepthTest(!0),t.prototype.update.call(this),this._depthMode&&Scene_data.context3D.setDepthTest(!1)},e.prototype.setAllInfo=function(e){var i=e.display;this._depthMode=i.depthMode,t.prototype.setAllInfo.call(this,e)},e}(Display3DModelPartilce),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Display3dModelAnimParticle=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.updateUV=function(){var t=this._time/Scene_data.frameTime;t=t>this._maxAnimTime?this._maxAnimTime:t,t=t/this._animInterval%(this._animLine*this._animRow),this._resultUvVec[0]=float2int(t%this._animLine)/this._animLine+this._time/Scene_data.frameTime*this._uSpeed,this._resultUvVec[1]=float2int(t/this._animLine)/this._animRow+this._time/Scene_data.frameTime*this._vSpeed},e}(Display3DModelPartilce),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Display3DFollowPartilce=function(t){function e(){t.call(this),this.flag=0,this.initBingMatrixAry()}return __extends(e,t),e.prototype.setVc=function(){t.prototype.setVc.call(this),this.updateBind();for(var e=0;this._totalNum>e;e++)Scene_data.context3D.setVc3fv(this.materialParam.program,"bindpos["+e+"]",this._bindMatrixAry[e])},e.prototype.initBingMatrixAry=function(){this._bindMatrixAry=[],this._bindFlagAry=[];for(var t=0;this._totalNum>t;t++)this._bindMatrixAry.push([0,0,0]),this._bindFlagAry.push(0)},e.prototype.updateBind=function(){for(var t=this._time/Scene_data.frameTime,e=this.flag;this._totalNum>e;e++){var i=(t-e*this._shootSpeed)/this._life;i>=this._bindFlagAry[e]&&(console.log(this.bindVecter3d),this._bindMatrixAry[e][0]=this.bindVecter3d.x,this._bindMatrixAry[e][1]=this.bindVecter3d.y,this._bindMatrixAry[e][2]=this.bindVecter3d.z,this._bindFlagAry[e]++)}},e.prototype.updateMatrix=function(){this.bindMatrix&&(this.modelMatrix.identity(),this.groupMatrix.isIdentity||this.posMatrix.append(this.groupMatrix),this.modelMatrix.append(this.posMatrix))},e.prototype.updateAllRotationMatrix=function(){this._allRotationMatrix.identity(),this._allRotationMatrix.prependScale(.1*this.overAllScale*this._scaleX*this.bindScale.x,.1*this.overAllScale*this._scaleY*this.bindScale.y,.1*this.overAllScale*this._scaleZ*this.bindScale.z),this.isInGroup&&(this._allRotationMatrix.appendRotation(this.groupRotation.x,Vector3D.X_AXIS),this._allRotationMatrix.appendRotation(this.groupRotation.y,Vector3D.Y_AXIS),this._allRotationMatrix.appendRotation(this.groupRotation.z,Vector3D.Z_AXIS))},e.prototype.reset=function(){t.prototype.reset.call(this);for(var e=0;this._totalNum>e;e++)this._bindMatrixAry[e][0]=0,this._bindMatrixAry[e][1]=0,this._bindMatrixAry[e][2]=0,this._bindFlagAry[e]=0},e.prototype.updateWatchCaramMatrix=function(){this._rotationMatrix.identity(),this.facez?this._rotationMatrix.prependRotation(90,Vector3D.X_AXIS):this._watchEye&&(this._rotationMatrix.prependRotation(-Scene_data.cam3D.rotationY,Vector3D.Y_AXIS),this._rotationMatrix.prependRotation(-Scene_data.cam3D.rotationX,Vector3D.X_AXIS))},e.prototype.regShader=function(){if(this.materialParam){var t=this.getShaderParam();this.materialParam.program=ProgrmaManager.getInstance().getMaterialProgram(Display3DFollowShader.Display3D_Follow_Shader,new Display3DFollowShader,this.materialParam.material,t)}},e}(Display3DBallPartilce),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Display3DFollowShader=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.binLocation=function(t){t.bindAttribLocation(this.program,0,"vPosition"),t.bindAttribLocation(this.program,1,"texcoord"),t.bindAttribLocation(this.program,2,"basePos"),t.bindAttribLocation(this.program,3,"speed");var e=this.paramAry[3];e&&t.bindAttribLocation(this.program,4,"rotation");var i=this.paramAry[1];i&&t.bindAttribLocation(this.program,5,"color")},e.prototype.getVertexShaderString=function(){var t,e,i,n,a,s,o,r,h,c,l,u,h,r,d,p,_,f,m,y,g,v,x;d="attribute vec4 vPosition;\nattribute vec3 texcoord;\nattribute vec4 basePos;\nattribute vec3 speed;\nuniform mat4 watheye;\nuniform mat4 viewMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 cameraMatrix;\nuniform vec4 time;\nuniform vec3 bindpos[20];\nvarying vec2 v0;\n",v="attribute vec4 color;\nvarying vec4 v2;\n",p="uniform vec4 scale;\nuniform vec4 scaleCtrl;\n",_="attribute vec2 rotation;\n",f="uniform vec3 force;\n",m="uniform mat4 rotationMatrix;\nuniform vec3 worldPos;\nuniform vec3 camPos;\n",y="uniform vec3 animCtrl;\n",g="uniform vec2 uvCtrl;\n",x="varying vec2 v1;\n",t="float ctime = time.x - basePos.w;\nif (time.w > 0.0 && ctime >= 0.0) {\n    ctime = fract(ctime / time.z) * time.z;\n}\nvec4 pos = vPosition;\n",e="float stime = ctime - scale.w;\nstime = max(stime,0.0);\nfloat sf = scale.x * stime;\nif (scale.y != 0.0 && scale.z != 0.0) {\n    sf += sin(scale.y * stime) * scale.z;\n}\nif (sf > scaleCtrl.z) {\n    sf = scaleCtrl.z;\n} else if (sf < scaleCtrl.w) {\n    sf = scaleCtrl.w;\n}\nvec2 sv2 = vec2(scaleCtrl.x * sf, scaleCtrl.y * sf);\nsv2 = sv2 + 1.0;\npos.x *= sv2.x;\npos.y *= sv2.y;\n",i="float angle = rotation.x + rotation.y * ctime;\nvec4 np = vec4(sin(angle), cos(angle), 0, 0);\nnp.z = np.x * pos.y + np.y * pos.x;\nnp.w = np.y * pos.y - np.x * pos.x;\npos.xy = np.zw;\n",n="vec3 addPos = speed * ctime;\nvec3 uspeed = vec3(0,0,0);\nif (ctime < 0.0 || ctime >= time.z) {\n    addPos.y = addPos.y + 100000.0;\n}\n",a="if(time.y != 0.0 && length(speed) != 0.0) {\n    uspeed = vec3(speed.x, speed.y, speed.z);\n    uspeed = normalize(uspeed);\n    uspeed = uspeed * time.y;\n    uspeed.xyz = uspeed.xyz + force.xyz;\n} else {\n    uspeed = vec3(force.x, force.y, force.z);\n}\naddPos.xyz = addPos.xyz + uspeed.xyz * ctime * ctime;\n",s="uspeed = speed + uspeed * ctime * 2.0;\nuspeed = normalize(uspeed);\nvec4 tempMul = rotationMatrix * vec4(uspeed,1.0);\nuspeed.xyz = tempMul.xyz;\nuspeed = normalize(uspeed);\nvec3 cPos = addPos;\ntempMul = rotationMatrix * vec4(cPos,1.0);\ncPos.xyz = tempMul.xyz; \ncPos.xyz = worldPos.xyz + cPos.xyz;\ncPos.xyz = camPos.xyz - cPos.xyz;\ncPos = normalize(cPos);\ncPos = cross(uspeed, cPos);\ncPos = normalize(cPos);\nuspeed = uspeed * pos.x;\ncPos = cPos * pos.y;\npos.xyz = uspeed.xyz + cPos.xyz;\n",o="pos = watheye * pos;\npos.xyz = pos.xyz + basePos.xyz + addPos.xyz;\npos = modelMatrix * pos;\npos.xyz = pos.xyz + bindpos[int(texcoord.z)].xyz;\ngl_Position = viewMatrix * cameraMatrix * pos;\n",c="v0 = vec2(texcoord.x,texcoord.y);\n",l="vec2 uv = vec2(texcoord.x,texcoord.y);\nfloat animframe = floor(ctime / animCtrl.z);\nanimframe = animframe / animCtrl.x;\nuv.x += animframe;\nanimframe = floor(animframe);\nuv.y += animframe / animCtrl.y;\nv0.xy = uv.xy;\n",u="vec2 uv = uvCtrl;\nuv.xy = uv.xy * ctime + texcoord.xy;\nv0.xy = uv.xy;\n",h="v2 = color;\n",r="v1 = vec2(ctime/time.z,1.0);\n";var b=this.paramAry[0],D=this.paramAry[1],T=this.paramAry[2],w=this.paramAry[3],M=this.paramAry[4],S=this.paramAry[5],I=this.paramAry[6],E="",A="";E+=t,A+=d,M&&(E+=e,A+=p),w&&(E+=i,A+=_),E+=n,S&&(E+=a,A+=f),T&&(E+=s,A+=m),E+=o,1==I?(E+=l,A+=y):2==I?(E+=u,A+=g):E+=c,D&&(E+=h,A+=v),b&&(E+=r,A+=x);var C=A+"void main(){\n"+E+"}";return C},e.prototype.getFragmentShaderString=function(){var t=" precision mediump float;\nuniform sampler2D tex;\nvarying vec2 v0;\nvoid main(void)\n{\nvec4 infoUv = texture2D(tex, v0.xy);\ngl_FragColor = infoUv;\n}";return t},e.Display3D_Follow_Shader="Display3DFollowShader",e}(Shader3D),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Display3DFollowLocusPartilce=function(t){function e(){t.call(this),this.flag=0,this.objData=new ParticleData,this._caramPosVec=[0,0,0]}return __extends(e,t),e.prototype.initBindMatrixAry=function(){this._bindPosAry=[];for(var t=0;this._fenduanshu>=t;t++)this._bindPosAry.push([0,0,5*t]),this._bindPosAry.push([0,0,1])},e.prototype.setAllInfo=function(e){var i=e.display;this._fenduanshu=i.fenduanshu,t.prototype.setAllInfo.call(this,e),this.initBindMatrixAry(),this.uploadToGpu()},e.prototype.uploadToGpu=function(){this.objData.vertices=[],this.objData.uvs=[],this.objData.indexs=[];for(var t=0;this._fenduanshu>=t;t++){var e=new Vector2D(t/this._fenduanshu,0),i=new Vector2D(t/this._fenduanshu,1);e.scaleBy(.9),i.scaleBy(.9),this._isU&&(e.x=-e.x,i.x=-i.x),this._isV&&(e.y=-e.y,i.y=-i.y);var n=2*t;this.objData.vertices.push(n,n+1,-this._originWidthScale*this._width/100),this.objData.vertices.push(n,n+1,(1-this._originWidthScale)*this._width/100),this._isUV?(this.objData.uvs.push(e.y,e.x),this.objData.uvs.push(i.y,i.x)):(this.objData.uvs.push(e.x,e.y),this.objData.uvs.push(i.x,i.y))}for(t=0;this._fenduanshu>t;t++)this.objData.indexs.push(0+2*t,1+2*t,2+2*t,1+2*t,3+2*t,2+2*t);this.pushToGpu()},e.prototype.pushToGpu=function(){this.objData.vertexBuffer=Scene_data.context3D.uploadBuff3D(this.objData.vertices),this.objData.uvBuffer=Scene_data.context3D.uploadBuff3D(this.objData.uvs),this.objData.indexBuffer=Scene_data.context3D.uploadIndexBuff3D(this.objData.indexs),this.objData.treNum=this.objData.indexs.length},e.prototype.setVa=function(){Scene_data.context3D.setVa(0,3,this.objData.vertexBuffer),Scene_data.context3D.setVa(1,2,this.objData.uvBuffer),this.setMaterialTexture(),Scene_data.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum)},e.prototype.setVc=function(){this.updateMatrix(),this.updateBind(),Scene_data.context3D.setVcMatrix4fv(this.materialParam.program,"viewMatrix3D",Scene_data.viewMatrx3D.m),Scene_data.context3D.setVcMatrix4fv(this.materialParam.program,"camMatrix3D",Scene_data.cam3D.cameraMatrix.m),this._caramPosVec[0]=Scene_data.cam3D.x,this._caramPosVec[1]=Scene_data.cam3D.y,this._caramPosVec[2]=Scene_data.cam3D.z,Scene_data.context3D.setVc3fv(this.materialParam.program,"camPos",this._caramPosVec),this.setBindPosVc(),this.setMaterialVc()},e.prototype.setBindPosVc=function(){for(var t=0;this._bindPosAry.length>t;t++)Scene_data.context3D.setVc3fv(this.materialParam.program,"bindpos["+t+"]",this._bindPosAry[t])},e.prototype.updateMatrix=function(){this.modelMatrix.identity(),this.modelMatrix.prepend(this.posMatrix)},e.prototype.resetPos=function(){for(var t=0;this._bindPosAry.length>t;t+=2)this._bindPosAry[t][0]=this.bindVecter3d.x,this._bindPosAry[t][1]=this.bindVecter3d.y,this._bindPosAry[t][2]=this.bindVecter3d.z;this.flag=TimeUtil.getTimer()},e.prototype.updateBind=function(){var t=TimeUtil.getTimer();if(t-this.flag>=35){var e=this._bindPosAry.pop(),i=this._bindPosAry.pop();i[0]=this.bindVecter3d.x,i[1]=this.bindVecter3d.y,i[2]=this.bindVecter3d.z;var n=this._bindPosAry[0],a=this._bindPosAry[1],s=new Vector3D(i[0]-n[0],i[1]-n[1],i[2]-n[2]);s.normalize(),a[0]=s.x,e[0]=s.x,a[1]=s.y,e[1]=s.y,a[2]=s.z,e[2]=s.z,this._bindPosAry.unshift(e),this._bindPosAry.unshift(i),this.flag=t}},e.prototype.regShader=function(){this.materialParam&&(this.materialParam.program=ProgrmaManager.getInstance().getMaterialProgram(Display3DFollowLocusShader.Display3D_FollowLocus_Shader,new Display3DFollowLocusShader,this.materialParam.material))},e}(Display3DParticle),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Display3DFollowLocusShader=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.binLocation=function(t){t.bindAttribLocation(this.program,0,"v3Position"),t.bindAttribLocation(this.program,1,"v2TexCoord")},e.prototype.getVertexShaderString=function(){var t="attribute vec3 v3Position;\nattribute vec2 v2TexCoord;\nuniform mat4 viewMatrix3D;\nuniform mat4 camMatrix3D;\nuniform vec3 bindpos[100];\nuniform vec3 camPos;\nvarying vec2 v0;\n",e="   vec3 cpos = bindpos[int(v3Position.x)];\n   vec3 mulPos = normalize(camPos - cpos);\n   vec3 normals = bindpos[int(v3Position.y)];\n   mulPos = cross(mulPos, normals);\n   mulPos = normalize(mulPos);\n   mulPos *= v3Position.z;\n   cpos += mulPos;\n   gl_Position = viewMatrix3D  * camMatrix3D * vec4(cpos,1.0);\n",i="v0 = v2TexCoord;\n",n=t+"void main(){\n"+e+i+"}";return n},e.prototype.getFragmentShaderString=function(){var t=" precision mediump float;\nuniform sampler2D tex;\nvarying vec2 v0;\nvoid main(void)\n{\nvec4 infoUv = texture2D(tex, v0.xy);\ngl_FragColor = infoUv;\n}";return t},e.Display3D_FollowLocus_Shader="Display3DFollowLocusShader",e}(Shader3D),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Display3DFollowMulLocusParticle=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.setAllInfo=function(e){var i=e.display;this._itemNum=i.itemNum,this._currentPosAry=[];for(var n=0;this._itemNum>n;n++)this._currentPosAry.push(new Vector3D);t.prototype.setAllInfo.call(this,e)},e.prototype.initBindMatrixAry=function(){this._bindPosAry=[];for(var t=0;this._itemNum>t;t++)for(var e=0;this._fenduanshu>=e;e++)this._bindPosAry.push([-47+10*t,45,50*e-645]),this._bindPosAry.push([0,0,1])},e.prototype.resetPos=function(){},e.prototype.resetMulPos=function(t){this.resultAry=t},e.prototype.setBindPosVc=function(){var t=this._fenduanshu+1,e=2*(float2int(this._time/33)+t);e>=this.resultAry[0].length&&(e=this.resultAry[0].length-2);for(var i=0,n=0;this._itemNum>n;n++)for(var a=this.resultAry[n],s=0;t>s;s++)Scene_data.context3D.setVc3fv(this.materialParam.program,"bindpos["+i+"]",a[e-2*s]),i++,Scene_data.context3D.setVc3fv(this.materialParam.program,"bindpos["+i+"]",a[e-2*s+1]),i++},e.prototype.getMulBindList=function(){return this._currentPosAry},e.prototype.uploadToGpu=function(){this.objData.vertices=[],this.objData.uvs=[],this.objData.indexs=[];for(var t=0,e=0;this._itemNum>e;e++){for(var i=0;this._fenduanshu>=i;i++){var n=new Vector2D(i/this._fenduanshu,0),a=new Vector2D(i/this._fenduanshu,1);n.scaleBy(.9),a.scaleBy(.9),this._isU&&(n.x=-n.x,a.x=-a.x),this._isV&&(n.y=-n.y,a.y=-a.y);var s=2*i+2*e*(this._fenduanshu+1);this.objData.vertices.push(s,s+1,-this._originWidthScale*this._width/100),this.objData.vertices.push(s,s+1,(1-this._originWidthScale)*this._width/100),this._isUV?(this.objData.uvs.push(n.y,n.x),this.objData.uvs.push(a.y,a.x)):(this.objData.uvs.push(n.x,n.y),this.objData.uvs.push(a.x,a.y))}for(i=0;this._fenduanshu>i;i++)this.objData.indexs.push(0+2*i+t,1+2*i+t,2+2*i+t,1+2*i+t,3+2*i+t,2+2*i+t);t+=2*this._fenduanshu+2}this.pushToGpu()},e.prototype.updateBind=function(){return},e}(Display3DFollowLocusPartilce),KeyFrame=function(){function t(){}return t}(),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},TimeLine=function(t){function e(){t.call(this),this._time=0,this.targetFlag=-1,this.beginTime=0,this.targetFlag=-1,this.visible=!1,this.maxFrameNum=0,this._time=0,this._keyFrameAry=[]}return __extends(e,t),e.prototype.updateMatrix=function(t,e){this._axisMove&&t.prependTranslation(this._axisMove.axis.x*this._axisMove.num,this._axisMove.axis.y*this._axisMove.num,this._axisMove.axis.z*this._axisMove.num),this._axisRotaion&&t.prependRotation(this._axisRotaion.num,this._axisRotaion.axis),t.prependTranslation(e.x,e.y,e.z),this._scaleChange?t.prependScale(e.widthFixed?1:this._scaleChange.num,e.heightFixed?1:this._scaleChange.num,e.widthFixed?1:this._scaleChange.num):this._scaleNosie?t.prependScale(e.widthFixed?1:1+this._scaleNosie.num,e.heightFixed?1:1+this._scaleNosie.num,e.widthFixed?1:1+this._scaleNosie.num):this._scaleAnim&&t.prependScale(e.widthFixed?1:this._scaleAnim.num,e.heightFixed?1:this._scaleAnim.num,e.widthFixed?1:this._scaleAnim.num),t.prependRotation(e.rotationZ,Vector3D.Z_AXIS),t.prependRotation(e.rotationY,Vector3D.Y_AXIS),t.prependRotation(e.rotationX,Vector3D.X_AXIS)},e.prototype.inverAxisRotation=function(t){this._axisRotaion&&t.prependRotation(-this._axisRotaion.num,this._axisRotaion.axis)},e.prototype.applySelfRotation=function(t,e){this._selfRotaion&&t.prependRotation(this._selfRotaion.num,e)
},e.prototype.addKeyFrame=function(t){var e=new KeyFrame;return e.frameNum=t,this._keyFrameAry.push(e),e},e.prototype.updateTime=function(t){this._currentKeyFrame&&(this._time=t,this.getTarget(),this._axisRotaion&&this._axisRotaion.update(this._time),this._selfRotaion&&this._selfRotaion.update(this._time),this._axisMove&&this._axisMove.update(this._time),this._scaleChange?this._scaleChange.update(this._time):this._scaleNosie?this._scaleNosie.update(this._time):this._scaleAnim&&this._scaleAnim.update(this._time))},e.prototype.getTarget=function(){for(var t=-1,e=0;this._keyFrameAry.length>e&&this._keyFrameAry[e].frameNum*Scene_data.frameTime<this._time;e++)t=e;t!=this.targetFlag&&(this._currentKeyFrame=this._keyFrameAry[t],this.targetFlag=t,t==this._keyFrameAry.length-1?(this.visible=!1,this._currentKeyFrame=null):(this.visible=!0,this.enterKeyFrame(this._currentKeyFrame.animData,this._currentKeyFrame.frameNum*Scene_data.frameTime,this._currentKeyFrame.baseValue)))},e.prototype.enterKeyFrame=function(t,e,i){if(void 0===e&&(e=0),void 0===i&&(i=null),null!=i){for(var n=0;10>n;n++)if(i[n])switch(n){case 1:this._selfRotaion||(this._selfRotaion=new SelfRotation),this._selfRotaion.num=this._selfRotaion.baseNum=i[n];break;case 2:this._axisRotaion||(this._axisRotaion=new AxisRotaion),this._axisRotaion.num=this._axisRotaion.baseNum=i[n];break;case 6:this._scaleChange||(this._scaleChange=new ScaleChange),this._scaleChange.num=this._scaleChange.baseNum=i[n];break;case 7:this._scaleAnim||(this._scaleAnim=new ScaleAnim),this._scaleAnim.num=this._scaleAnim.baseNum=i[n];break;case 8:this._scaleNosie||(this._scaleNosie=new ScaleNoise),this._scaleNosie.num=this._scaleNosie.baseNum=i[n];break;case 9:this._axisMove||(this._axisMove=new AxisMove),this._axisMove.num=this._axisMove.baseNum=i[n]}if(this._selfRotaion&&(this._selfRotaion.isDeath=!0),this._axisRotaion&&(this._axisRotaion.isDeath=!0),this._scaleChange&&(this._scaleChange.isDeath=!0),this._scaleAnim&&(this._scaleAnim.isDeath=!0),this._scaleNosie&&(this._scaleNosie.isDeath=!0),this._axisMove&&(this._axisMove.isDeath=!0),t)for(var n=0;t.length>n;n++)1==t[n].type?(this._selfRotaion?this._selfRotaion.reset():this._selfRotaion=new SelfRotation,this._selfRotaion.data=t[n].data,this._selfRotaion.baseTime=e):2==t[n].type?(this._axisRotaion?this._axisRotaion.reset():this._axisRotaion=new AxisRotaion,this._axisRotaion.data=t[n].data,this._axisRotaion.baseTime=e):6==t[n].type?(this._scaleChange?this._scaleChange.reset():this._scaleChange=new ScaleChange,this._scaleChange.data=t[n].data,this._scaleChange.baseTime=e):7==t[n].type?(this._scaleAnim?this._scaleAnim.reset():this._scaleAnim=new ScaleAnim,this._scaleAnim.data=t[n].data,this._scaleAnim.baseTime=e):8==t[n].type?(this._scaleNosie?this._scaleNosie.reset():this._scaleNosie=new ScaleNoise,this._scaleNosie.data=t[n].data,this._scaleNosie.baseTime=e):9==t[n].type&&(this._axisMove?this._axisMove.reset():this._axisMove=new AxisMove,this._axisMove.data=t[n].data,this._axisMove.baseTime=e)}},e.prototype.reset=function(){this._time=0,this._currentKeyFrame=this._keyFrameAry[0],this.visible=!1,this.targetFlag=-1},e.prototype.setAllInfo=function(t){for(var e=t,i=0;e.length>i;i++){var n=this.addKeyFrame(e[i].frameNum);n.animData=e[i].animdata,n.baseValue=e[i].baseValue}this.maxFrameNum=e[e.length-1].frameNum,this.beginTime=e[0].frameNum*Scene_data.frameTime,this._currentKeyFrame=e[0]},e.prototype.getMaxFrame=function(){return this._keyFrameAry[this._keyFrameAry.length-1].frameNum},e.prototype.dispose=function(){},e}(EventDispatcher),BaseAnim=function(){function t(){this.baseNum=0,this.num=0,this.time=0,this.speed=0,this.aSpeed=0,this.beginTime=0,this.lastTime=0,this.baseTime=0}return t.prototype.BaseAnim=function(){},t.prototype.update=function(t){this._isDeath||(this.time=t-this.baseTime,this._isActiva?(this.time=this.time-this.beginTime,this.time>this.lastTime&&(this.time=this.lastTime-this.beginTime,this._isDeath=!0),this.coreCalculate()):this.time>=this.beginTime&&(this.time>=this.lastTime?(this.time=this.lastTime-this.beginTime,this.coreCalculate(),this._isDeath=!0):(this.time=this.time-this.beginTime,this.coreCalculate()),this._isActiva=!0))},t.prototype.coreCalculate=function(){this.num=this.speed*this.time+this.aSpeed*this.time*this.time+this.baseNum},t.prototype.reset=function(){this._isActiva=!1,this._isDeath=!1,this.time=0,this.num=0},t.prototype.depthReset=function(){this._isActiva=!1,this._isDeath=!1,this.time=0,this.baseNum=0,this.num=0},Object.defineProperty(t.prototype,"data",{set:function(){},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isDeath",{get:function(){return this._isDeath},set:function(t){this._isDeath=t},enumerable:!0,configurable:!0}),t.prototype.getAllNum=function(t){t=Math.min(t,this.lastTime),t-=this.beginTime;var e=this.speed*t+this.aSpeed*t*t;this.baseNum+=e},t}(),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},AxisMove=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),Object.defineProperty(e.prototype,"data",{set:function(t){this.beginTime=Number(t[0].value),this.lastTime=-1==Number(t[1].value)?Scene_data.MAX_NUMBER:Number(t[1].value);var e=t[2].value.split("|");this.axis=new Vector3D(Number(e[0]),Number(e[1]),Number(e[2])),this.axis.normalize(),this.speed=.1*Number(t[3].value),this.aSpeed=.001*Number(t[4].value)},enumerable:!0,configurable:!0}),e}(BaseAnim),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},AxisRotaion=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),Object.defineProperty(e.prototype,"data",{set:function(t){this.beginTime=Number(t[0].value),this.lastTime=-1==Number(t[1].value)?Scene_data.MAX_NUMBER:Number(t[1].value);var e=(t[2].value+"").split("|");this.axis=new Vector3D(Number(e[0]),Number(e[1]),Number(e[2])),e=(t[3].value+"").split("|"),this.axisPos=new Vector3D(100*Number(e[0]),100*Number(e[1]),100*Number(e[2])),this.speed=.1*Number(t[4].value),this.aSpeed=.1*Number(t[5].value)},enumerable:!0,configurable:!0}),e}(BaseAnim),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},ScaleAnim=function(t){function e(){t.call(this),this.num=1}return __extends(e,t),e.prototype.update=function(t){this._isDeath||(this.time=t-this.baseTime,this._isActiva?(this.coreCalculate(),this.time>this.lastTime&&(this._isDeath=!0)):this.time>=this.beginTime&&(this._isActiva=!0))},e.prototype.coreCalculate=function(){var t=float2int(this.time/Scene_data.frameTime);this.num=t>=this.numAry.length?this.numAry[this.numAry.length-1]:this.numAry[t]},e.prototype.reset=function(){t.prototype.reset.call(this),this.num=1},e.prototype.depthReset=function(){t.prototype.depthReset.call(this),this.num=1},Object.defineProperty(e.prototype,"data",{set:function(t){this.numAry=[],this.beginTime=Number(t[0].value),this.lastTime=-1==Number(t[1].value)?Scene_data.MAX_NUMBER:Number(t[1].value),this.beginScale=Number(t[2].value),this.scaleNum=Number(t[3].value),this.scaleAry=[];for(var e=0,i=4;4+2*this.scaleNum>i;i+=2){var n={};n.value=Number(t[i].value),n.time=Number(t[i+1].value),e+=n.time,n.beginTime=this.beginTime+e,this.scaleAry.push(n)}var a,s=0,o=1;this.scaleAry.length?(a=(this.scaleAry[this.scaleAry.length-1].beginTime+this.scaleAry[this.scaleAry.length-1].time)/Scene_data.frameTime,o=this.scaleAry[0].beginTime,this._currentTarget=this.scaleAry[0]):a=0;var r=0;for(i=0;a>i;i++){var h=Scene_data.frameTime*i;h>=this._currentTarget.beginTime&&(this.beginScale=this._currentTarget.value,s=this._currentTarget.beginTime,r==this.scaleAry.length-1?this._currentTarget=this.scaleAry[this.scaleAry.length-1]:(r++,this._currentTarget=this.scaleAry[r]),o=this._currentTarget.time);var c=(h-s)/o*(this._currentTarget.value-this.beginScale)+this.beginScale;this.numAry.push(c)}this._currentTarget=this.scaleAry[0]},enumerable:!0,configurable:!0}),e.prototype.getAllNum=function(t){t=Math.min(t,this.lastTime+this.beginTime);var e=this.scaleAry[this.scaleAry.length-1];if(t>=e.beginTime+e.time)return this.baseNum=e.value,void 0;for(var i,n=0;this.scaleAry.length>n;n++)t>this.scaleAry[n].this.beginTime&&(this._currentTarget=this.scaleAry[n],this.beginTime=this._currentTarget.this.beginTime,this.beginScale=this._currentTarget.value,i=n);i++,this._currentTarget=this.scaleAry[i],this.baseNum=(this._currentTarget.value-this.beginScale)/this._currentTarget.this.time*(t-this.beginTime)+this.beginScale},e}(BaseAnim),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},ScaleChange=function(t){function e(){t.call(this),this.num=1}return __extends(e,t),e.prototype.coreCalculate=function(){this.num=1+this.speed*this.time+this.baseNum,this.num<this.minNum?this.num=this.minNum:this.num>this.maxNum&&(this.num=this.maxNum)},Object.defineProperty(e.prototype,"data",{set:function(t){this.beginTime=Number(t[0].value),this.lastTime=-1==Number(t[1].value)?Scene_data.MAX_NUMBER:Number(t[1].value),this.speed=.001*Number(t[2].value),this.minNum=.01*Number(t[3].value),this.maxNum=.01*Number(t[4].value)},enumerable:!0,configurable:!0}),e.prototype.getAllNum=function(t){t=Math.min(t,this.lastTime),t-=this.beginTime;var e=this.speed*t;this.baseNum+=e,this.baseNum<this.minNum?this.baseNum=this.minNum:e>this.maxNum&&(this.baseNum=this.maxNum)},e.prototype.reset=function(){this._isActiva=!1,this._isDeath=!1,this.time=0,this.num=1},e.prototype.depthReset=function(){this._isActiva=!1,this._isDeath=!1,this.time=0,this.baseNum=0,this.num=1},e}(BaseAnim),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},ScaleNoise=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.coreCalculate=function(){this.num=this.amplitude+this.amplitude*Math.sin(this.speed*this.time)},Object.defineProperty(e.prototype,"data",{set:function(t){this.beginTime=Number(t[0].value),this.lastTime=-1==Number(t[1].value)?Scene_data.MAX_NUMBER:Number(t[1].value),this.amplitude=Number(t[2].value),this.speed=.01*Number(t[3].value)},enumerable:!0,configurable:!0}),e.prototype.getAllNum=function(t){this.baseNum=this.amplitude+this.amplitude*Math.sin(this.speed*t)},e}(BaseAnim),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},SelfRotation=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),Object.defineProperty(e.prototype,"data",{set:function(t){this.beginTime=Number(t[0].value),this.lastTime=-1==Number(t[1].value)?Scene_data.MAX_NUMBER:Number(t[1].value),this.speed=.1*Number(t[2].value),this.aSpeed=.1*Number(t[3].value)},enumerable:!0,configurable:!0}),e}(BaseAnim),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},InteractiveEvent=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.Down="down",e.Up="Up",e.Move="Move",e.PinchStart="PinchStart",e.Pinch="Pinch",e}(BaseEvent),TextAlign=function(){function t(){}return t.LEFT="left",t.CENTER="center",t.RIGHT="right",t.TOP="top",t.MIDDLE="middle",t.BOTTOM="bottom",t}(),UIAtlas=function(){function t(){}return t.prototype.setInfo=function(t,e,i){var n=this;LoadManager.getInstance().load(Scene_data.fileRoot+t,LoadManager.XML_TYPE,function(t){var a=JSON.parse(t);n.configData=a.uiArr,n.layoutData=a.panelArr,n.loadImgUrl(e,i)})},t.prototype.loadConfig=function(t,e){var i=this;LoadManager.getInstance().load(Scene_data.fileRoot+t,LoadManager.XML_TYPE,function(t){var n=JSON.parse(t);i.configData=n.uiArr,e()})},t.prototype.loadImgUrl=function(t,e){var i=this;TextureManager.getInstance().getTexture(Scene_data.fileRoot+t,function(t){i.texture=t,e()})},t.prototype.getRec=function(t){for(var e=new UIRectangle,i=0;this.configData.length>i;i++)if(this.configData[i].name==t){e.x=this.configData[i].x,e.y=this.configData[i].y,e.width=this.configData[i].width,e.height=this.configData[i].height,e.pixelWitdh=this.configData[i].ow,e.pixelHeight=this.configData[i].oh,e.pixelX=this.configData[i].ox,e.pixelY=this.configData[i].oy,e.type=this.configData[i].type,e.cellX=this.configData[i].cellX,e.cellY=this.configData[i].cellY;break}return e},t.prototype.getLayoutData=function(t){if(!this.layoutData)return null;for(var e in this.layoutData)for(var i=this.layoutData[e].item,n=0;i.length>n;n++)if(i[n].name==t)return i[n]},t.prototype.getGridRec=function(t){for(var e=new UIGridRentangle,i=0;this.configData.length>i;i++)if(this.configData[i].name==t){e.x=this.configData[i].x,e.y=this.configData[i].y,e.width=this.configData[i].width,e.height=this.configData[i].height,e.pixelWitdh=this.configData[i].ow,e.pixelHeight=this.configData[i].oh,e.pixelX=this.configData[i].ox,e.pixelY=this.configData[i].oy,e.ogw=this.configData[i].uow,e.ogh=this.configData[i].uoh;break}return e},Object.defineProperty(t.prototype,"hasData",{get:function(){return this.configData},enumerable:!0,configurable:!0}),t.prototype.getObject=function(t,e,i,n,a,s,o){var r={};return r.x=e/s,r.y=i/o,r.width=n/s,r.height=a/o,r.ow=n,r.oh=a,r.name=t,r},t.prototype.updateCtx=function(t,e,i){TextureManager.getInstance().updateTexture(this.texture,e,i,this.ctx)},t.prototype.upDataPicToTexture=function(t,e){var i=this;LoadManager.getInstance().load(Scene_data.fileRoot+t,LoadManager.IMG_TYPE,function(t){var n=i.getRec(e);i.ctx=UIManager.getInstance().getContext2D(n.pixelWitdh,n.pixelHeight,!1),i.ctx.drawImage(t,0,0,n.pixelWitdh,n.pixelHeight),TextureManager.getInstance().updateTexture(i.texture,n.pixelX,n.pixelY,i.ctx)})},t.prototype.updateLable=function(t,e,i,n,a,s,o,r){void 0===o&&(o=!1),void 0===r&&(r=0);var h=this.getRec(t);this.ctx=UIManager.getInstance().getContext2D(h.pixelWitdh,h.pixelHeight,!1),this.ctx.textBaseline=a,this.ctx.textAlign=s,this.ctx.fillStyle=n,this.ctx.font=(o?"bolder ":"")+i+"px"+UIData.font;var c=0,l=0;s==TextAlign.LEFT?c=0:s==TextAlign.RIGHT?c=h.pixelWitdh:s==TextAlign.CENTER&&(c=h.pixelWitdh/2),a==TextAlign.BOTTOM?l=h.pixelHeight:a==TextAlign.TOP?l=0:a==TextAlign.MIDDLE&&(l=h.pixelHeight/2),r>0?this.wrapText(this.ctx,e,c,l,r,i+3):this.ctx.fillText(e,c,l),TextureManager.getInstance().updateTexture(this.texture,h.pixelX,h.pixelY,this.ctx)},t.prototype.wrapText=function(t,e,i,n,a,s){for(var o=e,r="",h=0;o.length>h;h++)if("\n"==o[h])t.fillText(r,i,n),r="",n+=s;else{var c=r+o[h]+" ",l=t.measureText(c),u=l.width;u>a?(t.fillText(r,i,n),r=o[h]+"",n+=s):r=c}t.fillText(r,i,n)},t.prototype.dispose=function(){},t}(),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},UIRectangle=function(t){function e(){t.apply(this,arguments),this.pixelWitdh=1,this.pixelHeight=1,this.pixelX=0,this.pixelY=0,this.cellX=0,this.cellY=0,this.type=0}return __extends(e,t),e}(Rectangle),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},UIGridRentangle=function(t){function e(){t.apply(this,arguments),this.ogw=0,this.ogh=0}return __extends(e,t),e}(UIRectangle),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},UICompenent=function(t){function e(){t.call(this),this._x=0,this._y=0,this._width=0,this._height=0,this.z=0,this.absoluteX=0,this.absoluteY=0,this.absoluteWidth=0,this.absoluteHeight=0,this._left=0,this._right=0,this._center=0,this._xType=-1,this._top=0,this._bottom=0,this._middle=0,this._yType=-1,this.renderX=0,this.renderY=0,this.renderWidth=0,this.renderHeight=0,this.tr=new Rectangle,this.mouseEnable=!0}return __extends(e,t),e.prototype.addStage=function(){this.renderData=[0,0,0,0],this.renderData2=[1,1,0,0],this.applyAbsolutePoint(),this.uiRender.addRenderUI(this)},e.prototype.removeStage=function(){this.uiRender.removeRenderUI(this)},e.prototype.pushVaData=function(t,e,i){return t.vertices.push(0,0,0,1,0,0,1,-1,0,0,-1,0),t.uvs.push(0,0,e,1,0,e,1,1,e,0,1,e),t.indexs.push(i,1+i,2+i,i,2+i,3+i),i+4},e.prototype.setVc=function(t,e){Scene_data.context3D.setVc4fv(t,"ui["+e+"]",this.renderData),Scene_data.context3D.setVc4fv(t,"ui2["+e+"]",this.renderData2)},e.prototype.update=function(){},e.prototype.applyRenderSize=function(){this.parent&&(this.renderX=this.absoluteX/Scene_data.stageWidth,this.renderY=this.absoluteY/Scene_data.stageHeight,this.renderWidth=this.absoluteWidth/Scene_data.stageWidth,this.renderHeight=this.absoluteHeight/Scene_data.stageHeight,this.renderData[0]=this.renderX,this.renderData[1]=this.renderY,this.renderData[2]=this.renderWidth,this.renderData[3]=this.renderHeight,this.renderData2[0]=this.tr.width,this.renderData2[1]=this.tr.height,this.renderData2[2]=this.tr.x,this.renderData2[3]=this.tr.y)},e.prototype.applyAbsolutePoint=function(){this.parent&&(-1==this._xType?this.absoluteX=this._x*UIData.Scale+this.parent.x:0==this._xType?this.absoluteX=this._left*UIData.Scale:1==this._xType?this.absoluteX=Scene_data.stageWidth-this._right*UIData.Scale-this.width*UIData.Scale:2==this._xType&&(this.absoluteX=this._center*UIData.Scale+Scene_data.stageWidth/2-this.width*UIData.Scale/2),-1==this._yType?this.absoluteY=this._y*UIData.Scale+this.parent.y:0==this._yType?this.absoluteY=this._top*UIData.Scale:1==this._yType?this.absoluteY=Scene_data.stageHeight-this._bottom*UIData.Scale-this.height*UIData.Scale:2==this._yType&&(this.absoluteY=this._middle*UIData.Scale+Scene_data.stageHeight/2-this.height*UIData.Scale/2),this.absoluteWidth=this.width*UIData.Scale,this.absoluteHeight=this.height*UIData.Scale,this.applyRenderSize())},Object.defineProperty(e.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this.applyAbsolutePoint()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this.applyAbsolutePoint()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t,this.applyAbsolutePoint()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t,this.applyAbsolutePoint()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"left",{set:function(t){this._left=t,this._xType=0,this.applyAbsolutePoint()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{set:function(t){this._right=t,this._xType=1,this.applyAbsolutePoint()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"center",{set:function(t){this._center=t,this._xType=2,this.applyAbsolutePoint()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{set:function(t){this._top=t,this._yType=0,this.applyAbsolutePoint()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{set:function(t){this._bottom=t,this._yType=1,this.applyAbsolutePoint()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"middle",{set:function(t){this._middle=t,this._yType=2,this.applyAbsolutePoint()},enumerable:!0,configurable:!0}),e.prototype.testPoint=function(t,e){return t>this.absoluteX&&this.absoluteX+this.absoluteWidth>t&&e>this.absoluteY&&this.absoluteY+this.absoluteHeight>e?!0:!1},e.prototype.interactiveEvent=function(t){t.type;var e=this._eventsMap;if(!e)return!1;var i=e[t.type];if(!i)return!1;if(!this.testPoint(t.x,t.y))return!1;var n=i.length;if(0==n)return!1;t.target=this;for(var a=0;n>a;a++){var s=i[a];s.listener.call(s.thisObject,t)}return!0},e}(EventDispatcher),UIConatiner=function(){function t(){this._x=0,this._y=0,this._width=0,this._height=0,this._left=0,this._right=0,this._center=0,this._xType=0,this._top=0,this._bottom=0,this._middle=0,this._yType=0,this._list=[],this.renderList=[],this.hasStage=!1}return t.prototype.addChild=function(t){this._list.push(t),t.parent=this,t.addStage()},t.prototype.removeChild=function(t){var e=this._list.indexOf(t);-1!=e&&this._list.splice(e,1),t.parent=null,t.removeStage()},t.prototype.addMask=function(t){this._maskList||(this._maskList=[]),t.parent=this,t.applyAbsolutePoint(),this._maskList.push(t)},t.prototype.removeMaks=function(t){if(this._maskList){var e=this._maskList.indexOf(t);-1!=e&&this._maskList.splice(e,1)}},t.prototype.addRender=function(t){this.renderList.push(t),this.hasStage&&UIManager.getInstance().addUI(t)},t.prototype.removeRender=function(t){var e=this.renderList.indexOf(t);-1!=e&&this.renderList.splice(e,1),this.hasStage&&UIManager.getInstance().removeUI(t)},t.prototype.resize=function(){0==this._xType?this._x=this._left*UIData.Scale:1==this._xType?this._x=Scene_data.stageWidth-this._right*UIData.Scale-this.width*UIData.Scale:2==this._xType&&(this._x=this._center*UIData.Scale+Scene_data.stageWidth/2-this.width*UIData.Scale/2),0==this._yType?this._y=this._top*UIData.Scale:1==this._yType?this._y=Scene_data.stageHeight-this._bottom*UIData.Scale-this.height*UIData.Scale:2==this._yType&&(this._y=this._middle*UIData.Scale+Scene_data.stageHeight/2-this.height*UIData.Scale/2),this.applyChild()},Object.defineProperty(t.prototype,"left",{set:function(t){this._left=t,this._xType=0,this._x=this._left*UIData.Scale,this.applyChild()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{set:function(t){this._right=t,this._xType=1,this._x=Scene_data.stageWidth-this._right*UIData.Scale-this.width*UIData.Scale,this.applyChild()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"center",{set:function(t){this._center=t,this._xType=2,this._x=this._center*UIData.Scale+Scene_data.stageWidth/2-this.width*UIData.Scale/2,this.applyChild()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"top",{set:function(t){this._top=t,this._yType=0,this._y=this._top*UIData.Scale,this.applyChild()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{set:function(t){this._bottom=t,this._yType=1,this._y=Scene_data.stageHeight-this._bottom*UIData.Scale-this.height*UIData.Scale,this.applyChild()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"middle",{set:function(t){this._middle=t,this._yType=2,this._y=this._middle*UIData.Scale+Scene_data.stageHeight/2-this.height*UIData.Scale/2,this.applyChild()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){if(0!=this._width)return this._width;for(var t=0,e=0;this._list.length>e;e++)t=Math.max(this._list[e].width);return t},set:function(t){this._width=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){if(0!=this._height)return this._height;for(var t=0,e=0;this._list.length>e;e++)t=Math.max(this._list[e].height);return t},set:function(t){this._height=t},enumerable:!0,configurable:!0}),t.prototype.applyChild=function(){for(var t=0;this._list.length>t;t++)this._list[t].applyAbsolutePoint();if(this._maskList)for(var t=0;this._maskList.length>t;t++)this._maskList[t].applyAbsolutePoint()},Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t},enumerable:!0,configurable:!0}),t}(),UIData=function(){function t(){}return t.setDesignWH=function(t,e){this.designWidth=t,this.designHeight=e,this.Scale=Math.min(Scene_data.stageWidth/t,Scene_data.stageHeight/e)},t.resize=function(){this.Scale=Math.min(Scene_data.stageWidth/this.designWidth,Scene_data.stageHeight/this.designHeight)},t.loadUIdata=function(e,i,n){void 0===i&&(i=null),void 0===n&&(n="default"),LoadManager.getInstance().load(Scene_data.fileRoot+e,LoadManager.XML_TYPE,function(e){var a=Array(JSON.parse(e))[0];t.dic[n]=a,i&&i()},null)},t.getUiDataByUid=function(e,i){void 0===i&&(i="default");var n=new Rectangle;if(t.dic.containsKey(i))for(var a=t.dic[i],s=0;a.length>s;s++)a[s].name==e&&(n.x=a[s].x,n.y=a[s].y,n.width=a[s].width,n.height=a[s].height);else alert("ui数据没加载");return n},t.designWidth=1e3,t.designHeight=800,t.font=" 微软雅黑",t.dic=new Dictionary([]),t}(),UIRenderComponent=function(){function t(){this.rendering=!1,this.initData()}return t.prototype.initData=function(){this._uiList=[],this.container=new UIConatiner,this.objData=new ObjData,this.program=ProgrmaManager.getInstance().getProgram(UIShader.UI_SHADER)},t.prototype.resize=function(){this.container.resize()},t.prototype.setImgUrl=function(t){var e=this;TextureManager.getInstance().getTexture(Scene_data.fileRoot+t,function(t){e.texture=t})},t.prototype.setInfo=function(t,e,i){this.uiAtlas=new UIAtlas,this.uiAtlas.setInfo(t,e,function(){i()})},t.prototype.setAtlas=function(t){this.uiAtlas=t},t.prototype.creatComponent=function(t,e,i,n){var a=new UICompenent;return a.tr.sets(t,e,i,n),a.uiRender=this,a},t.prototype.getComponent=function(t){var e=this.uiAtlas.getLayoutData(t);if(e){var i=e.type;if(0==i){var n=this.creatBaseComponent(e.dataItem[0]);return n.width=e.rect.width,n.height=e.rect.height,n.x=e.rect.x,n.y=e.rect.y,n}if(1==i){var a=this.creatGrid9Component(e.dataItem[0],e.rect.width,e.rect.height);return a.x=e.rect.x,a.y=e.rect.y,a}if(2==i){if(e.selected){var s=this.createSelectButton(e.dataItem[0],e.dataItem[1]);return s.width=e.rect.width,s.height=e.rect.height,s.x=e.rect.x,s.y=e.rect.y,s}var o=this.creatButton(e.dataItem[0],e.dataItem[1]);return o.width=e.rect.width,o.height=e.rect.height,o.x=e.rect.x,o.y=e.rect.y,o}if(4==i){var r=this.createFrame(e.dataItem[0]);return r.width=e.rect.width,r.height=e.rect.height,r.x=e.rect.x,r.y=e.rect.y,r}}return null},t.prototype.createFrame=function(t){var e=new FrameCompenent,i=this.uiAtlas.getRec(t);return e.setFrameData(i),e.uiRender=this,e},t.prototype.creatBaseComponent=function(t){var e=new UICompenent,i=this.uiAtlas.getRec(t);return e.tr.setRec(i),e.width=i.pixelWitdh,e.height=i.pixelHeight,e.uiRender=this,e},t.prototype.creatGrid9Component=function(t,e,i){var n=new Grid9Compenent,a=this.uiAtlas.getGridRec(t);return n.tr.setRec(a),n.ogw=a.ogw,n.ogh=a.ogh,n.gw=n.ogw/a.pixelWitdh,n.gh=n.ogh/a.pixelHeight,n.width=e,n.height=i,n.uiRender=this,n},t.prototype.creatButton=function(t,e){if(!this.uiAtlas.hasData)return null;var i=new Button,n=this.uiAtlas.getRec(t);return i.tr.setRec(n),i.trDown.setRec(this.uiAtlas.getRec(e)),i.width=n.pixelWitdh,i.height=n.pixelHeight,i.uiRender=this,i},t.prototype.createSelectButton=function(t,e){if(!this.uiAtlas.hasData)return null;var i=new SelectButton,n=this.uiAtlas.getRec(t);return i.tr.setRec(n),i.trDown.setRec(this.uiAtlas.getRec(e)),i.width=n.pixelWitdh,i.height=n.pixelHeight,i.uiRender=this,i},t.prototype.creatComponentByName=function(t,e){void 0===e&&(e="default");var i=new UICompenent,n=UIData.getUiDataByUid(t,e);return i.tr.setRec(n),i.uiRender=this,i},t.prototype.addRenderUI=function(t){this._uiList.push(t),this._uiList.sort(function(t,e){return t.z>e.z?-1:1}),this.applyObjData()},t.prototype.removeRenderUI=function(t){var e=this._uiList.indexOf(t);-1!=e&&this._uiList.splice(e,1),this.applyObjData()},t.prototype.applyObjData=function(){this.objData.vertices.length=0,this.objData.uvs.length=0,this.objData.indexs.length=0;for(var t=0,e=0;this._uiList.length>e;e++){var i=this._uiList[e];t=i.pushVaData(this.objData,e,t)}this.objData.treNum=this.objData.indexs.length,this.objData.vertexBuffer?(Scene_data.context3D.uploadBuff3DByBuffer(this.objData.vertexBuffer,this.objData.vertices),Scene_data.context3D.uploadBuff3DByBuffer(this.objData.uvBuffer,this.objData.uvs),Scene_data.context3D.uploadIndexBuff3DByBuffer(this.objData.indexBuffer,this.objData.indexs)):(this.objData.vertexBuffer=Scene_data.context3D.uploadBuff3D(this.objData.vertices),this.objData.uvBuffer=Scene_data.context3D.uploadBuff3D(this.objData.uvs),this.objData.indexBuffer=Scene_data.context3D.uploadIndexBuff3D(this.objData.indexs))},t.prototype.update=function(){if(0!=this._uiList.length){if(this.mask){var t=Scene_data.context3D.renderContext;t.enable(t.STENCIL_TEST),t.stencilMask(255),t.stencilFunc(t.NEVER,3,255),t.stencilOp(t.REPLACE,t.REPLACE,t.REPLACE),this.mask.update(),t.stencilFunc(t.LESS,1,255),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}Scene_data.context3D.setBlendParticleFactors(0),Scene_data.context3D.setProgram(this.program);for(var e=0;this._uiList.length>e;e++)this._uiList[e].update(),this._uiList[e].setVc(this.program,e);if(Scene_data.context3D.setVa(0,3,this.objData.vertexBuffer),Scene_data.context3D.setVa(1,3,this.objData.uvBuffer),this.uiAtlas?Scene_data.context3D.setRenderTexture(this.program,"s_texture",this.uiAtlas.texture,0):Scene_data.context3D.setRenderTexture(this.program,"s_texture",this.texture,0),Scene_data.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum),this.mask&&Scene_data.context3D.renderContext.disable(Scene_data.context3D.renderContext.STENCIL_TEST),this.modelRenderList)for(var e=0;this.modelRenderList.length>e;e++)this.modelRenderList[e].update()}},t.prototype.addModel=function(t){this.modelRenderList||(this.modelRenderList=[]),this.modelRenderList.push(t)},t.prototype.interactiveEvent=function(t){for(var e=!1,i=0;this._uiList.length>i;i++)this._uiList[i].interactiveEvent(t)&&(e=!0);return e},t}(),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},UIListRenderComponent=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createList=function(){var t=new List;return t.uiRender=this,t},e.prototype.createGridList=function(){var t=new GridList;return t.uiRender=this,t},e}(UIRenderComponent),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},UIBackImg=function(t){function e(){t.call(this),this._scaleData=[1,1]}return __extends(e,t),e.prototype.initData=function(){this.objData=new ObjData,this.program=ProgrmaManager.getInstance().getProgram(UIImageShader.UI_IMG_SHADER),this.objData.vertices.push(-1,1,0,1,1,0,1,-1,0,-1,-1,0),this.objData.uvs.push(0,0,1,0,1,1,0,1),this.objData.indexs.push(0,1,2,0,2,3),this.objData.treNum=6,this.objData.vertexBuffer=Scene_data.context3D.uploadBuff3D(this.objData.vertices),this.objData.uvBuffer=Scene_data.context3D.uploadBuff3D(this.objData.uvs),this.objData.indexBuffer=Scene_data.context3D.uploadIndexBuff3D(this.objData.indexs)},e.prototype.resize=function(){this.appleyPos()},e.prototype.setImgInfo=function(t,e,i){this.setImgUrl(t),this._width=e,this._height=i},e.prototype.appleyPos=function(){var t=this._width/Scene_data.stageWidth,e=this._height/Scene_data.stageHeight;e>t?(this._scaleData[0]=1,this._scaleData[1]=this._height/Scene_data.stageHeight/t):(this._scaleData[0]=this._width/Scene_data.stageWidth/e,this._scaleData[1]=1)},e.prototype.update=function(){Scene_data.context3D.setBlendParticleFactors(0),Scene_data.context3D.setProgram(this.program),Scene_data.context3D.setVa(0,3,this.objData.vertexBuffer),Scene_data.context3D.setVa(1,2,this.objData.uvBuffer),Scene_data.context3D.setVc2fv(this.program,"scale",this._scaleData),Scene_data.context3D.setRenderTexture(this.program,"s_texture",this.texture,0),Scene_data.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum)
},e.prototype.interactiveEvent=function(){return!1},e}(UIRenderComponent),UIMask=function(){function t(){this._x=0,this._y=0,this._width=0,this._height=0,this.absoluteX=0,this.absoluteY=0,this.absoluteWidth=0,this.absoluteHeight=0,this.initData(),this.renderData=[0,0,0,0]}return t.prototype.initData=function(){this.objData=new ObjData,this.program=ProgrmaManager.getInstance().getProgram(UIMaskShader.UI_MASK_SHADER),this.applyObjData()},t.prototype.applyAbsolutePoint=function(){this.parent&&(this.absoluteX=this._x*UIData.Scale+this.parent.x,this.absoluteY=this._y*UIData.Scale+this.parent.y,this.absoluteWidth=this._width*UIData.Scale,this.absoluteHeight=this._height*UIData.Scale,this.applyRenderSize())},t.prototype.applyRenderSize=function(){this.parent&&(this.renderData[0]=this.absoluteX/Scene_data.stageWidth,this.renderData[1]=this.absoluteY/Scene_data.stageHeight,this.renderData[2]=this.absoluteWidth/Scene_data.stageWidth,this.renderData[3]=this.absoluteHeight/Scene_data.stageHeight)},t.prototype.applyObjData=function(){this.objData.vertices.length=0,this.objData.uvs.length=0,this.objData.indexs.length=0,this.objData.vertices.push(0,0,0,1,0,0,1,-1,0,0,-1,0),this.objData.indexs.push(0,1,2,0,2,3),this.objData.treNum=this.objData.indexs.length,this.objData.vertexBuffer=Scene_data.context3D.uploadBuff3D(this.objData.vertices),this.objData.indexBuffer=Scene_data.context3D.uploadIndexBuff3D(this.objData.indexs)},t.prototype.update=function(){Scene_data.context3D.setBlendParticleFactors(0),Scene_data.context3D.setProgram(this.program),Scene_data.context3D.setVc4fv(this.program,"ui",this.renderData),Scene_data.context3D.setVa(0,3,this.objData.vertexBuffer),Scene_data.context3D.drawCall(this.objData.indexBuffer,this.objData.treNum)},Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this.applyAbsolutePoint()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this.applyAbsolutePoint()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t,this.applyAbsolutePoint()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t,this.applyAbsolutePoint()},enumerable:!0,configurable:!0}),t}(),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},BaseButton=function(t){function e(){t.call(this),this.trDown=new Rectangle,this._state=0,this._currentState=0}return __extends(e,t),e.prototype.update=function(){this._currentState!=this._state&&(0==this._state?(this.renderData2[0]=this.tr.width,this.renderData2[1]=this.tr.height,this.renderData2[2]=this.tr.x,this.renderData2[3]=this.tr.y):1==this._state&&(this.renderData2[0]=this.trDown.width,this.renderData2[1]=this.trDown.height,this.renderData2[2]=this.trDown.x,this.renderData2[3]=this.trDown.y),this._currentState=this._state)},e}(UICompenent),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Button=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.interactiveEvent=function(e){return t.prototype.interactiveEvent.call(this,e)},e}(BaseButton),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},SelectButton=function(t){function e(){t.call(this),this._selected=!1}return __extends(e,t),Object.defineProperty(e.prototype,"selected",{get:function(){return this._selected},set:function(t){this._selected=t,this._state=this._selected?1:0},enumerable:!0,configurable:!0}),e.prototype.interactiveEvent=function(e){return e.type==InteractiveEvent.Down&&this.testPoint(e.x,e.y)&&(this._selected=!this._selected,this._state=this._selected?1:0),t.prototype.interactiveEvent.call(this,e)},e}(BaseButton),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Grid9Compenent=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.pushVaData=function(t,e,i){for(var n=[0,0,0,this.ogw,0,0,this.width-this.ogw,0,0,this.width,0,0,0,-this.ogh,0,this.ogw,-this.ogh,0,this.width-this.ogw,-this.ogh,0,this.width,-this.ogh,0,0,this.ogh-this.height,0,this.ogw,this.ogh-this.height,0,this.width-this.ogw,this.ogh-this.height,0,this.width,this.ogh-this.height,0,0,-this.height,0,this.ogw,-this.height,0,this.width-this.ogw,-this.height,0,this.width,-this.height,0],a=0;n.length>a;a+=3)t.vertices.push(n[a]/this.width,n[a+1]/this.height,n[a+2]);t.uvs.push(0,0,e,this.gw,0,e,1-this.gw,0,e,1,0,e,0,this.gh,e,this.gw,this.gh,e,1-this.gw,this.gh,e,1,this.gh,e,0,1-this.gh,e,this.gw,1-this.gh,e,1-this.gw,1-this.gh,e,1,1-this.gh,e,0,1,e,this.gw,1,e,1-this.gw,1,e,1,1,e);for(var s=[0,1,5,0,5,4,1,2,6,1,6,5,2,3,7,2,7,6,4,5,9,4,9,8,5,6,10,5,10,9,6,7,11,6,11,10,8,9,13,8,13,12,9,10,14,9,14,13,10,11,15,10,15,14],a=0;s.length>a;a++)t.indexs.push(i+s[a]);return i+16},e}(UICompenent),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},FrameCompenent=function(t){function e(){t.call(this),this.isTrue=!1,this.idnum=0,this.stopStatic=0,this.speedNum=0}return __extends(e,t),e.prototype.setFrameData=function(t){this._frameData=t},e.prototype.applyRenderSize=function(){if(this.parent){this.renderX=this.absoluteX/Scene_data.stageWidth,this.renderY=this.absoluteY/Scene_data.stageHeight,this.renderWidth=this.absoluteWidth/Scene_data.stageWidth,this.renderHeight=this.absoluteHeight/Scene_data.stageHeight,this.renderData[0]=this.renderX,this.renderData[1]=this.renderY,this.renderData[2]=this.renderWidth,this.renderData[3]=this.renderHeight;var t=this._frameData.cellX,e=this._frameData.cellY,i=this._frameData.width/t,n=this._frameData.height/e,a=new Rectangle(0,0,i,n),s=this.idnum%(t*e);a.x=s%t*i,a.y=float2int(s/t)*n,this.renderData2[0]=a.width,this.renderData2[1]=a.height,this.renderData2[2]=a.x+this._frameData.x,this.renderData2[3]=a.y+this._frameData.y}},e.prototype.update=function(){if(this._frameData&&2!=this.stopStatic){this.applyRenderSize(),this.speedNum++,this.speedNum>6&&(this.idnum++,this.speedNum=0);var t=this._frameData.cellX,e=this._frameData.cellY;this.idnum>=t*e-1&&(1==this.stopStatic?this.stopStatic=2:this.idnum=0)}},e.prototype.goToAndPlay=function(t){this.stopStatic=1,this.idnum=t},e.prototype.play=function(){this.stopStatic=0},e.prototype.stopEnd=function(){this.stopStatic=2;var t=this._frameData.cellX,e=this._frameData.cellY;this.idnum=t*e-1,this.applyRenderSize()},e}(UICompenent),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},List=function(t){function e(){t.call(this),this._contentX=0,this._contentY=0,this._needScoller=!1,this.addEventListener(InteractiveEvent.Down,this.onDown,this)}return __extends(e,t),e.prototype.applyAbsolutePoint=function(){this.parent&&(this.absoluteX=(this._x+this._contentX)*UIData.Scale+this.parent.x,this.absoluteY=(this._y+this._contentY)*UIData.Scale+this.parent.y,this.absoluteWidth=this.width*UIData.Scale,this.absoluteHeight=this.height*UIData.Scale,this.applyRenderSize())},Object.defineProperty(e.prototype,"contentX",{get:function(){return this._contentX},set:function(t){this._contentX=t,this.applyAbsolutePoint()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contentY",{get:function(){return this._contentY},set:function(t){this._contentY=t,this.applyAbsolutePoint()},enumerable:!0,configurable:!0}),e.prototype.setData=function(t,e,i,n,a,s,o,r){void 0===o&&(o=256),void 0===r&&(r=300),this.uiRender.uiAtlas&&this.uiRender.uiAtlas.dispose(),this.width=a,this.height=s,this._showWidth=o,this._showHeight=r,this._itemWidth=i,this._itemHeight=n,this._data=t;var h=new ListAtlas;this.uiRender.setAtlas(h),h.setData(a,s,i,n,t.length),this._itemRenderAry=[];for(var c=0;t.length>c;c++){var l=new e;l.setData(t[c],h,h.configData[c]),this._itemRenderAry.push(l)}this._oHeight=n*t.length,this._needScoller=this._oHeight>this._showHeight?!0:!1,this.uiRender.applyObjData()},e.prototype.pushVaData=function(t,e,i){if(!this._itemRenderAry)return 0;for(var n=0;this._itemRenderAry.length>n;n++){var a=this._itemRenderAry[n].uvData;t.vertices.push(0,-a.y,0,1,-a.y,0),t.uvs.push(0,a.y,e,1,a.y,e)}t.vertices.push(0,-1,0,1,-1,0),t.uvs.push(0,1,e,1,1,e);for(var n=0;this._itemRenderAry.length>n;n++)t.indexs.push(i+2*n,1+i+2*n,3+i+2*n,i+2*n,3+i+2*n,2+i+2*n);return i+2*(this._itemRenderAry.length+1)},e.prototype.onDown=function(t){this._ypos=t.y,this.testItemClick(t.x,t.y),this._needScoller&&(Scene_data.uiStage.addEventListener(InteractiveEvent.Move,this.onMove,this),Scene_data.uiStage.addEventListener(InteractiveEvent.Up,this.onUp,this))},e.prototype.testItemClick=function(t,e){var i=t-this.absoluteX,n=e-this.absoluteY,a=this._itemHeight*UIData.Scale,s=Math.ceil(n/a);s>=this._itemRenderAry.length||this._itemRenderAry[s].click(i,n-a*(s-1))},e.prototype.onMove=function(t){this.contentY-=this._ypos-t.y,this.contentY>0?this.contentY=0:this.contentY<this._showHeight-this._oHeight&&(this.contentY=this._showHeight-this._oHeight),this._ypos=t.y},e.prototype.onUp=function(){Scene_data.uiStage.removeEventListener(InteractiveEvent.Move,this.onMove,this),Scene_data.uiStage.removeEventListener(InteractiveEvent.Up,this.onUp,this)},e}(UICompenent),ListAtlas=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.setData=function(t,e,i,n,a){this.ctx=UIManager.getInstance().getContext2D(t,e,!1);var s=this.ctx.createImageData(t,e);this.texture=TextureManager.getInstance().getImageDataTexture(s),this.configData=[];for(var o=0;a>o;o++){var r={};r.ox=0,r.oy=o*n,r.ow=i,r.oh=n,r.x=0,r.y=o*n/e,r.width=i/t,r.height=n/e,r.name=""+o,this.configData.push(r)}},e}(UIAtlas),ListItemData=function(){function t(){}return t}(),ListItemRender=function(){function t(){}return t.prototype.setData=function(t,e,i){this._listItemData=t,this._listItemData.itemRender=this,this.uvData=i,this.atlas=e,this.draw()},Object.defineProperty(t.prototype,"selected",{set:function(){},enumerable:!0,configurable:!0}),t.prototype.draw=function(){},t.prototype.click=function(){this._listItemData.clickFun&&this._listItemData.clickFun(this._listItemData)},t}(),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},GridList=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.setGridData=function(t,e,i,n,a,s,o,r,h){void 0===r&&(r=256),void 0===h&&(h=300),this.uiRender.uiAtlas&&this.uiRender.uiAtlas.dispose(),this.width=s,this.height=o,this._showWidth=r,this._showHeight=h,this._data=t,this.wNum=i,this._itemWidth=n,this._itemHeight=a;var c=new GridListAtlas;this.uiRender.setAtlas(c),c.setGridData(s,o,n,a,i,t.length),this._itemRenderAry=[];for(var l=0;t.length>l;l++){var u=new e;u.setData(t[l],c,c.configData[l]),this._itemRenderAry.push(u)}this._oHeight=a*Math.ceil(this._itemRenderAry.length/this.wNum),this._needScoller=this._oHeight>this._showHeight?!0:!1,this.uiRender.applyObjData()},e.prototype.testItemClick=function(t,e){var i=t-this.absoluteX,n=e-this.absoluteY,a=this._itemHeight*UIData.Scale,s=this._itemWidth*UIData.Scale,o=float2int(i/s),r=float2int(n/a),h=r*this.wNum+o;h>=this._itemRenderAry.length||this._itemRenderAry[h].click(i-s*(o-1),n-a*(r-1))},e.prototype.pushVaData=function(t,e,i){if(!this._itemRenderAry)return 0;for(var n=Math.ceil(this._itemRenderAry.length/this.wNum),a=this._itemWidth/this.width,s=this._itemHeight/this.height,e=0;n+1>e;e++)for(var o=0;this.wNum+1>o;o++)t.vertices.push(o*a,-e*s,0),t.uvs.push(o*a,e*s,0);for(var r=n*this.wNum,o=0;r>o;o++){var h=o%this.wNum+float2int(o/this.wNum)*(this.wNum+1),c=h+i,l=h+1+i,u=h+this.wNum+1+i,d=h+1+this.wNum+1+i;t.indexs.push(c,l,d,c,d,u)}return i+2*(this._itemRenderAry.length+1)},e}(List),GridListAtlas=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.setGridData=function(t,e,i,n,a,s){this.ctx=UIManager.getInstance().getContext2D(t,e,!1),this.ctx.fillStyle="#660000",this.ctx.fillRect(0,0,t,e);var o=this.ctx.createImageData(t,e);this.texture=TextureManager.getInstance().getImageDataTexture(o),this.configData=[];for(var r=Math.ceil(s/a),h=0,c=0;r>c;c++)for(var l=0;a>l;l++){h=c*a+l;var u={};u.ox=l*i,u.oy=c*n,u.ow=i,u.oh=n,u.x=l*i/t,u.y=c*n/e,u.width=i/t,u.height=n/e,u.name=""+h,this.configData.push(u)}},e}(ListAtlas),UIManager=function(){function t(){Scene_data.uiStage=new UIStage,Scene_data.uiBlankStage=new UIStage,this._canvas=document.createElement("canvas"),this._canvas.style.zIndex="3",this._canvas.width=200,this._canvas.height=200,this._canvas.style.left=200,this._canvas.style.top=300,this._ctx=this._canvas.getContext("2d"),this._ctx.textBaseline=TextAlign.TOP}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.getContext2D=function(t,e,i){return void 0===i&&(i=!0),this._canvas.width=t,this._canvas.height=e,this._ctx.clearRect(0,0,t,e),i&&(this._ctx.textBaseline=TextAlign.TOP,this._ctx.textAlign=TextAlign.LEFT),this._ctx},t.prototype.showCanvas=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this._canvas.style.left=t,this._canvas.style.top=e,document.getElementById("root").appendChild(this._canvas)},t.prototype.init=function(){ProgrmaManager.getInstance().registe(UIShader.UI_SHADER,new UIShader),ProgrmaManager.getInstance().registe(UIImageShader.UI_IMG_SHADER,new UIImageShader),ProgrmaManager.getInstance().registe(UIMaskShader.UI_MASK_SHADER,new UIMaskShader),ProgrmaManager.getInstance().registe(Movie2DShader.MOVIE2D_SHADER,new Movie2DShader),ProgrmaManager.getInstance().registe(Sprite2DShader.SPRITE2D_SHADER,new Sprite2DShader),this._uiList=[],this._containerList=[],UIData.setDesignWH(800,450)},t.prototype.addUI=function(t){this._uiList.push(t),t.rendering=!0},t.prototype.removeUI=function(t){var e=this._uiList.indexOf(t);t.rendering=!1,-1!=e&&this._uiList.splice(e,1)},t.prototype.addUIContainer=function(t){if(!t.hasStage){this._containerList.push(t),t.hasStage=!0,t.resize();for(var e=0;t.renderList.length>e;e++)this.addUI(t.renderList[e])}},t.prototype.removeUIContainer=function(t){var e=this._containerList.indexOf(t);t.hasStage=!1,-1!=e&&this._containerList.splice(e,1);for(var i=0;t.renderList.length>i;i++)this.removeUI(t.renderList[i])},t.prototype.resize=function(){if(this._uiList){UIData.resize();for(var t=0;this._uiList.length>t;t++)this._uiList[t].resize();for(var t=0;this._containerList.length>t;t++)this._containerList[t].resize()}},t.prototype.update=function(){for(var t=0;this._uiList.length>t;t++)this._uiList[t].update()},t.prototype.regEvent=function(){var t=this;document.addEventListener(MouseType.MouseDown,function(e){t.onMouse(e)}),document.addEventListener(MouseType.MouseUp,function(e){t.onMouse(e)}),document.addEventListener(MouseType.MouseMove,function(e){t.onMouse(e)}),document.addEventListener(MouseType.TouchStart,function(e){t.onTouch(e)}),document.addEventListener(MouseType.TouchEnd,function(e){t.onTouch(e)}),document.addEventListener(MouseType.TouchMove,function(e){t.onTouch(e)})},t.prototype.onTouch=function(t){this.interactiveEvent(t)},t.prototype.onMouse=function(t){this.interactiveEvent(t)},t.prototype.interactiveEvent=function(t){var e,i=new Vector2D;if(t instanceof MouseEvent)t.type==MouseType.MouseDown?e=new InteractiveEvent(InteractiveEvent.Down):t.type==MouseType.MouseUp?e=new InteractiveEvent(InteractiveEvent.Up):t.type==MouseType.MouseMove?e=new InteractiveEvent(InteractiveEvent.Move):t.type==MouseType.MouseClick,i.x=t.pageX,i.y=t.pageY;else if(t.type==MouseType.TouchStart?t.touches.length>1?(e=new InteractiveEvent(InteractiveEvent.PinchStart),this.lastSwipeDis=MathClass.math_distance(t.touches[0].clientX,t.touches[0].clientY,t.touches[1].clientX,t.touches[1].clientY),this.lastSwipeRot=Math.atan2(t.touches[1].clientY-t.touches[0].clientY,t.touches[1].clientX-t.touches[0].clientX)):e=new InteractiveEvent(InteractiveEvent.Down):t.type==MouseType.TouchEnd?e=new InteractiveEvent(InteractiveEvent.Up):t.type==MouseType.TouchMove?t.touches.length>1?(e=new InteractiveEvent(InteractiveEvent.Pinch),e.data=MathClass.math_distance(t.touches[0].clientX,t.touches[0].clientY,t.touches[1].clientX,t.touches[1].clientY)/this.lastSwipeDis,e.roation=180*(Math.atan2(t.touches[1].clientY-t.touches[0].clientY,t.touches[1].clientX-t.touches[0].clientX)-this.lastSwipeRot)/Math.PI):e=new InteractiveEvent(InteractiveEvent.Move):t.type==MouseType.TouchClick,i.x=t.pageX,i.y=t.pageY,t.touches.length)for(var n=0;t.touches.length>n;n++)i.x=t.touches[n].clientX,i.y=t.touches[n].clientY;Scene_data.verticalScene?(e.x=i.y,e.y=Scene_data.stageHeight-i.x):(e.x=i.x,e.y=i.y),console.log(e.x,e.y,i.x,i.y,Scene_data.stageWidth,Scene_data.stageHeight);for(var a=!1,s=[],n=0;this._uiList.length>n;n++)s.push(this._uiList[n]);for(var n=0;s.length>n;n++)s[n].interactiveEvent(e)&&(a=!0);Scene_data.uiStage.interactiveEvent(e),a||Scene_data.uiBlankStage.interactiveEvent(e)},t}(),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},UIStage=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.interactiveEvent=function(t){var e=t.type,i=this._eventsMap;if(i){var n=i[e];if(n){var a=n.length;if(0!=a)for(var s=0;a>s;s++){var o=n[s];o.listener.call(o.thisObject,t)}}}},e}(EventDispatcher),TextureManager=function(){function t(){this._dic={},this._loadDic={},this._resDic={},this.initDefaultLightMapTexture()}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.getTexture=function(t,e,i,n,a,s){var o=this;if(void 0===i&&(i=0),void 0===n&&(n=null),void 0===a&&(a=0),void 0===s&&(s=0),this._dic[t])return n?e(this._dic[t],n):e(this._dic[t]),void 0;var r=new TextureLoad(e,n,t,i,a,s);if(this._loadDic[t]){var h=this._loadDic[t];return h.push(r),void 0}this._loadDic[t]=[],this._loadDic[t].push(r),this._resDic[t]?this.loadTextureCom(this._resDic[t],r):LoadManager.getInstance().load(t,LoadManager.IMG_TYPE,function(t,e){o.loadTextureCom(t,e)},r)},t.prototype.addRes=function(t,e){this._resDic[t]||(this._resDic[t]=e)},t.prototype.getCanvasTexture=function(t){var e=Scene_data.context3D.getTexture(t.canvas,0,0);return e},t.prototype.getImageDataTexture=function(t){var e=Scene_data.context3D.getTexture(t,0,0);return e},t.prototype.updateTexture=function(t,e,i,n){Scene_data.context3D.updateTexture(t,e,i,n.canvas)},t.prototype.loadCubeTexture=function(t,e){var i=new CubemapLoad;i.loadCube(t,function(t){e(t)})},t.prototype.loadTextureCom=function(t,e){for(var i=Scene_data.context3D.getTexture(t,e.wrap,e.filter,e.mipmap),n=this._loadDic[e.url],a=0;n.length>a;a++)n[a].info?n[a].fun(i,n[a].info):n[a].fun(i);delete this._loadDic[e.url],this._dic[e.url]=i},t.prototype.initDefaultLightMapTexture=function(){var t=document.createElement("canvas"),e=t.getContext("2d");t.width=32,t.height=32,e.fillStyle="rgb(51,51,51)",e.fillRect(0,0,32,32),this.defaultLightMap=Scene_data.context3D.getTexture(t)},t}(),TextureLoad=function(){function t(t,e,i,n,a,s){this.fun=t,this.info=e,this.url=i,this.wrap=n,this.filter=a,this.mipmap=s}return t}(),CubemapLoad=function(){function t(){this.ary=Array(6),this.flagNum=0}return t.prototype.loadCube=function(t,e){var i=this;this.fun=e;for(var n=0;6>n;n++){var a=t+"0"+(n+1)+".jpg";LoadManager.getInstance().load(a,LoadManager.IMG_TYPE,function(t,e){i.loadCom(t,e)},{id:n})}},t.prototype.loadCom=function(t,e){var i=t.width/4,n=document.createElement("canvas"),a=n.getContext("2d");n.width=i,n.height=i;var s=Scene_data.context3D.renderContext,o=s.createTexture();s.bindTexture(s.TEXTURE_CUBE_MAP,o),a.drawImage(t,2*i,i,i,i,0,0,i,i),s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,n),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,s.LINEAR),a.drawImage(t,0,i,i,i,0,0,i,i),s.texImage2D(s.TEXTURE_CUBE_MAP_NEGATIVE_X,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,n),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,s.LINEAR),a.drawImage(t,i,0,i,i,0,0,i,i),s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_Y,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,n),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,s.LINEAR),a.drawImage(t,i,2*i,i,i,0,0,i,i),s.texImage2D(s.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,n),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,s.LINEAR),a.drawImage(t,i,i,i,i,0,0,i,i),s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_Z,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,n),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,s.LINEAR),a.drawImage(t,3*i,i,i,i,0,0,i,i),s.texImage2D(s.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,n),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,s.LINEAR),this.ary[e.id]=o,this.flagNum++,6==this.flagNum&&this.fun(this.ary)},t}(),ConstItem=function(){function t(){this.value=new Vector3D,this.vecNum=[]}return Object.defineProperty(t.prototype,"id",{get:function(){return this._id},set:function(t){this._id=t,this.name="fc"+t},enumerable:!0,configurable:!0}),t.prototype.creat=function(){this.vecNum[0]=this.value.x,this.vecNum[1]=this.value.y,this.vecNum[2]=this.value.z,this.vecNum[3]=this.value.w},t.prototype.setData=function(t){this.id=t.id,this.value=new Vector3D(t.value.x,t.value.y,t.value.z,t.value.w),this.paramName0=t.paramName0,this.param0Type=t.param0Type,this.param0Index=t.param0Index,this.paramName1=t.paramName1,this.param1Type=t.param1Type,this.param1Index=t.param1Index,this.paramName2=t.paramName2,this.param2Type=t.param2Type,this.param2Index=t.param2Index,this.paramName3=t.paramName3,this.param3Type=t.param3Type,this.param3Index=t.param3Index,this.creat()},t.prototype.setDynamic=function(t){this.paramName0==t.paramName?1==this.param0Type?this.vecNum[this.param0Index]=t.currentValue.x:2==this.param0Type?(this.vecNum[this.param0Index]=t.currentValue.x,this.vecNum[this.param0Index+1]=t.currentValue.y):3==this.param0Type?(this.vecNum[this.param0Index]=t.currentValue.x,this.vecNum[this.param0Index+1]=t.currentValue.y,this.vecNum[this.param0Index+2]=t.currentValue.z):4==this.param0Type&&(this.vecNum[this.param0Index]=t.currentValue.x,this.vecNum[this.param0Index+1]=t.currentValue.y,this.vecNum[this.param0Index+2]=t.currentValue.z,this.vecNum[this.param0Index+3]=t.currentValue.w):this.paramName1==t.paramName?1==this.param1Type?this.vecNum[this.param1Index]=t.currentValue.x:2==this.param1Type?(this.vecNum[this.param1Index]=t.currentValue.x,this.vecNum[this.param1Index+1]=t.currentValue.y):3==this.param1Type?(this.vecNum[this.param1Index]=t.currentValue.x,this.vecNum[this.param1Index+1]=t.currentValue.y,this.vecNum[this.param1Index+2]=t.currentValue.z):4==this.param1Type&&(this.vecNum[this.param1Index]=t.currentValue.x,this.vecNum[this.param1Index+1]=t.currentValue.y,this.vecNum[this.param1Index+2]=t.currentValue.z,this.vecNum[this.param1Index+3]=t.currentValue.w):this.paramName2==t.paramName?1==this.param2Type?this.vecNum[this.param2Index]=t.currentValue.x:2==this.param2Type?(this.vecNum[this.param2Index]=t.currentValue.x,this.vecNum[this.param2Index+1]=t.currentValue.y):3==this.param2Type?(this.vecNum[this.param2Index]=t.currentValue.x,this.vecNum[this.param2Index+1]=t.currentValue.y,this.vecNum[this.param2Index+2]=t.currentValue.z):4==this.param2Type&&(this.vecNum[this.param2Index]=t.currentValue.x,this.vecNum[this.param2Index+1]=t.currentValue.y,this.vecNum[this.param2Index+2]=t.currentValue.z,this.vecNum[this.param2Index+3]=t.currentValue.w):this.paramName3==t.paramName&&(1==this.param3Type?this.vecNum[this.param3Index]=t.currentValue.x:2==this.param3Type?(this.vecNum[this.param3Index]=t.currentValue.x,this.vecNum[this.param3Index+1]=t.currentValue.y):3==this.param3Type?(this.vecNum[this.param3Index]=t.currentValue.x,this.vecNum[this.param3Index+1]=t.currentValue.y,this.vecNum[this.param3Index+2]=t.currentValue.z):4==this.param3Type&&(this.vecNum[this.param3Index]=t.currentValue.x,this.vecNum[this.param3Index+1]=t.currentValue.y,this.vecNum[this.param3Index+2]=t.currentValue.z,this.vecNum[this.param3Index+3]=t.currentValue.w))},t}(),TexItem=function(){function t(){}return Object.defineProperty(t.prototype,"id",{get:function(){return this._id},set:function(t){this._id=t,this.name="fs"+t},enumerable:!0,configurable:!0}),t.LIGHTMAP=1,t.LTUMAP=2,t.CUBEMAP=3,t.HEIGHTMAP=4,t.REFRACTIONMAP=5,t}(),Material=function(){function t(){this.texList=[],this.constList=[],this.killNum=0,this.writeZbuffer=!0}return t.prototype.setCompileData=function(t){if(t){if(this.shaderStr=t.shaderStr,this.hasTime=t.hasTime,this.timeSpeed=t.timeSpeed,this.blendMode=t.blendMode,this.backCull=t.backCull,this.killNum=t.killNum,this.hasVertexColor=t.hasVertexColor,this.usePbr=t.usePbr,this.useNormal=t.useNormal,this.roughness=t.roughness,this.writeZbuffer=t.writeZbuffer,this.hasFresnel=t.hasFresnel,this.useDynamicIBL=t.useDynamicIBL,this.normalScale=t.normalScale,this.lightProbe=t.lightProbe,this.useKill=t.useKill,this.directLight=t.directLight,this.noLight=t.noLight,this.scaleLightMap=t.scaleLightMap,this.hasParticleColor=!1,t.texList){var e=t.texList;this.texList=[];for(var i=0;e.length>i;i++){var n=new TexItem;n.id=e[i].id,n.url=e[i].url,n.isDynamic=e[i].isDynamic,n.paramName=e[i].paramName,n.isMain=e[i].isMain,n.isParticleColor=e[i].isParticleColor,n.type=e[i].type,n.wrap=e[i].wrap,n.filter=e[i].filter,n.mipmap=e[i].mipmap,this.texList.push(n),n.isParticleColor&&(this.hasParticleColor=!0)}}if(t.constList)for(e=t.constList,this.constList=[],i=0;e.length>i;i++){var a=new ConstItem;a.setData(e[i]),this.constList.push(a)}}},t.prototype.setByteData=function(t){var e=t;this.shaderStr=e.readUTF(),this.hasTime=e.readBoolean(),this.timeSpeed=e.readFloat(),this.blendMode=e.readFloat(),this.backCull=e.readBoolean(),this.killNum=e.readFloat(),this.hasVertexColor=e.readBoolean(),this.usePbr=e.readBoolean(),this.useNormal=e.readBoolean(),this.roughness=e.readFloat(),this.writeZbuffer=e.readBoolean(),this.hasFresnel=e.readBoolean(),this.useDynamicIBL=e.readBoolean(),this.normalScale=e.readFloat(),this.lightProbe=e.readBoolean(),this.useKill=e.readBoolean(),this.directLight=e.readBoolean(),this.noLight=e.readBoolean(),this.scaleLightMap=e.readBoolean(),this.hasParticleColor=!1,this.readTexList(e),this.readConstLis(e)},t.prototype.readConstLis=function(t){var e=t.readInt();this.constList=[];for(var i=0;e>i;i++){var n=new ConstItem;n.id=t.readFloat(),n.value=new Vector3D(t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat()),n.paramName0=t.readUTF(),n.param0Type=t.readFloat(),n.param0Index=t.readFloat(),n.paramName1=t.readUTF(),n.param1Type=t.readFloat(),n.param1Index=t.readFloat(),n.paramName2=t.readUTF(),n.param2Type=t.readFloat(),n.param2Index=t.readFloat(),n.paramName3=t.readUTF(),n.param3Type=t.readFloat(),n.param3Index=t.readFloat(),n.creat(),this.constList.push(n)}},t.prototype.readTexList=function(t){var e=t.readInt();this.texList=[];for(var i=0;e>i;i++){var n=new TexItem;n.id=t.readFloat(),n.url=t.readUTF(),n.isDynamic=t.readBoolean(),n.paramName=t.readUTF(),n.isMain=t.readBoolean(),n.isParticleColor=t.readBoolean(),n.type=t.readFloat(),n.wrap=t.readFloat(),n.filter=t.readFloat(),n.mipmap=t.readFloat(),n.isParticleColor&&(this.hasParticleColor=!0),this.texList.push(n)}},t}(),MaterialManager=function(){function t(){this._dic={},this._loadDic={},this._resDic={}}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.getMaterial=function(t,e,i,n,a,s){var o=this;if(void 0===i&&(i=null),void 0===n&&(n=!1),void 0===a&&(a=null),void 0===s&&(s=null),this._dic[t])return i?e(this._dic[t],i):e(this._dic[t]),void 0;var r=new MaterialLoad(e,i,t,n,a,s);if(this._loadDic[t]){var h=this._loadDic[t];return h.push(r),void 0}this._loadDic[t]=[],this._loadDic[t].push(r),this._resDic[t]?this.loadMaterialCom(this._resDic[t],r):LoadManager.getInstance().load(t,LoadManager.XML_TYPE,function(t,e){o.loadMaterialCom(t,e)},r)},t.prototype.getMaterialByte=function(t,e){var i=this;LoadManager.getInstance().load(t,LoadManager.BYTE_TYPE,function(t){var n=new egret.ByteArray(t);e.setByteData(n),i.loadMaterial(e);var a=new MaterialShader;e.program=ProgrmaManager.getInstance().getMaterialProgram(e.url,a,e,null,!0)})},t.prototype.addRes=function(t,e){this._resDic[t]||(this._resDic[t]=e)},t.prototype.loadMaterialCom=function(t,e){var i=JSON.parse(t),n=new Material;n.setCompileData(i),n.url=e.url,this.loadMaterial(n),e.autoReg&&(n.program=ProgrmaManager.getInstance().getMaterialProgram(e.regName,e.shader3D,n,null,!0));for(var a=this._loadDic[e.url],s=0;a.length>s;s++)a[s].info?a[s].fun(n,a[s].info):a[s].fun(n);delete this._loadDic[e.url],this._dic[e.url]=n},t.prototype.loadMaterial=function(t){for(var e=t.texList,i=0;e.length>i;i++)e[i].isParticleColor||e[i].isDynamic||0!=e[i].type||TextureManager.getInstance().getTexture(Scene_data.fileRoot+e[i].url,function(t,e){e.texture=t},e[i].wrap,e[i],e[i].filter,e[i].mipmap)},t.prototype.loadDynamicTexUtil=function(t){for(var e=t.dynamicTexList,i=0;e.length>i;i++)e[i].isParticleColor?e[i].creatTextureByCurve():TextureManager.getInstance().getTexture(Scene_data.fileRoot+e[i].url,function(t,e){e.texture=t},0,e[i],0,1)},t}(),MaterialLoad=function(){function t(t,e,i,n,a,s){this.fun=t,this.info=e,this.url=i,this.autoReg=n,this.regName=a,this.shader3D=s}return t}(),MaterialParam=function(){function t(){}return t.prototype.setMaterial=function(t){this.material=t,this.materialUrl=t.url,this.dynamicTexList=[],this.dynamicConstList=[],this.setTexList(),this.setConstList()},t.prototype.setLife=function(t){for(var e=0;this.dynamicTexList.length>e;e++)this.dynamicTexList[e].isParticleColor&&(this.dynamicTexList[e].life=t)},t.prototype.setTexList=function(){for(var t=this.material.texList,e=0;t.length>e;e++){var i;t[e].isParticleColor?(i=new DynamicTexItem,i.target=t[e],i.paramName=t[e].paramName,i.initCurve(4),this.dynamicTexList.push(i),i.isParticleColor=!0):t[e].isDynamic&&(i=new DynamicTexItem,i.target=t[e],i.paramName=t[e].paramName,this.dynamicTexList.push(i))}},t.prototype.setConstList=function(){for(var t=this.material.constList,e=0;t.length>e;e++){var i,n=t[e];0!=n.param0Type&&(i=new DynamicConstItem,i.target=n,i.paramName=n.paramName0,i.indexID=n.param0Index,i.type=n.param0Type,this.dynamicConstList.push(i)),0!=n.param1Type&&(i=new DynamicConstItem,i.target=n,i.paramName=n.paramName1,i.indexID=n.param1Index,i.type=n.param1Type,this.dynamicConstList.push(i)),0!=n.param2Type&&(i=new DynamicConstItem,i.target=n,i.paramName=n.paramName2,i.indexID=n.param2Index,i.type=n.param2Type,this.dynamicConstList.push(i)),0!=n.param3Type&&(i=new DynamicConstItem,i.target=n,i.paramName=n.paramName3,i.indexID=n.param3Index,i.type=n.param3Type,this.dynamicConstList.push(i))}},t.prototype.setTextObj=function(t){for(var e=0;t.length>e;e++)for(var i=t[e],n=0;this.dynamicTexList.length>n;n++)if(this.dynamicTexList[n].paramName==i.paramName){this.dynamicTexList[n].isParticleColor?this.dynamicTexList[n].curve.setData(i.curve):this.dynamicTexList[n].url=i.url;
break}},t.prototype.setConstObj=function(t){for(var e=0;t.length>e;e++)for(var i=t[e],n=0;this.dynamicConstList.length>n;n++)if(this.dynamicConstList[n].paramName==i.paramName){this.dynamicConstList[n].curve.setData(i.curve);break}},t}(),DynamicConstItem=function(){function t(){}return t.prototype.update=function(t){this.currentValue=this.curve.getValue(t),this.target.setDynamic(this)},Object.defineProperty(t.prototype,"type",{get:function(){return this._type},set:function(t){this._type=t,this.curve=new Curve,this.curve.type=t},enumerable:!0,configurable:!0}),t}(),DynamicTexItem=function(){function t(){}return t.prototype.initCurve=function(t){this.curve=new Curve,this.curve.type=t},t.prototype.creatTextureByCurve=function(){for(var t=0,e=this.curve.valueVec[0].length-1,i=[],t=0;this.life>t;t++)if(this.curve.begintFrame>t)i.push(255*this.curve.valueVec[0][0],255*this.curve.valueVec[1][0],255*this.curve.valueVec[2][0],255*this.curve.valueVec[3][0]);else if(t>this.curve.maxFrame)0==this.curve.maxFrame&&0>this.curve.begintFrame?i.push(255,255,255,255):i.push(255*this.curve.valueVec[0][e],255*this.curve.valueVec[1][e],255*this.curve.valueVec[2][e],255*this.curve.valueVec[3][e]);else if(0>this.curve.begintFrame)i.push(255,255,255,255);else{var n=t-this.curve.begintFrame;i.push(255*this.curve.valueVec[0][n],255*this.curve.valueVec[1][n],255*this.curve.valueVec[2][n],255*this.curve.valueVec[3][n])}var a=ColorTransition.getInstance().getImageDataByVec(i,this.life);this.texture=Scene_data.context3D.getTexture(a)},Object.defineProperty(t.prototype,"life",{get:function(){return this._life},set:function(t){this._life=t},enumerable:!0,configurable:!0}),t}(),QuadTreeNode=function(){function t(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n,this.pointList=[],this.pointList.push(new Vector2D(this.x,this.y)),this.pointList.push(new Vector2D(this.x+this.width,this.y)),this.pointList.push(new Vector2D(this.x+this.width,this.y+this.height)),this.pointList.push(new Vector2D(this.x,this.y+this.height))}return t.prototype.testCam=function(){if(this.testCamResult()&&(this.target&&(this.target.sceneVisible=!0),this.sun))for(var t=0;this.sun.length>t;t++)this.sun[t].testCamResult()},t.prototype.testCircle=function(t){if(this.testResult(t)&&(this.target&&(this.target.sceneVisible=!0),this.sun))for(var e=0;this.sun.length>e;e++)this.sun[e].testCircle(t)},t.prototype.testCamResult=function(){for(var t=0;this.pointList.length>t;t++){var e=new Vector3D(this.pointList[t].x,0,this.pointList[t].y,1);if(e=Scene_data.cam3D.cameraMatrix.transformVector(e),e=Scene_data.viewMatrx3D.transformVector(e),e.scaleBy(1/e.w),e.x>-1&&1>e.y&&e.x>-1&&1>e.y)return!0}return!1},t.prototype.testResult=function(t){for(var e=0;this.pointList.length>e;e++)if(t.testPoint(this.pointList[e]))return!0;if(t.x>this.x&&t.x<this.x+this.width&&t.y>this.y&&t.y<this.y+this.height)return!0;var i=new Vector2D(t.x,t.y);return this.pointToLine(this.pointList[0],this.pointList[1],i)<t.radius?!0:this.pointToLine(this.pointList[1],this.pointList[2],i)<t.radius?!0:this.pointToLine(this.pointList[2],this.pointList[3],i)<t.radius?!0:this.pointToLine(this.pointList[3],this.pointList[0],i)<t.radius?!0:!1},t.prototype.pointToLine=function(t,e,i){var n,a,s,o=0;if(n=Vector2D.distance(t,e),a=Vector2D.distance(t,i),s=Vector2D.distance(e,i),s+a==n)return o=0;if(1e-5>=n)return o=a;if(s*s>=n*n+a*a)return o=a;if(a*a>=n*n+s*s)return o=s;var r=(n+a+s)/2,h=Math.sqrt(r*(r-n)*(r-a)*(r-s));return o=2*h/n},t}(),SceneQuadTree=function(){function t(){this.needUpdata=!1}return t.prototype.init=function(t,e){this._circle=new Circle,this._sceneDic=e,this._rootNode=this.getNode(t)},t.prototype.getNode=function(t){var e=new QuadTreeNode(t.x,t.y,t.width,t.height);if(t.data){e.sun||(e.sun=[]);for(var i=0;t.data.length>i;i++){var n,a=new QuadTreeNode(t.data[i].x,t.data[i].y,t.data[i].width,t.data[i].height);1==t.data[i].type?n="build"+t.data[i].id:11==t.data[i].type&&(n="particle"+t.data[i].id),a.target=this._sceneDic[n],e.sun.push(a)}}if(t.sun){e.sun||(e.sun=[]);for(var i=0;t.sun.length>i;i++)e.sun.push(this.getNode(t.sun[i]))}return e},t.prototype.setCircle=function(t,e,i){var n=t-this._circle.x,a=e-this._circle.y;10>Math.sqrt(n*n+a*a)?this.needUpdata=!1:(this._circle.setData(t,e,i),this.needUpdata=!0)},t.prototype.update=function(){this._rootNode.testCircle(this._circle)},t.prototype.updateDraw=function(){this.capsuleLineSprite?(this.capsuleLineSprite.x=Scene_data.focus3D.x,this.capsuleLineSprite.y=Scene_data.focus3D.y+50,this.capsuleLineSprite.z=Scene_data.focus3D.z,this.capsuleLineSprite.update()):(this.capsuleLineSprite=new LineDisplaySprite,this.capsuleLineSprite.clear(),this.capsuleLineSprite.baseColor=new Vector3D(1,0,0,1),this.drawCylinder(this._circle.radius,10),this.capsuleLineSprite.upToGpu())},t.prototype.drawCylinder=function(t,e){var i,n,a,s=t,o=e,r=12;for(a=0;r>a;a++){var h=new Vector3D(s,0,0),c=new Vector3D(s,+o,0),l=new Matrix3D;l.appendRotation(a*(360/r),Vector3D.Y_AXIS);var u=l.transformVector(h),d=l.transformVector(c);this.capsuleLineSprite.makeLineMode(u,d),this.capsuleLineSprite.makeLineMode(d,new Vector3D(0,+o,0)),a==r-1&&(this.capsuleLineSprite.makeLineMode(u,h),this.capsuleLineSprite.makeLineMode(d,c)),(i||n)&&(this.capsuleLineSprite.makeLineMode(u,i),this.capsuleLineSprite.makeLineMode(d,n)),i=u.clone(),n=d.clone()}},t}(),SceneManager=function(){function t(){this._displayList=[],this._displayRoleList=[],this._display2DList=[],this._sceneParticleList=[],this._time=TimeUtil.getTimer(),this.initSceneLoader(),this._sceneDic={};var t=new BuildShader;ProgrmaManager.getInstance().registe(BuildShader.buildShader,t);var e=new SkyShader;ProgrmaManager.getInstance().registe(SkyShader.Sky_Shader,e),ProgrmaManager.getInstance().registe(LineDisplayShader.LineShader,new LineDisplayShader),this.initScene()}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.initSceneLoader=function(){Scene_data.supportBlob&&(this._sceneLoader=new SceneRes)},t.prototype.clearScene=function(){for(var t=0;this._displayList.length>t;t++)this._displayList[t].removeStage();this._displayList.length=0;for(var t=0;this._sceneParticleList.length>t;t++)ParticleManager.getInstance().removeParticle(this._sceneParticleList[t]);this._sceneParticleList.length=0,LightProbeManager.getInstance().clear()},t.prototype.loadScene=function(t,e,i,n,a){var s=this;void 0===a&&(a=null),this.clearScene(),this._ready=!1;var o;o=Scene_data.supportBlob?Scene_data.fileRoot+t+".txt":Scene_data.fileRoot+t+"_base.txt",ResManager.getInstance().loadSceneRes(o,e,i,function(t){s.loadSceneConfigCom(t),n()})},t.prototype.addSceneImgBg=function(t){var e=new Display3dBg;e.setImgInfo(t.url,t.width,t.height),this.addDisplay(e)},t.prototype.loadSceneConfigCom=function(t){for(var e=t.groundItem,i=t.buildItem,n=0;e&&e.length>n;n++){var a=this.getGroundSprite(e[n]);this.addDisplay(a)}for(var s=0;i.length>s;s++){var o=i[s];if(1==o.type){var r=this.getBuildSprite(o);this.addDisplay(r)}else if(11==o.type){var h=this.getParticleSprite(o);ParticleManager.getInstance().addParticle(h),this._sceneParticleList.push(h)}}Scene_data.light.setData(t.SunNrm,t.SunLigth,t.AmbientLight),LightProbeManager.getInstance().setLightProbeData(t.lightProbeItem),this._ready=!0,t.quadTreeData?(this._sceneQuadTree=new SceneQuadTree,this._sceneQuadTree.init(t.quadTreeData,this._sceneDic)):this._sceneQuadTree=null},t.prototype.getGroundSprite=function(t){var e=new Display3DSprite;return e.setObjUrl(t.objsurl),e.setMaterialUrl(t.materialurl),e.setLightMapUrl(t.lighturl),e.scaleX=t.scaleX,e.scaleY=t.scaleY,e.scaleZ=t.scaleZ,e.x=t.x,e.y=t.y,e.z=t.z,e.rotationX=t.rotationX,e.rotationY=t.rotationY,e.rotationZ=t.rotationZ,e},t.prototype.makeCollisioin=function(){},Object.defineProperty(t.prototype,"ready",{set:function(){this._ready=!0},enumerable:!0,configurable:!0}),t.prototype.getBuildSprite=function(t){var e=new Display3DSprite;return e.setObjUrl(t.objsurl),e.setMaterialUrl(t.materialurl),e.setLightMapUrl(t.lighturl),e.scaleX=t.scaleX,e.scaleY=t.scaleY,e.scaleZ=t.scaleZ,e.x=t.x,e.y=t.y,e.z=t.z,e.rotationX=t.rotationX,e.rotationY=t.rotationY,e.rotationZ=t.rotationZ,this._sceneDic["build"+t.id]=e,e},t.prototype.getParticleSprite=function(t){var e=ParticleManager.getInstance().getParticle(t.url);return e.scaleX=t.scaleX,e.scaleY=t.scaleY,e.scaleZ=t.scaleZ,e.x=t.x,e.y=t.y,e.z=t.z,e.rotationX=t.rotationX,e.rotationY=t.rotationY,e.rotationZ=t.rotationZ,this._sceneDic["particle"+t.id]=e,e},t.prototype.initScene=function(){},t.prototype.addDisplay=function(t){this._displayList.push(t),t.addStage()},t.prototype.addDisplay2D=function(t){this._display2DList.push(t),t.addStage()},t.prototype.removeDisplay2D=function(t){var e=this._display2DList.indexOf(t);-1!=e&&this._display2DList.splice(e,1),t.removeStage()},t.prototype.addMovieDisplay=function(t){this._displayRoleList.push(t),t.addStage()},t.prototype.removeMovieDisplay=function(t){var e=this._displayRoleList.indexOf(t);-1!=e&&this._displayRoleList.splice(e,1),t.removeStage()},t.prototype.update=function(){if(0==Scene_data.user&&MathClass.getCamView(Scene_data.cam3D,Scene_data.focus3D),this._sceneQuadTree&&(this._sceneQuadTree.setCircle(Scene_data.focus3D.x,Scene_data.focus3D.z,GameData.mapQudaTreeDistance),this._sceneQuadTree.needUpdata)){for(var t in this._sceneDic)this._sceneDic[t].sceneVisible=!1;this._sceneQuadTree.update()}Scene_data.context3D.update(),Scene_data.context3D.setDepthTest(!0),this._ready&&(this.updateStaticDiplay(),0==Scene_data.user&&ShadowManager.getInstance().update(),this.updateMovieDisplay(),ParticleManager.getInstance().updateTime(),SkillManager.getInstance().update(),Scene_data.context3D.setWriteDepth(!1),ParticleManager.getInstance().update()),Scene_data.context3D.setDepthTest(!1),UIManager.getInstance().update()},t.prototype.updateStaticDiplay=function(){for(var t=0,e=0;this._displayList.length>e;e++)this._displayList[e].update(),this._displayList[e].sceneVisible&&t++},t.prototype.updateMovieDisplay=function(){var t=TimeUtil.getTimer(),e=t-this._time;this._time=t;for(var i=0;this._displayRoleList.length>i;i++)this._displayRoleList[i].updateFrame(e),this._displayRoleList[i].update();for(var i=0;this._display2DList.length>i;i++){if(this._display2DList[i]instanceof Display2dMovie){var n=this._display2DList[i];n.updateFrame(e)}this._display2DList[i].update()}},t}(),SkillManager=function(){function t(){this._time=0,this._skillDic={},this._skillAry=[]}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.update=function(){for(var t=TimeUtil.getTimer(),e=t-this._time,i=0;this._skillAry.length>i;i++)this._skillAry[i].update(e);this._time=t},t.prototype.preLoadSkill=function(t){ResManager.getInstance().loadSkillRes(Scene_data.fileRoot+t,function(){})},t.prototype.getSkill=function(t,e){var i,n=t+e,a=this._skillDic[n];if(a)for(var s=0;a.length>s;s++)if(i=a[s],i.isDeath)return i.reset(),i.isDeath=!1,i;return i=new Skill,i.name=e,ResManager.getInstance().loadSkillRes(Scene_data.fileRoot+t,function(t){i.setData(t.data[i.name])}),i.isDeath=!1,this._skillDic[n]||(this._skillDic[n]=[]),this._skillDic[n].push(i),i},t.prototype.playSkill=function(t){this._skillAry.push(t),t.play()},t.prototype.removeSkill=function(t){var e=this._skillAry.indexOf(t);-1!=e&&this._skillAry.splice(e,1)},t}(),Skill=function(){function t(){this.isDeath=!0,this.time=0,this.targetFlag=0}return t.prototype.setData=function(t){this.skillVo=new SkillVo,this.skillVo.setData(t),this.setKeyAry(),this.trajectoryAry=[]},t.prototype.play=function(){this.skillVo&&this.active&&this.active instanceof Display3dMovie&&this.active.play(this.skillVo.action,2,!1)},t.prototype.setKeyAry=function(){var t=this;if(this.keyAry=[],this.skillVo.types==SkillType.FixEffect)for(var e=0;this.skillVo.keyAry.length>e;e++){var i=new SkillFixEffect;i.setInfo(this.skillVo.keyAry[e]),i.removeCallFun=function(e){t.removeKey(e)},i.active=this.active,this.keyAry.push(i)}else if(this.skillVo.types==SkillType.TrajectoryDynamicTarget)for(var e=0;this.skillVo.keyAry.length>e;e++){var n,a=this.skillVo.keyAry[e];n=1==a.multype?new SkillMulTrajectory:new SkillTrajectory,n.setInfo(this.skillVo.keyAry[e]),this.keyAry.push(n)}},t.prototype.removeKey=function(){this.completeNum++,this.completeNum==this.keyAry.length&&(console.log("播放结束"),this.skillComplete())},t.prototype.skillComplete=function(){SkillManager.getInstance().removeSkill(this),this.isDeath=!0,this.completeFun&&this.completeFun()},t.prototype.reset=function(){this.time=0,this.completeNum=0,this.active=null,this.completeFun=null,this.targetFlag=0},t.prototype.update=function(e){this.time+=e,this.time>t.MaxTime&&(console.log("超时结束"),this.skillComplete()),this.getKeyTarget(),this.updateTrajector(e)},t.prototype.updateTrajector=function(t){for(var e=0;this.trajectoryAry.length>e;e++)this.trajectoryAry[e].update(t)},t.prototype.getKeyTarget=function(){if(this.keyAry)for(var t=this.targetFlag;this.keyAry.length>t&&this.keyAry[t].time<this.time;){if(this.keyAry[t].addToRender(),this.skillVo.types==SkillType.TrajectoryDynamicTarget){var e=this.keyAry[t];this.trajectoryAry.push(e)}t++,this.targetFlag=t}},t.prototype.configFixEffect=function(t,e){if(void 0===e&&(e=null),this.active=t,this.completeFun=e,this.keyAry)for(var i=0;this.keyAry.length>i;i++)if(this.skillVo.types==SkillType.FixEffect){var n=this.keyAry[i];n.active=t}},t.prototype.configTrajectory=function(t,e,i,n){var a=this;if(void 0===i&&(i=null),void 0===n&&(n=0),this.active=t,this.completeFun=i,this.completeNum=0,this.keyAry)for(var s=0;this.keyAry.length>s;s++)if(this.skillVo.types==SkillType.TrajectoryDynamicTarget){var o=this.keyAry[s];o.setPlayData(t,e,function(t){a.removeTrajectory(t)},n)}},t.prototype.configMulTrajectory=function(t,e,i,n){var a=this;if(void 0===n&&(n=null),this.active=e,this.completeFun=n,this.completeNum=0,this.keyAry)for(var s=0;this.keyAry.length>s;s++)if(this.skillVo.types==SkillType.TrajectoryDynamicTarget){var o=this.keyAry[s];o.setMulPlayData(t,i,function(t){a.removeTrajectory(t)},2)}},t.prototype.removeTrajectory=function(t){var e=this.trajectoryAry.indexOf(t);-1!=e&&this.trajectoryAry.splice(e,1),this.completeNum++,this.completeNum==this.keyAry.length&&(console.log("播放结束"),this.skillComplete())},t.MaxTime=3e3,t}(),SkillVo=function(){function t(){}return t.prototype.setData=function(t){this.keyAry=[],this.action=t.action,this.types=t.type,this.types==SkillType.FixEffect?this.keyAry=this.getFixEffect(t.data):this.types==SkillType.TrajectoryDynamicTarget&&(this.keyAry=this.getTrajectoryDynamicTarget(t.data))},t.prototype.getFixEffect=function(t){for(var e=[],i=0;t.length>i;i++){var n=new SkillFixEffectKeyVo;n.setData(t[i]),e.push(n)}return e},t.prototype.getTrajectoryDynamicTarget=function(t){for(var e=[],i=0;t.length>i;i++){var n=new SkillTrajectoryTargetKeyVo;n.setData(t[i]),e.push(n)}return e},t}(),SkillType=function(){function t(){}return t.TrajectoryDynamicTarget=1,t.FixEffect=4,t}(),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},SkillKeyVo=function(){function t(){this.frame=0}return t.prototype.setData=function(t){this.frame=t.frame,this.url=t.url},t}(),SkillFixEffectKeyVo=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.setData=function(e){t.prototype.setData.call(this,e),this.pos=new Vector3D(e.pos.x,e.pos.y,e.pos.z),this.rotation=new Vector3D(e.rotation.x,e.rotation.y,e.rotation.z)},e}(SkillKeyVo),SkillTrajectoryTargetKeyVo=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.setData=function(e){t.prototype.setData.call(this,e),this.beginType=e.beginType,0==this.beginType?this.beginPos=new Vector3D(e.beginPos.x,e.beginPos.y,e.beginPos.z):1==this.beginType&&(this.beginSocket=e.beginSocket),this.speed=e.speed,e.hitSocket&&(this.hitSocket=e.hitSocket),e.endParticle&&(this.endParticleUrl=e.endParticle),this.multype=e.multype},e}(SkillKeyVo),SkillKey=function(){function t(){this.time=0}return t.prototype.addToRender=function(){this.particle&&(this.particle.reset(),ParticleManager.getInstance().addParticle(this.particle))},t.prototype.setInfo=function(t){this.time=t.frame*Scene_data.frameTime,this.particle=ParticleManager.getInstance().getParticle(t.url)},t.prototype.reset=function(){this.time=0,this.particle.reset(),ParticleManager.getInstance().removeParticle(this.particle)},t}(),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},SkillEffect=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.addToRender=function(){t.prototype.addToRender.call(this),this.particle.addEventListener(BaseEvent.COMPLETE,this.onPlayCom,this)},e.prototype.onPlayCom=function(t){void 0===t&&(t=null),this.particle.removeEventListener(BaseEvent.COMPLETE,this.onPlayCom,this),ParticleManager.getInstance().removeParticle(this.particle),this.removeCallFun(this)},e}(SkillKey),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},SkillFixEffect=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.setInfo=function(e){t.prototype.setInfo.call(this,e);var i=e;this.pos=i.pos,this.rotation=i.rotation},e.prototype.addToRender=function(){t.prototype.addToRender.call(this);var e=new Matrix3D;e.appendRotation(this.active.rotationY,Vector3D.Y_AXIS);var i=e.transformVector(this.pos);i.x+=this.active.x,i.y+=this.active.y,i.z+=this.active.z,this.particle.x=i.x,this.particle.y=i.y,this.particle.z=i.z,this.particle.rotationX=this.rotation.x,this.particle.rotationY=this.rotation.y+this.active.rotationY,this.particle.rotationZ=this.rotation.z},e}(SkillEffect),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},SkillTrajectory=function(t){function e(){t.call(this),this._currentPos=new Vector3D,this.rotationMatrix=new Matrix3D,this._socketMaxrix=new Matrix3D,this._currentTargetPos=new Vector3D}return __extends(e,t),e.prototype.update=function(t){this.path.update(t)},e.prototype.applyArrive=function(){ParticleManager.getInstance().removeParticle(this.particle),this.removeCallFun(this)},e.prototype.setCurrentPos=function(){if(this.data.hitSocket){var t=this.target;return t.getSocket(this.data.hitSocket,this._socketMaxrix),this._currentTargetPos.setTo(this._socketMaxrix.position.x,this._socketMaxrix.position.y,this._socketMaxrix.position.z),!0}return this._currentTargetPos.x==this.target.x&&this._currentTargetPos.y==this.target.y&&this._currentTargetPos.z==this.target.z?!1:(this._currentTargetPos.setTo(this.target.x,this.target.y,this.target.z),!0)},e.prototype.addToRender=function(){t.prototype.addToRender.call(this);var e;if(0==this.data.beginType){var i=new Matrix3D;i.appendRotation(this.active.rotationY,Vector3D.Y_AXIS),e=i.transformVector(this.data.beginPos),this._currentPos.setTo(this.active.x+e.x,this.active.y+e.y,this.active.z+e.z)}else if(1==this.data.beginType){var n=new Matrix3D,a=this.active;a.getSocket(this.data.beginSocket,n),e=n.position,this._currentPos.setTo(e.x,e.y,e.z)}this.particle.setPos(this._currentPos.x,this._currentPos.y,this._currentPos.z),this.path.add()},e.prototype.getSocket=function(t,e){e.identity(),e.append(this.rotationMatrix),e.appendTranslation(this._currentPos.x,this._currentPos.y,this._currentPos.z)},e.prototype.getSunType=function(){return 0},e.prototype.setInfo=function(e){t.prototype.setInfo.call(this,e),this.particle.bindTarget=this,this.data=e},e.prototype.setPlayData=function(t,e,i,n){var a=this;void 0===n&&(n=0),this.active=t,this.target=e,this.removeCallFun=i,this._currentPos.setTo(0,0,0),this.rotationMatrix.identity(),this._socketMaxrix.identity(),this._currentTargetPos.setTo(0,0,0),this.path||(this.path=PathManager.getNewPath(n),this.path.setData(this,function(){a.applyArrive()},this._currentPos,this.rotationMatrix,this._currentTargetPos),this.path.speed=this.data.speed),this.path.reset()},e}(SkillKey),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},SkillMulTrajectory=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.update=function(t){this.pathMul.update(t)},e.prototype.getSunType=function(){return 1},e.prototype.addToRender=function(){if(this.particle){if(this.particle.reset(),ParticleManager.getInstance().addParticle(this.particle),this.currentPosList)for(var t=0;this.activeList.length>t;t++)this.currentPosList[t].setTo(this.activeList[t].x,this.activeList[t].y+10,this.activeList[t].z+5),this.currentPosList[t].w=0;else{this.currentPosList=[];for(var t=0;this.activeList.length>t;t++)this.currentPosList.push(new Vector3D(this.activeList[t].x,this.activeList[t].y+10,this.activeList[t].z+5));this.pathMul.setInitCurrentPos(this.currentPosList)}this.pathMul.add(),this.particle.setMulPos(this.pathMul.resultAry)}},e.prototype.setMulPlayData=function(t,e,i,n){var a=this;void 0===n&&(n=0),this.activeList=t,this.active=this.activeList[0],this.target=e,this.removeCallFun=i,this._currentPos.setTo(0,0,0),this.rotationMatrix.identity(),this._socketMaxrix.identity(),this._currentTargetPos.setTo(0,0,0),this.pathMul||(this.pathMul=PathManager.getNewPath(n),this.pathMul.setData(this,function(){a.applyArrive()},this._currentPos,this.rotationMatrix,this._currentTargetPos),this.pathMul.speed=this.data.speed),this.pathMul.reset()},e.prototype.getMulSocket=function(t){t&&this.pathMul.applyData(t)},e}(SkillTrajectory),SkillPath=function(){function t(){this._currentDirect=new Vector3D}return t.prototype.update=function(t){if(this.time=t,this.hasReached)return this.endTime+=t,this.endTime>200&&this.applyArrive(),void 0;if(this.skillTrajectory.setCurrentPos()&&(this._currentDirect.x=this.currentTargetPos.x-this.currentPos.x,this._currentDirect.y=this.currentTargetPos.y-this.currentPos.y,this._currentDirect.z=this.currentTargetPos.z-this.currentPos.z,this._currentDirect.normalize(),this._currentDirect.scaleBy(this.speed),this.setRotationMatrix(this.currentTargetPos.subtract(this.currentPos)),0==this._currentDirect.length))return this.arrive(),void 0;var e=this._currentDirect.length*this.time;if(!this.hasReached){var i=Vector3D.distance(this.currentPos,this.currentTargetPos);this.currentPos.x+=this._currentDirect.x*this.time,this.currentPos.y+=this._currentDirect.y*this.time,this.currentPos.z+=this._currentDirect.z*this.time}e>i&&this.arrive()},t.prototype.setRotationMatrix=function(t){t.normalize();var e=new Vector3D(0,0,-1),i=e.cross(t);i.normalize();var n=Math.acos(t.dot(e)),a=new Quaternion;a.fromAxisAngle(i,n),a.toMatrix3D(this.rotationMatrix)},t.prototype.arrive=function(){this.hasReached=!0},t.prototype.applyArrive=function(){this.endFun()},t.prototype.reset=function(){this.hasReached=!1,this._currentDirect.setTo(0,0,0),this.endTime=0},t.prototype.add=function(){},t.prototype.setData=function(t,e,i,n,a){this.skillTrajectory=t,this.currentPos=i,this.rotationMatrix=n,this.currentTargetPos=a,this.endFun=e},t}(),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},SkillSinPath=function(t){function e(){t.apply(this,arguments),this.basePos=new Vector3D}return __extends(e,t),e.prototype.add=function(){this.skillTrajectory.setCurrentPos();var t=new Vector3D;t.x=this.currentTargetPos.x-this.currentPos.x,t.y=this.currentTargetPos.y-this.currentPos.y,t.z=this.currentTargetPos.z-this.currentPos.z,this.basePos.setTo(this.currentPos.x,this.currentPos.y,this.currentPos.z),this.alltime=t.length/this.speed},e.prototype.update=function(t){if(this.time=t,this.lastTime+=t,this.hasReached)return this.endTime+=t,this.endTime>200&&this.applyArrive(),void 0;this.skillTrajectory.setCurrentPos();var e=this.lastTime/this.alltime;if(e-=e*e,e*=100,this._currentDirect.x=this.currentTargetPos.x-this.basePos.x,this._currentDirect.y=this.currentTargetPos.y-this.basePos.y,this._currentDirect.z=this.currentTargetPos.z-this.basePos.z,this._currentDirect.normalize(),this._currentDirect.scaleBy(this.speed),this.setRotationMatrix(this.currentTargetPos.subtract(this.basePos)),0==this._currentDirect.length)return this.arrive(),void 0;var i=this._currentDirect.length*this.time;if(!this.hasReached){var n=Vector3D.distance(this.basePos,this.currentTargetPos);this.basePos.x+=this._currentDirect.x*this.time,this.basePos.y+=this._currentDirect.y*this.time,this.basePos.z+=this._currentDirect.z*this.time,this.currentPos.x=this.basePos.x,this.currentPos.y=this.basePos.y+e,this.currentPos.z=this.basePos.z}i>n&&this.arrive()},e.prototype.reset=function(){t.prototype.reset.call(this),this.lastTime=0},e}(SkillPath),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},SkillMulPath=function(t){function e(){t.apply(this,arguments),this.lastTime=0}return __extends(e,t),e.prototype.setInitCurrentPos=function(t){this.currentPosAry=t,this.allTimeList=[];for(var e=0;t.length>e;e++)this.allTimeList.push(0)},e.prototype.add=function(){this.skillTrajectory.setCurrentPos(),this.directAry=[];for(var t=0,e=0;this.currentPosAry.length>e;e++){var i=new Vector3D;i.x=this.currentTargetPos.x-this.currentPosAry[e].x,i.y=this.currentTargetPos.y-this.currentPosAry[e].y,i.z=this.currentTargetPos.z-this.currentPosAry[e].z;var n=i.length;n>t&&(t=n,this.maxV3d=this.currentPosAry[e]),this.allTimeList[e]=n/this.speed,i.normalize(),i.scaleBy(this.speed),this.directAry.push(i)}this.alltime=t/this.speed,this.setAllData()},e.prototype.setAllData=function(){var t=float2int(this.alltime/33)+8;this.resultAry=[];for(var e=0;this.currentPosAry.length>e;e++){var i=[];this.resultAry.push(i);for(var n=this.directAry[e],a=0;6>a;a++)i.push([this.currentPosAry[e].x,this.currentPosAry[e].y,this.currentPosAry[e].z]);for(var s=0;t>s;s++){this.lastTime=33*s;var o,r=this.lastTime/this.allTimeList[e],h=r;r>=1?(h=0,o=[this.currentTargetPos.x,this.currentTargetPos.y,this.currentTargetPos.z]):(h-=h*h,h*=250,o=[n.x*this.lastTime+this.currentPosAry[e].x,n.y*this.lastTime+h+this.currentPosAry[e].y,n.z*this.lastTime+this.currentPosAry[e].z]);var c;if(0==s)c=[0,1,0];else{var l=i[2*s-2];c=[o[0]-l[0],o[1]-l[1],o[2]-l[2]];var u=Math.sqrt(c[0]*c[0]+c[1]*c[1]+c[2]*c[2]);c[0]/=u,c[1]/=u,c[2]/=u}i.push(o,c)}}},e.prototype.update=function(t){if(this.time=t,this.lastTime+=t,this.hasReached)return this.endTime+=t,this.endTime>200&&this.applyArrive(),void 0;this.skillTrajectory.setCurrentPos();for(var e=0;this.currentPosAry.length>e;e++){var i=this.lastTime/this.allTimeList[e];i-=i*i,i*=250;var n=this.currentPosAry[e];if(this._currentDirect.x=this.currentTargetPos.x-n.x,this._currentDirect.y=this.currentTargetPos.y-n.y,this._currentDirect.z=this.currentTargetPos.z-n.z,this._currentDirect.normalize(),this._currentDirect.scaleBy(this.speed),this.maxV3d==n&&(this.setRotationMatrix(this.currentTargetPos.subtract(n)),0==this._currentDirect.length))return this.arrive(),void 0;var a=this._currentDirect.length*this.time;if(!this.hasReached){var s=Vector3D.distance(n,this.currentTargetPos);n.x+=this._currentDirect.x*this.time,n.y+=this._currentDirect.y*this.time,n.z+=this._currentDirect.z*this.time,n.w=i}this.maxV3d==n&&a>s&&this.arrive()}this.currentPos.setTo(this.currentPosAry[0].x,this.currentPosAry[0].y+this.currentPosAry[0].w,this.currentPosAry[0].z)},e.prototype.setData=function(e,i,n,a,s){t.prototype.setData.call(this,e,i,n,a,s),this.skillMul=e},e.prototype.applyData=function(t){for(var e=0;t.length>e;e++)t[e].setTo(this.currentPosAry[e].x,this.currentPosAry[e].y+this.currentPosAry[e].w,this.currentPosAry[e].z)},e.prototype.reset=function(){t.prototype.reset.call(this),this.lastTime=0},e}(SkillPath),PathManager=function(){function t(){}return t.reg=function(t,e){this.dic[t]=e},t.getNewPath=function(t){var e=this.dic[t];return new e},t.init=function(){this.dic[0]=SkillPath,this.dic[1]=SkillSinPath,this.dic[2]=SkillMulPath},t.dic={},t}(),Dictionary=function(){function t(t){this._keys=[],this._values=[];for(var e=0;t.length>e;e++)this[t[e].key]=t[e].value,this._keys.push(t[e].key),this._values.push(t[e].value)}return t.prototype.add=function(t,e){this[t]=e,this._keys.push(t),this._values.push(e)},t.prototype.remove=function(t){var e=this._keys.indexOf(t,0);this._keys.splice(e,1),this._values.splice(e,1),delete this[t]},t.prototype.keys=function(){return this._keys},t.prototype.values=function(){return this._values},t.prototype.containsKey=function(t){return this[t]===void 0?!1:!0},t.prototype.toLookup=function(){return this},t}(),LoadManager=function(){function t(){this._loadThreadList=[],this._waitLoadList=[];for(var t=0;5>t;t++)this._loadThreadList.push(new LoaderThread)}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.load=function(t,e,i,n,a){void 0===n&&(n=null),void 0===a&&(a=null);for(var s=new LoadInfo(t,e,i,n,a),o=0;this._loadThreadList.length>o;o++)if(this._loadThreadList[o].idle)return this._loadThreadList[o].load(s),void 0;this._waitLoadList.push(s)},t.prototype.loadWaitList=function(){if(!(0>=this._waitLoadList.length))for(var t=0;this._loadThreadList.length>t;t++)if(this._loadThreadList[t].idle)return this._loadThreadList[t].load(this._waitLoadList.shift()),void 0},t.BYTE_TYPE="BYTE_TYPE",t.IMG_TYPE="IMG_TYPE",t.XML_TYPE="XML_TYPE",t}(),LoaderThread=function(){function t(){var t=this;this._xhr=new XMLHttpRequest,this._xhr.onreadystatechange=function(){200==t._xhr.status&&4==t._xhr.readyState&&t.loadByteXML()},this._xhr.onprogress=function(e){t._loadInfo.progressFun&&t._loadInfo.progressFun(e.loaded/e.total)},this.idle=!0}return t.prototype.load=function(t){var e=this;this._loadInfo=t,this.idle=!1,this._loadInfo.type==LoadManager.BYTE_TYPE?(this._xhr.open("GET",t.url,!0),this._xhr.responseType="arraybuffer",this._xhr.send()):this._loadInfo.type==LoadManager.XML_TYPE?(this._xhr.open("GET",t.url,!0),this._xhr.responseType="text",this._xhr.send()):this._loadInfo.type==LoadManager.IMG_TYPE&&(this._img=new Image,this._img.onload=function(){e.loadImg()},this._img.src=t.url)},t.prototype.loadByteXML=function(){this._loadInfo.info?this._loadInfo.fun(this._xhr.response,this._loadInfo.info):this._loadInfo.fun(this._xhr.response),this.idle=!0,LoadManager.getInstance().loadWaitList()},t.prototype.loadByteImg=function(){var t=new Blob([this._xhr.response],{type:"application/octet-binary"});this._img.src=URL.createObjectURL(t)},t.prototype.loadImg=function(){this._loadInfo.info?this._loadInfo.fun(this._img,this._loadInfo.info):this._loadInfo.fun(this._img),this.idle=!0,LoadManager.getInstance().loadWaitList()},t}(),LoadInfo=function(){function t(t,e,i,n,a){void 0===n&&(n=null),void 0===a&&(a=null),this.url=t,this.type=e,this.fun=i,this.info=n,this.progressFun=a}return t}(),ObjDataManager=function(){function t(){this._dic={},this._loadList={}}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.getObjData=function(t,e){var i=this;if(this._dic[t])return e(this._dic[t]),void 0;var n;this._loadList[t]||(this._loadList[t]=[],LoadManager.getInstance().load(t,LoadManager.BYTE_TYPE,function(e){i.loadObjCom(e,t)})),n=this._loadList[t],n.push(e)},t.prototype.loadObjCom=function(t,e){var i=new ObjData,n=new egret.ByteArray(t);n.readUTF();
for(var a=n.readInt(),s=0;a>s;s++)i.vertices.push(n.readFloat());for(var o=n.readInt(),s=0;o>s;s++)i.uvs.push(n.readFloat());for(var r=n.readInt(),s=0;r>s;s++)i.lightuvs.push(n.readFloat());for(var h=n.readInt(),s=0;h>s;s++)i.normals.push(n.readFloat());for(var c=n.readInt(),s=0;c>s;s++)i.indexs.push(n.readInt());for(var l=n.readInt(),s=0;l>s;s++)i.tangents.push(n.readFloat());for(var u=n.readInt(),s=0;u>s;s++)i.bitangents.push(n.readFloat());if(n.position<n.length){var d=n.readInt();i.collision=new CollisionItemVo,i.collision.collisionItem=[];for(var s=0;d>s;s++){var p=new CollisionVo;switch(p.name=n.readUTF(),p.type=n.readInt(),p.x=n.readFloat(),p.y=n.readFloat(),p.z=n.readFloat(),p.rotationX=n.readFloat(),p.rotationY=n.readFloat(),p.rotationZ=n.readFloat(),p.type){case CollisionType.Polygon:p.scaleX=n.readFloat(),p.scaleY=n.readFloat(),p.scaleZ=n.readFloat();var _=n.readBoolean();if(_){p.data={},p.data.vertices=[],p.data.indexs=[];for(var f=n.readInt(),m=0;f>m;m++)p.data.vertices.push(n.readFloat());for(var y=n.readInt(),g=0;y>g;g++)p.data.indexs.push(n.readInt())}break;case CollisionType.BOX:p.scaleX=n.readFloat(),p.scaleY=n.readFloat(),p.scaleZ=n.readFloat();break;case CollisionType.Cylinder:p.scaleX=n.readFloat(),p.scaleY=n.readFloat(),p.scaleZ=n.readFloat();break;case CollisionType.Cone:p.scaleX=n.readFloat(),p.scaleY=n.readFloat(),p.scaleZ=n.readFloat();break;case CollisionType.BALL:p.radius=n.readFloat();break;default:}i.collision.collisionItem.push(p)}n.position<n.length&&(i.collision.friction=n.readFloat(),i.collision.restitution=n.readFloat(),i.collision.isField=n.readBoolean())}i.treNum=c,i.vertexBuffer=Scene_data.context3D.uploadBuff3D(i.vertices),i.uvBuffer=Scene_data.context3D.uploadBuff3D(i.uvs),i.lightUvBuffer=Scene_data.context3D.uploadBuff3D(i.lightuvs),i.normalsBuffer=Scene_data.context3D.uploadBuff3D(i.normals),i.indexBuffer=Scene_data.context3D.uploadIndexBuff3D(i.indexs),this._dic[e]=i;var v=this._loadList[e];if(v){for(var s=0;v.length>s;s++)v[s](i);delete this._loadList[e]}return i},t.prototype.creatTBNBuffer=function(t){t.tangentBuffer=Scene_data.context3D.uploadBuff3D(t.tangents),t.bitangentBuffer=Scene_data.context3D.uploadBuff3D(t.bitangents)},t}(),MeshDataManager=function(){function t(){this._dic={}}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.getMeshData=function(t,e,i){var n=this;return void 0===i&&(i=1),this._dic[t]?(e(this._dic[t]),void 0):(LoadManager.getInstance().load(t,LoadManager.BYTE_TYPE,function(a){var s=new egret.ByteArray(a),o=n.readData(s,i,t);e(o)},e),void 0)},t.prototype.readData=function(t,e,i){var n=new SkinMesh;n.fileScale=t.readFloat();for(var a=t.readInt(),s=0;a>s;s++){for(var o=new MeshData,r=t.readInt(),h=0;r>h;h++)o.vertices.push(t.readFloat());r=t.readInt();for(var h=0;r>h;h++)o.tangents.push(t.readFloat());r=t.readInt();for(var h=0;r>h;h++)o.bitangents.push(t.readFloat());r=t.readInt();for(var h=0;r>h;h++)o.normals.push(t.readFloat());r=t.readInt();for(var h=0;r>h;h++)o.uvs.push(t.readFloat());r=t.readInt();for(var h=0;r>h;h++)o.bonetIDAry.push(t.readFloat());r=t.readInt();for(var h=0;r>h;h++)o.boneWeightAry.push(t.readFloat());r=t.readInt();for(var h=0;r>h;h++)o.indexs.push(t.readInt());o.treNum=r,r=t.readInt();for(var h=0;r>h;h++)o.boneNewIDAry.push(t.readInt());1!=e&&this.cloneMeshData(o,e),o.materialUrl=t.readUTF();for(var c=t.readInt(),h=0;c>h;h++){var l=new BindParticle(t.readUTF(),t.readUTF());o.particleAry.push(l)}this.uploadMesh(o),n.addMesh(o)}for(var u=t.readInt(),d=[],h=0;u>h;h++){var p=[t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat()];d.push(p)}this.getBindPosMatrix(d,n);var _=t.readInt();n.boneSocketDic={};for(var h=0;_>h;h++){var f=new BoneSocketData;f.name=t.readUTF(),f.boneName=t.readUTF(),f.index=t.readInt(),f.x=t.readFloat(),f.y=t.readFloat(),f.z=t.readFloat(),f.rotationX=t.readFloat(),f.rotationY=t.readFloat(),f.rotationZ=t.readFloat(),n.boneSocketDic[f.name]=f}return this._dic[i]=n,n},t.prototype.cloneMeshData=function(t,e){var i=t.vertices,n=t.normals,a=t.uvs,s=t.bonetIDAry,o=t.boneWeightAry,r=t.indexs;t.vertices=[],t.normals=[],t.uvs=[],t.bonetIDAry=[],t.boneWeightAry=[],t.indexs=[];for(var h=i.length/3,c=0;e>c;c++){t.vertices=t.vertices.concat(i),t.normals=t.normals.concat(n),t.bonetIDAry=t.bonetIDAry.concat(s),t.boneWeightAry=t.boneWeightAry.concat(o);for(var l=0;a.length>l;l+=2)t.uvs.push(a[l],a[l+1],c);for(var l=0;r.length>l;l++)t.indexs.push(r[l]+c*h)}t.treNum=t.indexs.length},t.prototype.getBindPosMatrix=function(t,e){for(var i=[],n=[],a=0;t.length>a;a++){var s=t[a],o=new Quaternion(s[0],s[1],s[2]);o.setMd5W();var r=o.toMatrix3D();r.appendTranslation(s[3],s[4],s[5]),n.push(r.clone()),r.invert(),i.push(r)}e.bindPosMatrixAry=i,e.bindPosInvertMatrixAry=n},t.prototype.uploadMesh=function(t){t.vertexBuffer=Scene_data.context3D.uploadBuff3D(t.vertices),t.uvBuffer=Scene_data.context3D.uploadBuff3D(t.uvs),t.boneIdBuffer=Scene_data.context3D.uploadBuff3D(t.bonetIDAry),t.boneWeightBuffer=Scene_data.context3D.uploadBuff3D(t.boneWeightAry),t.indexBuffer=Scene_data.context3D.uploadIndexBuff3D(t.indexs)},t.prototype.uploadPbrMesh=function(t,e){t.normalsBuffer=Scene_data.context3D.uploadBuff3D(t.normals),e&&(t.tangentBuffer=Scene_data.context3D.uploadBuff3D(t.tangents),t.bitangentBuffer=Scene_data.context3D.uploadBuff3D(t.bitangents))},t.prototype.preLoad=function(t){this.getMeshData(t,function(t){t.loadMaterial()})},t}(),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},AnimManager=function(){function t(){this._dic={}}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.getAnimData=function(t,e){var i=this;return this._dic[t]?(e(this._dic[t]),void 0):(LoadManager.getInstance().load(t,LoadManager.BYTE_TYPE,function(e,n){var a=i.readData(new egret.ByteArray(e),t);n(a)},e),void 0)},t.prototype.readData=function(t,e){var i=[],n=[],a=new AnimData;a.inLoop=t.readInt();for(var s=t.readInt(),o=0;s>o;o++)a.inter.push(t.readInt());s=t.readInt();for(var o=0;s>o;o++)a.bounds.push(new Vector3D(t.readFloat(),t.readFloat(),t.readFloat()));a.nameHeight=t.readInt(),s=t.readInt();for(var o=0;s>o;o++){var r=new ObjectBone;r.father=t.readInt(),r.changtype=t.readInt(),r.startIndex=t.readInt(),r.tx=t.readFloat(),r.ty=t.readFloat(),r.tz=t.readFloat(),r.qx=t.readFloat(),r.qy=t.readFloat(),r.qz=t.readFloat(),i.push(r)}s=t.readInt();for(var o=0;s>o;o++){var h=t.readInt(),c=[];n.push(c);for(var l=0;h>l;l++)c.push(t.readFloat())}s=t.readInt();for(var o=0;s>o;o++)a.posAry.push(new Vector3D(t.readFloat(),t.readFloat(),t.readFloat()));return a.matrixAry=this.processFrame(n,i),this._dic[e]=a,a},t.prototype.processFrame=function(t,e){for(var i=[],n=0;t.length>n;n++)i.push(this.frameToBone(t[n],e));return this.setFrameToMatrix(i)},t.prototype.frameToBone=function(t,e){for(var i=[],n=0;e.length>n;n++){var a=new ObjectBaseBone;a.father=e[n].father;var s=0;1&e[n].changtype?(a.tx=t[e[n].startIndex+s],++s):a.tx=e[n].tx,2&e[n].changtype?(a.ty=t[e[n].startIndex+s],++s):a.ty=e[n].ty,4&e[n].changtype?(a.tz=t[e[n].startIndex+s],++s):a.tz=e[n].tz,8&e[n].changtype?(a.qx=t[e[n].startIndex+s],++s):a.qx=e[n].qx,16&e[n].changtype?(a.qy=t[e[n].startIndex+s],++s):a.qy=e[n].qy,32&e[n].changtype?(a.qz=t[e[n].startIndex+s],++s):a.qz=e[n].qz,i.push(a)}return i},t.prototype.setFrameToMatrix=function(t){for(var e=[],i=0;t.length>i;i++){var n=t[i],a=new Quaternion,s=new Matrix3D,o=[];e.push(o);for(var r=0;n.length>r;r++){var h=n[r];a=new Quaternion(h.qx,h.qy,h.qz),a.w=this.getW(a.x,a.y,a.z),-1==h.father?(s=a.toMatrix3D(),s.appendTranslation(h.tx,h.ty,h.tz),s.appendRotation(-90,Vector3D.X_AXIS),o.push(s)):(n[h.father],s=a.toMatrix3D(),s.appendTranslation(h.tx,h.ty,h.tz),s.append(o[h.father]),o.push(s))}for(r=0;o.length>r;r++)o[r].appendScale(-1,1,1)}return e},t.prototype.getW=function(t,e,i){var n=1-(t*t+e*e+i*i);return n=0>n?0:-Math.sqrt(n)},t}(),ObjectBaseBone=function(){function t(){}return t}(),ObjectBone=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(ObjectBaseBone),LightProbeManager=function(){function t(){this._defaultVec=[];for(var t=[.4444730390920146,-.3834955622240026,-.33124467509627725,.09365654209093091,-.05673310882817577,.2120523322966496,.02945768486978205,-.04965996229802928,-.1136529129285836],e=0;9>e;e++)this._defaultVec.push(new Vector3D(t[e],t[e],t[e]))}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setLightProbeData=function(t){this._dataAry=t},t.prototype.clear=function(){this._dataAry=null},t.prototype.getData=function(t){if(!this._dataAry)return this._defaultVec;for(var e=0;this._dataAry.length>e;e++){var i=this._dataAry[e];if(this.testPoint(i,t)){var n=i.postion,a=t.subtract(n);return this.getResultData(i.posItem,float2int(a.x/i.betweenNum),float2int(a.z/i.betweenNum),float2int(a.y/i.betweenNum),i.betweenNum,a)}}return this._defaultVec},t.prototype.testPoint=function(t,e){var i=(t.cubeVec.x-1)*t.betweenNum,n=(t.cubeVec.y-1)*t.betweenNum,a=(t.cubeVec.z-1)*t.betweenNum,s=e.x-t.postion.x,o=e.y-t.postion.y,r=e.z-t.postion.z;return s>=0&&i>s&&o>=0&&n>o&&r>=0&&a>r?!0:!1},t.prototype.getResultData=function(t,e,i,n,a,s){var o=[];o.push(new PosItem(t[e][i][n],s)),o.push(new PosItem(t[e+1][i][n],s)),o.push(new PosItem(t[e][i+1][n],s)),o.push(new PosItem(t[e+1][i+1][n],s)),o.push(new PosItem(t[e][i][n+1],s)),o.push(new PosItem(t[e+1][i][n+1],s)),o.push(new PosItem(t[e][i+1][n+1],s)),o.push(new PosItem(t[e+1][i+1][n+1],s));for(var r=0,h=0;o.length>h;h++)r+=o[h].dis;for(h=0;o.length>h;h++)o[h].setBais(r);var c=0;for(h=0;o.length>h;h++)c+=o[h].bais;for(h=0;o.length>h;h++)o[h].bais=o[h].bais/c;var l=[];for(h=0;9>h;h++){for(var u=new Vector3D,d=0;o.length>d;d++){var p=new Vector3D(o[d].vecNum[h].x,o[d].vecNum[h].y,o[d].vecNum[h].z);p.scaleBy(o[d].bais),u=u.add(p)}l.push(u)}return l},t}(),PosItem=function(){function t(t,e){this.pos=new Vector3D(t.x,t.y,t.z),this.vecNum=t.resultSHVec,this.dis=Vector3D.distance(this.pos,e)}return t.prototype.setBais=function(t){this.bais=this.dis/t*(this.dis/t),this.bais=1/this.bais},t}(),egret;(function(t){var e=function(){function t(){}return t.LITTLE_ENDIAN="littleEndian",t.BIG_ENDIAN="bigEndian",t}();t.Endian=e;var i=function(){function t(t){this.BUFFER_EXT_SIZE=0,this.EOF_byte=-1,this.EOF_code_point=-1,this._setArrayBuffer(t||new ArrayBuffer(this.BUFFER_EXT_SIZE)),this.endian=e.BIG_ENDIAN}return t.prototype._setArrayBuffer=function(t){this.write_position=t.byteLength,this.data=new DataView(t),this._position=0},Object.defineProperty(t.prototype,"buffer",{get:function(){return this.data.buffer},set:function(t){this.data=new DataView(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataView",{get:function(){return this.data},set:function(t){this.data=t,this.write_position=t.byteLength},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bufferOffset",{get:function(){return this.data.byteOffset},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(t){this._position=t,this.write_position=t>this.write_position?t:this.write_position},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return this.write_position},set:function(t){this.validateBuffer(t,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bytesAvailable",{get:function(){return this.data.byteLength-this._position},enumerable:!0,configurable:!0}),t.prototype.clear=function(){this._setArrayBuffer(new ArrayBuffer(this.BUFFER_EXT_SIZE))},t.prototype.readBoolean=function(){return 0!=this.data.getUint8(this.position++)},t.prototype.readByte=function(){return this.data.getInt8(this.position++)},t.prototype.readBytes=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0);for(var n=0;i>n;n++)t.data.setUint8(n+e,this.data.getUint8(this.position++))},t.prototype.readDouble=function(){var i=this.data.getFloat64(this.position,this.endian==e.LITTLE_ENDIAN);return this.position+=t.SIZE_OF_FLOAT64,i},t.prototype.readFloat=function(){var i=this.data.getFloat32(this.position,this.endian==e.LITTLE_ENDIAN);return this.position+=t.SIZE_OF_FLOAT32,i},t.prototype.readInt=function(){var i=this.data.getInt32(this.position,this.endian==e.LITTLE_ENDIAN);return this.position+=t.SIZE_OF_INT32,i},t.prototype.readShort=function(){var i=this.data.getInt16(this.position,this.endian==e.LITTLE_ENDIAN);return this.position+=t.SIZE_OF_INT16,i},t.prototype.readUnsignedByte=function(){return this.data.getUint8(this.position++)},t.prototype.readUnsignedInt=function(){var i=this.data.getUint32(this.position,this.endian==e.LITTLE_ENDIAN);return this.position+=t.SIZE_OF_UINT32,i},t.prototype.readUnsignedShort=function(){var i=this.data.getUint16(this.position,this.endian==e.LITTLE_ENDIAN);return this.position+=t.SIZE_OF_UINT16,i},t.prototype.readUTF=function(){var i=this.data.getUint16(this.position,this.endian==e.LITTLE_ENDIAN);return this.position+=t.SIZE_OF_UINT16,i>0?this.readUTFBytes(i):""},t.prototype.readUTFBytes=function(t){var e=new Uint8Array(this.buffer,this.bufferOffset+this.position,t);return this.position+=t,this.decodeUTF8(e)},t.prototype.writeBoolean=function(e){this.validateBuffer(t.SIZE_OF_BOOLEAN),this.data.setUint8(this.position++,e?1:0)},t.prototype.writeByte=function(e){this.validateBuffer(t.SIZE_OF_INT8),this.data.setInt8(this.position++,e)},t.prototype.writeBytes=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0);var n;if(!(0>e)&&!(0>i)&&(n=0==i?t.length-e:Math.min(t.length-e,i),n>0)){this.validateBuffer(n);for(var a=new DataView(t.buffer),s=e;n+e>s;s++)this.data.setUint8(this.position++,a.getUint8(s))}},t.prototype.writeDouble=function(i){this.validateBuffer(t.SIZE_OF_FLOAT64),this.data.setFloat64(this.position,i,this.endian==e.LITTLE_ENDIAN),this.position+=t.SIZE_OF_FLOAT64},t.prototype.writeFloat=function(i){this.validateBuffer(t.SIZE_OF_FLOAT32),this.data.setFloat32(this.position,i,this.endian==e.LITTLE_ENDIAN),this.position+=t.SIZE_OF_FLOAT32},t.prototype.writeInt=function(i){this.validateBuffer(t.SIZE_OF_INT32),this.data.setInt32(this.position,i,this.endian==e.LITTLE_ENDIAN),this.position+=t.SIZE_OF_INT32},t.prototype.writeShort=function(i){this.validateBuffer(t.SIZE_OF_INT16),this.data.setInt16(this.position,i,this.endian==e.LITTLE_ENDIAN),this.position+=t.SIZE_OF_INT16},t.prototype.writeUnsignedInt=function(i){this.validateBuffer(t.SIZE_OF_UINT32),this.data.setUint32(this.position,i,this.endian==e.LITTLE_ENDIAN),this.position+=t.SIZE_OF_UINT32},t.prototype.writeUTF=function(i){var n=this.encodeUTF8(i),a=n.length;this.validateBuffer(t.SIZE_OF_UINT16+a),this.data.setUint16(this.position,a,this.endian===e.LITTLE_ENDIAN),this.position+=t.SIZE_OF_UINT16,this._writeUint8Array(n,!1)},t.prototype.writeUTFBytes=function(t){this._writeUint8Array(this.encodeUTF8(t))},t.prototype.toString=function(){return"[ByteArray] length:"+this.length+", bytesAvailable:"+this.bytesAvailable},t.prototype._writeUint8Array=function(t,e){void 0===e&&(e=!0),e&&this.validateBuffer(this.position+t.length);for(var i=0;t.length>i;i++)this.data.setUint8(this.position++,t[i])},t.prototype.validate=function(t){return this.data.byteLength>0&&this._position+t<=this.data.byteLength?!0:void 0},t.prototype.validateBuffer=function(t,e){if(void 0===e&&(e=!1),this.write_position=t>this.write_position?t:this.write_position,t+=this._position,t>this.data.byteLength||e){var i=new Uint8Array(new ArrayBuffer(t+this.BUFFER_EXT_SIZE)),n=Math.min(this.data.buffer.byteLength,t+this.BUFFER_EXT_SIZE);i.set(new Uint8Array(this.data.buffer,0,n)),this.buffer=i.buffer}},t.prototype.encodeUTF8=function(t){for(var e=0,i=this.stringToCodePoints(t),n=[];i.length>e;){var a=i[e++];if(this.inRange(a,55296,57343))this.encoderError(a);else if(this.inRange(a,0,127))n.push(a);else{var s,o;for(this.inRange(a,128,2047)?(s=1,o=192):this.inRange(a,2048,65535)?(s=2,o=224):this.inRange(a,65536,1114111)&&(s=3,o=240),n.push(this.div(a,Math.pow(64,s))+o);s>0;){var r=this.div(a,Math.pow(64,s-1));n.push(128+r%64),s-=1}}}return new Uint8Array(n)},t.prototype.decodeUTF8=function(t){for(var e,i=!1,n=0,a="",s=0,o=0,r=0,h=0;t.length>n;){var c=t[n++];if(c===this.EOF_byte)e=0!==o?this.decoderError(i):this.EOF_code_point;else if(0===o)this.inRange(c,0,127)?e=c:(this.inRange(c,194,223)?(o=1,h=128,s=c-192):this.inRange(c,224,239)?(o=2,h=2048,s=c-224):this.inRange(c,240,244)?(o=3,h=65536,s=c-240):this.decoderError(i),s*=Math.pow(64,o),e=null);else if(this.inRange(c,128,191))if(r+=1,s+=(c-128)*Math.pow(64,o-r),r!==o)e=null;else{var l=s,u=h;s=0,o=0,r=0,h=0,e=this.inRange(l,u,1114111)&&!this.inRange(l,55296,57343)?l:this.decoderError(i,c)}else s=0,o=0,r=0,h=0,n--,e=this.decoderError(i,c);null!==e&&e!==this.EOF_code_point&&(65535>=e?e>0&&(a+=String.fromCharCode(e)):(e-=65536,a+=String.fromCharCode(55296+(1023&e>>10)),a+=String.fromCharCode(56320+(1023&e))))}return a},t.prototype.encoderError=function(){},t.prototype.decoderError=function(t,e){return e||65533},t.prototype.inRange=function(t,e,i){return t>=e&&i>=t},t.prototype.div=function(t,e){return Math.floor(t/e)},t.prototype.stringToCodePoints=function(t){for(var e=[],i=0,n=t.length;t.length>i;){var a=t.charCodeAt(i);if(this.inRange(a,55296,57343))if(this.inRange(a,56320,57343))e.push(65533);else if(i===n-1)e.push(65533);else{var s=t.charCodeAt(i+1);if(this.inRange(s,56320,57343)){var o=1023&a,r=1023&s;i+=1,e.push(65536+(o<<10)+r)}else e.push(65533)}else e.push(a);i+=1}return e},t.SIZE_OF_BOOLEAN=1,t.SIZE_OF_INT8=1,t.SIZE_OF_INT16=2,t.SIZE_OF_INT32=4,t.SIZE_OF_UINT8=1,t.SIZE_OF_UINT16=2,t.SIZE_OF_UINT32=4,t.SIZE_OF_FLOAT32=4,t.SIZE_OF_FLOAT64=8,t}();t.ByteArray=i})(egret||(egret={}));var MouseType=function(){function t(){}return t.MouseDown="mousedown",t.MouseUp="mouseup",t.MouseMove="mousemove",t.MouseClick="mouseclick",t.KeyDown="keydown",t.KeyUp="keyup",t.MouseWheel="mousewheel",t.TouchStart="touchstart",t.TouchMove="touchmove",t.TouchEnd="touchend",t.TouchClick="touchstart",t}(),KeyControl=function(){function t(){var t=this;this._isUpData=!0,this.speedNum=10,this._keyDic={},this._lostMousePos=new Object3D,this._lastFousce=new Object3D,this._isMouseDown=!1,setInterval(function(){t.upData()},1e3/60)}return Object.defineProperty(t,"instance",{get:function(){return this._instance||(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.init=function(){document.addEventListener(MouseType.MouseDown,this.onMouseDown),document.addEventListener(MouseType.MouseUp,this.onMouseUp),document.addEventListener(MouseType.MouseMove,this.onMouseMove),document.addEventListener(MouseType.KeyDown,this.onKeyDown),document.addEventListener(MouseType.KeyUp,this.onKeyUp)},t.prototype.clearAllEvet=function(){document.removeEventListener(MouseType.MouseDown,this.onMouseDown),document.removeEventListener(MouseType.MouseUp,this.onMouseUp),document.removeEventListener(MouseType.MouseMove,this.onMouseMove),document.removeEventListener(MouseType.KeyDown,this.onKeyDown),document.removeEventListener(MouseType.KeyUp,this.onKeyUp)},t.prototype.clearMouseEvent=function(){document.removeEventListener(MouseType.MouseDown,this.onMouseDown),document.removeEventListener(MouseType.MouseUp,this.onMouseUp),document.removeEventListener(MouseType.MouseMove,this.onMouseMove),this._isUpData=!1},t.prototype.onMouseMove=function(e){var i=t.instance,n=new Object3D;n.x=e.pageX,n.y=e.pageY,i._isMouseDown&&(Scene_data.cam3D.rotationY=i._lastFousce.rotationY-(n.x-i._lostMousePos.x)/10,Scene_data.cam3D.rotationX=i._lastFousce.rotationX-(n.y-i._lostMousePos.y)/10)},t.prototype.onMouseDown=function(e){var i=t.instance;i._isMouseDown=!0,i._lostMousePos.x=e.pageX,i._lostMousePos.y=e.pageY,i._lastFousce.rotationX=Scene_data.cam3D.rotationX,i._lastFousce.rotationY=Scene_data.cam3D.rotationY},t.prototype.onMouseUp=function(){var e=t.instance;e._isMouseDown=!1},t.prototype.upData=function(){if(this._isUpData){var t=this._keyDic;t[65]&&this.tureLeft(),t[83]&&this.tureDown(),t[68]&&this.tureRight(),t[87]&&this.tureUp(),t[81]&&(Scene_data.cam3D.y-=this.speedNum),t[69]&&(Scene_data.cam3D.y+=this.speedNum),MathClass.MathCam(Scene_data.cam3D)}},t.prototype.tureLeft=function(){var t=new Vector3D(-this.speedNum,0,0,1);new Matrix3D,this.mathFocus3D(t)},t.prototype.tureRight=function(){var t=new Vector3D(this.speedNum,0,0,1);this.mathFocus3D(t)},t.prototype.tureUp=function(){var t=new Vector3D(0,0,this.speedNum,1);this.mathFocus3D(t)},t.prototype.tureDown=function(){var t=new Vector3D(0,0,-this.speedNum,1);this.mathFocus3D(t)},t.prototype.mathFocus3D=function(t){var e=new Matrix3D;e.prependRotation(-Scene_data.cam3D.rotationY,Vector3D.Y_AXIS),e.prependRotation(-Scene_data.cam3D.rotationX,Vector3D.X_AXIS),t=e.transformVector(t),Scene_data.cam3D.x+=t.x,Scene_data.cam3D.y+=t.y,Scene_data.cam3D.z+=t.z},t.prototype.onKeyDown=function(e){var i=t.instance._keyDic;i[e.keyCode]=!0},t.prototype.onKeyUp=function(e){var i=t.instance._keyDic;i[e.keyCode]=!1},t}(),TimeUtil=function(){function t(){}return t.getTimer=function(){return Date.now()-t.START_TIME},t.init=function(){t.START_TIME=Date.now()},t.addTimeTick=function(e,i,n){void 0===n&&(n=0);var a=new TimeFunTick;a.alltime=e,a.fun=i,a.time=e-n,t.timefunAry.push(a)},t.removeTimeTick=function(e){for(var i=0;t.timefunAry.length>i;i++)if(t.timefunAry[i].fun==e){t.timefunAry.splice(i,1);break}},t.addTimeOut=function(e,i){var n=new TimeFunOut;n.alltime=e,n.fun=i,n.time=0,t.outTimeFunAry.push(n)},t.addFrameTick=function(e){t.funAry.push(e)},t.hasFrameTick=function(e){var i=t.funAry.indexOf(e);return-1!=i?!0:!1},t.removeFrameTick=function(e){var i=t.funAry.indexOf(e);-1!=i&&t.funAry.splice(i,1)},t.update=function(){for(var e=t.getTimer()-t.time,i=0;t.funAry.length>i;i++)t.funAry[i](e);for(var i=0;t.timefunAry.length>i;i++)t.timefunAry[i].update(e);for(var i=t.outTimeFunAry.length-1;i>=0;i--)t.outTimeFunAry[i].update(e)&&t.outTimeFunAry.splice(i,1);t.time=t.getTimer()},t.funAry=[],t.timefunAry=[],t.outTimeFunAry=[],t.time=0,t}(),TimeFunTick=function(){function t(){this.alltime=0,this.time=0}return t.prototype.update=function(t){this.time+=t,this.time>=this.alltime&&(this.fun(),this.time=0)},t}(),TimeFunOut=function(){function t(){this.alltime=0,this.time=0}return t.prototype.update=function(t){return this.time+=t,this.time>=this.alltime?(this.fun(),!0):!1},t}(),ColorTransition=function(){function t(){this._canvas=document.createElement("canvas"),this._cxt=this._canvas.getContext("2d"),this._gnt=this._cxt.createLinearGradient(0,0,128,0),this._canvas.style.zIndex="1"}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.getImageData=function(t){for(var e=t.pos.length,i=new Vector3D,n=0;e>n;n++)hexToArgb(t.color[n],!1,i),this._gnt.addColorStop(t.pos[n]/255,"rgba("+i.x+","+i.y+","+i.z+","+t.alpha[n]+")");return this._cxt.fillStyle=this._gnt,this._cxt.fillRect(0,0,128,2),this._cxt.getImageData(0,0,128,2)},t.prototype.getImageDataByVec=function(t,e){for(var i,n,a=this._cxt.createImageData(64,1),s=0;64>s;s++)i=4*s,n=4*float2int(s/64*e),a.data[i]=t[n],a.data[i+1]=t[n+1],a.data[i+2]=t[n+2],a.data[i+3]=t[n+3];return a},t.prototype.setData=function(){},t}(),Curve=function(){function t(){this.valueV3d=new Vector3D(1,1,1,1)}return t.prototype.getValue=function(t){if(!this.valueVec||-1==this.begintFrame)return this.valueV3d;var e=float2int(t/Scene_data.frameTime-this.begintFrame);return 0>e?e=0:e>this.maxFrame-this.begintFrame&&(e=this.maxFrame-this.begintFrame),1==this.type?this.valueV3d.x=this.valueVec[0][e]:2==this.type?(this.valueV3d.x=this.valueVec[0][e],this.valueV3d.y=this.valueVec[1][e]):3==this.type?(this.valueV3d.x=this.valueVec[0][e],this.valueV3d.y=this.valueVec[1][e],this.valueV3d.z=this.valueVec[2][e]):4==this.type&&(this.valueV3d.x=this.valueVec[0][e],this.valueV3d.y=this.valueVec[1][e],this.valueV3d.z=this.valueVec[2][e],this.valueV3d.w=this.valueVec[3][e],this.valueV3d.scaleBy(this.valueV3d.w)),this.valueV3d},t.prototype.setData=function(t){this.type=t.type,this.maxFrame=t.maxFrame,this.begintFrame=t.items.length?t.items[0].frame:-1,this.valueVec=t.values},t}(),Shadow=function(){function t(){this._visible=!1,this.data=[0,0,0,5]}return Object.defineProperty(t.prototype,"visible",{get:function(){return this._visible},set:function(t){this._visible=t,this.display.stateChage()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this.data[0]},set:function(t){this.data[0]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this.data[1]},set:function(t){this.data[1]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"z",{get:function(){return this.data[2]},set:function(t){this.data[2]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this.data[3]},set:function(t){this.data[3]=t},enumerable:!0,configurable:!0}),t}(),ShadowManager=function(){function t(){this._displayList=[],ProgrmaManager.getInstance().registe(Display3DShadowShader.Display3DShadowShader,new Display3DShadowShader)}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.addShadow=function(){var t=this.getIdleShadow(),e=new Shadow;return t.addShadow(e),e},t.prototype.removeShadow=function(t){t.display.removeShadow(t)},t.prototype.update=function(){if(this._displayList.length){Scene_data.context3D.setWriteDepth(!1);for(var t=0;this._displayList.length>t;t++)this._displayList[t].update();Scene_data.context3D.setWriteDepth(!0)}},t.prototype.getIdleShadow=function(){for(var t=0;this._displayList.length>t;t++)if(this._displayList[t].hasIdle())return this._displayList[t];var e=new Display3dShadow;return this._displayList.push(e),e},t}(),BaseRes=function(){function t(){this.allImgBytes=1e7,this.useNum=0}return t.prototype.read=function(){var e=this._byte.readInt();e==t.IMG_TYPE?Scene_data.supportBlob?this.readImg():this.readImgLow():e==t.OBJS_TYPE?this.readObj():e==t.MATERIAL_TYPE?this.readMaterial():e==t.PARTICLE_TYPE&&this.readParticle()},t.prototype.readImg=function(){var t=this;this.imgNum=this._byte.readInt(),this.imgLoadNum=0,this.imgAry=[];for(var e=TimeUtil.getTimer(),i=0;this.imgNum>i;i++){var n=Scene_data.fileRoot+this._byte.readUTF(),a=this._byte.readInt(),s=new egret.ByteArray;s.length=a,this._byte.readBytes(s,0,a);var o=new Blob([s.buffer],{type:"application/octet-binary"}),r=new Image;this.imgAry.push(n),r.url=n,r.onload=function(e){t.loadImg(e.target)},r.src=URL.createObjectURL(o)}console.log("img time",TimeUtil.getTimer()-e)},t.prototype.readImgLow=function(){var t=this;this.imgNum=this._byte.readInt(),this.imgLoadNum=0,this.imgAry=[],TimeUtil.getTimer();for(var e=0,i=0;this.imgNum>i;i++){var n=Scene_data.fileRoot+this._byte.readUTF(),a=this._byte.readInt();e+=a;var s=new Image;s.url=n,this.imgAry.push(n),s.onload=function(e){t.loadImg(e.target)},s.src=n}this.allImgBytes=e},t.prototype.loadImg=function(t){TextureManager.getInstance().addRes(t.url,t),this.imgLoadNum++,this.imgLoadNum==this.imgNum&&(this._imgComplete=!0,this.allResCom())},t.prototype.readObj=function(){var t=this._byte.readInt();this.objAry=[];for(var e=TimeUtil.getTimer(),i=0;t>i;i++){var n=Scene_data.fileRoot+this._byte.readUTF(),a=this._byte.readInt(),s=new egret.ByteArray;s.length=a,this._byte.readBytes(s,0,a),ObjDataManager.getInstance().loadObjCom(s.buffer,n),this.objAry.push(n)}console.log("obj time",TimeUtil.getTimer()-e)},t.prototype.readMaterial=function(){var t=this._byte.readInt();this.materialAry=[];for(var e=TimeUtil.getTimer(),i=0;t>i;i++){var n=Scene_data.fileRoot+this._byte.readUTF(),a=this._byte.readInt(),s=this._byte.readUTFBytes(a);this.materialAry.push(n),MaterialManager.getInstance().addRes(n,s)}console.log("material time",TimeUtil.getTimer()-e)},t.prototype.readParticle=function(){var t=this._byte.readInt();this.particleAry=[];for(var e=TimeUtil.getTimer(),i=0;t>i;i++){var n=Scene_data.fileRoot+this._byte.readUTF(),a=this._byte.readInt(),s=this._byte.readUTFBytes(a);this.particleAry.push(n),ParticleManager.getInstance().addRes(n,s)}console.log("particle time",TimeUtil.getTimer()-e)},t.prototype.allResCom=function(){},t.IMG_TYPE=1,t.OBJS_TYPE=2,t.MATERIAL_TYPE=3,t.PARTICLE_TYPE=4,t.SCENE_TYPE=5,t}(),ResManager=function(){function t(){this._resDic={},this._loadDic={}}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.loadRoleRes=function(t,e,i){var n=this;if(this._resDic[t])return e(this._resDic[t]),void 0;if(this._loadDic[t])return this._loadDic[t].push(e),void 0;this._loadDic[t]=[],this._loadDic[t].push(e);var a=new RoleRes;a.meshBatchNum=i,a.load(t,function(){for(var e=0;n._loadDic[t].length>e;e++)n._loadDic[t][e](a);delete n._loadDic[t],n._resDic[t]=a})},t.prototype.loadSkillRes=function(t,e){var i=this;if(this._resDic[t])return e(this._resDic[t]),void 0;if(this._loadDic[t])return this._loadDic[t].push(e),void 0;this._loadDic[t]=[],this._loadDic[t].push(e);var n=new SkillRes;n.load(t,function(){for(var e=0;i._loadDic[t].length>e;e++)i._loadDic[t][e](n);delete i._loadDic[t],i._resDic[t]=n})},t.prototype.loadSceneRes=function(t,e,i,n){var a;return this._resDic[t]?a=this._resDic[t]:(a=new SceneRes,this._resDic[t]=a),a.load(t,e,i,n),a},t}(),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},RoleRes=function(t){function e(){t.call(this),this.meshBatchNum=1}return __extends(e,t),e.prototype.load=function(t,e){var i=this;this._fun=e,LoadManager.getInstance().load(t,LoadManager.BYTE_TYPE,function(t){i.loadComplete(t)})},e.prototype.loadComplete=function(t){this._byte=new egret.ByteArray(t),this.readMesh()},e.prototype.readMesh=function(){this.roleUrl=this._byte.readUTF(),MeshDataManager.getInstance().readData(this._byte,this.meshBatchNum,this.roleUrl),this.readAction()},e.prototype.readAction=function(){this.actionAry=[];for(var t=this._byte.readInt(),e=0;t>e;e++){var i=this._byte.readUTF();AnimManager.getInstance().readData(this._byte,this.roleUrl+i),this.actionAry.push(i)}this.read(),this.read(),this.read()},e.prototype.allResCom=function(){this._fun()},e}(BaseRes),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},SkillRes=function(t){function e(){t.call(this),this.meshBatchNum=1}return __extends(e,t),e.prototype.load=function(t,e){var i=this;this._fun=e,LoadManager.getInstance().load(t,LoadManager.BYTE_TYPE,function(t){i.loadComplete(t)})},e.prototype.loadComplete=function(t){this._byte=new egret.ByteArray(t),this.skillUrl=this._byte.readUTF(),this.read(),this.read(),this.read();var e=this._byte.readUTF();this.data=JSON.parse(e)},e.prototype.allResCom=function(){this._fun()},e}(BaseRes),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},ModelRes=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.load=function(t,e){var i=this;this._fun=e,LoadManager.getInstance().load(t,LoadManager.BYTE_TYPE,function(t){i.loadComplete(t)})},e.prototype.loadComplete=function(t){this._byte=new egret.ByteArray(t),this.read(),this.read(),this.read(),this.objUrl=this._byte.readUTF(),this.materialUrl=this._byte.readUTF(),this._byte.readBoolean()&&(this.light=new LightVo,this.light.ambientColor[0]=this._byte.readFloat(),this.light.ambientColor[1]=this._byte.readFloat(),this.light.ambientColor[2]=this._byte.readFloat(),this.light.sunColor[0]=this._byte.readFloat(),this.light.sunColor[1]=this._byte.readFloat(),this.light.sunColor[2]=this._byte.readFloat(),this.light.sunDirect[0]=this._byte.readFloat(),this.light.sunDirect[1]=this._byte.readFloat(),this.light.sunDirect[2]=this._byte.readFloat()),this._fun()
},e}(BaseRes),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},SceneRes=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.load=function(t,e,i,n){var a=this;return this.sceneData?(e(),i(1),n(this.sceneData),void 0):(this._completeFun=e,this._readDataFun=n,this._progressFun=i,LoadManager.getInstance().load(t,LoadManager.BYTE_TYPE,function(t){a.loadComplete(t)},null,i),void 0)},e.prototype.loadComplete=function(t){this._completeFun(),this._byte=new egret.ByteArray(t),this.read(),this.read(),this.read(),this.read(),this.readScene()},e.prototype.readScene=function(){this._byte.readInt();var t=this._byte.readInt();this.sceneData=JSON.parse(this._byte.readUTFBytes(t))},e.prototype.allResCom=function(){this._readDataFun(this.sceneData)},e}(BaseRes),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},SceneResLow=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.readImgLow=function(){t.prototype.readImgLow.call(this),this._progressFun(0)},e.prototype.loadImg=function(t){TextureManager.getInstance().addRes(t.url,t),this.imgLoadNum++,this._progressFun(this.imgLoadNum/this.imgNum);var e=new SceneLoadEvent(SceneLoadEvent.INFO_EVENT);e.str="加载进度："+this.imgLoadNum+"/"+this.imgNum,ModuleEventManager.dispatchEvent(e),this.imgLoadNum==this.imgNum&&(this._imgComplete=!0,this.allResCom())},e}(SceneRes),AnimData=function(){function t(){this.inLoop=0,this.inter=[],this.bounds=[],this.nameHeight=0,this.posAry=[],this.hasProcess=!1}return t}(),SkinMesh=function(){function t(){this.meshAry=[],this.fileScale=1,this.type=0}return t.prototype.addMesh=function(t){this.meshAry.push(t)},t.prototype.loadMaterial=function(t){void 0===t&&(t=null);for(var e=0;this.meshAry.length>e;e++)this.loadMeshDataMaterial(this.meshAry[e],t)},t.prototype.loadMeshDataMaterial=function(t,e){void 0===e&&(e=null);var i=Scene_data.fileRoot+t.materialUrl,n=new MaterialAnimShader;0==this.type?n=new MaterialAnimShader:1==this.type&&(n=new MaterialBatchAnimShader),MaterialManager.getInstance().getMaterial(i,function(i){t.material=i,i.usePbr?MeshDataManager.getInstance().uploadPbrMesh(t,i.useNormal):(i.lightProbe||i.directLight)&&MeshDataManager.getInstance().uploadPbrMesh(t,!1),e&&e(i)},null,!0,n.name,n)},t.prototype.loadParticle=function(t){console.log(t);for(var e=0;this.meshAry.length>e;e++)for(var i=this.meshAry[e].particleAry,n=0;i.length>n;n++){var a=i[n],s=ParticleManager.getInstance().getParticle(a.url);s.bindTarget=t,s.bindSocket=a.socketName,a.particle=s,ParticleManager.getInstance().addParticle(s)}},t}(),BoneSocketData=function(){function t(){}return t}(),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},CollisionVo=function(t){function e(e,i,n){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),t.call(this)}return __extends(e,t),e}(Object3D),CollisionItemVo=function(){function t(){}return t}(),CollisionType=function(){function t(){}return t.Polygon=0,t.BOX=1,t.BALL=2,t.Cylinder=3,t.Cone=4,t}(),CapsuleVo=function(){function t(t,e){this.radius=t,this.height=e}return t}(),LightVo=function(){function t(){this.sunDirect=[0,1,0],this.sunColor=[2,0,0],this.ambientColor=[0,0,0]}return t.prototype.setData=function(t,e,i){this.sunDirect[0]=t.x,this.sunDirect[1]=t.y,this.sunDirect[2]=t.z,this.sunColor[0]=e.x,this.sunColor[1]=e.y,this.sunColor[2]=e.z,this.ambientColor[0]=i.x,this.ambientColor[1]=i.y,this.ambientColor[2]=i.z},t}(),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},LineDisplayShader=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.binLocation=function(t){t.bindAttribLocation(this.program,0,"v3Position"),t.bindAttribLocation(this.program,1,"v3Color")},e.prototype.getVertexShaderString=function(){var t="attribute vec3 v3Position;attribute vec3 v3Color;uniform mat4 viewMatrix3D;uniform mat4 camMatrix3D;uniform mat4 posMatrix3D;varying vec4 colorData;void main(void){   vec4 vt0= vec4(v3Position, 1.0);   colorData =vec4(v3Color,1) ;   vt0 = posMatrix3D * vt0;   vt0 = camMatrix3D * vt0;   vt0 = viewMatrix3D * vt0;   gl_Position = vt0;}";return t},e.prototype.getFragmentShaderString=function(){var t=" precision mediump float;\nvarying vec4 colorData;\nvoid main(void)\n{\ngl_FragColor =colorData;\n}";return t},e.LineShader="LineShader",e}(Shader3D),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},LineDisplaySprite=function(t){function e(){t.call(this),this.baseColor=new Vector3D(1,0,0),this.objData=new ObjData,this.program=ProgrmaManager.getInstance().getProgram(LineDisplayShader.LineShader),this.makeLineMode(new Vector3D(0,0,0),new Vector3D(100,0,0),new Vector3D),this.makeLineMode(new Vector3D(0,0,0),new Vector3D(100,0,100),new Vector3D),this.makeLineMode(new Vector3D(100,0,0),new Vector3D(100,0,100),new Vector3D),this.upToGpu()}return __extends(e,t),e.prototype.makeLineMode=function(t,e,i){void 0===i&&(i=null),this.lineVecPos&&this.lineIndex||this.clear(),i&&(this.baseColor=i),this.lineVecPos.push(t.x,t.y,t.z),this.lineVecPos.push(e.x,e.y,e.z),this.lineColor.push(this.baseColor.x,this.baseColor.y,this.baseColor.z),this.lineColor.push(this.baseColor.x,this.baseColor.y,this.baseColor.z),this.lineIndex.push(this.lineIndex.length+0,this.lineIndex.length+1)},e.prototype.clear=function(){this.lineVecPos=[],this.lineIndex=[],this.lineColor=[],this.objData.indexBuffer&&(this.objData.indexBuffer=null)},e.prototype.upToGpu=function(){this.lineIndex.length&&(this.objData.treNum=this.lineIndex.length,this.objData.vertexBuffer=Scene_data.context3D.uploadBuff3D(this.lineVecPos),this.objData.normalsBuffer=Scene_data.context3D.uploadBuff3D(this.lineColor),this.objData.indexBuffer=Scene_data.context3D.uploadIndexBuff3D(this.lineIndex))},e.prototype.update=function(){this.objData&&this.objData.indexBuffer&&(Scene_data.context3D.setProgram(this.program),Scene_data.context3D.setVcMatrix4fv(this.program,"viewMatrix3D",Scene_data.viewMatrx3D.m),Scene_data.context3D.setVcMatrix4fv(this.program,"camMatrix3D",Scene_data.cam3D.cameraMatrix.m),Scene_data.context3D.setVcMatrix4fv(this.program,"posMatrix3D",this.posMatrix.m),Scene_data.context3D.setVa(0,3,this.objData.vertexBuffer),Scene_data.context3D.setVa(1,3,this.objData.normalsBuffer),Scene_data.context3D.drawLine(this.objData.indexBuffer,this.objData.treNum))},e}(Display3D),GridLineSprite=function(t){function e(){t.call(this),this.makeGridData()}return __extends(e,t),e.prototype.makeGridData=function(){var t=100,e=10,i=t/e;this.clear();var n,a;n=new Vector3D(0,0,+t),a=new Vector3D(0,0,-t),this.makeLineMode(n,a,new Vector3D(0,0,1,1)),n=new Vector3D(+t,0,0),a=new Vector3D(-t,0,0),this.makeLineMode(n,a,new Vector3D(1,0,0,1)),this.baseColor=new Vector3D(128/255,128/255,128/255,1);for(var s=1;e>=s;s++)n=new Vector3D(+s*i,0,+t),a=new Vector3D(+s*i,0,-t),this.makeLineMode(n,a),n=new Vector3D(-s*i,0,+t),a=new Vector3D(-s*i,0,-t),this.makeLineMode(n,a),n=new Vector3D(+t,0,+s*i),a=new Vector3D(-t,0,+s*i),this.makeLineMode(n,a),n=new Vector3D(+t,0,-s*i),a=new Vector3D(-t,0,-s*i),this.makeLineMode(n,a);this.upToGpu()},e}(LineDisplaySprite),Module=function(){function t(){this.processorMap={}}return t.prototype.getModuleName=function(){throw Error("module必须复写命名")},t.prototype.listProcessors=function(){return null},t.prototype.registerProcessors=function(){var t=this.listProcessors();if(null!=t&&t.length>0)for(var e=0;t.length>e;e++)this.registerProcessor(t[e])},t.prototype.registerProcessor=function(t){if(null!=this.processorMap[t.getName()])throw Error("同一Module不能注册两个相同的Processor");this.processorMap[t.getName()]=t,t.registerEvents()},t.registerModule=function(e){if(null!=t.moduleMap[e.getModuleName()])throw Error("不能注册两个相同的Module");t.moduleMap[e.getModuleName()]=e,e.registerProcessors()},t.moduleMap={},t}(),ModuleEventManager=function(){function t(){}return t.addEvents=function(e,i,n){for(var a=0;e.length>a;a++)t._instance.addEventListener(e[a].type,i,n)},t.dispatchEvent=function(e){t._instance.dispatchEvent(e)},t._instance=new EventDispatcher,t}(),Processor=function(){function t(){}return t.prototype.getName=function(){throw Error("process必须复写命名")},t.prototype.receivedModuleEvent=function(){},t.prototype.listenModuleEvents=function(){return null},t.prototype.registerEvents=function(){var t=this.listenModuleEvents();null!=t&&t.length>0&&ModuleEventManager.addEvents(t,this.receivedModuleEvent,this)},t}();(function(t,e){"use strict";var i=t.GreenSockGlobals=t.GreenSockGlobals||t;if(!i.TweenLite){var n,a,s,o,r,h=function(t){var e,n=t.split("."),a=i;for(e=0;n.length>e;e++)a[n[e]]=a=a[n[e]]||{};return a},c=h("com.greensock"),l=1e-10,u=function(t){var e,i=[],n=t.length;for(e=0;e!==n;i.push(t[e++]));return i},d=function(){},p=function(){var t=Object.prototype.toString,e=t.call([]);return function(i){return null!=i&&(i instanceof Array||"object"==typeof i&&!!i.push&&t.call(i)===e)}}(),_={},f=function(n,a,s,o){this.sc=_[n]?_[n].sc:[],_[n]=this,this.gsClass=null,this.func=s;var r=[];this.check=function(c){for(var l,u,d,p,m=a.length,y=m;--m>-1;)(l=_[a[m]]||new f(a[m],[])).gsClass?(r[m]=l.gsClass,y--):c&&l.sc.push(this);if(0===y&&s)for(u=("com.greensock."+n).split("."),d=u.pop(),p=h(u.join("."))[d]=this.gsClass=s.apply(s,r),o&&(i[d]=p,"function"==typeof define&&define.amd?define((t.GreenSockAMDPath?t.GreenSockAMDPath+"/":"")+n.split(".").pop(),[],function(){return p}):n===e&&"undefined"!=typeof module&&module.exports&&(module.exports=p)),m=0;this.sc.length>m;m++)this.sc[m].check()},this.check(!0)},m=t._gsDefine=function(t,e,i,n){return new f(t,e,i,n)},y=c._class=function(t,e,i){return e=e||function(){},m(t,[],function(){return e},i),e};m.globals=i;var g=[0,0,1,1],v=[],x=y("easing.Ease",function(t,e,i,n){this._func=t,this._type=i||0,this._power=n||0,this._params=e?g.concat(e):g},!0),b=x.map={},D=x.register=function(t,e,i,n){for(var a,s,o,r,h=e.split(","),l=h.length,u=(i||"easeIn,easeOut,easeInOut").split(",");--l>-1;)for(s=h[l],a=n?y("easing."+s,null,!0):c.easing[s]||{},o=u.length;--o>-1;)r=u[o],b[s+"."+r]=b[r+s]=a[r]=t.getRatio?t:t[r]||new t};for(s=x.prototype,s._calcEnd=!1,s.getRatio=function(t){if(this._func)return this._params[0]=t,this._func.apply(null,this._params);var e=this._type,i=this._power,n=1===e?1-t:2===e?t:.5>t?2*t:2*(1-t);return 1===i?n*=n:2===i?n*=n*n:3===i?n*=n*n*n:4===i&&(n*=n*n*n*n),1===e?1-n:2===e?n:.5>t?n/2:1-n/2},n=["Linear","Quad","Cubic","Quart","Quint,Strong"],a=n.length;--a>-1;)s=n[a]+",Power"+a,D(new x(null,null,1,a),s,"easeOut",!0),D(new x(null,null,2,a),s,"easeIn"+(0===a?",easeNone":"")),D(new x(null,null,3,a),s,"easeInOut");b.linear=c.easing.Linear.easeIn,b.swing=c.easing.Quad.easeInOut;var T=y("events.EventDispatcher",function(t){this._listeners={},this._eventTarget=t||this});s=T.prototype,s.addEventListener=function(t,e,i,n,a){a=a||0;var s,h,c=this._listeners[t],l=0;for(null==c&&(this._listeners[t]=c=[]),h=c.length;--h>-1;)s=c[h],s.c===e&&s.s===i?c.splice(h,1):0===l&&a>s.pr&&(l=h+1);c.splice(l,0,{c:e,s:i,up:n,pr:a}),this!==o||r||o.wake()},s.removeEventListener=function(t,e){var i,n=this._listeners[t];if(n)for(i=n.length;--i>-1;)if(n[i].c===e)return n.splice(i,1),void 0},s.dispatchEvent=function(t){var e,i,n,a=this._listeners[t];if(a)for(e=a.length,i=this._eventTarget;--e>-1;)n=a[e],n&&(n.up?n.c.call(n.s||i,{type:t,target:i}):n.c.call(n.s||i))};var w=t.requestAnimationFrame,M=t.cancelAnimationFrame,S=Date.now||function(){return(new Date).getTime()},I=S();for(n=["ms","moz","webkit","o"],a=n.length;--a>-1&&!w;)w=t[n[a]+"RequestAnimationFrame"],M=t[n[a]+"CancelAnimationFrame"]||t[n[a]+"CancelRequestAnimationFrame"];y("Ticker",function(t,e){var i,n,a,s,h,c=this,u=S(),p=e!==!1&&w,_=500,f=33,m="tick",y=function(t){var e,o,r=S()-I;r>_&&(u+=r-f),I+=r,c.time=(I-u)/1e3,e=c.time-h,(!i||e>0||t===!0)&&(c.frame++,h+=e+(e>=s?.004:s-e),o=!0),t!==!0&&(a=n(y)),o&&c.dispatchEvent(m)};T.call(c),c.time=c.frame=0,c.tick=function(){y(!0)},c.lagSmoothing=function(t,e){_=t||1/l,f=Math.min(e,_,0)},c.sleep=function(){null!=a&&(p&&M?M(a):clearTimeout(a),n=d,a=null,c===o&&(r=!1))},c.wake=function(){null!==a?c.sleep():c.frame>10&&(I=S()-_+5),n=0===i?d:p&&w?w:function(t){return setTimeout(t,0|1e3*(h-c.time)+1)},c===o&&(r=!0),y(2)},c.fps=function(t){return arguments.length?(i=t,s=1/(i||60),h=this.time+s,c.wake(),void 0):i},c.useRAF=function(t){return arguments.length?(c.sleep(),p=t,c.fps(i),void 0):p},c.fps(t),setTimeout(function(){p&&(!a||5>c.frame)&&c.useRAF(!1)},1500)}),s=c.Ticker.prototype=new c.events.EventDispatcher,s.constructor=c.Ticker;var E=y("core.Animation",function(t,e){if(this.vars=e=e||{},this._duration=this._totalDuration=t||0,this._delay=Number(e.delay)||0,this._timeScale=1,this._active=e.immediateRender===!0,this.data=e.data,this._reversed=e.reversed===!0,q){r||o.wake();var i=this.vars.useFrames?j:q;i.add(this,i._time),this.vars.paused&&this.paused(!0)}});o=E.ticker=new c.Ticker,s=E.prototype,s._dirty=s._gc=s._initted=s._paused=!1,s._totalTime=s._time=0,s._rawPrevTime=-1,s._next=s._last=s._onUpdate=s._timeline=s.timeline=null,s._paused=!1;var A=function(){r&&S()-I>2e3&&o.wake(),setTimeout(A,2e3)};A(),s.play=function(t,e){return null!=t&&this.seek(t,e),this.reversed(!1).paused(!1)},s.pause=function(t,e){return null!=t&&this.seek(t,e),this.paused(!0)},s.resume=function(t,e){return null!=t&&this.seek(t,e),this.paused(!1)},s.seek=function(t,e){return this.totalTime(Number(t),e!==!1)},s.restart=function(t,e){return this.reversed(!1).paused(!1).totalTime(t?-this._delay:0,e!==!1,!0)},s.reverse=function(t,e){return null!=t&&this.seek(t||this.totalDuration(),e),this.reversed(!0).paused(!1)},s.render=function(){},s.invalidate=function(){return this._time=this._totalTime=0,this._initted=this._gc=!1,this._rawPrevTime=-1,(this._gc||!this.timeline)&&this._enabled(!0),this},s.isActive=function(){var t,e=this._timeline,i=this._startTime;return!e||!this._gc&&!this._paused&&e.isActive()&&(t=e.rawTime())>=i&&i+this.totalDuration()/this._timeScale>t},s._enabled=function(t,e){return r||o.wake(),this._gc=!t,this._active=this.isActive(),e!==!0&&(t&&!this.timeline?this._timeline.add(this,this._startTime-this._delay):!t&&this.timeline&&this._timeline._remove(this,!0)),!1},s._kill=function(){return this._enabled(!1,!1)},s.kill=function(t,e){return this._kill(t,e),this},s._uncache=function(t){for(var e=t?this:this.timeline;e;)e._dirty=!0,e=e.timeline;return this},s._swapSelfInParams=function(t){for(var e=t.length,i=t.concat();--e>-1;)"{self}"===t[e]&&(i[e]=this);return i},s.eventCallback=function(t,e,i,n){if("on"===(t||"").substr(0,2)){var a=this.vars;if(1===arguments.length)return a[t];null==e?delete a[t]:(a[t]=e,a[t+"Params"]=p(i)&&-1!==i.join("").indexOf("{self}")?this._swapSelfInParams(i):i,a[t+"Scope"]=n),"onUpdate"===t&&(this._onUpdate=e)}return this},s.delay=function(t){return arguments.length?(this._timeline.smoothChildTiming&&this.startTime(this._startTime+t-this._delay),this._delay=t,this):this._delay},s.duration=function(t){return arguments.length?(this._duration=this._totalDuration=t,this._uncache(!0),this._timeline.smoothChildTiming&&this._time>0&&this._time<this._duration&&0!==t&&this.totalTime(this._totalTime*(t/this._duration),!0),this):(this._dirty=!1,this._duration)},s.totalDuration=function(t){return this._dirty=!1,arguments.length?this.duration(t):this._totalDuration},s.time=function(t,e){return arguments.length?(this._dirty&&this.totalDuration(),this.totalTime(t>this._duration?this._duration:t,e)):this._time},s.totalTime=function(t,e,i){if(r||o.wake(),!arguments.length)return this._totalTime;if(this._timeline){if(0>t&&!i&&(t+=this.totalDuration()),this._timeline.smoothChildTiming){this._dirty&&this.totalDuration();var n=this._totalDuration,a=this._timeline;if(t>n&&!i&&(t=n),this._startTime=(this._paused?this._pauseTime:a._time)-(this._reversed?n-t:t)/this._timeScale,a._dirty||this._uncache(!1),a._timeline)for(;a._timeline;)a._timeline._time!==(a._startTime+a._totalTime)/a._timeScale&&a.totalTime(a._totalTime,!0),a=a._timeline}this._gc&&this._enabled(!0,!1),(this._totalTime!==t||0===this._duration)&&(this.render(t,e,!1),B.length&&X())}return this},s.progress=s.totalProgress=function(t,e){return arguments.length?this.totalTime(this.duration()*t,e):this._time/this.duration()},s.startTime=function(t){return arguments.length?(t!==this._startTime&&(this._startTime=t,this.timeline&&this.timeline._sortChildren&&this.timeline.add(this,t-this._delay)),this):this._startTime},s.endTime=function(t){return this._startTime+(0!=t?this.totalDuration():this.duration())/this._timeScale},s.timeScale=function(t){if(!arguments.length)return this._timeScale;if(t=t||l,this._timeline&&this._timeline.smoothChildTiming){var e=this._pauseTime,i=e||0===e?e:this._timeline.totalTime();this._startTime=i-(i-this._startTime)*this._timeScale/t}return this._timeScale=t,this._uncache(!1)},s.reversed=function(t){return arguments.length?(t!=this._reversed&&(this._reversed=t,this.totalTime(this._timeline&&!this._timeline.smoothChildTiming?this.totalDuration()-this._totalTime:this._totalTime,!0)),this):this._reversed},s.paused=function(t){if(!arguments.length)return this._paused;if(t!=this._paused&&this._timeline){r||t||o.wake();var e=this._timeline,i=e.rawTime(),n=i-this._pauseTime;!t&&e.smoothChildTiming&&(this._startTime+=n,this._uncache(!1)),this._pauseTime=t?i:null,this._paused=t,this._active=this.isActive(),!t&&0!==n&&this._initted&&this.duration()&&this.render(e.smoothChildTiming?this._totalTime:(i-this._startTime)/this._timeScale,!0,!0)}return this._gc&&!t&&this._enabled(!0,!1),this};var C=y("core.SimpleTimeline",function(t){E.call(this,0,t),this.autoRemoveChildren=this.smoothChildTiming=!0});s=C.prototype=new E,s.constructor=C,s.kill()._gc=!1,s._first=s._last=s._recent=null,s._sortChildren=!1,s.add=s.insert=function(t,e){var i,n;if(t._startTime=Number(e||0)+t._delay,t._paused&&this!==t._timeline&&(t._pauseTime=t._startTime+(this.rawTime()-t._startTime)/t._timeScale),t.timeline&&t.timeline._remove(t,!0),t.timeline=t._timeline=this,t._gc&&t._enabled(!0,!0),i=this._last,this._sortChildren)for(n=t._startTime;i&&i._startTime>n;)i=i._prev;return i?(t._next=i._next,i._next=t):(t._next=this._first,this._first=t),t._next?t._next._prev=t:this._last=t,t._prev=i,this._recent=t,this._timeline&&this._uncache(!0),this},s._remove=function(t,e){return t.timeline===this&&(e||t._enabled(!1,!0),t._prev?t._prev._next=t._next:this._first===t&&(this._first=t._next),t._next?t._next._prev=t._prev:this._last===t&&(this._last=t._prev),t._next=t._prev=t.timeline=null,t===this._recent&&(this._recent=this._last),this._timeline&&this._uncache(!0)),this},s.render=function(t,e,i){var n,a=this._first;for(this._totalTime=this._time=this._rawPrevTime=t;a;)n=a._next,(a._active||t>=a._startTime&&!a._paused)&&(a._reversed?a.render((a._dirty?a.totalDuration():a._totalDuration)-(t-a._startTime)*a._timeScale,e,i):a.render((t-a._startTime)*a._timeScale,e,i)),a=n},s.rawTime=function(){return r||o.wake(),this._totalTime};var R=y("TweenLite",function(e,i,n){if(E.call(this,i,n),this.render=R.prototype.render,null==e)throw"Cannot tween a null target.";this.target=e="string"!=typeof e?e:R.selector(e)||e;var a,s,o,r=e.jquery||e.length&&e!==t&&e[0]&&(e[0]===t||e[0].nodeType&&e[0].style&&!e.nodeType),h=this.vars.overwrite;if(this._overwrite=h=null==h?z[R.defaultOverwrite]:"number"==typeof h?h>>0:z[h],(r||e instanceof Array||e.push&&p(e))&&"number"!=typeof e[0])for(this._targets=o=u(e),this._propLookup=[],this._siblings=[],a=0;o.length>a;a++)s=o[a],s?"string"!=typeof s?s.length&&s!==t&&s[0]&&(s[0]===t||s[0].nodeType&&s[0].style&&!s.nodeType)?(o.splice(a--,1),this._targets=o=o.concat(u(s))):(this._siblings[a]=Y(s,this,!1),1===h&&this._siblings[a].length>1&&H(s,this,null,1,this._siblings[a])):(s=o[a--]=R.selector(s),"string"==typeof s&&o.splice(a+1,1)):o.splice(a--,1);else this._propLookup={},this._siblings=Y(e,this,!1),1===h&&this._siblings.length>1&&H(e,this,null,1,this._siblings);(this.vars.immediateRender||0===i&&0===this._delay&&this.vars.immediateRender!==!1)&&(this._time=-l,this.render(-this._delay))},!0),P=function(e){return e&&e.length&&e!==t&&e[0]&&(e[0]===t||e[0].nodeType&&e[0].style&&!e.nodeType)},L=function(t,e){var i,n={};for(i in t)O[i]||i in e&&"transform"!==i&&"x"!==i&&"y"!==i&&"width"!==i&&"height"!==i&&"className"!==i&&"border"!==i||!(!V[i]||V[i]&&V[i]._autoCSS)||(n[i]=t[i],delete t[i]);t.css=n};s=R.prototype=new E,s.constructor=R,s.kill()._gc=!1,s.ratio=0,s._firstPT=s._targets=s._overwrittenProps=s._startAt=null,s._notifyPluginsOfEnabled=s._lazy=!1,R.version="1.15.1",R.defaultEase=s._ease=new x(null,null,1,1),R.defaultOverwrite="auto",R.ticker=o,R.autoSleep=!0,R.lagSmoothing=function(t,e){o.lagSmoothing(t,e)},R.selector=t.$||t.jQuery||function(e){var i=t.$||t.jQuery;return i?(R.selector=i,i(e)):"undefined"==typeof document?e:document.querySelectorAll?document.querySelectorAll(e):document.getElementById("#"===e.charAt(0)?e.substr(1):e)};var B=[],U={},k=R._internals={isArray:p,isSelector:P,lazyTweens:B},V=R._plugins={},N=k.tweenLookup={},F=0,O=k.reservedProps={ease:1,delay:1,overwrite:1,onComplete:1,onCompleteParams:1,onCompleteScope:1,useFrames:1,runBackwards:1,startAt:1,onUpdate:1,onUpdateParams:1,onUpdateScope:1,onStart:1,onStartParams:1,onStartScope:1,onReverseComplete:1,onReverseCompleteParams:1,onReverseCompleteScope:1,onRepeat:1,onRepeatParams:1,onRepeatScope:1,easeParams:1,yoyo:1,immediateRender:1,repeat:1,repeatDelay:1,data:1,paused:1,reversed:1,autoCSS:1,lazy:1,onOverwrite:1},z={none:0,all:1,auto:2,concurrent:3,allOnStart:4,preexisting:5,"true":1,"false":0},j=E._rootFramesTimeline=new C,q=E._rootTimeline=new C,X=k.lazyRender=function(){var t,e=B.length;for(U={};--e>-1;)t=B[e],t&&t._lazy!==!1&&(t.render(t._lazy[0],t._lazy[1],!0),t._lazy=!1);B.length=0};q._startTime=o.time,j._startTime=o.frame,q._active=j._active=!0,setTimeout(X,1),E._updateRoot=R.render=function(){var t,e,i;if(B.length&&X(),q.render((o.time-q._startTime)*q._timeScale,!1,!1),j.render((o.frame-j._startTime)*j._timeScale,!1,!1),B.length&&X(),!(o.frame%120)){for(i in N){for(e=N[i].tweens,t=e.length;--t>-1;)e[t]._gc&&e.splice(t,1);0===e.length&&delete N[i]}if(i=q._first,(!i||i._paused)&&R.autoSleep&&!j._first&&1===o._listeners.tick.length){for(;i&&i._paused;)i=i._next;i||o.sleep()}}},o.addEventListener("tick",E._updateRoot);var Y=function(t,e,i){var n,a,s=t._gsTweenID;if(N[s||(t._gsTweenID=s="t"+F++)]||(N[s]={target:t,tweens:[]}),e&&(n=N[s].tweens,n[a=n.length]=e,i))for(;--a>-1;)n[a]===e&&n.splice(a,1);return N[s].tweens},W=function(t,e,i,n){var a,s,o=t.vars.onOverwrite;return o&&(a=o(t,e,i,n)),o=R.onOverwrite,o&&(s=o(t,e,i,n)),a!==!1&&s!==!1},H=function(t,e,i,n,a){var s,o,r,h;if(1===n||n>=4){for(h=a.length,s=0;h>s;s++)if((r=a[s])!==e)r._gc||W(r,e)&&r._enabled(!1,!1)&&(o=!0);else if(5===n)break;return o}var c,u=e._startTime+l,d=[],p=0,_=0===e._duration;for(s=a.length;--s>-1;)(r=a[s])===e||r._gc||r._paused||(r._timeline!==e._timeline?(c=c||G(e,0,_),0===G(r,c,_)&&(d[p++]=r)):u>=r._startTime&&r._startTime+r.totalDuration()/r._timeScale>u&&((_||!r._initted)&&2e-10>=u-r._startTime||(d[p++]=r)));for(s=p;--s>-1;)if(r=d[s],2===n&&r._kill(i,t,e)&&(o=!0),2!==n||!r._firstPT&&r._initted){if(2!==n&&!W(r,e))continue;r._enabled(!1,!1)&&(o=!0)}return o},G=function(t,e,i){for(var n=t._timeline,a=n._timeScale,s=t._startTime;n._timeline;){if(s+=n._startTime,a*=n._timeScale,n._paused)return-100;n=n._timeline}return s/=a,s>e?s-e:i&&s===e||!t._initted&&2*l>s-e?l:(s+=t.totalDuration()/t._timeScale/a)>e+l?0:s-e-l};s._init=function(){var t,e,i,n,a,s=this.vars,o=this._overwrittenProps,r=this._duration,h=!!s.immediateRender,c=s.ease;if(s.startAt){this._startAt&&(this._startAt.render(-1,!0),this._startAt.kill()),a={};for(n in s.startAt)a[n]=s.startAt[n];if(a.overwrite=!1,a.immediateRender=!0,a.lazy=h&&s.lazy!==!1,a.startAt=a.delay=null,this._startAt=R.to(this.target,0,a),h)if(this._time>0)this._startAt=null;else if(0!==r)return}else if(s.runBackwards&&0!==r)if(this._startAt)this._startAt.render(-1,!0),this._startAt.kill(),this._startAt=null;else{0!==this._time&&(h=!1),i={};for(n in s)O[n]&&"autoCSS"!==n||(i[n]=s[n]);if(i.overwrite=0,i.data="isFromStart",i.lazy=h&&s.lazy!==!1,i.immediateRender=h,this._startAt=R.to(this.target,0,i),h){if(0===this._time)return}else this._startAt._init(),this._startAt._enabled(!1),this.vars.immediateRender&&(this._startAt=null)}if(this._ease=c=c?c instanceof x?c:"function"==typeof c?new x(c,s.easeParams):b[c]||R.defaultEase:R.defaultEase,s.easeParams instanceof Array&&c.config&&(this._ease=c.config.apply(c,s.easeParams)),this._easeType=this._ease._type,this._easePower=this._ease._power,this._firstPT=null,this._targets)for(t=this._targets.length;--t>-1;)this._initProps(this._targets[t],this._propLookup[t]={},this._siblings[t],o?o[t]:null)&&(e=!0);else e=this._initProps(this.target,this._propLookup,this._siblings,o);if(e&&R._onPluginEvent("_onInitAllProps",this),o&&(this._firstPT||"function"!=typeof this.target&&this._enabled(!1,!1)),s.runBackwards)for(i=this._firstPT;i;)i.s+=i.c,i.c=-i.c,i=i._next;this._onUpdate=s.onUpdate,this._initted=!0},s._initProps=function(e,i,n,a){var s,o,r,h,c,l;if(null==e)return!1;U[e._gsTweenID]&&X(),this.vars.css||e.style&&e!==t&&e.nodeType&&V.css&&this.vars.autoCSS!==!1&&L(this.vars,e);for(s in this.vars){if(l=this.vars[s],O[s])l&&(l instanceof Array||l.push&&p(l))&&-1!==l.join("").indexOf("{self}")&&(this.vars[s]=l=this._swapSelfInParams(l,this));else if(V[s]&&(h=new V[s])._onInitTween(e,this.vars[s],this)){for(this._firstPT=c={_next:this._firstPT,t:h,p:"setRatio",s:0,c:1,f:!0,n:s,pg:!0,pr:h._priority},o=h._overwriteProps.length;--o>-1;)i[h._overwriteProps[o]]=this._firstPT;(h._priority||h._onInitAllProps)&&(r=!0),(h._onDisable||h._onEnable)&&(this._notifyPluginsOfEnabled=!0)}else this._firstPT=i[s]=c={_next:this._firstPT,t:e,p:s,f:"function"==typeof e[s],n:s,pg:!1,pr:0},c.s=c.f?e[s.indexOf("set")||"function"!=typeof e["get"+s.substr(3)]?s:"get"+s.substr(3)]():parseFloat(e[s]),c.c="string"==typeof l&&"="===l.charAt(1)?parseInt(l.charAt(0)+"1",10)*Number(l.substr(2)):Number(l)-c.s||0;c&&c._next&&(c._next._prev=c)}return a&&this._kill(a,e)?this._initProps(e,i,n,a):this._overwrite>1&&this._firstPT&&n.length>1&&H(e,this,i,this._overwrite,n)?(this._kill(i,e),this._initProps(e,i,n,a)):(this._firstPT&&(this.vars.lazy!==!1&&this._duration||this.vars.lazy&&!this._duration)&&(U[e._gsTweenID]=!0),r)},s.render=function(t,e,i){var n,a,s,o,r=this._time,h=this._duration,c=this._rawPrevTime;if(t>=h)this._totalTime=this._time=h,this.ratio=this._ease._calcEnd?this._ease.getRatio(1):1,this._reversed||(n=!0,a="onComplete"),0===h&&(this._initted||!this.vars.lazy||i)&&(this._startTime===this._timeline._duration&&(t=0),(0===t||0>c||c===l&&"isPause"!==this.data)&&c!==t&&(i=!0,c>l&&(a="onReverseComplete")),this._rawPrevTime=o=!e||t||c===t?t:l);else if(1e-7>t)this._totalTime=this._time=0,this.ratio=this._ease._calcEnd?this._ease.getRatio(0):0,(0!==r||0===h&&c>0&&c!==l)&&(a="onReverseComplete",n=this._reversed),0>t&&(this._active=!1,0===h&&(this._initted||!this.vars.lazy||i)&&(c>=0&&(c!==l||"isPause"!==this.data)&&(i=!0),this._rawPrevTime=o=!e||t||c===t?t:l)),this._initted||(i=!0);else if(this._totalTime=this._time=t,this._easeType){var u=t/h,d=this._easeType,p=this._easePower;(1===d||3===d&&u>=.5)&&(u=1-u),3===d&&(u*=2),1===p?u*=u:2===p?u*=u*u:3===p?u*=u*u*u:4===p&&(u*=u*u*u*u),this.ratio=1===d?1-u:2===d?u:.5>t/h?u/2:1-u/2}else this.ratio=this._ease.getRatio(t/h);if(this._time!==r||i){if(!this._initted){if(this._init(),!this._initted||this._gc)return;if(!i&&this._firstPT&&(this.vars.lazy!==!1&&this._duration||this.vars.lazy&&!this._duration))return this._time=this._totalTime=r,this._rawPrevTime=c,B.push(this),this._lazy=[t,e],void 0;this._time&&!n?this.ratio=this._ease.getRatio(this._time/h):n&&this._ease._calcEnd&&(this.ratio=this._ease.getRatio(0===this._time?0:1))}for(this._lazy!==!1&&(this._lazy=!1),this._active||!this._paused&&this._time!==r&&t>=0&&(this._active=!0),0===r&&(this._startAt&&(t>=0?this._startAt.render(t,e,i):a||(a="_dummyGS")),this.vars.onStart&&(0!==this._time||0===h)&&(e||this.vars.onStart.apply(this.vars.onStartScope||this,this.vars.onStartParams||v))),s=this._firstPT;s;)s.f?s.t[s.p](s.c*this.ratio+s.s):s.t[s.p]=s.c*this.ratio+s.s,s=s._next;this._onUpdate&&(0>t&&this._startAt&&t!==-1e-4&&this._startAt.render(t,e,i),e||(this._time!==r||n)&&this._onUpdate.apply(this.vars.onUpdateScope||this,this.vars.onUpdateParams||v)),a&&(!this._gc||i)&&(0>t&&this._startAt&&!this._onUpdate&&t!==-1e-4&&this._startAt.render(t,e,i),n&&(this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),!e&&this.vars[a]&&this.vars[a].apply(this.vars[a+"Scope"]||this,this.vars[a+"Params"]||v),0===h&&this._rawPrevTime===l&&o!==l&&(this._rawPrevTime=0))}},s._kill=function(t,e,i){if("all"===t&&(t=null),null==t&&(null==e||e===this.target))return this._lazy=!1,this._enabled(!1,!1);e="string"!=typeof e?e||this._targets||this.target:R.selector(e)||e;var n,a,s,o,r,h,c,l,u;if((p(e)||P(e))&&"number"!=typeof e[0])for(n=e.length;--n>-1;)this._kill(t,e[n])&&(h=!0);else{if(this._targets){for(n=this._targets.length;--n>-1;)if(e===this._targets[n]){r=this._propLookup[n]||{},this._overwrittenProps=this._overwrittenProps||[],a=this._overwrittenProps[n]=t?this._overwrittenProps[n]||{}:"all";break}}else{if(e!==this.target)return!1;r=this._propLookup,a=this._overwrittenProps=t?this._overwrittenProps||{}:"all"}if(r){if(c=t||r,l=t!==a&&"all"!==a&&t!==r&&("object"!=typeof t||!t._tempKill),i&&(R.onOverwrite||this.vars.onOverwrite)){for(s in c)r[s]&&(u||(u=[]),u.push(s));if(!W(this,i,e,u))return!1}for(s in c)(o=r[s])&&(o.pg&&o.t._kill(c)&&(h=!0),o.pg&&0!==o.t._overwriteProps.length||(o._prev?o._prev._next=o._next:o===this._firstPT&&(this._firstPT=o._next),o._next&&(o._next._prev=o._prev),o._next=o._prev=null),delete r[s]),l&&(a[s]=1);!this._firstPT&&this._initted&&this._enabled(!1,!1)}}return h},s.invalidate=function(){return this._notifyPluginsOfEnabled&&R._onPluginEvent("_onDisable",this),this._firstPT=this._overwrittenProps=this._startAt=this._onUpdate=null,this._notifyPluginsOfEnabled=this._active=this._lazy=!1,this._propLookup=this._targets?{}:[],E.prototype.invalidate.call(this),this.vars.immediateRender&&(this._time=-l,this.render(-this._delay)),this},s._enabled=function(t,e){if(r||o.wake(),t&&this._gc){var i,n=this._targets;if(n)for(i=n.length;--i>-1;)this._siblings[i]=Y(n[i],this,!0);else this._siblings=Y(this.target,this,!0)}return E.prototype._enabled.call(this,t,e),this._notifyPluginsOfEnabled&&this._firstPT?R._onPluginEvent(t?"_onEnable":"_onDisable",this):!1},R.to=function(t,e,i){return new R(t,e,i)},R.from=function(t,e,i){return i.runBackwards=!0,i.immediateRender=0!=i.immediateRender,new R(t,e,i)},R.fromTo=function(t,e,i,n){return n.startAt=i,n.immediateRender=0!=n.immediateRender&&0!=i.immediateRender,new R(t,e,n)},R.delayedCall=function(t,e,i,n,a){return new R(e,0,{delay:t,onComplete:e,onCompleteParams:i,onCompleteScope:n,onReverseComplete:e,onReverseCompleteParams:i,onReverseCompleteScope:n,immediateRender:!1,lazy:!1,useFrames:a,overwrite:0})},R.set=function(t,e){return new R(t,0,e)},R.getTweensOf=function(t,e){if(null==t)return[];t="string"!=typeof t?t:R.selector(t)||t;var i,n,a,s;if((p(t)||P(t))&&"number"!=typeof t[0]){for(i=t.length,n=[];--i>-1;)n=n.concat(R.getTweensOf(t[i],e));for(i=n.length;--i>-1;)for(s=n[i],a=i;--a>-1;)s===n[a]&&n.splice(i,1)
}else for(n=Y(t).concat(),i=n.length;--i>-1;)(n[i]._gc||e&&!n[i].isActive())&&n.splice(i,1);return n},R.killTweensOf=R.killDelayedCallsTo=function(t,e,i){"object"==typeof e&&(i=e,e=!1);for(var n=R.getTweensOf(t,e),a=n.length;--a>-1;)n[a]._kill(i,t)};var Z=y("plugins.TweenPlugin",function(t,e){this._overwriteProps=(t||"").split(","),this._propName=this._overwriteProps[0],this._priority=e||0,this._super=Z.prototype},!0);if(s=Z.prototype,Z.version="1.10.1",Z.API=2,s._firstPT=null,s._addTween=function(t,e,i,n,a,s){var o,r;return null!=n&&(o="number"==typeof n||"="!==n.charAt(1)?Number(n)-i:parseInt(n.charAt(0)+"1",10)*Number(n.substr(2)))?(this._firstPT=r={_next:this._firstPT,t:t,p:e,s:i,c:o,f:"function"==typeof t[e],n:a||e,r:s},r._next&&(r._next._prev=r),r):void 0},s.setRatio=function(t){for(var e,i=this._firstPT,n=1e-6;i;)e=i.c*t+i.s,i.r?e=Math.round(e):n>e&&e>-n&&(e=0),i.f?i.t[i.p](e):i.t[i.p]=e,i=i._next},s._kill=function(t){var e,i=this._overwriteProps,n=this._firstPT;if(null!=t[this._propName])this._overwriteProps=[];else for(e=i.length;--e>-1;)null!=t[i[e]]&&i.splice(e,1);for(;n;)null!=t[n.n]&&(n._next&&(n._next._prev=n._prev),n._prev?(n._prev._next=n._next,n._prev=null):this._firstPT===n&&(this._firstPT=n._next)),n=n._next;return!1},s._roundProps=function(t,e){for(var i=this._firstPT;i;)(t[this._propName]||null!=i.n&&t[i.n.split(this._propName+"_").join("")])&&(i.r=e),i=i._next},R._onPluginEvent=function(t,e){var i,n,a,s,o,r=e._firstPT;if("_onInitAllProps"===t){for(;r;){for(o=r._next,n=a;n&&n.pr>r.pr;)n=n._next;(r._prev=n?n._prev:s)?r._prev._next=r:a=r,(r._next=n)?n._prev=r:s=r,r=o}r=e._firstPT=a}for(;r;)r.pg&&"function"==typeof r.t[t]&&r.t[t]()&&(i=!0),r=r._next;return i},Z.activate=function(t){for(var e=t.length;--e>-1;)t[e].API===Z.API&&(V[(new t[e])._propName]=t[e]);return!0},m.plugin=function(t){if(!(t&&t.propName&&t.init&&t.API))throw"illegal plugin definition.";var e,i=t.propName,n=t.priority||0,a=t.overwriteProps,s={init:"_onInitTween",set:"setRatio",kill:"_kill",round:"_roundProps",initAll:"_onInitAllProps"},o=y("plugins."+i.charAt(0).toUpperCase()+i.substr(1)+"Plugin",function(){Z.call(this,i,n),this._overwriteProps=a||[]},t.global===!0),r=o.prototype=new Z(i);r.constructor=o,o.API=t.API;for(e in s)"function"==typeof t[e]&&(r[s[e]]=t[e]);return o.version=t.version,Z.activate([o]),o},n=t._gsQueue){for(a=0;n.length>a;a++)n[a]();for(s in _)_[s].func||t.console.log("GSAP encountered missing dependency: com.greensock."+s)}r=!1}})("undefined"!=typeof module&&module.exports&&"undefined"!=typeof global?global:this||window,"TweenLite");var Server=function(){function t(){this._serverScenePoint=new ServerScenePoint,this._charList=[]}return t.prototype.onMessage=function(t){if(1==t.id){for(var e=this._serverScenePoint.getPointAry(t.data),i=[],n=0;e.length>n;n++){var a=new ServerChar;a.server=this,a.id=n,a.setPoint(e[n]),a.url="role/gou/gou.txt",a.standurl="role/gou/act/stand.txt",a.attackurl="role/gou/act/attack.txt",a.deathurl="role/gou/act/death.txt",this._charList.push(a),i.push(a.getObj())}var s={};s.id=2,s.data=i,this.postMessage(s)}else 3==t.id?this.processAttack(t.data):0==t.id&&this.processMainChar(t.data)},t.prototype.processMainChar=function(t){for(var e=0;this._charList.length>e;e++)this._charList[e].resetAttack(t),this._charList[e].update()},t.prototype.processAttack=function(t){for(var e=t.type,i=0;this._charList.length>i;i++){var n=this._charList[i].testAttack(t);0==e||1==e?60>=n&&this._charList[i].beAttack(30):2==e?30>=n&&this._charList[i].beAttack(120):3==e&&90>=n&&this._charList[i].beAttack(55)}},t.prototype.postMessage=function(t){this.worker.postMessage(t)},t}(),ServerChar=function(){function t(){this.x=0,this.y=0,this.z=0,this.id=0,this.hp=100,this.state=0,this.deathTime=0}return t.prototype.setPoint=function(t){this.x=t.x,this.y=t.y,this.z=t.z},t.prototype.update=function(){2==this.state&&(this.deathTime++,this.deathTime>=10&&(this.sendDefault(),this.state=1,this.hp=100,this.deathTime=0))},t.prototype.resetAttack=function(t){1==this.state&&this.getDistance(t)>50&&(this.sendDefault(),this.state=0)},t.prototype.getDistance=function(t){var e=this.x-t.x,i=this.z-t.z;return Math.sqrt(e*e+i*i)},t.prototype.beAttack=function(t){this.hp-=t,0>this.hp?(this.sendDeath(),this.state=2):1!=this.state&&(this.sendAttack(),this.state=1)},t.prototype.sendAttack=function(){var t={};t.id=4,t.data={id:this.id,state:1},server.postMessage(t)},t.prototype.sendDefault=function(){var t={};t.id=4,t.data={id:this.id,state:0},server.postMessage(t)},t.prototype.sendDeath=function(){var t={};t.id=4,t.data={id:this.id,state:2},server.postMessage(t)},t.prototype.testAttack=function(t){var e=t.pos,i=this.x-e.x,n=this.z-e.z,a=Math.sqrt(i*i+n*n);if(50>a){i/=a,n/=a;var s=180*(Math.asin(i)/Math.PI);0>=n&&(s=180-s);var o=t.rotation;o=(o%360+360)%360,s=(s%360+360)%360;var r=Math.abs(o-s);return r>180&&(r=360-r),r}return 180},t.prototype.getObj=function(){var t={};return t.id=this.id,t.x=this.x,t.y=this.y,t.z=this.z,t.url=this.url,t.standurl=this.standurl,t.attackurl=this.attackurl,t.deathurl=this.deathurl,t},t}(),ServerScenePoint=function(){function t(){this.mapDic={},this.init()}return t.prototype.init=function(){this.init1(),this.init2()},t.prototype.init1=function(){var t=[];t.push({x:0,z:0,y:0}),t.push({x:-26,z:-43,y:0}),t.push({x:72,z:30,y:0}),this.mapDic["1.txt"]=t},t.prototype.init2=function(){var t=[];this.mapDic["mobile_00.txt"]=t},t.prototype.getPointAry=function(t){return this.mapDic[t]},t}(),server;onmessage=function(t){var e=t.data;server||init(),server.onMessage(e)};var ServerManager=function(){function t(){this.enable=!1}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.init=function(){var t=this;this.enable&&(this._serverWorker=new Worker("server/ServerWorker.js"),this._serverWorker.addEventListener("message",function(e){t.workerBack(e)}),setInterval(function(){var e={};e.id=0,e.data={x:GameInstance.mainChar.x,y:GameInstance.mainChar.y,z:GameInstance.mainChar.z},t.postMessage(e)},1e3))},t.prototype.postMessage=function(t){this.enable&&this._serverWorker.postMessage(t)},t.prototype.workerBack=function(t){var e=t.data;NetManager.getInstance().onMessage(e)},t}(),BaoshiMeshVo=function(){function t(){}return t}(),EquMeshVo=function(){function t(){var e=float2int(t.nameArr.length*Math.random());this.name=t.nameArr[e],this.zl=float2int(99999*Math.random()),this.zbpj=float2int(99*Math.random()),this.qhdj=float2int(99*Math.random()),this.jcgj=float2int(99999*Math.random()),this.qhgj=float2int(99999*Math.random()),this.txt0=float2int(100*Math.random())+"",this.txt1=float2int(100*Math.random())+""+"/"+(float2int(100*Math.random())+""),this.txt2=float2int(999*Math.random())+"",this.txt3=float2int(999*Math.random())+"",this.txt4=float2int(100*Math.random())+"",this.txt5=float2int(100*Math.random())+""+"/"+(float2int(100*Math.random())+""),this.txt6=float2int(999*Math.random())+"",this.txt7=float2int(999*Math.random())+"",this.bigIconUrl="ui/eqicon/qi00"+float2int(4*Math.random())+".png"}return t.nameArr=["铁鞭","石子镖","流星锤","金锁甲","网羽","绝刃"],t}(),ChengjiuMeshVo=function(){function t(){}return t}(),RoleMeshVo=function(){function t(){}return t}(),MakeFontClass=function(){function t(){this.fontData=new Dictionary([]),this.makeBigGreenNum(),this.makeYellow12pxNum(),this.makeWhite12pxNum(),this.makeRed12pxNum(),this.makeGreen12pxNum()}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.makeBigGreenNum=function(){var t=[];t.push(new Rectangle(1,341,21,25)),t.push(new Rectangle(25,341,17,25)),t.push(new Rectangle(47,341,19,25)),t.push(new Rectangle(70,341,19,25)),t.push(new Rectangle(94,341,20,25)),t.push(new Rectangle(120,341,19,25)),t.push(new Rectangle(143,341,19,25)),t.push(new Rectangle(164,341,19,25)),t.push(new Rectangle(187,341,19,25)),t.push(new Rectangle(210,341,19,25)),t.push(new Rectangle(238,341,18,25)),this.fontData.BigGreen=t},t.prototype.makeYellow12pxNum=function(){var t=[];t.push(new Rectangle(3,320,9,14)),t.push(new Rectangle(14,320,9,14)),t.push(new Rectangle(25,320,9,14)),t.push(new Rectangle(36,320,9,14)),t.push(new Rectangle(47,320,9,14)),t.push(new Rectangle(59,320,9,14)),t.push(new Rectangle(70,320,9,14)),t.push(new Rectangle(81,320,9,14)),t.push(new Rectangle(92.5,320,9,14)),t.push(new Rectangle(104,320,9,14)),t.push(new Rectangle(116,320,9,14)),t.push(new Rectangle(126,320,9,14)),t.push(new Rectangle(136,320,9,14)),t.push(new Rectangle(144,321,9,13)),t.push(new Rectangle(154,321,9,13)),this.fontData.Yellow=t},t.prototype.makeGreen12pxNum=function(){var t=[];t.push(new Rectangle(3,385,9,14)),t.push(new Rectangle(14,385,9,14)),t.push(new Rectangle(25,385,9,14)),t.push(new Rectangle(36,385,9,14)),t.push(new Rectangle(47,385,9,14)),t.push(new Rectangle(59,385,9,14)),t.push(new Rectangle(70,385,9,14)),t.push(new Rectangle(81,385,9,14)),t.push(new Rectangle(93,385,9,14)),t.push(new Rectangle(104,385,9,14)),t.push(new Rectangle(116,385,9,14)),t.push(new Rectangle(126,385,9,14)),t.push(new Rectangle(136,385,9,14)),this.fontData.Green=t},t.prototype.makeWhite12pxNum=function(){var t=[];t.push(new Rectangle(3,305,9,14)),t.push(new Rectangle(14,305,9,14)),t.push(new Rectangle(25,305,9,14)),t.push(new Rectangle(36,305,9,14)),t.push(new Rectangle(47,305,9,14)),t.push(new Rectangle(59,305,9,14)),t.push(new Rectangle(70,305,9,14)),t.push(new Rectangle(81,305,9,14)),t.push(new Rectangle(93,305,9,14)),t.push(new Rectangle(104,305,9,14)),t.push(new Rectangle(116,305,9,14)),t.push(new Rectangle(126,305,9,14)),t.push(new Rectangle(136,305,9,14)),this.fontData.White=t},t.prototype.makeRed12pxNum=function(){var t=[];t.push(new Rectangle(3,370,9,14)),t.push(new Rectangle(14,370,9,14)),t.push(new Rectangle(25,370,9,14)),t.push(new Rectangle(36,370,9,14)),t.push(new Rectangle(47,370,9,14)),t.push(new Rectangle(59,370,9,14)),t.push(new Rectangle(70,370,9,14)),t.push(new Rectangle(81,370,9,14)),t.push(new Rectangle(93,370,9,14)),t.push(new Rectangle(104,370,9,14)),t.push(new Rectangle(116,370,9,14)),t.push(new Rectangle(126,370,9,14)),t.push(new Rectangle(136,370,9,14)),this.fontData.Red=t},t.prototype.upBlueNum=function(e,i,n,a,s,o){void 0===a&&(a=12),void 0===s&&(s=t.White),void 0===o&&(o=TextAlign.LEFT);var r,h,c=a/12,l=this.fontData[s],u=0;for(r=0;n.length>r;r++){h=this.getCharId(n[r]);var d=l[h];u+=(d.width-2)*c}var p=e.getRec(i);e.ctx=UIManager.getInstance().getContext2D(p.pixelWitdh,p.pixelHeight,!1);var _=0;for(o==TextAlign.LEFT?_=0:o==TextAlign.RIGHT?_=p.pixelWitdh-u:o==TextAlign.CENTER&&(_=(p.pixelWitdh-u)/2),u=0,r=0;n.length>r;r++){h=this.getCharId(n[r]);var d=l[h];e.ctx.drawImage(EquUtil.uiListImg,d.x,d.y,d.width,d.height,u+_,0,d.width*c,d.height*c),u+=(d.width-2)*c}TextureManager.getInstance().updateTexture(e.texture,p.pixelX,p.pixelY,e.ctx)},t.prototype.getCharId=function(t){return"+"==t?10:"-"==t?11:"/"==t?12:":"==t?13:"."==t?14:(0/0==Number(t)&&alert("MeshVo,GetCharId error:"+t),Number(t))},t.prototype.upColorNum=function(t,e){for(var i=8/12,n=this.fontData.Green,a=0;n.length>a;a++)n[a].x+=0,n[a].y+=0;var s=t.getRec(e);t.ctx=UIManager.getInstance().getContext2D(s.pixelWitdh,s.pixelHeight,!1);for(var o=0,r=0;6>r;r++){var h=float2int(10*Math.random()),c=n[h];t.ctx.drawImage(EquUtil.uiListImg,c.x,c.y,c.width,c.height,o,0,c.width*i,c.height*i),o+=(c.width-2)*i}TextureManager.getInstance().updateTexture(t.texture,s.pixelX,s.pixelY,t.ctx)},t.Green="Green",t.White="White",t.Red="Red",t.Yellow="Yellow",t.BigGreen="BigGreen",t}(),CharAction=function(){function t(){}return t.STANAD="stand",t.WALK="walk",t.DEATH="death",t.ATTACK_01="attack_01",t.ATTACK_02="attack_02",t.ATTACK_03="attack_03",t.ATTACK_04="attack_04",t.ATTACK_05="attack_05",t.ATTACK_06="attack_06",t}(),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},EngineEvent=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.CREAT_SCENE_EVENT="creat_scene_event",e.CREAT_MAINCHAR_EVENT="creat_mainchar_event",e}(BaseEvent),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},LoginEvent=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.CREAT_LOGIN_UI_EVENT="creat_login_ui_event",e.REMOVE_LOGIN_UI_EVENT="remove_login_ui_event",e}(BaseEvent),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},MainUIEvent=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.CREAT_MAINUI_EVENT="creat_mainui_event",e.SHOW_MAINUI_EVENT="show_mainui_event",e}(BaseEvent),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},SceneLoadEvent=function(t){function e(){t.apply(this,arguments),this.progress=0}return __extends(e,t),e.SHOW_LOAD_EVENT="show_load_event",e.REMOVE_LOAD_EVENT="remove_load_event",e.PROGRESS_LOAD_EVENT="progress_load_event",e.ANALYSIS_LOAD_EVENT="analysis_load_event",e.INFO_EVENT="info_event",e}(BaseEvent),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},TestUIEvent=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.CREAT_TESTUI_EVENT="creat_testui_event",e.ADD_TESTUI_EVENT="add_testui_event",e.HIDE_TESTUI_EVENT="hide_testui_event",e}(BaseEvent),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},EquipmentEvent=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.INIT_EQU_EVENT="init_equ_event",e.SHOW_EQU_EVENT="show_equ_event",e.HIDE_EQU_EVENT="hide_equ_event",e}(BaseEvent),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},BgEvent=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.INIT_BG_EVENT="init_bg_event",e.SHOW_BG_EVENT="show_bg_event",e.HIDE_BG_EVENT="hide_bg_event",e.SHOW_EQU_INFO="show_equ_info",e}(BaseEvent),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},BattleEvent=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.BATTLE_START_EVENT="battle_start_event",e.BATTLE_INIT_EVENT="battle_init_event",e.BATTLE_END_EVENT="battle_end_event",e.BATTLE_RESTART_EVENT="battle_restart_event",e}(BaseEvent),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},BaseProcessor=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.sendToServer=function(t){NetManager.getInstance().sendToServer(t)},e}(Processor),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},SceneChar=function(t){function e(){t.call(this),this._watchFlag=!1,this.skillLock=!1,this.angerNum=0,this.life=0,this.index=0,this.shadow=!0}return __extends(e,t),Object.defineProperty(e.prototype,"speedDirect",{set:function(t){this._speedDirect=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"watchFlag",{set:function(t){this._watchFlag=t,this._rotationY=t?180:0},enumerable:!0,configurable:!0}),e.prototype.addRetinue=function(t,e){void 0===e&&(e=null),this.displayRetinue=new Display2dMovie,this.displayRetinue.setUrl("rolemovie/"+t+".png"),this.displayRetinue.initData(6,1,40/512,.3125,12),this.retinueList=[];var i;i=this._watchFlag?new Vector3D(this.x-20,this.y,this.z+30):new Vector3D(this.x-20,this.y,this.z-30);for(var n=0;2>n;n++)for(var a=0;3>a;a++){var s=new Movie3D;s.x=i.x+20*a,s.y=i.y,s.z=i.z+10*n,s.scale=.9,s.shadow=!0,s.retinueShadowFix=e,this.displayRetinue.addSun(s),this.retinueList.push(s)}},e.prototype.setRetinuePos=function(){var t,e=0;t=this._watchFlag?new Vector3D(this.x-20,this.y,this.z+30):new Vector3D(this.x-20,this.y,this.z-30);for(var i=0;2>i;i++)for(var n=0;3>n;n++){var a=this.retinueList[e];a.x=t.x+20*n,a.y=t.y,a.z=t.z+10*i,e++}},e.prototype.changePos=function(){this.displayRetinue&&this.setRetinuePos()},e.prototype.addStage=function(){t.prototype.addStage.call(this),this.displayRetinue&&SceneManager.getInstance().addDisplay2D(this.displayRetinue)},e.prototype.removeStage=function(){t.prototype.removeStage.call(this),this.displayRetinue&&SceneManager.getInstance().removeDisplay2D(this.displayRetinue)},e.prototype.play=function(e,i,n){return void 0===i&&(i=0),void 0===n&&(n=!0),this.displayRetinue&&n&&this.displayRetinue.play(e,i),t.prototype.play.call(this,e,i)},e.prototype.startMove=function(t){this._speedDirect=t,this._speedDirect.scaleBy(100),this.play(CharAction.WALK),this._enablePhysics},e.prototype.stopMove=function(){this._speedDirect=null,this.play(CharAction.STANAD),this._enablePhysics},e.prototype.update=function(){t.prototype.update.call(this)},e.prototype.watch=function(t){var e=t.x-this.x,i=t.z-this.z,n=Math.sqrt(e*e+i*i);e/=n,i/=n;var a=180*(Math.asin(e)/Math.PI);0>=i&&(a=180-a),this.rotationY=a},e}(Display3dMovie),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Net2C=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.NET_EVENT="net_event",e}(BaseEvent),Net2S=function(){function t(){}return t.prototype.getData=function(){return this.data},t}(),GameData=function(){function t(){}return t.needCreatChar=!0,t.roleInitPos=new Vector2D,t.mapQudaTreeDistance=200,t}(),GameInstance=function(){function t(){}return t.init=function(){EquUtil.init(t.initData)},t.initData=function(){if(GameData.needCreatChar){var e=new LoginEvent(LoginEvent.CREAT_LOGIN_UI_EVENT);ModuleEventManager.dispatchEvent(e)}else t.initMainScene()},t.addSceneChar=function(t){this.roleList.push(t),SceneManager.getInstance().addMovieDisplay(t)},t.removeSceneChar=function(t){var e=this.roleList.indexOf(t);-1!=e&&this.roleList.splice(e,1),SceneManager.getInstance().removeMovieDisplay(t)},t.getSceneCharByID=function(t){for(var e=0;this.roleList.length>e;e++)if(this.roleList[e].id==t)return this.roleList[e];return null},t.loadMainScene=function(){t.setMapData(),t.loadScene("slg_city",this.addMainUI),ModuleEventManager.dispatchEvent(new MainSceneEvent(MainSceneEvent.ADD_MAIN_SCENE))},t.initMainScene=function(){t.setMapData(),t.loadScene("slg_city",this.addMainUI),ModuleEventManager.dispatchEvent(new TestUIEvent(TestUIEvent.CREAT_TESTUI_EVENT)),ModuleEventManager.dispatchEvent(new BgEvent(BgEvent.INIT_BG_EVENT)),ModuleEventManager.dispatchEvent(new RoleEvent(RoleEvent.INIT_ROLE_EVENT)),ModuleEventManager.dispatchEvent(new FinishEvent(FinishEvent.INIT_FINISH_EVENT)),ModuleEventManager.dispatchEvent(new TaskEvent(TaskEvent.INIT_TASK_EVENT)),ModuleEventManager.dispatchEvent(new BattleEvent(BattleEvent.BATTLE_INIT_EVENT)),ModuleEventManager.dispatchEvent(new MainSceneEvent(MainSceneEvent.ADD_MAIN_SCENE))},t.test=function(){var t=new Display2dMovie;t.initData(6,1,40/512,.3125,12),t.setUrl("rolemovie/gjs_00.png"),t.play(CharAction.ATTACK_01),SceneManager.getInstance().addDisplay2D(t)},t.loadScene=function(e,i,n){void 0===i&&(i=null),void 0===n&&(n=null),t.mapName=e,KeyControlManager.getInstance().changeScene(),t.loadComplteFun=i,t.loadProgressFun=n;var a=new SceneLoadEvent(SceneLoadEvent.SHOW_LOAD_EVENT);ModuleEventManager.dispatchEvent(a);var s=new EngineEvent(EngineEvent.CREAT_SCENE_EVENT);s.sceneName=t.mapName,s.sceneLoadcomplteFun=t.mainSceneComplete,s.sceneAnylsizFun=t.mainSceneAnalysisComplete,s.sceneProgressFun=t.mainSceneProgress,ModuleEventManager.dispatchEvent(s)},t.setMapData=function(){Scene_data.focus3D.rotationY=45,Scene_data.focus3D.rotationX=-45,Scene_data.cam3D.distance=1400,Scene_data.focus3D.x=0,Scene_data.focus3D.z=0,Scene_data.focus3D.y=0,GameData.mapQudaTreeDistance=2e3},t.mainSceneAnalysisComplete=function(){t.loadComplteFun&&t.loadComplteFun();var e=new SceneLoadEvent(SceneLoadEvent.REMOVE_LOAD_EVENT);ModuleEventManager.dispatchEvent(e)},t.addMainUI=function(){var t=new TestUIEvent(TestUIEvent.ADD_TESTUI_EVENT);ModuleEventManager.dispatchEvent(t)},t.mainSceneComplete=function(){var t=new SceneLoadEvent(SceneLoadEvent.ANALYSIS_LOAD_EVENT);ModuleEventManager.dispatchEvent(t)},t.mainSceneProgress=function(e){t.loadProgressFun&&t.loadProgressFun(e);var i=new SceneLoadEvent(SceneLoadEvent.PROGRESS_LOAD_EVENT);i.progress=e,ModuleEventManager.dispatchEvent(i)},Object.defineProperty(t,"mainChar",{get:function(){return t._mainChar||(t._mainChar=new SceneChar,t._mainChar.y=-20),t._mainChar},enumerable:!0,configurable:!0}),t.roleList=[],t}(),FocusRect=function(){function t(t,e,i,n,a,s,o,r){this.centX=t,this.centZ=e,this.minx=i,this.minz=n,this.maxx=a,this.maxz=s,this.mindis=o,this.maxdis=r}return t}(),KeyControlManager=function(){function t(){this.focusRect=new FocusRect(0,0,-200,-200,200,200,500,1500),this.lastFopcus3DPos=new Object3D,this.lastMouseHit=new Object3D,this.lastRotationY=0,this._lastMousePos=new Vector3D,this._lastFocus=new Vector3D,this._isMouseDown=!1,this._lock=!1}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.init=function(){var t=this;Scene_data.uiBlankStage.addEventListener(InteractiveEvent.Down,this.onMouseDown,this),Scene_data.uiBlankStage.addEventListener(InteractiveEvent.Up,this.onMouseUp,this),Scene_data.uiBlankStage.addEventListener(InteractiveEvent.Move,this.onMouseMove,this),Scene_data.uiBlankStage.addEventListener(InteractiveEvent.PinchStart,this.onMousePinchStart,this),Scene_data.uiBlankStage.addEventListener(InteractiveEvent.Pinch,this.onMouseSwipe,this),document.addEventListener(MouseType.MouseWheel,function(e){t.onMouseWheel(e)})},t.prototype.changeScene=function(){switch(GameInstance.mapName){case"slg_city":this.focusRect=new FocusRect(0,0,-200,-200,200,200,500,1500);break;default:this.focusRect=new FocusRect(0,0,-40,-40,40,40,500,800)}},t.prototype.onMousePinchStart=function(){this.lastCamDis=Scene_data.cam3D.distance},t.prototype.onMouseSwipe=function(t){Math.max(.2,Math.min(t.data,2)),Scene_data.cam3D.distance=this.lastCamDis*(2-t.data),this.upData()},t.prototype.onMouseWheel=function(t){Scene_data.cam3D.distance+=t.wheelDelta/10},t.prototype.onMouseMove=function(t){if(this._isMouseDown){var e=Groundposition._getposition(Scene_data.cam3D,t.x,t.y);Scene_data.focus3D.x=this.lastFopcus3DPos.x-(e.x-this.lastMouseHit.x),Scene_data.focus3D.z=this.lastFopcus3DPos.z-(e.z-this.lastMouseHit.z)}this.upData()},t.prototype.upData=function(){this.focusRect&&(Scene_data.focus3D.x<this.focusRect.minx+this.focusRect.centX&&(Scene_data.focus3D.x=this.focusRect.minx+this.focusRect.centX),Scene_data.focus3D.x>this.focusRect.maxx+this.focusRect.centX&&(Scene_data.focus3D.x=this.focusRect.maxx+this.focusRect.centX),Scene_data.focus3D.z<this.focusRect.minz+this.focusRect.centZ&&(Scene_data.focus3D.z=this.focusRect.minz+this.focusRect.centZ),Scene_data.focus3D.z>this.focusRect.maxz+this.focusRect.centZ&&(Scene_data.focus3D.z=this.focusRect.maxz+this.focusRect.centZ)),Scene_data.cam3D.distance=Math.max(Scene_data.cam3D.distance,this.focusRect.mindis),Scene_data.cam3D.distance=Math.min(Scene_data.cam3D.distance,this.focusRect.maxdis)},t.prototype.addCentZ=function(t){Scene_data.focus3D.z+=t,this.focusRect.centZ+=t,this.upData()},t.prototype.onMouseDown=function(t){this._lastMousePos.x=t.x,this.lastRotationY=Scene_data.focus3D.rotationY,this._isMouseDown=!0,this.lastFopcus3DPos.x=Scene_data.focus3D.x,this.lastFopcus3DPos.y=Scene_data.focus3D.y,this.lastFopcus3DPos.z=Scene_data.focus3D.z,this.lastMouseHit=Groundposition._getposition(Scene_data.cam3D,t.x,t.y)},t.prototype.onMouseUp=function(){this._isMouseDown=!1},t}(),NetManager=function(){function t(){}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.sendToServer=function(t){ServerManager.getInstance().postMessage(t.data)},t.prototype.onMessage=function(t){var e=new Net2C(Net2C.NET_EVENT);e.id=t.id,e.data=t,ModuleEventManager.dispatchEvent(e)},t}(),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},EngineModule=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.getModuleName=function(){return"EngineModule"},e.prototype.listProcessors=function(){return[new EngineProcessor]},e}(Module),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},EngineProcessor=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.getName=function(){return"EngineProcessor"},e.prototype.receivedModuleEvent=function(t){if(t instanceof Net2C)return this.receiveNet(t.data),void 0;var e=t;if(e.type==EngineEvent.CREAT_SCENE_EVENT){var i="map/"+e.sceneName;SceneManager.getInstance().loadScene(i,e.sceneLoadcomplteFun,e.sceneProgressFun,e.sceneAnylsizFun,{url:"login/b.jpg",width:1024,height:512})}else e.type==EngineEvent.CREAT_MAINCHAR_EVENT&&(GameInstance.mainChar.id=-1,GameInstance.mainChar.setMeshUrl("role/niumo/niumo.txt"),GameInstance.mainChar.addAction(CharAction.WALK,"role/niumo/act/walk.txt",!0),GameInstance.mainChar.addAction(CharAction.STANAD,"role/niumo/act/stand.txt"),GameInstance.mainChar.addAction(CharAction.ATTACK_01,"role/niumo/act/attack_01.txt",!0),GameInstance.mainChar.addAction(CharAction.ATTACK_02,"role/niumo/act/attack_02.txt",!0),GameInstance.mainChar.addAction(CharAction.ATTACK_03,"role/niumo/act/attack_03.txt",!0),GameInstance.mainChar.addAction(CharAction.ATTACK_04,"role/niumo/act/attack_04.txt",!0),GameInstance.mainChar.addAction(CharAction.ATTACK_05,"role/niumo/act/attack_05.txt",!0),GameInstance.mainChar.addPart("wq","Bone_weapon_01_socket_1","role/bj/t3.txt"),GameInstance.mainChar.x=-90,GameInstance.mainChar.y=200,GameInstance.mainChar.z=200,GameInstance.mainChar.setCollision(10,20),SceneManager.getInstance().addMovieDisplay(GameInstance.mainChar))},e.prototype.receiveNet=function(t){if(2==t.id)for(var e=t.data,i=0;e.length>i;i++){var n=new SceneChar;n.id=e[i].id,n.setMeshUrl(e[i].url),n.x=e[i].x,n.y=e[i].y,n.z=e[i].z,n.rotationY=360*Math.random(),n.setCollision(10,20),n.addAction(CharAction.STANAD,e[i].standurl),n.addAction(CharAction.ATTACK_01,e[i].attackurl,!0),n.addAction(CharAction.DEATH,e[i].deathurl,!0),GameInstance.addSceneChar(n)}else if(4==t.id){var n=GameInstance.getSceneCharByID(t.data.id);n&&(1==t.data.state?(n.play(CharAction.ATTACK_01),n.watch(GameInstance.mainChar)):0==t.data.state?n.play(CharAction.STANAD):2==t.data.state&&n.play(CharAction.DEATH,1))}},e.prototype.loadSecenCom=function(){console.log("over")},e.prototype.loadProgress=function(t){console.log("loading "+float2int(100*t)+"%")},e.prototype.listenModuleEvents=function(){return[new EngineEvent(EngineEvent.CREAT_SCENE_EVENT),new EngineEvent(EngineEvent.CREAT_MAINCHAR_EVENT),new Net2C(Net2C.NET_EVENT)]},e}(BaseProcessor),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},LoginPanel=function(t){function e(){t.call(this),this.init()}return __extends(e,t),e.prototype.init=function(){this.enterBtn=this.creatComponent(0,0,1,1),this.enterBtn.x=0,this.enterBtn.y=0,this.enterBtn.width=128,this.enterBtn.height=64,this.enterBtn.addEventListener(InteractiveEvent.Down,this.enterDown,this),this.enterBtn.addEventListener(InteractiveEvent.Down,this.enterDown,this),this.container.addChild(this.enterBtn),this.textBtn=this.creatComponent(.1,.2,.2,.6),this.textBtn.x=200,this.textBtn.y=0,this.textBtn.width=30,this.textBtn.height=30,this.textBtn.addEventListener(InteractiveEvent.Down,this.showTestUI,this),this.textBtn.addEventListener(InteractiveEvent.Down,this.showTestUI,this),this.container.width=128,this.container.height=64,this.container.center=0,this.container.bottom=30,this.setImgUrl("ui/login/login.png")},e.prototype.enterDown=function(){this.processor.removeUI(),GameInstance.initMainScene()},e.prototype.showTestUI=function(){this.processor.removeUI();var t=new TestUIEvent(TestUIEvent.CREAT_TESTUI_EVENT);ModuleEventManager.dispatchEvent(t)},e}(UIRenderComponent),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},LoginProcessor=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.getName=function(){return"LoginProcessor"},e.prototype.receivedModuleEvent=function(t){var e=this,i=t;if(i.type==LoginEvent.CREAT_LOGIN_UI_EVENT){this.initUI(),Scene_data.focus3D.rotationY=0,Scene_data.focus3D.rotationX=-15,Scene_data.focus3D.y=130,Scene_data.cam3D.distance=1540;var n=new EngineEvent(EngineEvent.CREAT_SCENE_EVENT);n.sceneName="Interface",n.sceneLoadcomplteFun=function(){e.loadSceneCom()},n.sceneProgressFun=function(t){e.loadProgress(t)},n.sceneAnylsizFun=function(){e.addUI()},ModuleEventManager.dispatchEvent(n);var a=new SceneLoadEvent(SceneLoadEvent.SHOW_LOAD_EVENT);ModuleEventManager.dispatchEvent(a)}},e.prototype.loadSceneCom=function(){var t=new SceneLoadEvent(SceneLoadEvent.ANALYSIS_LOAD_EVENT);ModuleEventManager.dispatchEvent(t)},e.prototype.initUI=function(){this._loginPanel=new LoginPanel,this._loginPanel.processor=this},e.prototype.addUI=function(){UIManager.getInstance().addUI(this._loginPanel);var t=new SceneLoadEvent(SceneLoadEvent.REMOVE_LOAD_EVENT);ModuleEventManager.dispatchEvent(t)},e.prototype.loadProgress=function(t){var e=new SceneLoadEvent(SceneLoadEvent.PROGRESS_LOAD_EVENT);e.progress=t,ModuleEventManager.dispatchEvent(e)},e.prototype.removeUI=function(){UIManager.getInstance().removeUI(this._loginPanel)},e.prototype.listenModuleEvents=function(){return[new LoginEvent(LoginEvent.CREAT_LOGIN_UI_EVENT)]},e}(BaseProcessor),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},LoginModule=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.getModuleName=function(){return"LoginModule"},e.prototype.listProcessors=function(){return[new LoginProcessor]},e}(Module),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},SceneLoadView=function(t){function e(){t.call(this),this.init()}return __extends(e,t),e.prototype.init=function(){this.barbgLeft=this.creatComponent(.0234375,.03515625,.046875,.046875),this.barbgLeft.x=0,this.barbgLeft.y=0,this.barbgLeft.width=12,this.barbgLeft.height=12,this.container.addChild(this.barbgLeft),this.barbgCenter=this.creatComponent(.108984375,.03515625,.046875,.046875),this.barbgCenter.x=10,this.barbgCenter.y=0,this.barbgCenter.width=380,this.barbgCenter.height=12,this.container.addChild(this.barbgCenter),this.barbgRight=this.creatComponent(.193359375,.034765625,.046875,.046875),this.barbgRight.x=390,this.barbgRight.y=0,this.barbgRight.width=12,this.barbgRight.height=12,this.container.addChild(this.barbgRight),this.txt1=this.creatComponent(.0283203125,.341015625,.90234375,.09375),this.txt1.x=0,this.txt1.y=2e3,this.txt1.width=231,this.txt1.height=24,this.container.addChild(this.txt1),this.txt2=this.creatComponent(.0318359375,.213671875,.71484375,.09375),this.txt2.x=0,this.txt2.y=2e3,this.txt2.width=183,this.txt2.height=24,this.container.addChild(this.txt2),this.container.width=400,this.container.height=50,this.container.center=0,this.container.bottom=60,this.setImgUrl("ui/loding.png")
},e.prototype.showTxt=function(t){1==t?(this.txt1.y=15,this.txt2.y=2e3):2==t&&(this.txt1.y=2e3,this.txt2.y=15)},e}(UIRenderComponent),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},SceneLoadBar=function(t){function e(){t.call(this),this.init()}return __extends(e,t),e.prototype.init=function(){this.progressBar=this.creatComponent(.07421875,.132421875,.046875,.046875),this.progressBar.x=0,this.progressBar.y=0,this.progressBar.width=1,this.progressBar.height=12,this.container.addChild(this.progressBar),this.container.width=400,this.container.height=50,this.container.center=0,this.container.bottom=60,this.setImgUrl("ui/loding.png")},e.prototype.setProgress=function(t){this.progressBar.width=400*t},e}(UIRenderComponent),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},SceneLoadAtlas=function(t){function e(){t.call(this),this._txtStr="",this._hasData=!1}return __extends(e,t),e.prototype.init=function(t){var e=this;this.loadConfig("ui/load/load.xml",function(){e.initCom(t)})},e.prototype.initCom=function(t){var e=this;LoadManager.getInstance().load(Scene_data.fileRoot+"ui/load/load.png",LoadManager.IMG_TYPE,function(i){e.ctx=UIManager.getInstance().getContext2D(256,64,!1),e.ctx.drawImage(i,0,0),e.texture=TextureManager.getInstance().getCanvasTexture(e.ctx),e.updateLable("txt",e._txtStr,15,"#ffffff",TextAlign.TOP,TextAlign.LEFT,!0),e._hasData=!0,t()})},e.prototype.setTxt=function(t){this._txtStr=t,this._hasData&&this.updateLable("txt",this._txtStr,15,"#ffffff",TextAlign.TOP,TextAlign.LEFT,!0)},e}(UIAtlas),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},SceneLoadUI=function(t){function e(){t.call(this),this.skipNum=0,this.width=400,this.height=80,this.center=0,this.bottom=50,this._baImg=new UIBackImg,this._baImg.setImgInfo("ui/load/lod.jpg",1024,512),this.addRender(this._baImg),this._baseRender=new UIRenderComponent,this.addRender(this._baseRender),this._midRender=new UIRenderComponent,this.addRender(this._midRender),this.loadConfigComA()}return __extends(e,t),e.prototype.loadConfigComA=function(){var t=this;this._baseRender.uiAtlas=new UIAtlas,this._midRender.uiAtlas=this._baseRender.uiAtlas;var e=this._baseRender.uiAtlas;e.configData=[],e.configData.push(this.getObject("numLabel",0,32,100,32,256,64)),e.configData.push(this.getObject("numText",100,32,100,32,256,64)),e.configData.push(this.getObject("barA",0,0,13,15,256,64)),e.configData.push(this.getObject("barB",13,0,13,15,256,64)),e.configData.push(this.getObject("barC",30,0,13,15,256,64)),e.configData.push(this.getObject("btA",45,0,18,18,256,64)),e.configData.push(this.getObject("btB",60,0,10,18,256,64)),e.configData.push(this.getObject("btC",75,0,18,18,256,64)),e.ctx=UIManager.getInstance().getContext2D(256,64,!1),e.ctx.drawImage(EquUtil.uiListImg,0,475,100,18,0,0,100,18),e.ctx.drawImage(EquUtil.uiListImg,0,492,100,20,0,32,100,20),e.texture=TextureManager.getInstance().getCanvasTexture(e.ctx);var i=this._baseRender.creatBaseComponent("btA");this.addChild(i);var n=this._baseRender.creatBaseComponent("btB");n.x=18,n.width=364,this.addChild(n);var a=this._baseRender.creatBaseComponent("btC");a.x=n.width+n.x,this.addChild(a);var s=this._midRender.creatBaseComponent("barA");s.x=2,s.y=.5,this.addChild(s),this.barB=this._midRender.creatBaseComponent("barB"),this.barB.x=13,this.barB.y=.5,this.addChild(this.barB),this.barC=this._midRender.creatBaseComponent("barC"),this.barC.x=26,this.barC.y=.5,this.addChild(this.barC);var o=this._baseRender.creatBaseComponent("numLabel");o.y=22,o.x=3,this.addChild(o);var r=this._baseRender.creatBaseComponent("numText");r.y=20,r.x=100,this.addChild(r),this.setProgress(.01),this.upDataFun=function(){t.updData(0)}},e.prototype.remove=function(){TimeUtil.removeFrameTick(this.upDataFun)},e.prototype.show=function(){TimeUtil.addFrameTick(this.upDataFun)},e.prototype.updData=function(){if(this.barB){this.skipNum>50&&(this.skipNum=0);for(var t="",e=0;this.skipNum/10>e;e++)t+=".";MakeFontClass.getInstance().upBlueNum(this._baseRender.uiAtlas,"numText",t,15,MakeFontClass.Yellow,TextAlign.LEFT),this.skipNum++}},e.prototype.getObject=function(t,e,i,n,a,s,o){var r=this._baseRender.uiAtlas.getObject(t,e,i,n,a,s,o);return r.ox=e,r.oy=i,r},e.prototype.setProgress=function(t){this.barB&&(this.barB.width=369*t,this.barC.x=this.barB.width+this.barB.x)},e.prototype.setTxt=function(){},e.prototype.resize=function(){t.prototype.resize.call(this),this._baImg.resize()},e}(UIConatiner),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},SceneLoadProcessor=function(t){function e(){t.apply(this,arguments),this._tempNum=0}return __extends(e,t),e.prototype.getName=function(){return"SceneLoadProcessor"},e.prototype.receivedModuleEvent=function(t){var e=t;e.type==SceneLoadEvent.SHOW_LOAD_EVENT?(this.addUI(),this._sceneLoadUI.setTxt("正在加载地图资源...")):e.type==SceneLoadEvent.REMOVE_LOAD_EVENT?this.removeUI():e.type==SceneLoadEvent.PROGRESS_LOAD_EVENT?this._sceneLoadUI.setProgress(e.progress):e.type==SceneLoadEvent.ANALYSIS_LOAD_EVENT||e.type==SceneLoadEvent.INFO_EVENT&&this._sceneLoadUI.setTxt(e.str)},e.prototype.addUI=function(){this._sceneLoadUI||(this._sceneLoadUI=new SceneLoadUI),this._sceneLoadUI.show(),this._sceneLoadUI.resize(),UIManager.getInstance().addUIContainer(this._sceneLoadUI)},e.prototype.removeUI=function(){this._sceneLoadUI.remove(),UIManager.getInstance().removeUIContainer(this._sceneLoadUI)},e.prototype.listenModuleEvents=function(){return[new SceneLoadEvent(SceneLoadEvent.SHOW_LOAD_EVENT),new SceneLoadEvent(SceneLoadEvent.REMOVE_LOAD_EVENT),new SceneLoadEvent(SceneLoadEvent.PROGRESS_LOAD_EVENT),new SceneLoadEvent(SceneLoadEvent.ANALYSIS_LOAD_EVENT),new SceneLoadEvent(SceneLoadEvent.INFO_EVENT)]},e}(BaseProcessor),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},SceneLoadModule=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.getModuleName=function(){return"SceneLoadModule"},e.prototype.listProcessors=function(){return[new SceneLoadProcessor]},e}(Module),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},MainUIModule=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.getModuleName=function(){return"MainUIModule"},e.prototype.listProcessors=function(){return[new MainUIProcessor]},e}(Module),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},MainUIProcessor=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.getName=function(){return"MainUIProcessor"},e.prototype.receivedModuleEvent=function(t){var e=t;e.type==MainUIEvent.CREAT_MAINUI_EVENT?this.initUI():e.type==MainUIEvent.SHOW_MAINUI_EVENT&&this.addMainUI()},e.prototype.initUI=function(){this._joystic=new Joystick,this._skillPanel=new SkillPanel},e.prototype.addMainUI=function(){UIManager.getInstance().addUI(this._joystic),UIManager.getInstance().addUI(this._skillPanel)},e.prototype.listenModuleEvents=function(){return[new MainUIEvent(MainUIEvent.CREAT_MAINUI_EVENT),new MainUIEvent(MainUIEvent.SHOW_MAINUI_EVENT)]},e}(BaseProcessor),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Joystick=function(t){function e(){t.call(this),this.init()}return __extends(e,t),e.prototype.init=function(){this._btn=this.creatComponent(0,0,.25,.25),this._btn.x=0,this._btn.y=0,this._btn.width=128,this._btn.height=128,this._btn.z=0,this.container.addChild(this._btn),this._btn.addEventListener(InteractiveEvent.Down,this.onDown,this),this._bg=this.creatComponent(.25,0,.25,.25),this._bg.x=0,this._bg.y=0,this._bg.width=128,this._bg.height=128,this._bg.z=1,this.container.addChild(this._bg),this.container.left=10,this.container.bottom=30,this.setImgUrl("ui/001.png")},e.prototype.onDown=function(){Scene_data.uiStage.addEventListener(InteractiveEvent.Move,this.onStageMove,this),Scene_data.uiStage.addEventListener(InteractiveEvent.Up,this.onStageUp,this)},e.prototype.onStageMove=function(t){var e=new Vector2D(t.x-this._bg.absoluteX-64*UIData.Scale,t.y-this._bg.absoluteY-64*UIData.Scale);e.normalize(),this._btn.x=20*e.x,this._btn.y=20*e.y;var i=new Matrix3D;i.appendRotation(-Scene_data.focus3D.rotationY,Vector3D.Y_AXIS),GameInstance.mainChar.startMove(i.transformVector(new Vector3D(e.x,0,-e.y)));var n=180*(Math.asin(e.x)/Math.PI);GameInstance.mainChar.rotationY=0>e.y?-Scene_data.focus3D.rotationY+n:-Scene_data.focus3D.rotationY+180-n},e.prototype.onStageUp=function(){this._btn.x=0,this._btn.y=0,Scene_data.uiStage.removeEventListener(InteractiveEvent.Move,this.onStageMove,this),Scene_data.uiStage.removeEventListener(InteractiveEvent.Up,this.onStageUp,this),GameInstance.mainChar.stopMove()},e}(UIRenderComponent),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},SkillPanel=function(t){function e(){t.call(this),this._lock=!1,this.init()}return __extends(e,t),e.prototype.init=function(){this.attackBtn=this.creatComponentByName("hit_b"),this.attackBtn.x=80,this.attackBtn.y=80,this.attackBtn.width=128,this.attackBtn.height=128,this.attackBtn.addEventListener(InteractiveEvent.Down,this.attckDown,this),this.container.addChild(this.attackBtn),this.attack1Btn=this.creatComponentByName("a"),this.attack1Btn.x=20,this.attack1Btn.y=130,this.attack1Btn.width=50,this.attack1Btn.height=50,this.attack1Btn.addEventListener(InteractiveEvent.Down,this.attckDown1,this),this.container.addChild(this.attack1Btn),this.attack2Btn=this.creatComponentByName("c"),this.attack2Btn.x=40,this.attack2Btn.y=40,this.attack2Btn.width=50,this.attack2Btn.height=50,this.attack2Btn.addEventListener(InteractiveEvent.Down,this.attckDown2,this),this.container.addChild(this.attack2Btn),this.attack3Btn=this.creatComponentByName("e"),this.attack3Btn.x=120,this.attack3Btn.y=20,this.attack3Btn.width=50,this.attack3Btn.height=50,this.attack3Btn.addEventListener(InteractiveEvent.Down,this.attckDown3,this),this.container.addChild(this.attack3Btn),this.container.width=200,this.container.height=200,this.container.right=10,this.container.bottom=30,this.setImgUrl("ui/001.png")},e.prototype.attckDown=function(){var t=this;if(!this._lock){var e=SkillManager.getInstance().getSkill("skill/s1.txt","attack_01");e.configFixEffect(GameInstance.mainChar,function(){t._lock=!1}),SkillManager.getInstance().playSkill(e),this._lock=!0,setTimeout(function(){t.sendAttack(0)},300)}},e.prototype.sendAttack=function(t){var e=new Net2S,i={};i.id=3;var n={};n.pos={x:GameInstance.mainChar.x,z:GameInstance.mainChar.z},n.type=t,n.rotation=GameInstance.mainChar.rotationY,i.data=n,e.data=i,NetManager.getInstance().sendToServer(e)},e.prototype.attckDown1=function(){var t=this;if(!this._lock){var e=SkillManager.getInstance().getSkill("skill/s1.txt","attack_02");e.configFixEffect(GameInstance.mainChar,function(){t._lock=!1}),SkillManager.getInstance().playSkill(e),this._lock=!0,setTimeout(function(){t.sendAttack(1)},300)}},e.prototype.attckDown2=function(){var t=this;if(!this._lock){var e=SkillManager.getInstance().getSkill("skill/s1.txt","attack_03");e.configFixEffect(GameInstance.mainChar,function(){t._lock=!1}),SkillManager.getInstance().playSkill(e),this._lock=!0,setTimeout(function(){t.sendAttack(2)},300)}},e.prototype.attckDown3=function(){var t=this;if(!this._lock){var e=SkillManager.getInstance().getSkill("skill/s1.txt","attack_04");e.configFixEffect(GameInstance.mainChar,function(){t._lock=!1}),SkillManager.getInstance().playSkill(e),this._lock=!0,setTimeout(function(){t.sendAttack(3)},700)}},e}(UIRenderComponent),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},TestUIModule=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.getModuleName=function(){return"TestUIModule"},e.prototype.listProcessors=function(){return[new TestUIProcessor]},e}(Module),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},TestUIProcessor=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.getName=function(){return"TestUIProcessor"},e.prototype.receivedModuleEvent=function(t){var e=t;e.type==TestUIEvent.CREAT_TESTUI_EVENT?this.initUI():e.type==TestUIEvent.ADD_TESTUI_EVENT?this.addMainUI():e.type==TestUIEvent.HIDE_TESTUI_EVENT&&this.removeMainUI()},e.prototype.initUI=function(){this.testMainui=new RightBottomUi,this.topMainui=new TopMainUI},e.prototype.addMainUI=function(){UIManager.getInstance().addUIContainer(this.testMainui),UIManager.getInstance().addUIContainer(this.topMainui)},e.prototype.removeMainUI=function(){UIManager.getInstance().removeUIContainer(this.testMainui),UIManager.getInstance().removeUIContainer(this.topMainui)},e.prototype.listenModuleEvents=function(){return[new TestUIEvent(TestUIEvent.CREAT_TESTUI_EVENT),new TestUIEvent(TestUIEvent.ADD_TESTUI_EVENT),new TestUIEvent(TestUIEvent.HIDE_TESTUI_EVENT)]},e}(BaseProcessor),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},TestMainUI=function(t){function e(){var e=this;t.call(this),this.leftShowPos=225,this.leftHidePos=320,this.leftCurrentPos=225,this.upShowPos=355,this.upHidePos=450,this.upCurrentPos=355,this.render=new UIRenderComponent,this.render.setInfo("ui/mainui/data.xml","ui/mainui/mainui.png",function(){e.loadConfigCom()}),this.addRender(this.render)}return __extends(e,t),e.prototype.loadConfigCom=function(){this.width=430,this.height=300,this.right=0,this.bottom=0,this.roleBtn=this.render.creatButton("jl","jl_d"),this.roleBtn.x=140,this.roleBtn.y=225,this.addChild(this.roleBtn),this.roleBtn.addEventListener(InteractiveEvent.Down,this.showRole,this),this.zhenxingBtn=this.render.creatButton("zhenxing","zhenxing_down"),this.zhenxingBtn.x=210,this.zhenxingBtn.y=225,this.addChild(this.zhenxingBtn),this.zhenxingBtn.addEventListener(InteractiveEvent.Down,this.showZhenXing,this),this.equBtn=this.render.creatButton("zhuangbei","zhuangbei_down"),this.equBtn.x=0,this.equBtn.y=225,this.addChild(this.equBtn),this.equBtn.addEventListener(InteractiveEvent.Down,this.showEqu,this),this.bgBtn=this.render.creatButton("baoguo","baoguo_down"),this.bgBtn.x=70,this.bgBtn.y=225,this.addChild(this.bgBtn),this.bgBtn.addEventListener(InteractiveEvent.Down,this.showBg,this),this.areaBtn=this.render.creatButton("jiazu","jiazu_down"),this.areaBtn.x=280,this.areaBtn.y=225,this.addChild(this.areaBtn),this.areaBtn.addEventListener(InteractiveEvent.Down,this.showFamily,this),this.rankBtn=this.render.creatButton("paihang","paihang_down"),this.rankBtn.x=355,this.rankBtn.y=145,this.addChild(this.rankBtn),this.rankBtn.addEventListener(InteractiveEvent.Down,this.showBangDan,this),this.dayBtn=this.render.creatButton("richang","richang_down"),this.dayBtn.x=355,this.dayBtn.y=75,this.addChild(this.dayBtn),this.taskBtn=this.render.creatButton("renwu","renwu_down"),this.taskBtn.x=355,this.taskBtn.y=5,this.addChild(this.taskBtn),this.taskBtn.addEventListener(InteractiveEvent.Down,this.taskClick,this),this.battle=this.render.creatBaseComponent("battle"),this.battle.right=0,this.battle.top=0,this.addChild(this.battle),this.battle.addEventListener(InteractiveEvent.Down,this.battleClick,this),this.ctrlBtn=this.render.createSelectButton("hideBtn","hideBtn_down"),this.ctrlBtn.x=350,this.ctrlBtn.y=220,this.ctrlBtn.addEventListener(InteractiveEvent.Down,this.hideAllBtn,this),this.addChild(this.ctrlBtn),this.leftBtnAry=[this.roleBtn,this.zhenxingBtn,this.equBtn,this.bgBtn,this.areaBtn],this.upBtnAry=[this.taskBtn,this.dayBtn,this.rankBtn],this.resize()},e.prototype.taskClick=function(){var t=new TestUIEvent(TestUIEvent.HIDE_TESTUI_EVENT);ModuleEventManager.dispatchEvent(t);var e=new TaskEvent(TaskEvent.SHOW_TASK_EVENT);ModuleEventManager.dispatchEvent(e)},e.prototype.battleClick=function(){var t=new TestUIEvent(TestUIEvent.HIDE_TESTUI_EVENT);ModuleEventManager.dispatchEvent(t);var e=new BattleEvent(BattleEvent.BATTLE_START_EVENT);ModuleEventManager.dispatchEvent(e)},e.prototype.showRole=function(){var t=new TestUIEvent(TestUIEvent.HIDE_TESTUI_EVENT);ModuleEventManager.dispatchEvent(t);var e=new RoleEvent(RoleEvent.SHOW_ROLE_EVENT);ModuleEventManager.dispatchEvent(e)},e.prototype.showZhenXing=function(){alert("111")},e.prototype.showBangDan=function(){},e.prototype.showFamily=function(){},e.prototype.showEqu=function(){var t=new TestUIEvent(TestUIEvent.HIDE_TESTUI_EVENT);ModuleEventManager.dispatchEvent(t);var e=new EquipmentEvent(EquipmentEvent.SHOW_EQU_EVENT);ModuleEventManager.dispatchEvent(e)},e.prototype.showBg=function(){var t=new TestUIEvent(TestUIEvent.HIDE_TESTUI_EVENT);ModuleEventManager.dispatchEvent(t);var e=new BgEvent(BgEvent.SHOW_BG_EVENT);ModuleEventManager.dispatchEvent(e)},e.prototype.hideAllBtn=function(){var t=this;this.updateFun||(this.updateFun=function(){t.updateHide()}),TimeUtil.hasFrameTick(this.updateFun)||TimeUtil.addFrameTick(this.updateFun)},e.prototype.updateHide=function(){this.ctrlBtn.selected?(this.leftCurrentPos+=3,this.leftCurrentPos>=this.leftHidePos&&(this.leftCurrentPos=this.leftHidePos,TimeUtil.removeFrameTick(this.updateFun)),this.upCurrentPos+=3):(this.leftCurrentPos-=3,this.leftCurrentPos<=this.leftShowPos&&(this.leftCurrentPos=this.leftShowPos,TimeUtil.removeFrameTick(this.updateFun)),this.upCurrentPos-=3),this.setLeftPos()},e.prototype.setLeftPos=function(){for(var t=0;this.leftBtnAry.length>t;t++)this.leftBtnAry[t].y=this.leftCurrentPos;for(var t=0;this.upBtnAry.length>t;t++)this.upBtnAry[t].x=this.upCurrentPos},e}(UIConatiner),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},TopInfoAtlas=function(t){function e(){t.call(this),this.init()}return __extends(e,t),e.prototype.init=function(){this.configData=[],this.ctx=UIManager.getInstance().getContext2D(128,64),this.ctx.fillStyle="#8f8571",this.ctx.font="bolder 12px SimHei",this.ctx.fillText("36",0,0),this.configData.push(this.getObject("level",0,0,40,16,128,64)),this.ctx.fillStyle="#b9ac92",this.ctx.font="bolder 16px SimHei",this.ctx.fillText("5321万",64,0),this.configData.push(this.getObject("money",64,0,64,18,128,64)),this.ctx.fillText("2000",0,18),this.configData.push(this.getObject("kuang",0,18,64,18,128,64)),this.ctx.fillStyle="#dd671d",this.ctx.font="bolder 16px SimHei",this.ctx.fillText("V5",64,18),this.configData.push(this.getObject("vip",64,18,64,16,128,64)),this.texture=TextureManager.getInstance().getCanvasTexture(this.ctx)},e.prototype.updateKuangNum=function(t){this.ctx=UIManager.getInstance().getContext2D(64,18),this.ctx.fillStyle="#b9ac92",this.ctx.font="bolder 16px SimHei",this.ctx.fillText(""+t,0,0),TextureManager.getInstance().updateTexture(this.texture,0,18,this.ctx)},e}(UIAtlas),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},TopMainUI=function(t){function e(){var e=this;t.call(this),this.timeNum=5e3,this.skipNum=0,this.isFinish=!1,this.width=800,this.height=450,this.left=0,this.top=0,this._bottomRender=new UIRenderComponent,this.addRender(this._bottomRender),this._baseRender=new UIRenderComponent,this.addRender(this._baseRender),this._textRender=new UIRenderComponent,this.addRender(this._textRender),this._baseRender.setInfo("ui/uidata/mainui.xml","ui/uidata/mainui.png",function(){e.loadConfigCom()})}return __extends(e,t),e.prototype.setData=function(t){var e=this._baseRender.uiAtlas;e.updateLable("role_name_txt",t.name+"",12,"#d4b22a",TextAlign.BOTTOM,TextAlign.CENTER,!0),e.updateLable("time_txt",t.time+"",14,"#d4b22a",TextAlign.BOTTOM,TextAlign.CENTER,!0),MakeFontClass.getInstance().upBlueNum(e,"vip_leve_txt",t.vipLevel+"",12,MakeFontClass.Green,TextAlign.CENTER),MakeFontClass.getInstance().upBlueNum(e,"role_level_txt",t.level+"",12,MakeFontClass.Yellow,TextAlign.CENTER),MakeFontClass.getInstance().upBlueNum(e,"money_txt",float2int(999999*Math.random())+"",12,MakeFontClass.Yellow,TextAlign.CENTER),MakeFontClass.getInstance().upBlueNum(e,"diamond_txt",float2int(99999*Math.random())+"",12,MakeFontClass.Yellow,TextAlign.CENTER),MakeFontClass.getInstance().upBlueNum(e,"food_txt",float2int(99999*Math.random())+"",12,MakeFontClass.Yellow,TextAlign.CENTER),e.upDataPicToTexture("ui/eqicon/xh.png","role_pic")},e.prototype.upData=function(){if(this.timeNum=Math.max(0,2e3-(Date.now()-this.beginTime)/1e3),this.timeNum>=0){var t=float2int(this.timeNum/3600),e=float2int(this.timeNum/60%60),i=float2int(this.timeNum%60),n=this._baseRender.uiAtlas;MakeFontClass.getInstance().upBlueNum(n,"time_txt",t+""+":"+(e+"")+":"+(i+""),12,MakeFontClass.Yellow,TextAlign.CENTER)}this.skipNum+=7,this.C_jantou.right=5*Math.sin(this.skipNum/180*Math.PI)+100},e.prototype.getRoleInfoVo=function(){var t=new RoleInfoVo;return t.name="欧阳渡边",t.level=99,t.vipLevel=8,t.money=5684756,t.diamode=5684,t.food=100,t.time="00:00:00",t},e.prototype.loadConfigCom=function(){var t=this;this._bottomRender.uiAtlas=this._baseRender.uiAtlas,this._textRender.uiAtlas=this._baseRender.uiAtlas,this.addRolePic(),this.addBaseBgs(),this.addBaseButs(),this.addTexts(),this.setData(this.getRoleInfoVo()),this.C_zhanyi_but=this._baseRender.getComponent("C_zhanyi_but"),this.C_zhanyi_but.right=0,this.C_zhanyi_but.top=0,this.addChild(this.C_zhanyi_but),this.C_zhanyi_but.addEventListener(InteractiveEvent.Down,this.C_zhanyi_but_Clik,this),this.C_jantou=this._baseRender.getComponent("C_jantou"),this.C_jantou.right=150,this.C_jantou.top=40,TimeUtil.addTimeOut(1e4,function(){t.showTipTemp()}),this.beginTime=Date.now(),this.updateFun=function(){t.upData()},TimeUtil.addFrameTick(this.updateFun)},e.prototype.showTipTemp=function(){0==this.isFinish&&this.addChild(this.C_jantou)},e.prototype.C_zhanyi_but_Clik=function(){var t=new TestUIEvent(TestUIEvent.HIDE_TESTUI_EVENT);ModuleEventManager.dispatchEvent(t);var e=new BattleEvent(BattleEvent.BATTLE_START_EVENT);ModuleEventManager.dispatchEvent(e);var e=new MainSceneEvent(MainSceneEvent.REMOVE_MAIN_SCENE);ModuleEventManager.dispatchEvent(e),this.isFinish=!0,this.removeChild(this.C_jantou)},e.prototype.addRolePic=function(){this.addChild(this._bottomRender.getComponent("A_role_pic"))},e.prototype.addTexts=function(){this.addChild(this._textRender.getComponent("A_vip_leve_txt")),this.addChild(this._textRender.getComponent("A_role_level_txt")),this.addChild(this._textRender.getComponent("A_role_name_txt")),this.addChild(this._textRender.getComponent("A_money_txt")),this.addChild(this._textRender.getComponent("A_diamond_txt")),this.addChild(this._textRender.getComponent("A_food_txt")),this.addChild(this._textRender.getComponent("A_time_txt"))},e.prototype.addBaseButs=function(){this.addChild(this._baseRender.getComponent("A_money_but")),this.addChild(this._baseRender.getComponent("A_diamond_but")),this.addChild(this._baseRender.getComponent("A_food_but")),this.addChild(this._baseRender.getComponent("A_time_but"))},e.prototype.addBaseBgs=function(){this.addChild(this._baseRender.getComponent("A_role_bg")),this.addChild(this._baseRender.getComponent("A_role_name"))},e.prototype.showHuodong=function(){},e}(UIConatiner),RoleInfoVo=function(){function t(){}return t}(),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},RightBottomUi=function(t){function e(){var e=this;t.call(this),this.width=800,this.height=450,this.right=0,this.bottom=0,this._bottomRender=new UIRenderComponent,this.addRender(this._bottomRender),this._baseRender=new UIRenderComponent,this.addRender(this._baseRender),this._textRender=new UIRenderComponent,this.addRender(this._textRender),this._topRender=new UIRenderComponent,this.addRender(this._topRender),this._baseRender.setInfo("ui/uidata/mainui.xml","ui/uidata/mainui.png",function(){e.loadConfigCom()})}return __extends(e,t),e.prototype.setData=function(){this._baseRender.uiAtlas},e.prototype.loadConfigCom=function(){this._bottomRender.uiAtlas=this._baseRender.uiAtlas,this._textRender.uiAtlas=this._baseRender.uiAtlas,this._topRender.uiAtlas=this._baseRender.uiAtlas,this.addBottomBg(),this.addButs(),this.addTexts(),this.addRedPoints()},e.prototype.addRedPoints=function(){this.B_beibao_point=this._topRender.getComponent("B_beibao_point"),this.addChild(this._topRender.getComponent("B_chengjiu_point")),this.addChild(this._topRender.getComponent("B_zhugong_point")),this.addChild(this._topRender.getComponent("B_wujiang_point"))},e.prototype.addBottomBg=function(){this.addChild(this._bottomRender.getComponent("B_bottom_bg"))},e.prototype.addTexts=function(){},e.prototype.addButs=function(){this.addChild(this._baseRender.getComponent("B_beibao_but")),this.B_beibao_but=this._baseRender.getComponent("B_beibao_but"),this.addChild(this.B_beibao_but),this.B_beibao_but.addEventListener(InteractiveEvent.Down,this.B_beibao_but_Clik,this),this.B_chengjiu_but=this._baseRender.getComponent("B_chengjiu_but"),this.addChild(this.B_chengjiu_but),this.B_chengjiu_but.addEventListener(InteractiveEvent.Down,this.B_chengjiu_but_Clik,this),this.B_zhugong_but=this._baseRender.getComponent("B_zhugong_but"),this.addChild(this.B_zhugong_but),this.B_zhugong_but.addEventListener(InteractiveEvent.Down,this.showZhenxing,this),this.B_wujiang_but=this._baseRender.getComponent("B_wujiang_but"),this.addChild(this.B_wujiang_but),this.B_wujiang_but.addEventListener(InteractiveEvent.Down,this.showRole,this),this.addChild(this._baseRender.getComponent("B_qiandao_but"));var t=this._baseRender.getComponent("B_chongzhi_but");this.addChild(t),t.addEventListener(InteractiveEvent.Down,this.B_chongzhi_but_Down,this),this.B_dashijian_but=this._baseRender.getComponent("B_dashijian_but"),this.addChild(this.B_dashijian_but),this.B_dashijian_but.addEventListener(InteractiveEvent.Down,this.B_dashijian_but_Clik,this),this.B_close_but=this._textRender.getComponent("B_close_but"),this.addChild(this.B_close_but),this.B_close_but.selected=!1,this.B_close_but.addEventListener(InteractiveEvent.Down,this.B_close_but_Clik,this)},e.prototype.B_chongzhi_but_Down=function(){UiStage.showFps=!UiStage.showFps},e.prototype.B_dashijian_but_Clik=function(){},e.prototype.showZhenxing=function(){},e.prototype.showRole=function(){var t=new TestUIEvent(TestUIEvent.HIDE_TESTUI_EVENT);ModuleEventManager.dispatchEvent(t);var e=new RoleEvent(RoleEvent.SHOW_ROLE_EVENT);ModuleEventManager.dispatchEvent(e)},e.prototype.B_chengjiu_but_Clik=function(){var t=new TestUIEvent(TestUIEvent.HIDE_TESTUI_EVENT);ModuleEventManager.dispatchEvent(t);var e=new TaskEvent(TaskEvent.SHOW_TASK_EVENT);ModuleEventManager.dispatchEvent(e)},e.prototype.B_beibao_but_Clik=function(){var t=new TestUIEvent(TestUIEvent.HIDE_TESTUI_EVENT);ModuleEventManager.dispatchEvent(t);var e=new BgEvent(BgEvent.SHOW_BG_EVENT);ModuleEventManager.dispatchEvent(e)},e.prototype.B_close_but_Clik=function(){this.B_close_but.selected=this.B_close_but.selected,this.B_close_but.selected?this.showMenu():this.hideMenu()},e.prototype.showMenu=function(){this._baseRender.rendering&&this.removeRender(this._baseRender),this._bottomRender.rendering&&this.removeRender(this._bottomRender),this._topRender.rendering&&this.removeRender(this._topRender)},e.prototype.hideMenu=function(){this._bottomRender.rendering||this.addRender(this._bottomRender),this._baseRender.rendering||this.addRender(this._baseRender),this._topRender.rendering||this.addRender(this._topRender)},e.prototype.showHuodong=function(){},e}(UIConatiner),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},EquipmentModule=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.getModuleName=function(){return"EquipmentModule"},e.prototype.listProcessors=function(){return[new EquipmentProcessor]},e}(Module),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},EquAtlas=function(t){function e(){t.call(this),this.init()}return __extends(e,t),e.prototype.init=function(){this.posAry=[],this.posAry.push(new Vector2D(0,0),new Vector2D(50,0),new Vector2D(100,0),new Vector2D(150,0),new Vector2D(200,0),new Vector2D(0,50)),this.configData=[],this.ctx=UIManager.getInstance().getContext2D(256,128);for(var t=0;this.posAry.length>t;t++)this.configData.push(this.getObject("pos"+t,this.posAry[t].x,this.posAry[t].y,45,45,256,128));this.configData.push(this.getObject("name",50,50,40,60,256,128)),this.texture=TextureManager.getInstance().getCanvasTexture(this.ctx)},e.prototype.updateEqu=function(t,e,i){var n=this;LoadManager.getInstance().load(Scene_data.fileRoot+t,LoadManager.IMG_TYPE,function(t){n.ctx=UIManager.getInstance().getContext2D(45,45,!1);var a=n.posAry[e];n.ctx.drawImage(t,0,0,45,45),i>0&&(n.ctx.textBaseline=TextAlign.BOTTOM,n.ctx.textAlign=TextAlign.CENTER,n.ctx.fillStyle="#00ff00",n.ctx.font="bolder 16px SimHei",n.ctx.fillText("+"+i,22.5,45)),TextureManager.getInstance().updateTexture(n.texture,a.x,a.y,n.ctx)})},e}(UIAtlas),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},EquQhAtlas=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.init=function(t){var e=this;this.loadConfig("ui/equ/qh.xml",function(){e.initCom(t)})},e.prototype.initCom=function(t){var e=this;LoadManager.getInstance().load(Scene_data.fileRoot+"ui/equ/qh.png",LoadManager.IMG_TYPE,function(i){e.ctx=UIManager.getInstance().getContext2D(256,256,!1),e.ctx.drawImage(i,0,0),e.texture=TextureManager.getInstance().getCanvasTexture(e.ctx),t()})},e.prototype.setInfo=function(t){var e=this;LoadManager.getInstance().load(Scene_data.fileRoot+"ui/icon/"+t.id+".png",LoadManager.IMG_TYPE,function(t){var i=e.getRec("img");e.ctx=UIManager.getInstance().getContext2D(i.pixelWitdh,i.pixelHeight,!1),e.ctx.drawImage(t,0,0,i.pixelWitdh,i.pixelHeight),TextureManager.getInstance().updateTexture(e.texture,i.pixelX,i.pixelY,e.ctx)}),this.updateLable("name",t.name,16,"#d166d5",TextAlign.BOTTOM,TextAlign.CENTER),this.moneyNum=float2int(1e5*Math.random()),this.setRandomInfo(),this.updateLable("info","本次强化消耗铜币：",13,"#776347",TextAlign.BOTTOM,TextAlign.RIGHT,!0),this.updateLable("money",""+this.moneyNum,13,"#bf7620",TextAlign.BOTTOM,TextAlign.LEFT,!0)
},e.prototype.setBs=function(){var t=this;LoadManager.getInstance().load(Scene_data.fileRoot+"ui/icon/"+float2int(20*Math.random())+".png",LoadManager.IMG_TYPE,function(e){var i=t.getRec("b1");t.ctx=UIManager.getInstance().getContext2D(i.pixelWitdh,i.pixelHeight,!1),t.ctx.drawImage(e,0,0,i.pixelWitdh,i.pixelHeight),t.ctx.textBaseline=TextAlign.BOTTOM,t.ctx.textAlign=TextAlign.CENTER,t.ctx.fillStyle="#00ffff",t.ctx.font="bolder 14px"+UIData.font,t.ctx.fillText("+"+float2int(50*Math.random()),i.pixelWitdh/2,i.pixelHeight),TextureManager.getInstance().updateTexture(t.texture,i.pixelX,i.pixelY,t.ctx)}),LoadManager.getInstance().load(Scene_data.fileRoot+"ui/icon/"+float2int(20*Math.random())+".png",LoadManager.IMG_TYPE,function(e){var i=t.getRec("b2");t.ctx=UIManager.getInstance().getContext2D(i.pixelWitdh,i.pixelHeight,!1),t.ctx.drawImage(e,0,0,i.pixelWitdh,i.pixelHeight),t.ctx.textBaseline=TextAlign.BOTTOM,t.ctx.textAlign=TextAlign.CENTER,t.ctx.fillStyle="#00ffff",t.ctx.font="bolder 14px"+UIData.font,t.ctx.fillText("+"+float2int(50*Math.random()),i.pixelWitdh/2,i.pixelHeight),TextureManager.getInstance().updateTexture(t.texture,i.pixelX,i.pixelY,t.ctx)}),LoadManager.getInstance().load(Scene_data.fileRoot+"ui/icon/"+float2int(20*Math.random())+".png",LoadManager.IMG_TYPE,function(e){var i=t.getRec("b3");t.ctx=UIManager.getInstance().getContext2D(i.pixelWitdh,i.pixelHeight,!1),t.ctx.drawImage(e,0,0,i.pixelWitdh,i.pixelHeight),t.ctx.textBaseline=TextAlign.BOTTOM,t.ctx.textAlign=TextAlign.CENTER,t.ctx.fillStyle="#00ffff",t.ctx.font="bolder 14px"+UIData.font,t.ctx.fillText("+"+float2int(50*Math.random()),i.pixelWitdh/2,i.pixelHeight),TextureManager.getInstance().updateTexture(t.texture,i.pixelX,i.pixelY,t.ctx)})},e.prototype.setRandomInfo=function(){this.levelNum=float2int(100*Math.random()),this.attackNum=float2int(1e3*Math.random()),this.updateKeyValue("l1","等级","v1",""+this.levelNum),this.updateKeyValue("l2","等级","v2",""+(this.levelNum+1)),this.updateKeyValue("l3","攻击","v3",""+this.attackNum),this.updateKeyValue("l4","攻击","v4",""+(this.attackNum+200))},e.prototype.updateKeyValue=function(t,e,i,n){this.updateLable(t,e,14,"#ad9559",TextAlign.BOTTOM,TextAlign.LEFT,!0),this.updateLable(i,n,14,"#348022",TextAlign.BOTTOM,TextAlign.LEFT,!0)},e.prototype.updateOne=function(){this.levelNum++,this.attackNum+=200,this.moneyNum+=1233,this.updateValue()},e.prototype.updateTen=function(){this.levelNum+=10,this.attackNum+=2e3,this.moneyNum+=12331,this.updateValue()},e.prototype.updateValue=function(){this.updateLable("v1",""+this.levelNum,14,"#348022",TextAlign.BOTTOM,TextAlign.LEFT,!0),this.updateLable("v2",""+(this.levelNum+1),14,"#348022",TextAlign.BOTTOM,TextAlign.LEFT,!0),this.updateLable("v3",""+this.attackNum,14,"#348022",TextAlign.BOTTOM,TextAlign.LEFT,!0),this.updateLable("v4",""+(this.attackNum+200),14,"#348022",TextAlign.BOTTOM,TextAlign.LEFT,!0),this.updateLable("money",""+this.moneyNum,13,"#bf7620",TextAlign.BOTTOM,TextAlign.LEFT,!0)},e}(UIAtlas),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},EquInfoAtlas=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.init=function(t){var e=this;this.loadConfig("ui/equ/info.xml",function(){e.initCom(t)})},e.prototype.initCom=function(t){var e=this;LoadManager.getInstance().load(Scene_data.fileRoot+"ui/equ/equ_xie.png",LoadManager.IMG_TYPE,function(i){e.ctx=UIManager.getInstance().getContext2D(256,256,!1),e.ctx.drawImage(i,0,0),e.texture=TextureManager.getInstance().getCanvasTexture(e.ctx),e.updateLable("zl","战力",15,"#ec8f21",TextAlign.BOTTOM,TextAlign.LEFT),t()})},e.prototype.setInfo=function(t){var e=this;LoadManager.getInstance().load(Scene_data.fileRoot+"ui/icon/"+t.id+".png",LoadManager.IMG_TYPE,function(t){var i=e.getRec("equ");e.ctx=UIManager.getInstance().getContext2D(i.pixelWitdh,i.pixelHeight,!1),e.ctx.drawImage(t,0,0,i.pixelWitdh,i.pixelHeight),TextureManager.getInstance().updateTexture(e.texture,i.pixelX,i.pixelY,e.ctx)}),this.updateLable("name",t.name,16,"#d166d5",TextAlign.BOTTOM,TextAlign.CENTER);var i=float2int(1e5*Math.random());this.updateLable("zlnum",""+i,28,"#ec8f21",TextAlign.BOTTOM,TextAlign.RIGHT),this.setRandomInfo(),this.setBs()},e.prototype.setBs=function(){var t=this;LoadManager.getInstance().load(Scene_data.fileRoot+"ui/icon/"+float2int(20*Math.random())+".png",LoadManager.IMG_TYPE,function(e){var i=t.getRec("b1");t.ctx=UIManager.getInstance().getContext2D(i.pixelWitdh,i.pixelHeight,!1),t.ctx.drawImage(e,0,0,i.pixelWitdh,i.pixelHeight),t.ctx.textBaseline=TextAlign.BOTTOM,t.ctx.textAlign=TextAlign.CENTER,t.ctx.fillStyle="#00ffff",t.ctx.font="bolder 14px"+UIData.font,t.ctx.fillText("+"+float2int(50*Math.random()),i.pixelWitdh/2,i.pixelHeight),TextureManager.getInstance().updateTexture(t.texture,i.pixelX,i.pixelY,t.ctx)}),LoadManager.getInstance().load(Scene_data.fileRoot+"ui/icon/"+float2int(20*Math.random())+".png",LoadManager.IMG_TYPE,function(e){var i=t.getRec("b2");t.ctx=UIManager.getInstance().getContext2D(i.pixelWitdh,i.pixelHeight,!1),t.ctx.drawImage(e,0,0,i.pixelWitdh,i.pixelHeight),t.ctx.textBaseline=TextAlign.BOTTOM,t.ctx.textAlign=TextAlign.CENTER,t.ctx.fillStyle="#00ffff",t.ctx.font="bolder 14px"+UIData.font,t.ctx.fillText("+"+float2int(50*Math.random()),i.pixelWitdh/2,i.pixelHeight),TextureManager.getInstance().updateTexture(t.texture,i.pixelX,i.pixelY,t.ctx)}),LoadManager.getInstance().load(Scene_data.fileRoot+"ui/icon/"+float2int(20*Math.random())+".png",LoadManager.IMG_TYPE,function(e){var i=t.getRec("b3");t.ctx=UIManager.getInstance().getContext2D(i.pixelWitdh,i.pixelHeight,!1),t.ctx.drawImage(e,0,0,i.pixelWitdh,i.pixelHeight),t.ctx.textBaseline=TextAlign.BOTTOM,t.ctx.textAlign=TextAlign.CENTER,t.ctx.fillStyle="#00ffff",t.ctx.font="bolder 14px"+UIData.font,t.ctx.fillText("+"+float2int(50*Math.random()),i.pixelWitdh/2,i.pixelHeight),TextureManager.getInstance().updateTexture(t.texture,i.pixelX,i.pixelY,t.ctx)})},e.prototype.setRandomInfo=function(){this.updateKeyValue("l1","装备品级","v1",""+float2int(10*Math.random())),this.updateKeyValue("l2","强化等级","v2",""+float2int(100*Math.random())),this.updateKeyValue("l3","基础攻击","v3",""+float2int(1e3*Math.random())),this.updateKeyValue("l4","强化攻击","v4",""+float2int(1e3*Math.random()))},e.prototype.updateKeyValue=function(t,e,i,n){this.updateLable(t,e,14,"#ad9559",TextAlign.BOTTOM,TextAlign.LEFT,!0),this.updateLable(i,n,14,"#348022",TextAlign.BOTTOM,TextAlign.LEFT,!0)},e}(UIAtlas),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},EquipmentProcessor=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.getName=function(){return"EquipmentProcessor"},e.prototype.receivedModuleEvent=function(t){var e=t;e.type==EquipmentEvent.SHOW_EQU_EVENT?this.showUI():e.type==EquipmentEvent.INIT_EQU_EVENT&&this.initUI()},e.prototype.showUI=function(){UIManager.getInstance().addUIContainer(this._equPanel)},e.prototype.initUI=function(){this._equPanel||(this._equPanel=new EquipmentPanel)},e.prototype.listenModuleEvents=function(){return[new EquipmentEvent(EquipmentEvent.SHOW_EQU_EVENT),new EquipmentEvent(EquipmentEvent.HIDE_EQU_EVENT),new EquipmentEvent(EquipmentEvent.INIT_EQU_EVENT)]},e}(BaseProcessor),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},EquipmentPanel=function(t){function e(){var e=this;t.call(this),this.objAry=[{name:"穿云箭",id:419},{name:"霹雳鞋",id:367},{name:"狂战",id:399},{name:"景云衫",id:375},{name:"一把破剑",id:423},{name:"诺克萨斯之手",id:337}],this.width=580,this.height=340,this.center=0,this.middle=0,this._baseRender=new UIRenderComponent,this._baseRender.setInfo("ui/equ/data.xml","ui/equ/equ.png",function(){e.loadConfigCom()}),this.addRender(this._baseRender),this._equRender=new UIRenderComponent,this.addRender(this._equRender),this._infoRender=new UIRenderComponent,this.addRender(this._infoRender),this._qhRender=new UIRenderComponent}return __extends(e,t),e.prototype.loadConfigCom=function(){this._equBg=this._baseRender.creatBaseComponent("equ"),this._equBg.x=0,this._equBg.y=0,this.addChild(this._equBg),this._infoBg=this._baseRender.creatBaseComponent("info"),this._infoBg.x=285,this._infoBg.y=0,this.addChild(this._infoBg),this._equBtn=this._baseRender.createSelectButton("equ_down_btn","equ_up_btn"),this._equBtn.x=534,this._equBtn.y=40,this._equBtn.selected=!0,this.addChild(this._equBtn),this._equBtn.addEventListener(InteractiveEvent.Down,this.equClick,this),this._qhBtn=this._baseRender.createSelectButton("qh_down_btn","qh_up_btn"),this._qhBtn.x=534,this._qhBtn.y=104,this.addChild(this._qhBtn),this._qhBtn.addEventListener(InteractiveEvent.Down,this.qhClick,this),this.back=this._baseRender.creatBaseComponent("back"),this.back.left=0,this.back.top=0,this.addChild(this.back),this.back.addEventListener(InteractiveEvent.Down,this.toback,this),this.resize(),this.initEquRender(),this.initEquInfoRender(),this.initEquQhRender()},e.prototype.toback=function(){var t=new TestUIEvent(TestUIEvent.ADD_TESTUI_EVENT);ModuleEventManager.dispatchEvent(t),UIManager.getInstance().removeUIContainer(this)},e.prototype.equClick=function(){this._equBtn.selected=!0,this._qhBtn.selected=!1,this._infoRender.rendering||this.addRender(this._infoRender),this.removeRender(this._qhRender)},e.prototype.qhClick=function(){this._equBtn.selected=!1,this._qhBtn.selected=!0,this.removeRender(this._infoRender),this._qhRender.rendering||this.addRender(this._qhRender)},e.prototype.initEquRender=function(){this._equAtlas=new EquAtlas,this._equRender.setAtlas(this._equAtlas),this._equ0=this._equRender.creatBaseComponent("pos0"),this._equ0.x=25,this._equ0.y=53,this.addChild(this._equ0),this._equ0.data=this.objAry[0],this._equAtlas.updateEqu("ui/icon/"+this.objAry[0].id+".png",0,15),this._equ0.addEventListener(InteractiveEvent.Down,this.equItemClick,this),this._equ1=this._equRender.creatBaseComponent("pos1"),this._equ1.x=207,this._equ1.y=53,this.addChild(this._equ1),this._equ1.data=this.objAry[1],this._equAtlas.updateEqu("ui/icon/"+this.objAry[1].id+".png",1,0),this._equ1.addEventListener(InteractiveEvent.Down,this.equItemClick,this),this._equ2=this._equRender.creatBaseComponent("pos2"),this._equ2.x=25,this._equ2.y=143,this.addChild(this._equ2),this._equ2.data=this.objAry[2],this._equAtlas.updateEqu("ui/icon/"+this.objAry[2].id+".png",2,2),this._equ2.addEventListener(InteractiveEvent.Down,this.equItemClick,this),this._equ3=this._equRender.creatBaseComponent("pos3"),this._equ3.x=207,this._equ3.y=143,this.addChild(this._equ3),this._equ3.data=this.objAry[3],this._equAtlas.updateEqu("ui/icon/"+this.objAry[3].id+".png",3,0),this._equ3.addEventListener(InteractiveEvent.Down,this.equItemClick,this),this._equ4=this._equRender.creatBaseComponent("pos4"),this._equ4.x=25,this._equ4.y=233,this.addChild(this._equ4),this._equ4.data=this.objAry[4],this._equAtlas.updateEqu("ui/icon/"+this.objAry[4].id+".png",4,0),this._equ4.addEventListener(InteractiveEvent.Down,this.equItemClick,this),this._equ5=this._equRender.creatBaseComponent("pos5"),this._equ5.x=207,this._equ5.y=233,this.addChild(this._equ5),this._equ5.data=this.objAry[5],this._equAtlas.updateEqu("ui/icon/"+this.objAry[5].id+".png",5,6),this._equ5.addEventListener(InteractiveEvent.Down,this.equItemClick,this)},e.prototype.equItemClick=function(t){this._equBtn.selected?this._equInfoAtlas.setInfo(t.target.data):this._equQhAtlas.setInfo(t.target.data)},e.prototype.initEquInfoRender=function(){var t=this;this._equInfoAtlas=new EquInfoAtlas,this._equInfoAtlas.init(function(){t.initEquInfoCom()})},e.prototype.initEquInfoCom=function(){this._infoRender.setAtlas(this._equInfoAtlas),this._xieBtn=this._infoRender.creatButton("xie_up","xie_down"),this._xieBtn.x=310,this._xieBtn.y=30,this.addChild(this._xieBtn),this._huanBtn=this._infoRender.creatButton("huan_up","huan_down"),this._huanBtn.x=310,this._huanBtn.y=65,this.addChild(this._huanBtn),this._equImg=this._infoRender.creatBaseComponent("equ"),this._equImg.x=383,this._equImg.y=40,this.addChild(this._equImg),this._equNameLable=this._infoRender.creatBaseComponent("name"),this._equNameLable.x=374,this._equNameLable.y=117,this.addChild(this._equNameLable),this._equZhanliLable=this._infoRender.creatBaseComponent("zlnum"),this._equZhanliLable.x=324,this._equZhanliLable.y=139,this.addChild(this._equZhanliLable),this._zhanliLable=this._infoRender.creatBaseComponent("zl"),this._zhanliLable.x=424,this._zhanliLable.y=145,this.addChild(this._zhanliLable),this._l1lable=this._infoRender.creatBaseComponent("l1"),this._l1lable.x=305,this._l1lable.y=175,this.addChild(this._l1lable),this._v1lable=this._infoRender.creatBaseComponent("v1"),this._v1lable.x=368,this._v1lable.y=175,this.addChild(this._v1lable),this._l2lable=this._infoRender.creatBaseComponent("l2"),this._l2lable.x=428,this._l2lable.y=175,this.addChild(this._l2lable),this._v2lable=this._infoRender.creatBaseComponent("v2"),this._v2lable.x=491,this._v2lable.y=175,this.addChild(this._v2lable),this._l3lable=this._infoRender.creatBaseComponent("l3"),this._l3lable.x=305,this._l3lable.y=198,this.addChild(this._l3lable),this._v3lable=this._infoRender.creatBaseComponent("v3"),this._v3lable.x=368,this._v3lable.y=198,this.addChild(this._v3lable),this._l4lable=this._infoRender.creatBaseComponent("l4"),this._l4lable.x=428,this._l4lable.y=198,this.addChild(this._l4lable),this._v4lable=this._infoRender.creatBaseComponent("v4"),this._v4lable.x=491,this._v4lable.y=198,this.addChild(this._v4lable),this._bs1=this._infoRender.creatBaseComponent("b1"),this._bs1.x=320,this._bs1.y=230,this.addChild(this._bs1),this._bs2=this._infoRender.creatBaseComponent("b2"),this._bs2.x=395,this._bs2.y=230,this.addChild(this._bs2),this._bs3=this._infoRender.creatBaseComponent("b3"),this._bs3.x=470,this._bs3.y=230,this.addChild(this._bs3),this._equInfoAtlas.setInfo({name:"多兰剑",id:397})},e.prototype.initEquQhRender=function(){var t=this;this._equQhAtlas=new EquQhAtlas,this._equQhAtlas.init(function(){t.initEquQhCom()})},e.prototype.initEquQhCom=function(){this._qhRender.setAtlas(this._equQhAtlas),this._equQhImg=this._qhRender.creatBaseComponent("img"),this._equQhImg.x=383,this._equQhImg.y=40,this.addChild(this._equQhImg),this._equQhNameLable=this._qhRender.creatBaseComponent("name"),this._equQhNameLable.x=374,this._equQhNameLable.y=117,this.addChild(this._equQhNameLable),this._lqh1lable=this._qhRender.creatBaseComponent("l1"),this._lqh1lable.x=320,this._lqh1lable.y=175,this.addChild(this._lqh1lable),this._vqh1lable=this._qhRender.creatBaseComponent("v1"),this._vqh1lable.x=353,this._vqh1lable.y=175,this.addChild(this._vqh1lable),this._lqh2lable=this._qhRender.creatBaseComponent("l2"),this._lqh2lable.x=443,this._lqh2lable.y=175,this.addChild(this._lqh2lable),this._vqh2lable=this._qhRender.creatBaseComponent("v2"),this._vqh2lable.x=475,this._vqh2lable.y=175,this.addChild(this._vqh2lable),this._lqh3lable=this._qhRender.creatBaseComponent("l3"),this._lqh3lable.x=320,this._lqh3lable.y=198,this.addChild(this._lqh3lable),this._vqh3lable=this._qhRender.creatBaseComponent("v3"),this._vqh3lable.x=353,this._vqh3lable.y=198,this.addChild(this._vqh3lable),this._lqh4lable=this._qhRender.creatBaseComponent("l4"),this._lqh4lable.x=443,this._lqh4lable.y=198,this.addChild(this._lqh4lable),this._vqh4lable=this._qhRender.creatBaseComponent("v4"),this._vqh4lable.x=475,this._vqh4lable.y=198,this.addChild(this._vqh4lable),this._toSp=this._qhRender.creatBaseComponent("to"),this._toSp.x=403,this._toSp.y=180,this.addChild(this._toSp),this._moneyinfo=this._qhRender.creatBaseComponent("info"),this._moneyinfo.x=310,this._moneyinfo.y=225,this.addChild(this._moneyinfo),this._money=this._qhRender.creatBaseComponent("money"),this._money.x=455,this._money.y=225,this.addChild(this._money),this._qhOneBtn=this._qhRender.creatButton("qhbtn","qhbtn_down"),this._qhOneBtn.x=310,this._qhOneBtn.y=250,this.addChild(this._qhOneBtn),this._qhOneBtn.addEventListener(InteractiveEvent.Down,this.qhOne,this),this._qhTenBtn=this._qhRender.creatButton("qh2btn","qh2btn_down"),this._qhTenBtn.x=430,this._qhTenBtn.y=250,this.addChild(this._qhTenBtn),this._qhTenBtn.addEventListener(InteractiveEvent.Down,this.qhTen,this),this._equQhAtlas.setInfo({name:"多兰盾",id:415})},e.prototype.qhOne=function(){this._equQhAtlas.updateOne()},e.prototype.qhTen=function(){this._equQhAtlas.updateTen()},e}(UIConatiner),EquUtil=function(){function t(){}return t.init=function(e){t.uiListImg=new Image,t.uiListImg.onload=function(){e()},t.uiListImg.src=Scene_data.fileRoot+"ui/uilist.png"},t}(),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},RoleListItemRender=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.draw=function(){var t=this,e=this._listItemData.data;this._listItemData.itemRender=this,LoadManager.getInstance().load(Scene_data.fileRoot+e.url,LoadManager.IMG_TYPE,function(i){var n=UIManager.getInstance().getContext2D(t.uvData.ow,t.uvData.oh,!1);n.drawImage(i,0,0,i.width,i.height,1,1,62,62),e.select||n.drawImage(EquUtil.uiListImg,100,8,76,76,1,1,62,62),n.drawImage(EquUtil.uiListImg,1,1,91,91,0,0,62,62),t.atlas.updateCtx(n,t.uvData.ox,t.uvData.oy)})},e.prototype.drawLable=function(t,e,i,n,a,s,o){void 0===o&&(o=!1),t.textBaseline=TextAlign.TOP,t.textAlign=TextAlign.CENTER,t.fillStyle=s,t.font=(o?"bolder ":"")+a+"px"+UIData.font,t.fillText(n,e,i)},Object.defineProperty(e.prototype,"selected",{set:function(){},enumerable:!0,configurable:!0}),e.prototype.click=function(){this._listItemData.clickFun&&this._listItemData.clickFun(this._listItemData)},e}(ListItemRender),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},RoleItemRender=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.draw=function(){var t=this,i=float2int(58*Math.random());this._listItemData.renderData={},this._listItemData.renderData.id=i,LoadManager.getInstance().load(Scene_data.fileRoot+"ui/icon/a ("+i+").png",LoadManager.IMG_TYPE,function(i){var n=UIManager.getInstance().getContext2D(t.uvData.ow,t.uvData.oh,!1),a=12,s=58;n.drawImage(e.bgImg,0,0,a,s,0,0,a,s),n.drawImage(e.bgImg,a,0,3,s,a,0,t.uvData.ow-2*a,s),n.drawImage(e.bgImg,31-a,0,a,s,t.uvData.ow-a,0,a,s),n.drawImage(i,0,0,i.width,i.height,16,4,47,47),n.drawImage(e.bgImg,33,0,47,47,16,4,47,47),Math.random()>.5?n.drawImage(e.bgImg,83,0,48,19,100,17,48,19):n.drawImage(e.bgImg,83,20,48,22,100,17,48,22),t.atlas.updateCtx(n,t.uvData.ox,t.uvData.oy)})},e.prototype.drawLable=function(t,e,i,n,a,s,o){void 0===o&&(o=!1),t.textBaseline=TextAlign.TOP,t.textAlign=TextAlign.LEFT,t.fillStyle=s,t.font=(o?"bolder ":"")+a+"px"+UIData.font,t.fillText(n,e,i)},e}(ListItemRender),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},RolePanel=function(t){function e(){var e=this;t.call(this),this._lastMouseX=0,this._lastRoleRotatioinY=0,this.width=800,this.height=450,this.center=0,this.middle=0,this._baseRender=new UIRenderComponent,this.addRender(this._baseRender),this._midRender=new UIRenderComponent,this.addRender(this._midRender),this._topRender=new UIRenderComponent,this.addRender(this._topRender),this._effectRender=new UIRenderComponent,this.addRender(this._effectRender),this._zhuangbeiRender=new UIRenderComponent,this._zhuangbeiTxtRender=new UIRenderComponent,this._qianhuaRendr=new UIRenderComponent,this._qianhuaTxtRendr=new UIRenderComponent,this.initRole(),this._baseRender.setInfo("ui/uidata/roleAs.xml","ui/uidata/roleAs.png",function(){e.loadConfigCom()})}return __extends(e,t),e.prototype.initRole=function(){var t=this;this._role=new Display3DUISprite,this._role.y=-15,this._role.x=-60,this._role.scale=.7,this._role.loadRes("jm_xy00_0"),this._baseRender.addModel(this._role),this._rotationFun=function(){t.rotationRole()}},e.prototype.resize=function(){t.prototype.resize.call(this),this._role.resize(),this._role.scale=1.4*UIData.Scale,this._role.x=-100*UIData.Scale,this._role.y=-60*UIData.Scale,console.log(this.A_left_bg.absoluteX,this.A_left_bg.absoluteY)},e.prototype.rotationRole=function(){this._role.rotationY-=.5},e.prototype.add=function(){TimeUtil.addFrameTick(this._rotationFun)},e.prototype.remove=function(){TimeUtil.removeFrameTick(this._rotationFun)},e.prototype.A_left_bg_MouseDown=function(t){this._lastMouseX=t.x,this._lastRoleRotatioinY=this._role.rotationY,this.remove(),Scene_data.uiStage.addEventListener(InteractiveEvent.Move,this.A_left_bg_MouseMove,this),Scene_data.uiStage.addEventListener(InteractiveEvent.Up,this.A_left_bg_MouseUp,this)},e.prototype.A_left_bg_MouseMove=function(t){this._role.rotationY=this._lastRoleRotatioinY-(t.x-this._lastMouseX)},e.prototype.A_left_bg_MouseUp=function(){this.add(),Scene_data.uiStage.removeEventListener(InteractiveEvent.Move,this.A_left_bg_MouseMove,this),Scene_data.uiStage.removeEventListener(InteractiveEvent.Up,this.A_left_bg_MouseUp,this)},e.prototype.loadConfigCom=function(){this._topRender.uiAtlas=this._baseRender.uiAtlas,this._effectRender.uiAtlas=this._baseRender.uiAtlas,this._midRender.uiAtlas=this._baseRender.uiAtlas,this._zhuangbeiRender.uiAtlas=this._baseRender.uiAtlas,this._zhuangbeiTxtRender.uiAtlas=this._baseRender.uiAtlas,this._qianhuaRendr.uiAtlas=this._baseRender.uiAtlas,this._qianhuaTxtRendr.uiAtlas=this._baseRender.uiAtlas,this.A_left_bg=this._baseRender.getComponent("A_left_bg"),this.addChild(this.A_left_bg),this.A_left_bg.addEventListener(InteractiveEvent.Down,this.A_left_bg_MouseDown,this);var t=this._baseRender.getComponent("A_right_bg");this.addChild(t);var e=this._baseRender.getComponent("A_win_close");this.addChild(e),e.name="A_win_close",e.addEventListener(InteractiveEvent.Down,this.butClik,this);var i=this._baseRender.getComponent("A_bottom_bg");this.addChild(i);var n=this._midRender.getComponent("A_role_pic0");this.addChild(n);var a=this._midRender.getComponent("A_role_pic1");this.addChild(a);var s=this._midRender.getComponent("A_role_pic2");this.addChild(s);var o=this._midRender.getComponent("A_role_pic3");this.addChild(o);var r=this._midRender.getComponent("A_role_pic4");this.addChild(r);var h=this._midRender.getComponent("A_zhanli_txt");this.addChild(h),n.name="A_role_pic0",n.addEventListener(InteractiveEvent.Down,this.butClik,this),a.name="A_role_pic1",a.addEventListener(InteractiveEvent.Down,this.butClik,this),s.name="A_role_pic2",s.addEventListener(InteractiveEvent.Down,this.butClik,this),o.name="A_role_pic3",o.addEventListener(InteractiveEvent.Down,this.butClik,this),r.name="A_role_pic4",r.addEventListener(InteractiveEvent.Down,this.butClik,this),this.A_tab_0=this._midRender.getComponent("A_tab_0"),this.A_tab_0.name="A_tab_0",this.addChild(this.A_tab_0),this.A_tab_0.addEventListener(InteractiveEvent.Down,this.butClik,this),this.A_tab_1=this._midRender.getComponent("A_tab_1"),this.A_tab_1.name="A_tab_1",this.addChild(this.A_tab_1),this.A_tab_1.addEventListener(InteractiveEvent.Down,this.butClik,this);var c=this._midRender.getComponent("A_eq_icon_0");this.addChild(c);var l=this._midRender.getComponent("A_eq_icon_1");this.addChild(l);var u=this._midRender.getComponent("A_eq_icon_2");this.addChild(u);var d=this._midRender.getComponent("A_eq_icon_3");this.addChild(d);var p=this._midRender.getComponent("A_eq_icon_4");this.addChild(p);var _=this._midRender.getComponent("A_eq_icon_5");this.addChild(_),c.name="A_eq_icon_0",c.addEventListener(InteractiveEvent.Down,this.butClik,this),l.name="A_eq_icon_1",l.addEventListener(InteractiveEvent.Down,this.butClik,this),u.name="A_eq_icon_2",u.addEventListener(InteractiveEvent.Down,this.butClik,this),d.name="A_eq_icon_3",d.addEventListener(InteractiveEvent.Down,this.butClik,this),p.name="A_eq_icon_4",p.addEventListener(InteractiveEvent.Down,this.butClik,this),_.name="A_eq_icon_5",_.addEventListener(InteractiveEvent.Down,this.butClik,this);var f=this._midRender.getComponent("A_big_Eq_icon_bg");this.addChild(f);var m=this._topRender.getComponent("A_info_eq_big_icon");this.addChild(m);var y=this._zhuangbeiRender.getComponent("A_zhaungbei_data_bg");this.addChild(y);var g=this._zhuangbeiRender.getComponent("A_Baoshi_icon_bg_0");this.addChild(g);var v=this._zhuangbeiRender.getComponent("A_Baoshi_icon_bg_1");this.addChild(v);var x=this._zhuangbeiRender.getComponent("A_Baoshi_icon_bg_2");this.addChild(x);var b=this._zhuangbeiRender.getComponent("A_Baoshi_icon_bg_3");this.addChild(b);var D=this._zhuangbeiTxtRender.getComponent("A_zhuangbei_txt3");this.addChild(D);var T=this._zhuangbeiTxtRender.getComponent("A_zhuangbei_txt1");this.addChild(T);var w=this._zhuangbeiTxtRender.getComponent("A_zhuangbei_txt0");this.addChild(w);var M=this._zhuangbeiTxtRender.getComponent("A_zhuangbei_txt2");this.addChild(M);var S=this._qianhuaRendr.getComponent("B_qh_data_bg");this.addChild(S);var I=this._qianhuaRendr.getComponent("B_but0");this.addChild(I);var E=this._qianhuaRendr.getComponent("B_but1");this.addChild(E),I.name="B_but0",I.addEventListener(InteractiveEvent.Down,this.butClik,this),E.name="B_but1",E.addEventListener(InteractiveEvent.Down,this.butClik,this);var A=this._qianhuaRendr.getComponent("B_money_icon");this.addChild(A);var C=this._qianhuaRendr.getComponent("B_use_mony_label");this.addChild(C);var R=this._qianhuaRendr.getComponent("B_use_mony_txt");this.addChild(R);var P=this._qianhuaTxtRendr.getComponent("B_qianghua_txt0");this.addChild(P);var L=this._qianhuaTxtRendr.getComponent("B_qianghua_txt1");this.addChild(L);var B=this._qianhuaTxtRendr.getComponent("B_qianghua_txt3");this.addChild(B);var U=this._qianhuaTxtRendr.getComponent("B_qianghua_txt2");this.addChild(U),this.setData(),this.selectTabById(0)},e.prototype.butClik=function(t){switch(t.target.name){case"B_but0":this.setTempEquMeshVo(this.selectEquMeshVo);break;case"B_but1":this.setTempEquMeshVo(this.selectEquMeshVo);break;case"A_win_close":this.toback();break;case"A_tab_0":this.selectTabById(0);break;case"A_tab_1":this.selectTabById(1);break;case"A_role_pic0":this.selectRoleVo(this.roleList[0]);break;case"A_role_pic1":this.selectRoleVo(this.roleList[1]);break;case"A_role_pic2":this.selectRoleVo(this.roleList[2]);break;case"A_role_pic3":this.selectRoleVo(this.roleList[3]);break;case"A_role_pic4":this.selectRoleVo(this.roleList[4]);break;case"A_eq_icon_0":this.setTempEquMeshVo(this.selectRoleMeshVo.eqList[0]);break;case"A_eq_icon_1":this.setTempEquMeshVo(this.selectRoleMeshVo.eqList[1]);break;case"A_eq_icon_2":this.setTempEquMeshVo(this.selectRoleMeshVo.eqList[2]);break;case"A_eq_icon_3":this.setTempEquMeshVo(this.selectRoleMeshVo.eqList[3]);break;case"A_eq_icon_4":this.setTempEquMeshVo(this.selectRoleMeshVo.eqList[4]);break;case"A_eq_icon_5":this.setTempEquMeshVo(this.selectRoleMeshVo.eqList[5]);break;default:}},e.prototype.selectTabById=function(t){0==t&&(this.A_tab_0.selected=!1,this.A_tab_1.selected=!0,this._zhuangbeiRender.rendering||(this.addRender(this._zhuangbeiRender),this.addRender(this._zhuangbeiTxtRender)),this._qianhuaRendr.rendering&&(this.removeRender(this._qianhuaRendr),this.removeRender(this._qianhuaTxtRendr))),1==t&&(this.A_tab_0.selected=!0,this.A_tab_1.selected=!1,this._zhuangbeiRender.rendering&&(this.removeRender(this._zhuangbeiRender),this.removeRender(this._zhuangbeiTxtRender)),this._qianhuaRendr.rendering||(this.addRender(this._qianhuaRendr),this.addRender(this._qianhuaTxtRendr)))},e.prototype.setData=function(){this.makeRoleListItem(),this.selectRoleVo(this.roleList[0])},e.prototype.upRolePicToTexture=function(t,e){var i=this._baseRender.uiAtlas;LoadManager.getInstance().load(Scene_data.fileRoot+t.url,LoadManager.IMG_TYPE,function(n){var a=i.getRec(e);i.ctx=UIManager.getInstance().getContext2D(66,66,!1),i.ctx.drawImage(n,2,2,62,62),t.select?i.ctx.drawImage(EquUtil.uiListImg,1,0,91,89,0,0,66,66):i.ctx.drawImage(EquUtil.uiListImg,110,240,66,66,0,0,66,66),TextureManager.getInstance().updateTexture(i.texture,a.pixelX,a.pixelY,i.ctx)})},e.prototype.getEquList=function(){for(var t=[],e=0;6>e;e++){var i=new EquMeshVo;switch(i.color=float2int(3*Math.random()),i.url="ui/eqicon/eq00"+float2int(6*Math.random())+".png",e){case 0:i.url="ui/eqicon/eqa"+float2int(3*Math.random())+".png";break;case 1:i.url="ui/eqicon/eqb"+float2int(3*Math.random())+".png";break;case 2:i.url="ui/eqicon/eqc"+float2int(3*Math.random())+".png";break;case 3:i.url="ui/eqicon/eqd"+float2int(3*Math.random())+".png";break;case 4:i.url="ui/eqicon/eqe0.png";break;default:}t.push(i)}return t},e.prototype.selectRoleVo=function(t){this.selectRoleMeshVo=t;for(var e=0;5>e&&this.roleList.length>e;e++)this.roleList[e].select=this.roleList[e]==t?!0:!1,this.upRolePicToTexture(this.roleList[e],"role_pic"+e);t.eqList||(t.eqList=this.getEquList());for(var i=0;t.eqList.length>i;i++)this.upEqIconPicToTexture(t.eqList[i].url,"eq_icon_"+i);this.setTempEquMeshVo(t.eqList[0])},e.prototype.setTempEquMeshVo=function(t){if(this.selectEquMeshVo=t,!t.baoshiList){t.baoshiList=[];for(var e=0;4>e;e++){var i=new BaoshiMeshVo;i.url="ui/eqicon/bs00"+float2int(3*Math.random())+".png",t.baoshiList.push(i)}}var n=this._baseRender.uiAtlas;n.upDataPicToTexture(t.bigIconUrl,"info_eq_big_icon");for(var a=0;t.baoshiList.length>a;a++)this.upBsIconPicToTexture(t.baoshiList[a].url,"baoshi_icon_"+a);MakeFontClass.getInstance().upBlueNum(n,"zhuangbei_txt0",t.txt0,12,MakeFontClass.White,TextAlign.CENTER),MakeFontClass.getInstance().upBlueNum(n,"zhuangbei_txt1",t.txt1,12,MakeFontClass.White,TextAlign.CENTER),MakeFontClass.getInstance().upBlueNum(n,"zhuangbei_txt2",t.txt2,12,MakeFontClass.Red,TextAlign.CENTER),MakeFontClass.getInstance().upBlueNum(n,"zhuangbei_txt3",t.txt3,12,MakeFontClass.Red,TextAlign.CENTER),MakeFontClass.getInstance().upBlueNum(n,"qianghua_txt_0",t.txt4,12,MakeFontClass.Yellow,TextAlign.CENTER),MakeFontClass.getInstance().upBlueNum(n,"qianghua_txt_1",t.txt5,12,MakeFontClass.Yellow,TextAlign.CENTER),MakeFontClass.getInstance().upBlueNum(n,"qianghua_txt_2",t.txt6,12,MakeFontClass.Green,TextAlign.CENTER),MakeFontClass.getInstance().upBlueNum(n,"qianghua_txt_3",t.txt7,12,MakeFontClass.Green,TextAlign.CENTER),MakeFontClass.getInstance().upBlueNum(n,"zhanli_txt","+"+(float2int(99999*Math.random())+""),7,MakeFontClass.BigGreen,TextAlign.CENTER),MakeFontClass.getInstance().upBlueNum(n,"use_menu_txt",float2int(99999999*Math.random())+"")},e.prototype.makeRoleListItem=function(){this.roleList=[];for(var t=0;5>t;t++){var e=new RoleMeshVo;e.name="欧阳娜拉",e.url="ui/eqicon/"+t%3+".png",this.roleList.push(e)}this.roleList[0].select=!0},e.prototype.upBsIconPicToTexture=function(t,e){var i=this._baseRender.uiAtlas;LoadManager.getInstance().load(Scene_data.fileRoot+t,LoadManager.IMG_TYPE,function(t){var n=i.getRec(e);i.ctx=UIManager.getInstance().getContext2D(48,48,!1),i.ctx.drawImage(t,1,1,46,46),i.ctx.drawImage(EquUtil.uiListImg,60,250,47,47,0,0,48,48),TextureManager.getInstance().updateTexture(i.texture,n.pixelX,n.pixelY,i.ctx)})},e.prototype.upEqIconPicToTexture=function(t,e){var i=this._baseRender.uiAtlas;LoadManager.getInstance().load(Scene_data.fileRoot+t,LoadManager.IMG_TYPE,function(t){var n=i.getRec(e);i.ctx=UIManager.getInstance().getContext2D(56,56,!1),i.ctx.drawImage(t,1,1,54,54),i.ctx.drawImage(EquUtil.uiListImg,0,245,58,58,0,0,56,56),TextureManager.getInstance().updateTexture(i.texture,n.pixelX,n.pixelY,i.ctx)})},e.prototype.upDataPicToTextureAAAA=function(t,e){var i=this._baseRender.uiAtlas;LoadManager.getInstance().load(Scene_data.fileRoot+t,LoadManager.IMG_TYPE,function(t){var n=i.getRec(e);
i.ctx=UIManager.getInstance().getContext2D(n.pixelWitdh,n.pixelHeight,!1),i.ctx.drawImage(t,0,0,n.pixelWitdh,n.pixelHeight),TextureManager.getInstance().updateTexture(i.texture,n.pixelX,n.pixelY,i.ctx)})},e.prototype.toback=function(){var t=new TestUIEvent(TestUIEvent.ADD_TESTUI_EVENT);ModuleEventManager.dispatchEvent(t),UIManager.getInstance().removeUIContainer(this),this.remove()},e}(UIConatiner),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},RoleEvent=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.INIT_ROLE_EVENT="init_role_event",e.SHOW_ROLE_EVENT="show_role_event",e.HIDE_ROLE_EVENT="hide_role_event",e}(BaseEvent),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},RoleModule=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.getModuleName=function(){return"RoleModule"},e.prototype.listProcessors=function(){return[new RoleProcessor]},e}(Module),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},RoleProcessor=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.getName=function(){return"RoleProcessor"},e.prototype.receivedModuleEvent=function(t){var e=t;e.type==RoleEvent.SHOW_ROLE_EVENT?this.showUI():e.type==RoleEvent.INIT_ROLE_EVENT&&this.initUI()},e.prototype.showUI=function(){this._rolePanel.add(),UIManager.getInstance().addUIContainer(this._rolePanel)},e.prototype.initUI=function(){this._rolePanel||(this._rolePanel=new RolePanel)},e.prototype.listenModuleEvents=function(){return[new RoleEvent(RoleEvent.SHOW_ROLE_EVENT),new RoleEvent(RoleEvent.HIDE_ROLE_EVENT),new RoleEvent(RoleEvent.INIT_ROLE_EVENT)]},e.prototype.addTestModel=function(){var t=new Display3DSprite;this.textModel=t,t.setObjUrl("2016_slg_city/dae/chengqiang/zhujian_0.xml"),t.setLightMapUrl("2016_slg_city/slg_city_hide/lightuv/build35.jpg"),t.material=new Material,MaterialManager.getInstance().getMaterialByte(Scene_data.fileRoot+"well00_pan.txt",t.material),t.scaleX=.54,t.scaleY=.54,t.scaleZ=.54,SceneManager.getInstance().addDisplay(t)},e.prototype.addLyfModel=function(){var t=this;this.particleSprite=new CombineParticle,LoadManager.getInstance().load("res/hd_pan.txt",LoadManager.BYTE_TYPE,function(e){var i=new egret.ByteArray(e);t.particleSprite.setDataByte(i),ParticleManager.getInstance().addParticle(t.particleSprite)})},e}(BaseProcessor),MainSceneTitle=function(){function t(){var t=this;this.flag=!1,this.ypos=35,this._display=new Display2DSprite,this._display.setInfo("ui/uidata/scenetitle.xml","ui/uidata/scenetitle.png",function(){t.init()}),this._moveFun=function(e){t.moveFun(e)}}return t.prototype.init=function(){this.moveAry=[],this.t1=this._display.getSprite("t1"),this.t1.scale=.8,this.t1.setPos(211,63,104),this.t2=this._display.getSprite("t2"),this.t2.scale=.8,this.t2.setPos(125,63,-16),this.t3=this._display.getSprite("t3"),this.t3.scale=.8,this.t3.setPos(218.91738891601562,51.14762115478515,-21.91608428955078);var t=this._display.getSprite("money");t.scale=.8,t.setPos(-171,34,-9);var e=this._display.getSprite("money");e.scale=.8,e.setPos(-98,34,-9);var i=this._display.getSprite("money");i.scale=.8,i.setPos(-98,34,-87);var n=this._display.getSprite("money");n.scale=.8,n.setPos(-169,34,-87),this.moveAry.push(t,e,i,n),this._display.addSprite(this.t1,this.t2,this.t3,t,e,i,n)},t.prototype.moveFun=function(t){if(this.moveAry){var e=.02*t;this.flag?(this.ypos-=e,35>=this.ypos&&(this.flag=!1,this.ypos=35)):(this.ypos+=e,this.ypos>=50&&(this.flag=!0,this.ypos=50));for(var i=0;this.moveAry.length>i;i++)this.moveAry[i].y=this.ypos}},t.prototype.add=function(){SceneManager.getInstance().addDisplay2D(this._display),TimeUtil.addFrameTick(this._moveFun)},t.prototype.remove=function(){SceneManager.getInstance().removeDisplay2D(this._display),TimeUtil.removeFrameTick(this._moveFun)},t}(),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},MainSceneEvent=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.ADD_MAIN_SCENE="add_main_scene",e.REMOVE_MAIN_SCENE="remove_main_scene",e}(BaseEvent),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},MainSceneModule=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.getModuleName=function(){return"MainSceneModule"},e.prototype.listProcessors=function(){return[new MainSceneProcessor]},e}(Module),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},MainSceneProcessor=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.getName=function(){return"MainSceneProcessor"},e.prototype.receivedModuleEvent=function(t){var e=t;e.type==MainSceneEvent.ADD_MAIN_SCENE?(this._sceneTitle||(this._sceneTitle=new MainSceneTitle),this._sceneTitle.add(),MainSceneRoleManager.getInstance().show()):e.type==MainSceneEvent.REMOVE_MAIN_SCENE&&(this._sceneTitle.remove(),MainSceneRoleManager.getInstance().remove())},e.prototype.listenModuleEvents=function(){return[new MainSceneEvent(MainSceneEvent.ADD_MAIN_SCENE),new MainSceneEvent(MainSceneEvent.REMOVE_MAIN_SCENE)]},e}(BaseProcessor),MainSceneRoleManager=function(){function t(){this.walkSkipId=0,this.walkMovePos=new Vector3D(-225,0,142),this.walkLastArr=[],this.zhenxinStop=!1,this.zhenxinRotation=0,this.skipId=0,this.isStop=!1,this.initData()}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.initData=function(){var t=this;this.makeWalk(),this.makeZhenxin(),this.timeEnter=function(e){t.upRoleWalk(e)}},t.prototype.makeWalk=function(){this.walkRole=new Display3dBatchMovie,this.walkRole.setRoleUrl(getRoleUrl("daodun"),4),this.walkRole.setShadowSize(20);var t=new Movie3D;t.x=225,t.y=10,t.z=142,this.walkRole.addSun(t);var e=new Movie3D;e.x=225,e.y=10,e.z=142,this.walkRole.addSun(e);var i=new Movie3D;i.x=225,i.y=10,i.z=142,this.walkRole.addSun(i);var n=new Movie3D;n.x=225,n.y=10,n.z=142,this.walkRole.addSun(n),t.shadow=!0,e.shadow=!0,i.shadow=!0,n.shadow=!0,this.walkRole.play("walk",0)},t.prototype.upRoleWalk=function(t){var e=this;if(!isNaN(t)&&(this.zhenxinWalk(t),!this.isStop&&(this.skipId++,this.skipId>1e3&&(this.isStop=!0,this.walkRole.play("attack_01",1),TimeUtil.addTimeOut(2e3,function(){e.playNextLoad()}),this.skipId=0),this.walkRolePosItem||(this.walkRolePosItem=[],this.walkRolePosItem.push(new Vector3D(-222,0,35)),this.walkRolePosItem.push(new Vector3D(-222,0,-145)),this.walkRolePosItem.push(new Vector3D(-0,0,-145)),this.walkRolePosItem.push(new Vector3D(-0,0,50)),this.walkRolePosItem.push(new Vector3D(140,0,50)),this.walkRolePosItem.push(new Vector3D(140,0,183)),this.walkRolePosItem.push(new Vector3D(268,0,183)),this.walkRolePosItem.push(new Vector3D(268,0,-50)),this.walkRolePosItem.push(new Vector3D(0,0,-50)),this.walkRolePosItem.push(new Vector3D(0,0,47)),this.walkRolePosItem.push(new Vector3D(-222,0,47))),this.walkRole))){this.walkSkipId>=this.walkRolePosItem.length&&(this.walkSkipId=0);var i=new Vector3D(this.walkMovePos.x,this.walkMovePos.y,this.walkMovePos.z),n=this.walkRolePosItem[this.walkSkipId];if(Vector3D.distance(i,n)>1){var a=this.math_angle(n.z,n.x,i.z,i.x),s=.3*(t/10);i=this.moveA2B(i,n,Math.min(Math.max(.1,s),1)),isNaN(i.x)&&alert(t),this.walkMovePos=i.clone();var o=this.walkRole.batchPos[0];if(o.z=this.walkMovePos.z,o.x=this.walkMovePos.x,o.rotationY=a-180,this.walkLastArr){var r=new Object3D(o.x,o.y,o.z);r.rotationY=o.rotationY,this.walkLastArr.unshift(r)}var h=this.findNextWalkId(0);this.walkLastArr[h]&&(this.walkRole.batchPos[1].x=this.walkLastArr[h].x,this.walkRole.batchPos[1].z=this.walkLastArr[h].z,this.walkRole.batchPos[1].rotationY=this.walkLastArr[h].rotationY);var c=this.findNextWalkId(h);this.walkLastArr[c]&&(this.walkRole.batchPos[2].x=this.walkLastArr[c].x,this.walkRole.batchPos[2].z=this.walkLastArr[c].z,this.walkRole.batchPos[2].rotationY=this.walkLastArr[c].rotationY);var l=this.findNextWalkId(c);this.walkLastArr[l]&&(this.walkRole.batchPos[3].x=this.walkLastArr[l].x,this.walkRole.batchPos[3].z=this.walkLastArr[l].z,this.walkRole.batchPos[3].rotationY=this.walkLastArr[l].rotationY),this.walkLastArr.length>1e3&&this.walkLastArr.pop();for(var u=0;this.walkRole.batchPos.length>u;u++);}else this.walkSkipId++}},t.prototype.findNextWalkId=function(t){var e=15;if(this.walkLastArr[t])for(var i=this.walkLastArr[t],n=t;this.walkLastArr.length>n;){var a=this.walkLastArr[n];if(MathClass.math_distance(i.x,i.z,a.x,a.z)>e)return n;n++}return 0},t.prototype.remove=function(){SceneManager.getInstance().removeMovieDisplay(this.zhenxingRole),SceneManager.getInstance().removeMovieDisplay(this.walkRole),TimeUtil.removeFrameTick(this.timeEnter)},t.prototype.show=function(){var t=this;SceneManager.getInstance().addMovieDisplay(this.zhenxingRole),SceneManager.getInstance().addMovieDisplay(this.walkRole),TimeUtil.addFrameTick(this.timeEnter),TimeUtil.addTimeOut(1200,function(){t.playZhenxin()})},t.prototype.makeZhenxin=function(){this.zhenxingRole=new Display3dBatchMovie,this.zhenxingRole.setRoleUrl(getRoleUrl("changdao"),6);for(var t=0;6>t;t++){var e=new Movie3D;e.x=0,e.y=0,e.z=0,e.shadow=!0,this.zhenxingRole.addSun(e)}},t.prototype.zhenxinWalk=function(t){if(!this.zhenxinStop){this.zhenxinRotation+=t/20;for(var e,i=new Vector3D(152,7,-137),n=0;this.zhenxingRole.batchPos.length>n;n++){var a=new Matrix3D,s=60*n+this.zhenxinRotation;a.appendRotation(s,Vector3D.Y_AXIS),e=new Vector3D(25,0,0),e=a.transformVector(e);var o=new Object3D(e.x,e.y,e.z);o.rotationY=s;var r=this.zhenxingRole.batchPos[n];r.x=o.x+i.x,r.y=o.y+i.y,r.z=o.z+i.z,r.rotationY=o.rotationY+180}}},t.prototype.playZhenxin=function(){var t=this;this.zhenxinStop=!0,this.zhenxingRole.play("attack_01",2);for(var e=Math.random()>.5?90:-45,i=0;this.zhenxingRole.batchPos.length>i;i++){var n=this.zhenxingRole.batchPos[i];n.rotationY+=e}TimeUtil.addTimeOut(2e3,function(){t.changeZhenxinRotation()})},t.prototype.changeZhenxinRotation=function(){var t=this;this.zhenxinStop=!1,this.zhenxingRole.play("walk",0),TimeUtil.addTimeOut(4e3,function(){t.playZhenxin()})},t.prototype.upData=function(){},t.prototype.playNextLoad=function(){this.isStop=!1,this.walkRole.play("walk",0)},t.prototype.moveA2B=function(t,e,i){var n=e.subtract(t);return n.normalize(),n.scaleBy(i),n=n.add(t)},t.prototype.math_angle=function(t,e,i,n){return 180*Math.atan2(n-e,i-t)/Math.PI},t.prototype.addRole=function(){this._roleList=[];for(var t=new Vector2D(150,-142),e=0;4>e;e++){var i=this.getSceneChar("daodun",10);i.rotationY=180,i.y=10,i.x=t.x+20*e-20,i.z=t.y+10,this._roleList.push(i),GameInstance.addSceneChar(i)}},t.prototype.getSceneChar=function(t,e,i,n,a){void 0===e&&(e=10),void 0===i&&(i=!1),void 0===n&&(n=null),void 0===a&&(a=null);var s=new SceneChar;return s.watchFlag=i,s.setRoleUrl(getRoleUrl(t)),s.scale=1.5,s.setShadowSize(e),s},t}(),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},FinishPanel=function(t){function e(){var e=this;t.call(this),this.width=800,this.height=450,this.center=0,this.middle=0,this._baseRender=new UIRenderComponent,this.addRender(this._baseRender),this._midRender=new UIRenderComponent,this.addRender(this._midRender),this._topRender=new UIRenderComponent,this.addRender(this._topRender),this._baseRender.setInfo("ui/uidata/finish.xml","ui/uidata/finish.png",function(){e.loadConfigCom()})}return __extends(e,t),e.prototype.show=function(){var t=this;this._baseRender.uiAtlas&&(this.A_start0.x=2600,this.A_start1.x=2600,this.A_start2.x=2600,TimeUtil.addTimeOut(0,function(){t.playStart0()}),TimeUtil.addTimeOut(200,function(){t.playStart1()}),TimeUtil.addTimeOut(400,function(){t.playStart2()}))},e.prototype.playStart0=function(){this.A_start0.width=40,this.A_start0.height=40,this.A_start0.x=260,this.A_start0.y=95,TweenLite.to(this.A_start0,.3,{x:240,y:75,width:80,height:80})},e.prototype.playStart1=function(){this.A_start1.width=40,this.A_start1.height=40,this.A_start1.x=370,this.A_start1.y=60,TweenLite.to(this.A_start1,.3,{x:350,y:40,width:80,height:80})},e.prototype.playStart2=function(){this.A_start2.width=40,this.A_start2.height=40,this.A_start2.x=480,this.A_start2.y=95,TweenLite.to(this.A_start2,.3,{x:460,y:75,width:80,height:80})},e.prototype.remove=function(){},e.prototype.loadConfigCom=function(){this._midRender.uiAtlas=this._baseRender.uiAtlas,this._topRender.uiAtlas=this._baseRender.uiAtlas;var t=this._baseRender.getComponent("A_black_bg");t.left=0,t.top=0,t.width=2e3,t.height=2e3,this.addChild(t),t.name="A_black_bg",t.addEventListener(InteractiveEvent.Down,this.butClik,this);var e=this._midRender.getComponent("A_tittle_txt");this.addChild(e),this.A_start0=this._topRender.getComponent("A_start0"),this.addChild(this.A_start0),this.A_start1=this._topRender.getComponent("A_start1"),this.addChild(this.A_start1),this.A_start2=this._topRender.getComponent("A_start2"),this.addChild(this.A_start2);var i=this._midRender.getComponent("A_replayBut");this.addChild(i);var n=this._midRender.getComponent("A_nextplay");this.addChild(n),i.name="A_replayBut",i.addEventListener(InteractiveEvent.Down,this.butClik,this),n.name="A_nextplay",n.addEventListener(InteractiveEvent.Down,this.butClik,this)},e.prototype.butClik=function(t){switch(t.target.name){case"A_black_bg":break;case"A_replayBut":this.restart();break;case"A_nextplay":this.toBack();break;default:}},e.prototype.toBack=function(){UIManager.getInstance().removeUIContainer(this),ModuleEventManager.dispatchEvent(new BattleEvent(BattleEvent.BATTLE_END_EVENT))},e.prototype.restart=function(){UIManager.getInstance().removeUIContainer(this),ModuleEventManager.dispatchEvent(new BattleEvent(BattleEvent.BATTLE_RESTART_EVENT))},e}(UIConatiner),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},FinishEvent=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.INIT_FINISH_EVENT="init_finish_event",e.SHOW_FINISH_EVENT="show_finish_event",e.HIDE_FINISH_EVENT="hide_finish_event",e}(BaseEvent),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},FinishModule=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.getModuleName=function(){return"FinishModule"},e.prototype.listProcessors=function(){return[new FinishProcessor]},e}(Module),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},FinishProcessor=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.getName=function(){return"FinishProcessor"},e.prototype.receivedModuleEvent=function(t){var e=t;e.type==FinishEvent.SHOW_FINISH_EVENT?this.showUI():e.type==FinishEvent.INIT_FINISH_EVENT&&this.initUI()},e.prototype.showUI=function(){UIManager.getInstance().addUIContainer(this._finishPanel),this._finishPanel.show()},e.prototype.initUI=function(){this._finishPanel||(this._finishPanel=new FinishPanel)},e.prototype.listenModuleEvents=function(){return[new FinishEvent(FinishEvent.SHOW_FINISH_EVENT),new FinishEvent(FinishEvent.HIDE_FINISH_EVENT),new FinishEvent(FinishEvent.INIT_FINISH_EVENT)]},e}(BaseProcessor),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},TipsPanel=function(t){function e(){t.call(this),this.skipNum=0,this.width=100,this.height=450,this._baseRender=new UIRenderComponent,this.addRender(this._baseRender),this.loadConfigComA()}return __extends(e,t),e.prototype.loadConfigComA=function(){var t=this;this._baseRender.uiAtlas=new UIAtlas;var e=this._baseRender.uiAtlas;e.configData=[],e.configData.push(this.getObject("tureLeft",0,0,64,64,64,64)),e.ctx=UIManager.getInstance().getContext2D(64,64,!1),e.ctx.drawImage(EquUtil.uiListImg,113,102,54,54,0,0,32,32),e.texture=TextureManager.getInstance().getCanvasTexture(e.ctx),this.tureLeft=this._baseRender.creatBaseComponent("tureLeft"),this.tureLeft.right=100,this.tureLeft.top=40,this.addChild(this.tureLeft),this.upDataFun=function(e){t.upData(e)},TimeUtil.addFrameTick(this.upDataFun)},e.prototype.upData=function(){this.skipNum+=7,this.tureLeft.right=5*Math.sin(this.skipNum/180*Math.PI)+70},e.prototype.getObject=function(t,e,i,n,a,s,o){var r=this._baseRender.uiAtlas.getObject(t,e,i,n,a,s,o);return r.ox=e,r.oy=i,r},e.prototype.resize=function(){t.prototype.resize.call(this)},e}(UIConatiner),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},TipsEvent=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.INIT_TIIPS_EVENT="init_tips_event",e.SHOW_TIIPS_EVENT="show_tips_event",e.HIDE_TIIPS_EVENT="hide_tips_event",e}(BaseEvent),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},TipsModule=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.getModuleName=function(){return"TipsModule"},e.prototype.listProcessors=function(){return[new TipsProcessor]},e}(Module),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},TipsProcessor=function(t){function e(){t.apply(this,arguments),this.isFinish=!1}return __extends(e,t),e.prototype.getName=function(){return"TipsProcessor"},e.prototype.receivedModuleEvent=function(t){var e=t;e.type==TipsEvent.INIT_TIIPS_EVENT&&this.initUI(),e.type==TipsEvent.SHOW_TIIPS_EVENT&&this.showUI(),e.type==TipsEvent.HIDE_TIIPS_EVENT&&this.hidePanel()},e.prototype.showUI=function(){UIManager.getInstance().addUIContainer(this._tipsPanel)},e.prototype.initUI=function(){var t=this;this._tipsPanel||(this._tipsPanel=new TipsPanel,TimeUtil.addTimeOut(1e4,function(){t.showTipTemp()}))},e.prototype.showTipTemp=function(){0==this.isFinish&&this.showUI()},e.prototype.hidePanel=function(){this.isFinish=!0,UIManager.getInstance().removeUIContainer(this._tipsPanel)},e.prototype.listenModuleEvents=function(){return[new TipsEvent(TipsEvent.SHOW_TIIPS_EVENT),new TipsEvent(TipsEvent.HIDE_TIIPS_EVENT),new TipsEvent(TipsEvent.INIT_TIIPS_EVENT)]},e}(Processor),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},BgModule=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.getModuleName=function(){return"BgModule"},e.prototype.listProcessors=function(){return[new BgProcessor]},e}(Module),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},BgProcessor=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.getName=function(){return"BgProcessor"},e.prototype.receivedModuleEvent=function(t){var e=t;e.type==BgEvent.SHOW_BG_EVENT&&this.showUI(),e.type==BgEvent.INIT_BG_EVENT&&this.initUI(),e.type==BgEvent.HIDE_BG_EVENT&&this.removeUI(),e.type==BgEvent.SHOW_EQU_INFO&&this.showEquInfo(e)},e.prototype.showEquInfo=function(t){var e=t,i=e.equMeshVo;this._bgInfoPanel.setEquVo(i),UIManager.getInstance().addUIContainer(this._bgInfoPanel)},e.prototype.showUI=function(){UIManager.getInstance().addUIContainer(this._bgPanel)},e.prototype.initUI=function(){this._bgPanel||(this._bgPanel=new BgPanel),this._bgInfoPanel||(this._bgInfoPanel=new BgInfoPanel)},e.prototype.removeUI=function(){UIManager.getInstance().removeUIContainer(this._bgPanel),UIManager.getInstance().removeUIContainer(this._bgInfoPanel)},e.prototype.listenModuleEvents=function(){return[new BgEvent(BgEvent.SHOW_BG_EVENT),new BgEvent(BgEvent.HIDE_BG_EVENT),new BgEvent(BgEvent.SHOW_EQU_INFO),new BgEvent(BgEvent.INIT_BG_EVENT)]},e}(BaseProcessor),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},BgInfoPanel=function(t){function e(){var e=this;t.call(this),this.width=800,this.height=450,this.center=0,this.middle=0,this._bottomRender=new UIRenderComponent,this.addRender(this._bottomRender),this._baseRender=new UIRenderComponent,this.addRender(this._baseRender),this._topTxtRender=new UIRenderComponent,this.addRender(this._topTxtRender),this._baseRender.setInfo("ui/uidata/bag.xml","ui/uidata/bag.png",function(){e.loadConfigCom()})}return __extends(e,t),e.prototype.loadConfigCom=function(){this._bottomRender.uiAtlas=this._baseRender.uiAtlas,this._topTxtRender.uiAtlas=this._baseRender.uiAtlas,this.addChild(this._bottomRender.getComponent("B_info_bg_b")),this.addMidRender(),this.addTopTxt()},e.prototype.addMidRender=function(){this.B_but_cs=this._baseRender.getComponent("B_but_cs"),this.B_but_cs.addEventListener(InteractiveEvent.Down,this.B_but_cs_Clik,this),this.addChild(this.B_but_cs),this.B_but_xq=this._baseRender.getComponent("B_but_xq"),this.addChild(this.B_but_xq),this.B_but_xq.addEventListener(InteractiveEvent.Down,this.B_but_xq_Clik,this),this.addChild(this._baseRender.getComponent("B_name_bg")),this.addChild(this._baseRender.getComponent("B_money_bg")),this.B_project_bg=this._baseRender.getComponent("B_project_bg"),this.addChild(this.B_project_bg)},e.prototype.B_but_cs_Clik=function(){alert("出售")},e.prototype.B_but_xq_Clik=function(){alert("详情")},e.prototype.addTopTxt=function(){this.addChild(this._topTxtRender.getComponent("B_equ_icon")),this.addChild(this._topTxtRender.getComponent("B_equ_name")),this.addChild(this._topTxtRender.getComponent("B_equ_num")),this.addChild(this._topTxtRender.getComponent("B_equ_project0")),this.B_equ_info=this._topTxtRender.getComponent("B_equ_info"),this.addChild(this.B_equ_info),this.addChild(this._topTxtRender.getComponent("B_equ_money")),this.addChild(this._topTxtRender.getComponent("B_info_money_icon")),this.addChild(this._topTxtRender.getComponent("B_but_cs_txt")),this.addChild(this._topTxtRender.getComponent("B_but_xq_txt"))},e.prototype.setEquVo=function(t){var e=this._baseRender.uiAtlas;e.updateLable("info_equ_name",t.name,16,"#FFFFFF",TextAlign.BOTTOM,TextAlign.LEFT,!0),e.updateLable("info_equ_num","拥有"+(t.num+"")+"件",14,"#463424",TextAlign.BOTTOM,TextAlign.LEFT,!0);var i="物理攻击+"+(t.Physical_attack+"")+"\n"+"最大生命+"+(t.Max_life+"");Math.random()>.5?(i+="\n魔法攻击+"+(t.Magic_attack+""),this.B_project_bg.height=65):this.B_project_bg.height=50,e.updateLable("info_equ_project0",i,12,"#9b6530",TextAlign.TOP,TextAlign.LEFT,!0,200),e.updateLable("info_equ_money","  出售单价：          "+(t.money+""),12,"#9b6530",TextAlign.BOTTOM,TextAlign.LEFT,!0),e.updateLable("info_equ_info",t.info+"",12,"#524133",TextAlign.TOP,TextAlign.LEFT,!0,200),this.upUeqIcon(t),this.B_equ_info.y=this.B_project_bg.y+this.B_project_bg.height+10},e.prototype.upUeqIcon=function(t){var e=this._baseRender.uiAtlas;LoadManager.getInstance().load(Scene_data.fileRoot+t.url,LoadManager.IMG_TYPE,function(i){var n=e.getRec("info_equ_icon");e.ctx=UIManager.getInstance().getContext2D(n.pixelWitdh,n.pixelHeight,!1),e.ctx.drawImage(i,5,5,54,54),e.ctx.drawImage(EquUtil.uiListImg,70*t.color,159,68,66,1,1,62,62),TextureManager.getInstance().updateTexture(e.texture,n.pixelX,n.pixelY,e.ctx)})},e.prototype.upDataPicToTexture=function(t,e){var i=this._baseRender.uiAtlas;LoadManager.getInstance().load(Scene_data.fileRoot+t,LoadManager.IMG_TYPE,function(t){var n=i.getRec(e);i.ctx=UIManager.getInstance().getContext2D(n.pixelWitdh,n.pixelHeight,!1),i.ctx.drawImage(t,0,0,n.pixelWitdh,n.pixelHeight),TextureManager.getInstance().updateTexture(i.texture,n.pixelX,n.pixelY,i.ctx)})},e}(UIConatiner),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},BgPanel=function(t){function e(){var e=this;t.call(this),this.skipNum=0,this.selcetTabId=0,this.width=800,this.height=450,this.center=0,this.middle=0,this._baseRender=new UIRenderComponent,this.addRender(this._baseRender),this._midRender=new UIRenderComponent,this.addRender(this._midRender),this._topRender=new UIRenderComponent,this.addRender(this._topRender),this._listRender=new UIListRenderComponent,this.addRender(this._listRender),this._panelARender=new UIRenderComponent,this._panelBRender=new UIRenderComponent,this._baseRender.setInfo("ui/uidata/tbag.xml","ui/uidata/tbag.png",function(){e.loadConfigCom()})}return __extends(e,t),e.prototype.loadConfigCom=function(){this._midRender.uiAtlas=this._baseRender.uiAtlas,this._topRender.uiAtlas=this._baseRender.uiAtlas,this._panelARender.uiAtlas=this._baseRender.uiAtlas,this._panelBRender.uiAtlas=this._baseRender.uiAtlas;var t=this._baseRender.getComponent("A_left_bg");this.addChild(t);var e=this._baseRender.getComponent("A_right_bg");this.addChild(e);var i=this._topRender.getComponent("A_win_close");this.addChild(i),i.name="A_win_close",i.addEventListener(InteractiveEvent.Down,this.butClik,this),this.A_tab0=this._midRender.getComponent("A_tab0"),this.addChild(this.A_tab0),this.A_tab0.name="A_tab0",this.A_tab0.addEventListener(InteractiveEvent.Down,this.butClik,this),this.A_tab1=this._midRender.getComponent("A_tab1"),this.addChild(this.A_tab1),this.A_tab1.name="A_tab1",this.A_tab1.addEventListener(InteractiveEvent.Down,this.butClik,this);var n=this._midRender.getComponent("A_info_icon");this.addChild(n);var a=this._midRender.getComponent("A_info_name");this.addChild(a);var s=this._midRender.getComponent("A_info_num_bg");this.addChild(s);var o=this._midRender.getComponent("A_info_num");this.addChild(o);var r=this._midRender.getComponent("A_an_xq");this.addChild(r);var h=this._midRender.getComponent("A_an_hq");this.addChild(h),this.A_info_txt_bg=this._midRender.getComponent("A_info_txt_bg"),this.addChild(this.A_info_txt_bg);var c=this._panelARender.getComponent("A_info_txt");this.addChild(c);var l=this._panelBRender.getComponent("B_txt_0");this.addChild(l);var u=this._panelBRender.getComponent("B_txt_2");this.addChild(u);var d=this._panelBRender.getComponent("B_txt_3");this.addChild(d);var p=this._panelBRender.getComponent("B_txt_1");this.addChild(p);var _=this._panelBRender.getComponent("B_txt_22");this.addChild(_);var f=this._panelBRender.getComponent("B_txt_4");this.addChild(f),this.addList(),this.selectTabIndex(0)},e.prototype.showInfoPanel=function(t){this.skipNum++,t=this.skipNum%2,0==t&&(this._panelARender.rendering||this.addRender(this._panelARender),this._panelBRender.rendering&&this.removeRender(this._panelBRender),this.A_info_txt_bg.height=120),1==t&&(this._panelBRender.rendering||this.addRender(this._panelBRender),this._panelARender.rendering&&this.removeRender(this._panelARender),this.A_info_txt_bg.height=140)},e.prototype.selectTabIndex=function(t){0==t&&(this.A_tab0.selected=!1,this.A_tab1.selected=!0),1==t&&(this.A_tab0.selected=!0,this.A_tab1.selected=!1),this.selcetTabId=t,this.steData()},e.prototype.butClik=function(t){switch(t.target.name){case"A_win_close":this.toBack();break;case"A_tab0":this.selectTabIndex(0);break;case"A_tab1":this.selectTabIndex(1);break;default:}},e.prototype.addList=function(){var t=new Vector2D(385,50);this._bgList=this._listRender.createGridList(),this._bgList.x=t.x,this._bgList.y=t.y,this.addChild(this._bgList),this._bgMask=new UIMask,this._bgMask.x=t.x,this._bgMask.y=t.y,this._bgMask.width=256,this._bgMask.height=318,this.addMask(this._bgMask),this._listRender.mask=this._bgMask},e.prototype.steData=function(){var t=this,e=[],i=float2int(20*Math.random())+10;0==this.selcetTabId&&(i=25),1==this.selcetTabId&&(i=14);for(var n=0;i>n;n++){var a=new ListItemData,s=new EquMeshVo;s.name="头盔"+(float2int(100*Math.random())+""),s.url="ui/eqicon/eq00"+float2int(7*Math.random())+".png",s.color=float2int(4*Math.random()),s.num=float2int(10*Math.random()),s.Physical_attack=float2int(100*Math.random()),s.Max_life=float2int(100*Math.random()),s.Magic_attack=float2int(100*Math.random()),s.money=float2int(1e4*Math.random()),s.info=0==n%2?"是金子总会发光，\n是石头可以做飞镖。\n-飞镖界传奇许褚收获第16个世界冠军头衔":"新文化讯 \n 实习期间每月赚3000元，\n这对一个大二学生来说，但小赵却只能留给自己300元的生活费",a.data=s,a.clickFun=function(e){t.itemDataClick(e)},e.push(a)}0==this.selcetTabId&&(this.allDataArr&&(e=this.allDataArr),this.allDataArr=e),1==this.selcetTabId&&(this.equDataArr&&(e=this.equDataArr),this.equDataArr=e),this._bgList.contentY=0,this._bgList.setGridData(e,BgItemRender,4,64,64,256,512,255,318),this._listItemArr=e,this.itemDataClick(e[0])},e.prototype.itemDataClick=function(t){var e=t.data;this.upRolePicToTexture(e,"info_icon");var i=this._baseRender.uiAtlas;i.updateLable("info_name",e.name+"",14,"#d4b22a",TextAlign.BOTTOM,TextAlign.CENTER,!0),i.updateLable("info_txt",e.info+"",12,"#ffffff",TextAlign.TOP,TextAlign.LEFT,!0,160);for(var n=0;this._listItemArr&&this._listItemArr.length>n;n++)this._listItemArr[n].itemRender.selected=this._listItemArr[n]==t?!0:!1;MakeFontClass.getInstance().upBlueNum(i,"info_num",float2int(100*Math.random())+""+"-99",12,Math.random()>.5?MakeFontClass.Green:MakeFontClass.Red,TextAlign.CENTER),MakeFontClass.getInstance().upBlueNum(i,"level_txt_3","+"+(float2int(100*Math.random())+""),12,Math.random()>.5?MakeFontClass.Green:MakeFontClass.Red,TextAlign.CENTER),MakeFontClass.getInstance().upBlueNum(i,"level_txt_4","+"+(float2int(100*Math.random())+""),12,Math.random()>.5?MakeFontClass.Green:MakeFontClass.Red,TextAlign.CENTER),this.showInfoPanel(Math.random()>.5?0:1)},e.prototype.upRolePicToTexture=function(t,e){var i=this._baseRender.uiAtlas;LoadManager.getInstance().load(Scene_data.fileRoot+t.url,LoadManager.IMG_TYPE,function(n){var a=i.getRec(e);i.ctx=UIManager.getInstance().getContext2D(59,59,!1),i.ctx.drawImage(n,4,4,52,52),i.ctx.drawImage(EquUtil.uiListImg,1+59*t.color,178,59,59,2,2,58,58),TextureManager.getInstance().updateTexture(i.texture,a.pixelX,a.pixelY,i.ctx)})},e.prototype.toBack=function(){ModuleEventManager.dispatchEvent(new TestUIEvent(TestUIEvent.ADD_TESTUI_EVENT)),ModuleEventManager.dispatchEvent(new BgEvent(BgEvent.HIDE_BG_EVENT))},e}(UIConatiner),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},BgItemRender=function(t){function e(){t.apply(this,arguments),this.hasLight=!1}return __extends(e,t),e.prototype.draw=function(){var t=this,e=this._listItemData.data;LoadManager.getInstance().load(Scene_data.fileRoot+e.url,LoadManager.IMG_TYPE,function(i){var n=UIManager.getInstance().getContext2D(t.uvData.ow,t.uvData.oh,!1);
t.hasLight&&n.drawImage(EquUtil.uiListImg,181,244,62,62,2,2,59,59),n.drawImage(i,5,5,54,54),n.drawImage(EquUtil.uiListImg,1+59*e.color,178,59,59,2,2,58,58),e.num>1&&t.drawLable(n,44,44,e.num+"",16,"#ffffff",!0),t.atlas.updateCtx(n,t.uvData.ox,t.uvData.oy)})},Object.defineProperty(e.prototype,"selected",{set:function(t){this.hasLight!=t&&(this.hasLight=t,this.draw())},enumerable:!0,configurable:!0}),e.prototype.drawLable=function(t,e,i,n,a,s,o){void 0===o&&(o=!1),t.textBaseline=TextAlign.TOP,t.textAlign=TextAlign.LEFT,t.fillStyle=s,t.font=(o?"bolder ":"")+a+"px"+UIData.font,t.fillText(n,e,i)},e}(ListItemRender),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},BgItemInfoAtlas=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.init=function(t){var e=this;this.loadConfig("ui/bg/info.xml",function(){e.ctx=UIManager.getInstance().getContext2D(256,128,!1),e.texture=TextureManager.getInstance().getCanvasTexture(e.ctx),t()})},e.prototype.setInfo=function(t){var e=this;console.log(t.data),this.updateLable("name",t.name,18,"#d166d5",TextAlign.TOP,TextAlign.LEFT,!0),this.updateLable("nextname","X"+t.num,15,"#d6bc70",TextAlign.BOTTOM,TextAlign.LEFT,!0),this.updateLable("infotxt",t.info,14,"#aba087",TextAlign.TOP,TextAlign.LEFT,!1,140),LoadManager.getInstance().load(Scene_data.fileRoot+"ui/icon/a ("+t.id+").png",LoadManager.IMG_TYPE,function(t){var i=e.getRec("img");e.ctx=UIManager.getInstance().getContext2D(i.pixelWitdh,i.pixelHeight,!1),Math.random(),e.ctx.drawImage(t,7,7,45,45),e.updateCtx(e.ctx,i.pixelX,i.pixelY)})},e}(UIAtlas),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},BattleModule=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.getModuleName=function(){return"BattleModule"},e.prototype.listProcessors=function(){return[new BattleProcessor]},e}(Module),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},BattleProcessor=function(t){function e(){t.apply(this,arguments),this._caramType=!1,this._baseZ=-700,this._time=0,this._backClick=!1,this._allDistance=0}return __extends(e,t),e.prototype.getName=function(){return"BattleProcessor"},e.prototype.receivedModuleEvent=function(t){var e=t;e.type==BattleEvent.BATTLE_START_EVENT?this.initBattleScene():e.type==BattleEvent.BATTLE_INIT_EVENT?this.initRole():e.type==BattleEvent.BATTLE_END_EVENT?this.back():e.type==BattleEvent.BATTLE_RESTART_EVENT&&this.restart()},e.prototype.back=function(){this._backClick&&(this._t3=null,this._t4=null,this.removeRole(),this.removeUI(),this.battleEnd(),GameInstance.loadMainScene())},e.prototype.addBattleUI=function(){UIManager.getInstance().addUIContainer(this._battleUI)},e.prototype.removeUI=function(){UIManager.getInstance().removeUIContainer(this._battleUI)},e.prototype.initBattleScene=function(){var t=this;GameInstance.loadScene("slg_map",function(){t.sceneLoadCom()})},e.prototype.restart=function(){Scene_data.focus3D,Scene_data.cam3D,this._fightNum=0,this.setSceneRect(),this.addRole(!1),this.begin(),this._backClick=!1},e.prototype.setSceneRect=function(){KeyControlManager.getInstance().focusRect.centX=0,KeyControlManager.getInstance().focusRect.centZ=this._baseZ+30,Scene_data.focus3D.rotationX=-30,Scene_data.focus3D.rotationY=45,Scene_data.cam3D.distance=800,KeyControlManager.getInstance().upData()},e.prototype.sceneLoadCom=function(){Scene_data.focus3D,Scene_data.cam3D,this._backClick=!1,GameData.mapQudaTreeDistance=320,this._fightNum=0,this.setSceneRect(),this.addRole(),this.addBattleUI(),this.begin()},e.prototype.initBattleUI=function(){this._battleUI=new BattleUI,this._battleUI.processor=this},e.prototype.initRole=function(){var t=this;this.initBattleUI(),this._roleList=[],this._roleList.push(this.getSceneChar("guanyu",15,!1,"changdao")),this._roleList.push(this.getSceneChar("huangyueying",15,!1,"gongbing")),this._roleList.push(this.getSceneChar("xiaoqiao",15,!1,"nubing")),this._roleList[1].x=-50,this._roleList[2].x=50,this._roleList[0].index=0,this._roleList[1].index=1,this._roleList[2].index=2,this._enemy=this.getSceneChar("xuzhu",20,!0,"daodun",new Vector3D(-2,0,6)),this._enemy.rotationY=180,this._lightCtrl=new LightController,SkillManager.getInstance().preLoadSkill(getSkillUrl("guanyu")),SkillManager.getInstance().preLoadSkill(getSkillUrl("huangyueying")),SkillManager.getInstance().preLoadSkill(getSkillUrl("xiaoqiao")),SkillManager.getInstance().preLoadSkill(getSkillUrl("xuzhu")),SkillManager.getInstance().preLoadSkill(getSkillUrl("gongbing")),SkillManager.getInstance().preLoadSkill(getSkillUrl("nubing")),this._autoAttackFun0=function(){t.baseAttck(0)},this._autoAttackFun1=function(){t.baseAttck(1)},this._autoAttackFun2=function(){t.baseAttck(2)},this._autoAttackFun3=function(){t.baseAttck(3)}},e.prototype.getSceneChar=function(t,e,i,n,a){void 0===e&&(e=10),void 0===i&&(i=!1),void 0===n&&(n=null),void 0===a&&(a=null);var s=new SceneChar;return s.watchFlag=i,s.setRoleUrl(getRoleUrl(t)),s.x=0,s.y=5,s.z=this._baseZ,s.scale=.8,s.setShadowSize(e),n&&s.addRetinue(n,a),s},e.prototype.attck=function(t){var e=this,i=30;if(0==t){var n=SkillManager.getInstance().getSkill(getSkillUrl("guanyu"),"attack_02");n.configFixEffect(this._roleList[0],function(){var t=e._roleList[0];TweenLite.to(t,.3,{scale:.8}),t.skillLock=!1,e.attackEnemy(i)}),SkillManager.getInstance().playSkill(n);var a=this._roleList[0];TweenLite.to(a,1,{scale:1.2}),a.skillLock=!0,this._roleList[0].angerNum=0,this._battleUI.setRoleInfo(0,this._roleList[0])}else if(1==t){var n=SkillManager.getInstance().getSkill(getSkillUrl("huangyueying"),"attack_02");n.configFixEffect(this._roleList[1],function(){var t=e._roleList[1];TweenLite.to(t,.3,{scale:.8}),t.skillLock=!1,e.attackEnemy(i)}),SkillManager.getInstance().playSkill(n);var a=this._roleList[1];TweenLite.to(a,1,{scale:1.2}),a.skillLock=!0,this._roleList[1].angerNum=0,this._battleUI.setRoleInfo(1,this._roleList[1])}else if(2==t){var n=SkillManager.getInstance().getSkill(getSkillUrl("xiaoqiao"),"attack_02");n.configFixEffect(this._roleList[2],function(){var t=e._roleList[2];TweenLite.to(t,.3,{scale:.8}),t.skillLock=!1,e.attackEnemy(i)}),SkillManager.getInstance().playSkill(n);var a=this._roleList[2];TweenLite.to(a,1,{scale:1.2}),a.skillLock=!0,this._roleList[2].angerNum=0,this._battleUI.setRoleInfo(2,this._roleList[2])}else if(3==t){var n=SkillManager.getInstance().getSkill(getSkillUrl("xuzhu"),"attack_02");n.configFixEffect(this._enemy,function(){var t=e._enemy;TweenLite.to(t,.3,{scale:.8}),e._enemy.skillLock=!1,e._roleList[0].life-=5,e._battleUI.setRoleInfo(0,e._roleList[0])}),SkillManager.getInstance().playSkill(n);var a=this._enemy;TweenLite.to(a,.3,{scale:1.2}),this._enemy.skillLock=!0}this._lightCtrl.begin()},e.prototype.baseAttck=function(t){var e=this;if(0==t){if(this._roleList[0].skillLock)return;var i=SkillManager.getInstance().getSkill(getSkillUrl("guanyu"),"attack_01");i.configFixEffect(this._roleList[0],function(){e.attackEnemy()}),SkillManager.getInstance().playSkill(i),this.addAnger(this._roleList[0],50),this._roleList[0].displayRetinue.play("attack",2)}else if(1==t){if(this._roleList[1].skillLock)return;var i=SkillManager.getInstance().getSkill(getSkillUrl("huangyueying"),"attack_01");i.configTrajectory(this._roleList[1],this._enemy,function(){e.attackEnemy()},0),SkillManager.getInstance().playSkill(i);var n=SkillManager.getInstance().getSkill(getSkillUrl("gongbing"),"attack_01");n.configMulTrajectory(this._roleList[1].retinueList,this._roleList[1].displayRetinue,this._enemy,function(){}),SkillManager.getInstance().playSkill(n),this._roleList[1].displayRetinue.play("attack",2),this.addAnger(this._roleList[1],50)}else if(2==t){if(this._roleList[2].skillLock)return;var i=SkillManager.getInstance().getSkill(getSkillUrl("xiaoqiao"),"attack_01");i.configTrajectory(this._roleList[2],this._enemy,function(){e.attackEnemy()},0),SkillManager.getInstance().playSkill(i);var n=SkillManager.getInstance().getSkill(getSkillUrl("nubing"),"attack_01");n.configMulTrajectory(this._roleList[2].retinueList,this._roleList[2].displayRetinue,this._enemy,function(){}),SkillManager.getInstance().playSkill(n),this._roleList[2].displayRetinue.play("attack",2),this.addAnger(this._roleList[2],50)}else if(3==t){if(this._enemy.skillLock)return;var i=SkillManager.getInstance().getSkill(getSkillUrl("xuzhu"),"attack_01");i.configFixEffect(this._enemy,function(){e.addAnger(e._enemy,1),e._roleList[0].life-=3,e._battleUI.setRoleInfo(0,e._roleList[0])}),SkillManager.getInstance().playSkill(i),this._enemy.displayRetinue.play("attack",2)}},e.prototype.attackEnemy=function(t){var e=this;void 0===t&&(t=15),this._enemy.life-=t,0>=this._enemy.life&&(this._enemy.life=1e6,this.battleEnd(),this._enemy.play("death",1),TimeUtil.addTimeOut(3e3,function(){e.resetBattle()}))},e.prototype.resetBattle=function(){this._fightNum++,3>this._fightNum?this.begin():ModuleEventManager.dispatchEvent(new FinishEvent(FinishEvent.SHOW_FINISH_EVENT))},e.prototype.addRole=function(t){void 0===t&&(t=!0),this._roleList[0].z=this._baseZ,this._roleList[1].z=this._baseZ-50,this._roleList[2].z=this._baseZ-50;for(var e=0;this._roleList.length>e;e++)t&&GameInstance.addSceneChar(this._roleList[e]),this._roleList[e].life=100,this._roleList[e].angerNum=0,this._battleUI.setRoleInfo(e,this._roleList[e]);t&&GameInstance.addSceneChar(this._enemy),this._enemy.life=100},e.prototype.addAnger=function(t,e){t.angerNum+=e,t!=this._enemy&&(t.angerNum>100&&(t.angerNum=100),this._battleUI.setRoleInfo(t.index,t)),this._enemy.angerNum>2&&(this.attck(3),this._enemy.angerNum=0)},e.prototype.removeRole=function(){for(var t=0;this._roleList.length>t;t++)GameInstance.removeSceneChar(this._roleList[t]);GameInstance.removeSceneChar(this._enemy)},e.prototype.begin=function(){var t=this;this._allDistance=0,this.playAll(CharAction.WALK),this._enemy.z=this._baseZ+560+250*this._fightNum,this._enemy.play(CharAction.WALK),this._enemy.life=200,this._enemy.angerNum=0;for(var e=0;this._roleList.length>e;e++)this._roleList[e].life=100,this._roleList[e].angerNum=0,this._battleUI.setRoleInfo(e,this._roleList[e]);this._runFun=function(e){t.updateRun(e)},this._time=TimeUtil.getTimer(),TimeUtil.addFrameTick(this._runFun)},e.prototype.playAll=function(t){for(var e=0;this._roleList.length>e;e++)this._roleList[e].play(t)},e.prototype.updateRun=function(t){var e=.08*t;this.addZ(e),this._enemy.z-=e,this._allDistance+=e,this._allDistance>=250&&(TimeUtil.removeFrameTick(this._runFun),this.playAll(CharAction.STANAD),this._enemy.play(CharAction.STANAD),this._backClick=!0,this.battleBegin())},e.prototype.battleBegin=function(){TimeUtil.addTimeTick(2500,this._autoAttackFun0,100),TimeUtil.addTimeTick(2800,this._autoAttackFun1,1e3),TimeUtil.addTimeTick(2300,this._autoAttackFun2,2200),TimeUtil.addTimeTick(2700,this._autoAttackFun3,130)},e.prototype.battleEnd=function(){TimeUtil.removeTimeTick(this._autoAttackFun0),TimeUtil.removeTimeTick(this._autoAttackFun1),TimeUtil.removeTimeTick(this._autoAttackFun2),TimeUtil.removeTimeTick(this._autoAttackFun3)},e.prototype.addZ=function(t){for(var e=0;this._roleList.length>e;e++)this._roleList[e].z+=t;KeyControlManager.getInstance().addCentZ(t)},e.prototype.listenModuleEvents=function(){return[new BattleEvent(BattleEvent.BATTLE_START_EVENT),new BattleEvent(BattleEvent.BATTLE_INIT_EVENT),new BattleEvent(BattleEvent.BATTLE_END_EVENT),new BattleEvent(BattleEvent.BATTLE_RESTART_EVENT)]},e}(BaseProcessor),LightController=function(){function t(){var t=this;this.time=0,this.state=0,this.value=2,this.beginTime=500,this.lastTime=1500,this.endTime=500,this.updateFun=function(e){t.update(e)}}return t.prototype.begin=function(){1==this.state||(2==this.state?this.time=0:3==this.state?(this.state=1,this.time=0):(TimeUtil.addFrameTick(this.updateFun),this.state=1,this.time=0))},t.prototype.update=function(t){1==this.state?(this.time+=t,this.value=2-this.time/this.beginTime,this.time>this.beginTime&&(this.value=1,this.state=2,this.time=0)):2==this.state?(this.time+=t,this.time>=this.lastTime&&(this.state=3,this.time=0)):(this.state=3)&&(this.time+=t,this.value=1+this.time/this.beginTime,this.time>this.beginTime&&(this.value=2,this.state=0,this.time=0,TimeUtil.removeFrameTick(this.updateFun))),Scene_data.scaleLight[0]=this.value},t}(),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},BattleUI=function(t){function e(){var e=this;t.call(this),this.width=800,this.height=450,this.center=0,this.bottom=0,this._baseRender=new UIRenderComponent,this.addRender(this._baseRender),this._topRender=new UIRenderComponent,this.addRender(this._topRender),this._effectRender=new UIRenderComponent,this.addRender(this._effectRender),this._baseRender.setInfo("ui/uidata/battle.xml","ui/uidata/battle.png",function(){e.loadConfigCom()})}return __extends(e,t),e.prototype.loadConfigCom=function(){this._topRender.uiAtlas=this._baseRender.uiAtlas,this._effectRender.uiAtlas=this._baseRender.uiAtlas;var t=this._baseRender,e=t.getComponent("A_gline_0");this.addChild(e);var i=t.getComponent("A_yline_0");this.addChild(i);var n=t.getComponent("A_gline_1");this.addChild(n);var a=t.getComponent("A_yline_1");this.addChild(a);var s=t.getComponent("A_gline_2");this.addChild(s);var o=t.getComponent("A_yline_2");this.addChild(o);var r=t.getComponent("A_but_play");this.addChild(r);var h=this._topRender.getComponent("A_pic_0");this.addChild(h);var c=this._topRender.getComponent("A_pic_1");this.addChild(c);var l=this._topRender.getComponent("A_pic_2");this.addChild(l),r.addEventListener(InteractiveEvent.Down,this.toback,this),r.left=20,r.top=20,h.addEventListener(InteractiveEvent.Down,this.A_icon_0_Clik,this),c.addEventListener(InteractiveEvent.Down,this.A_icon_1_Clik,this),l.addEventListener(InteractiveEvent.Down,this.A_icon_2_Clik,this),this.A_yellow_2=this._topRender.getComponent("A_yellow_2"),this.addChild(this.A_yellow_2),this.A_green_2=this._topRender.getComponent("A_green_2"),this.addChild(this.A_green_2),this.A_yellow_1=this._topRender.getComponent("A_yellow_1"),this.addChild(this.A_yellow_1),this.A_green_1=this._topRender.getComponent("A_green_1"),this.addChild(this.A_green_1),this.A_yellow_0=this._topRender.getComponent("A_yellow_0"),this.addChild(this.A_yellow_0),this.A_green_0=this._topRender.getComponent("A_green_0"),this.addChild(this.A_green_0),this.A_sanguang_0=this._effectRender.getComponent("A_sanguang_0"),this.A_sanguang_1=this._effectRender.getComponent("A_sanguang_1"),this.A_sanguang_2=this._effectRender.getComponent("A_sanguang_2"),this.A_sanguang_0.stopEnd(),this.A_sanguang_1.stopEnd(),this.A_sanguang_2.stopEnd(),this.setData()},e.prototype.A_icon_0_Clik=function(){this.A_sanguang_0.parent&&this.processor.attck(0)},e.prototype.A_icon_1_Clik=function(){this.A_sanguang_1.parent&&this.processor.attck(1)},e.prototype.A_icon_2_Clik=function(){this.A_sanguang_2.parent&&this.processor.attck(2)},e.prototype.setData=function(){this.upDataPicToTexture("ui/eqicon/0.png","pic0"),this.upDataPicToTexture("ui/eqicon/1.png","pic1"),this.upDataPicToTexture("ui/eqicon/2.png","pic2")},e.prototype.setRoleInfo=function(t,e){var i=65,n=e.life/100,a=e.angerNum/100;switch(t){case 0:this.A_green_0.width=i*n,this.A_yellow_0.width=i*a,a>=1?(this.A_sanguang_0.parent||this.addChild(this.A_sanguang_0),this.A_sanguang_0.play()):(this.A_sanguang_0.stopEnd(),this.A_sanguang_0.parent&&this.removeChild(this.A_sanguang_0));break;case 1:this.A_green_1.width=i*n,this.A_yellow_1.width=i*a,a>=1?(this.A_sanguang_1.parent||this.addChild(this.A_sanguang_1),this.A_sanguang_1.play()):(this.A_sanguang_1.stopEnd(),this.A_sanguang_1.parent&&this.removeChild(this.A_sanguang_1));break;case 2:this.A_green_2.width=i*n,this.A_yellow_2.width=i*a,a>=1?(this.A_sanguang_2.parent||this.addChild(this.A_sanguang_2),this.A_sanguang_2.play()):(this.A_sanguang_2.stopEnd(),this.A_sanguang_2.parent&&this.removeChild(this.A_sanguang_2));break;default:}},e.prototype.upDataPicToTexture=function(t,e){var i=this._baseRender.uiAtlas;LoadManager.getInstance().load(Scene_data.fileRoot+t,LoadManager.IMG_TYPE,function(t){var n=i.getRec(e);i.ctx=UIManager.getInstance().getContext2D(n.pixelWitdh,n.pixelHeight,!1),i.ctx.drawImage(t,2,2,n.pixelWitdh-4,n.pixelHeight-4),i.ctx.drawImage(EquUtil.uiListImg,1,0,91,91,0,0,70,70),TextureManager.getInstance().updateTexture(i.texture,n.pixelX,n.pixelY,i.ctx)})},e.prototype.toback=function(){this.processor.back()},e.prototype.A_frame2_Clik=function(){this.A_frame2.goToAndPlay(0)},e}(UIConatiner),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},TaskEvent=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.INIT_TASK_EVENT="init_task_event",e.SHOW_TASK_EVENT="show_task_event",e.HIDE_TASK_EVENT="hide_task_event",e}(BaseEvent),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},TaskPanel=function(t){function e(){var e=this;t.call(this),this.infoary=[{title:"势不可挡",info:"通关普通战役：黄天之迷，狮口脱险"},{title:"过关斩将",info:"通关普通战役，讨董之盟 兵临城下"},{title:"逢龙遇虎",info:"招募7个武将为你出战"}],this.width=800,this.height=450,this.center=0,this.middle=0,this._baseRender=new UIRenderComponent,this.addRender(this._baseRender),this._btnRender=new UIRenderComponent,this.addRender(this._btnRender),this._listRender=new UIListRenderComponent,this.addRender(this._listRender),this._topTxtRender=new UIRenderComponent,this.addRender(this._topTxtRender),this._baseRender.setInfo("ui/uidata/task.xml","ui/uidata/task.png",function(){e.loadConfigCom()})}return __extends(e,t),e.prototype.loadConfigCom=function(){this._btnRender.uiAtlas=this._baseRender.uiAtlas,this._topTxtRender.uiAtlas=this._baseRender.uiAtlas,this.addChild(this._baseRender.getComponent("A_win_bg")),this.addChild(this._btnRender.getComponent("A_tittle_bg")),this.addChild(this._topTxtRender.getComponent("A_tittle_txt")),this.A_close_but=this._btnRender.getComponent("A_close_but"),this.addChild(this.A_close_but),this.A_close_but.addEventListener(InteractiveEvent.Down,this.toback,this),this.addList()},e.prototype.addList=function(){var t=new Vector2D(144,89);this._itemlist=this._listRender.createList(),this._itemlist.x=t.x,this._itemlist.y=t.y,this.addChild(this._itemlist),this._bgMask=new UIMask,this._bgMask.x=t.x,this._bgMask.y=t.y,this._bgMask.width=512,this._bgMask.height=300,this.addMask(this._bgMask),this._listRender.mask=this._bgMask,this.setData()},e.prototype.setData=function(){for(var t=[],e=0;5>e;e++){var i=new ListItemData,n=new ChengjiuMeshVo,a=this.infoary[e%3];n.title=a.title,n.info=a.info,n.jiangli_diamond=float2int(100*Math.random()),n.jiangli_money=float2int(99999*Math.random()),n.finish=Math.random()>.5,n.url="ui/eqicon/eq00"+float2int(7*Math.random())+".png",i.data=n,t.push(i)}this._itemlist.setData(t,TaskItemRender,512,100,512,512,512,300)},e.prototype.toback=function(){var t=new TestUIEvent(TestUIEvent.ADD_TESTUI_EVENT);ModuleEventManager.dispatchEvent(t),UIManager.getInstance().removeUIContainer(this)},e}(UIConatiner),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},TaskItemRender=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.draw=function(){var t=this,e=this._listItemData.data;LoadManager.getInstance().load(Scene_data.fileRoot+e.url,LoadManager.IMG_TYPE,function(i){var n=UIManager.getInstance().getContext2D(t.uvData.ow,t.uvData.oh,!1),a=83,s=79,o=318,r=6,h=30,c=30;n.drawImage(EquUtil.uiListImg,o,r,h,c,0,0,h,c),n.drawImage(EquUtil.uiListImg,o+a-h,r,h,c,t.uvData.ow-h,0,h,c),n.drawImage(EquUtil.uiListImg,o,r+s-c,h,c,0,t.uvData.oh-c,h,c),n.drawImage(EquUtil.uiListImg,o+a-h,r+s-c,h,c,t.uvData.ow-h,t.uvData.oh-c,h,c),n.drawImage(EquUtil.uiListImg,o+h,r,a-2*h,c,h,0,t.uvData.ow-2*h,c),n.drawImage(EquUtil.uiListImg,o+h,r+s-c,a-2*h,c,h,t.uvData.oh-c,t.uvData.ow-2*h,c),n.drawImage(EquUtil.uiListImg,o,r+c,h,s-2*c,0,c,h,t.uvData.oh-2*c),n.drawImage(EquUtil.uiListImg,o+a-h,r+c,h,s-2*c,t.uvData.ow-h,c,h,t.uvData.oh-2*c),n.drawImage(EquUtil.uiListImg,o+h,r+c,a-2*h,s-2*c,h,c,t.uvData.ow-2*h,t.uvData.oh-2*c),n.drawImage(i,0,0,i.width,i.height,30,20,60,60),n.drawImage(EquUtil.uiListImg,414,2,90,90,25,15,70,70),e.finish?t.drawLable(n,t.uvData.ow-100,40,"已完成",20,"#00ff00",!0):t.drawLable(n,t.uvData.ow-100,40,"未完成",20,"#ffffff",!0),t.drawLable(n,100,15,e.title,20,"#5d2a12",!0),t.drawLable(n,100,45,e.info,16,"#000000",!0),t.drawLable(n,100,70,"奖励：",12,"#5d2a12",!1),n.drawImage(EquUtil.uiListImg,10,117,41,31,130,60,41*.8,24.8),t.drawLable(n,160,70,"x "+e.jiangli_diamond,12,"#5d2a12",!1),n.drawImage(EquUtil.uiListImg,64,117,41,31,200,62,41*.8,24.8),t.drawLable(n,230,70,"x "+e.jiangli_money,12,"#5d2a12",!1),t.atlas.updateCtx(n,t.uvData.ox,t.uvData.oy)})},e.prototype.drawLable=function(t,e,i,n,a,s,o){void 0===o&&(o=!1),t.textBaseline=TextAlign.TOP,t.textAlign=TextAlign.LEFT,t.fillStyle=s,t.font=(o?"bolder ":"")+a+"px"+UIData.font,t.fillText(n,e,i)},e}(ListItemRender),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},TaskModule=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.getModuleName=function(){return"TeskModule"},e.prototype.listProcessors=function(){return[new TaskProcessor]},e}(Module),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},TaskProcessor=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.getName=function(){return"TaskProcessor"},e.prototype.receivedModuleEvent=function(t){var e=t;e.type==TaskEvent.SHOW_TASK_EVENT?this.showUI():e.type==TaskEvent.INIT_TASK_EVENT&&this.initUI()},e.prototype.showUI=function(){UIManager.getInstance().addUIContainer(this._taskPanel)},e.prototype.initUI=function(){this._taskPanel||(this._taskPanel=new TaskPanel)},e.prototype.listenModuleEvents=function(){return[new TaskEvent(TaskEvent.SHOW_TASK_EVENT),new TaskEvent(TaskEvent.HIDE_TASK_EVENT),new TaskEvent(TaskEvent.INIT_TASK_EVENT)]},e}(Processor),ModuleList=function(){function t(){}return t.getModuleList=function(){return[new EngineModule,new MainUIModule,new LoginModule,new SceneLoadModule,new TestUIModule,new EquipmentModule,new RoleModule,new BgModule,new BattleModule,new TaskModule,new FinishModule,new TipsModule,new MainSceneModule]},t.startup=function(){for(var e=t.getModuleList(),i=0;e.length>i;i++)Module.registerModule(e[i])},t}(),GameStart=function(){function t(){}return t.prototype.init=function(){0==Scene_data.user&&(UIData.loadUIdata("ui/data.xml"),ModuleList.startup(),GameData.needCreatChar=!1,GameInstance.init(),KeyControlManager.getInstance().init())},t}(),FpsMc=function(){function t(){this.drawNum=0,this.fpsStr="",this.lastData=new Date}return t.prototype.getStr=function(){var e=new Date,i=e.getTime()-this.lastData.getTime();return i/=1e3,i>1&&(this.fpsStr="Fps:"+(Math.min(this.drawNum+float2int(this.drawNum/10*t.addFps),60)+"")+" "+t.tipStr,this.drawNum=0,this.lastData=e),t.tipStr?(this.fpsStr=t.tipStr,this.fpsStr):this.fpsStr},t.addFps=2.5,t.tipStr="",t}(),UiStage=function(){function t(){this.cPos=new Vector2D(150,100)}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.init=function(t){var e=this;this.canvas2D=t,this.fps=new FpsMc,this.canvasUi=this.canvas2D.getContext("2d"),setInterval(function(){e.upData()},1e3/60)},t.prototype.upData=function(){if(!t.showFps)return this.canvasUi.clearRect(0,0,this.canvas2D.width,this.canvas2D.height),void 0;this.canvasUi.font="40px Georgia";var e=this.canvasUi.measureText(this.fps.getStr()).width;this.canvas2D.width=e,this.canvas2D.height=30,this.canvasUi.clearRect(0,0,this.canvas2D.width,this.canvas2D.height),this.fps.drawNum++,this.canvasUi.fillStyle="#000000",this.canvasUi.fillRect(0,0,this.canvas2D.width,this.canvas2D.height),this.canvasUi.font="30px Georgia",this.canvasUi.fillStyle="#ffffff",this.canvasUi.textBaseline=TextAlign.TOP,this.canvasUi.textAlign=TextAlign.LEFT,this.canvasUi.fillText(this.fps.getStr(),0,0),this.makeXyzLine()},t.prototype.makeXyzLine=function(){var t=new Vector3D(80,0,0),e=new Vector3D(0,70,0),i=new Vector3D(0,0,80),n=new Matrix3D;n.appendRotation(Scene_data.cam3D.rotationY,Vector3D.Y_AXIS),n.appendRotation(Scene_data.cam3D.rotationX,Vector3D.X_AXIS),t=n.transformVector(t),e=n.transformVector(e),i=n.transformVector(i),this.drawLine(new Vector2D(0,0),new Vector2D(t.x,-t.y),"#ff0000"),this.drawLine(new Vector2D(0,0),new Vector2D(e.x,-e.y),"#00ff00"),this.drawLine(new Vector2D(0,0),new Vector2D(i.x,-i.y),"#0000ff"),this.canvasUi.font="12px Georgia",this.canvasUi.fillStyle="#ff0000",this.canvasUi.fillText("x",t.x+this.cPos.x,-t.y+this.cPos.y),this.canvasUi.fillStyle="#00ff00",this.canvasUi.fillText("y",e.x+this.cPos.x,-e.y+this.cPos.y),this.canvasUi.fillStyle="#0000ff",this.canvasUi.fillText("z",i.x+this.cPos.x,-i.y+this.cPos.y)},t.prototype.drawLine=function(t,e,i){void 0===i&&(i="red"),this.canvasUi.beginPath(),this.canvasUi.lineWidth=2,this.canvasUi.strokeStyle=i,this.canvasUi.moveTo(t.x+this.cPos.x,t.y+this.cPos.y),this.canvasUi.lineTo(e.x+this.cPos.x,e.y+this.cPos.y),this.canvasUi.stroke()},t.prototype.resetSize=function(){this.cPos=new Vector2D(150,Scene_data.stageHeight-100)},t.showFps=!1,t}();